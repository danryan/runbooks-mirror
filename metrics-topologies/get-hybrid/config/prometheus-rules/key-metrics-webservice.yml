# WARNING. DO NOT EDIT THIS FILE BY HAND. USE /Users/andrewn/code/gitlab/runbooks/metrics-topologies/get-hybrid/source/generate.jsonnet TO GENERATE IT. YOUR CHANGES WILL BE OVERRIDDEN
groups:
- interval: 1m
  name: 'Component-Level SLIs: webservice - 5m burn-rate'
  rules:
  - expr: |
      sum by (environment,job,shard,stage,status,tier,type) (
        rate(http_requests_total[5m])
      )
    record: sli_aggregations:http_requests_total_rate5m
  - expr: |
      (
        sum by () (
          rate(http_request_duration_seconds_bucket{job="gitlab-rails",le="1"}[5m])
        )
        +
        sum by () (
          rate(http_request_duration_seconds_bucket{job="gitlab-rails",le="10"}[5m])
        )
      )
      /
      2
    labels:
      component: puma
      tier: app
      type: webservice
    record: gitlab_component_apdex:success:rate_5m
  - expr: |
      sum by () (
        rate(http_request_duration_seconds_bucket{job="gitlab-rails",le="+Inf"}[5m])
      )
    labels:
      component: puma
      tier: app
      type: webservice
    record: gitlab_component_apdex:weight:score_5m
  - expr: |
      sum by () (
        sli_aggregations:http_requests_total_rate5m{job="gitlab-rails"}
      )
    labels:
      component: puma
      tier: app
      type: webservice
    record: gitlab_component_ops:rate_5m
  - expr: |
      (
        sum by () (
          sli_aggregations:http_requests_total_rate5m{job="gitlab-rails",status=~"5.."}
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_5m{component="puma",tier="app",type="webservice"}
        )
      )
    labels:
      component: puma
      tier: app
      type: webservice
    record: gitlab_component_errors:rate_5m
- interval: 2m
  name: 'Component-Level SLIs: webservice - 30m burn-rate'
  rules:
  - expr: |
      sum by (environment,job,shard,stage,status,tier,type) (
        rate(http_requests_total[30m])
      )
    record: sli_aggregations:http_requests_total_rate30m
  - expr: |
      (
        sum by () (
          rate(http_request_duration_seconds_bucket{job="gitlab-rails",le="1"}[30m])
        )
        +
        sum by () (
          rate(http_request_duration_seconds_bucket{job="gitlab-rails",le="10"}[30m])
        )
      )
      /
      2
    labels:
      component: puma
      tier: app
      type: webservice
    record: gitlab_component_apdex:success:rate_30m
  - expr: |
      sum by () (
        rate(http_request_duration_seconds_bucket{job="gitlab-rails",le="+Inf"}[30m])
      )
    labels:
      component: puma
      tier: app
      type: webservice
    record: gitlab_component_apdex:weight:score_30m
  - expr: |
      sum by () (
        sli_aggregations:http_requests_total_rate30m{job="gitlab-rails"}
      )
    labels:
      component: puma
      tier: app
      type: webservice
    record: gitlab_component_ops:rate_30m
  - expr: |
      (
        sum by () (
          sli_aggregations:http_requests_total_rate30m{job="gitlab-rails",status=~"5.."}
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_30m{component="puma",tier="app",type="webservice"}
        )
      )
    labels:
      component: puma
      tier: app
      type: webservice
    record: gitlab_component_errors:rate_30m
- interval: 1m
  name: 'Component-Level SLIs: webservice - 1h burn-rate'
  rules:
  - expr: |
      sum by (environment,job,shard,stage,status,tier,type) (
        rate(http_requests_total[1h])
      )
    record: sli_aggregations:http_requests_total_rate1h
  - expr: |
      (
        sum by () (
          rate(http_request_duration_seconds_bucket{job="gitlab-rails",le="1"}[1h])
        )
        +
        sum by () (
          rate(http_request_duration_seconds_bucket{job="gitlab-rails",le="10"}[1h])
        )
      )
      /
      2
    labels:
      component: puma
      tier: app
      type: webservice
    record: gitlab_component_apdex:success:rate_1h
  - expr: |
      sum by () (
        rate(http_request_duration_seconds_bucket{job="gitlab-rails",le="+Inf"}[1h])
      )
    labels:
      component: puma
      tier: app
      type: webservice
    record: gitlab_component_apdex:weight:score_1h
  - expr: |
      sum by () (
        sli_aggregations:http_requests_total_rate1h{job="gitlab-rails"}
      )
    labels:
      component: puma
      tier: app
      type: webservice
    record: gitlab_component_ops:rate_1h
  - expr: |
      (
        sum by () (
          sli_aggregations:http_requests_total_rate1h{job="gitlab-rails",status=~"5.."}
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_1h{component="puma",tier="app",type="webservice"}
        )
      )
    labels:
      component: puma
      tier: app
      type: webservice
    record: gitlab_component_errors:rate_1h
- interval: 2m
  name: 'Component-Level SLIs: webservice - 6h burn-rate'
  rules:
  - expr: |
      sum by (environment,job,shard,stage,status,tier,type) (
        rate(http_requests_total[6h])
      )
    record: sli_aggregations:http_requests_total_rate6h
  - expr: |
      (
        sum by () (
          rate(http_request_duration_seconds_bucket{job="gitlab-rails",le="1"}[6h])
        )
        +
        sum by () (
          rate(http_request_duration_seconds_bucket{job="gitlab-rails",le="10"}[6h])
        )
      )
      /
      2
    labels:
      component: puma
      tier: app
      type: webservice
    record: gitlab_component_apdex:success:rate_6h
  - expr: |
      sum by () (
        rate(http_request_duration_seconds_bucket{job="gitlab-rails",le="+Inf"}[6h])
      )
    labels:
      component: puma
      tier: app
      type: webservice
    record: gitlab_component_apdex:weight:score_6h
  - expr: |
      sum by () (
        sli_aggregations:http_requests_total_rate6h{job="gitlab-rails"}
      )
    labels:
      component: puma
      tier: app
      type: webservice
    record: gitlab_component_ops:rate_6h
  - expr: |
      (
        sum by () (
          sli_aggregations:http_requests_total_rate6h{job="gitlab-rails",status=~"5.."}
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_6h{component="puma",tier="app",type="webservice"}
        )
      )
    labels:
      component: puma
      tier: app
      type: webservice
    record: gitlab_component_errors:rate_6h
- interval: 1m
  name: 'Component-Level SLIs: webservice - 3d burn-rate'
  rules: []
- interval: 1m
  name: 'Component mapping: webservice'
  rules:
  - expr: "1"
    labels:
      component: puma
      regional_aggregation: "no"
      service_aggregation: "yes"
      tier: app
      type: webservice
    record: gitlab_component_service:mapping
