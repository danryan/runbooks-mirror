# WARNING. DO NOT EDIT THIS FILE BY HAND. RUN ./scripts/generate-reference-architecture-configs.sh TO GENERATE IT. YOUR CHANGES WILL BE OVERRIDDEN
groups:
- interval: 1m
  name: 'Component-Level SLIs: sidekiq - 5m burn-rate'
  rules:
  - expr: |
      sum by (environment,feature_category,le,queue,shard,stage,tier,type,urgency,worker) (
        rate(sidekiq_jobs_completion_seconds_bucket[5m])
      )
    record: sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate5m
  - expr: |
      sum by (environment,feature_category,le,queue,shard,stage,tier,type,urgency,worker) (
        rate(sidekiq_jobs_queue_duration_seconds_bucket[5m])
      )
    record: sli_aggregations:sidekiq_jobs_queue_duration_seconds_bucket_rate5m
  - expr: |
      sum by (environment,feature_category,queue,shard,stage,tier,type,urgency,worker) (
        rate(sidekiq_jobs_failed_total[5m])
      )
    record: sli_aggregations:sidekiq_jobs_failed_total_rate5m
  - expr: |
      sum by () (
        rate(sidekiq_jobs_completion_seconds_count{worker=~"EmailReceiverWorker|ServiceDeskEmailReceiverWorker"}[5m])
      )
    labels:
      component: email_receiver
      tier: sv
      type: sidekiq
    record: gitlab_component_ops:rate_5m
  - expr: |
      (
        sum by () (
          rate(gitlab_transaction_event_email_receiver_error_total{error!="Gitlab::Email::AutoGeneratedEmailError"}[5m])
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_5m{component="email_receiver",tier="sv",type="sidekiq"}
        )
      )
    labels:
      component: email_receiver
      tier: sv
      type: sidekiq
    record: gitlab_component_errors:rate_5m
  - expr: |
      sum by () (
        label_replace(sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate5m{le="10",shard="catchall",urgency="high"}, "_c", "0", "", "")
        or
        label_replace(sli_aggregations:sidekiq_jobs_queue_duration_seconds_bucket_rate5m{le="10",shard="catchall",urgency="high"}, "_c", "1", "", "")
        or
        label_replace(sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate5m{le="300",shard="catchall",urgency="low"}, "_c", "2", "", "")
        or
        label_replace(sli_aggregations:sidekiq_jobs_queue_duration_seconds_bucket_rate5m{le="60",shard="catchall",urgency="low"}, "_c", "3", "", "")
        or
        label_replace(sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate5m{le="300",shard="catchall",urgency="throttled"}, "_c", "4", "", "")
        or
        label_replace(sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate5m{le="300",shard="catchall",urgency=""}, "_c", "5", "", "")
        or
        label_replace(sli_aggregations:sidekiq_jobs_queue_duration_seconds_bucket_rate5m{le="60",shard="catchall",urgency=""}, "_c", "6", "", "")
      )
    labels:
      component: shard_catchall
      tier: sv
      type: sidekiq
    record: gitlab_component_apdex:success:rate_5m
  - expr: |
      sum by () (
        label_replace(sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate5m{le="+Inf",shard="catchall",urgency="high"}, "_c", "0", "", "")
        or
        label_replace(sli_aggregations:sidekiq_jobs_queue_duration_seconds_bucket_rate5m{le="+Inf",shard="catchall",urgency="high"}, "_c", "1", "", "")
        or
        label_replace(sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate5m{le="+Inf",shard="catchall",urgency="low"}, "_c", "2", "", "")
        or
        label_replace(sli_aggregations:sidekiq_jobs_queue_duration_seconds_bucket_rate5m{le="+Inf",shard="catchall",urgency="low"}, "_c", "3", "", "")
        or
        label_replace(sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate5m{le="+Inf",shard="catchall",urgency="throttled"}, "_c", "4", "", "")
        or
        label_replace(sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate5m{le="+Inf",shard="catchall",urgency=""}, "_c", "5", "", "")
        or
        label_replace(sli_aggregations:sidekiq_jobs_queue_duration_seconds_bucket_rate5m{le="+Inf",shard="catchall",urgency=""}, "_c", "6", "", "")
      )
    labels:
      component: shard_catchall
      tier: sv
      type: sidekiq
    record: gitlab_component_apdex:weight:score_5m
  - expr: |
      sum by () (
        sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate5m{le="+Inf",shard="catchall"}
      )
    labels:
      component: shard_catchall
      tier: sv
      type: sidekiq
    record: gitlab_component_ops:rate_5m
  - expr: |
      (
        sum by () (
          sli_aggregations:sidekiq_jobs_failed_total_rate5m{shard="catchall"}
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_5m{component="shard_catchall",tier="sv",type="sidekiq"}
        )
      )
    labels:
      component: shard_catchall
      tier: sv
      type: sidekiq
    record: gitlab_component_errors:rate_5m
  - expr: |
      sum by (environment,tier,type,stage,shard,queue,feature_category,urgency,worker) (
        label_replace(sli_aggregations:sidekiq_jobs_queue_duration_seconds_bucket_rate5m{le="10",urgency="high"}, "_c", "0", "", "")
        or
        label_replace(sli_aggregations:sidekiq_jobs_queue_duration_seconds_bucket_rate5m{le="60",urgency="low"}, "_c", "1", "", "")
      )
    record: gitlab_background_jobs:queue:apdex:success:rate_5m
  - expr: |
      sum by (environment,tier,type,stage,shard,queue,feature_category,urgency,worker) (
        label_replace(sli_aggregations:sidekiq_jobs_queue_duration_seconds_bucket_rate5m{le="+Inf",urgency="high"}, "_c", "0", "", "")
        or
        label_replace(sli_aggregations:sidekiq_jobs_queue_duration_seconds_bucket_rate5m{le="+Inf",urgency="low"}, "_c", "1", "", "")
      )
    record: gitlab_background_jobs:queue:apdex:weight:score_5m
  - expr: |
      sum by (environment,tier,type,stage,shard,queue,feature_category,urgency,worker) (
        rate(sidekiq_enqueued_jobs_total{}[5m])
      )
    record: gitlab_background_jobs:queue:ops:rate_5m
  - expr: |
      sum by (environment,tier,type,stage,shard,queue,feature_category,urgency,worker) (
        label_replace(sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate5m{le="10",urgency="high"}, "_c", "0", "", "")
        or
        label_replace(sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate5m{le="300",urgency="low"}, "_c", "1", "", "")
        or
        label_replace(sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate5m{le="300",urgency="throttled"}, "_c", "2", "", "")
      )
    record: gitlab_background_jobs:execution:apdex:success:rate_5m
  - expr: |
      sum by (environment,tier,type,stage,shard,queue,feature_category,urgency,worker) (
        label_replace(sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate5m{le="+Inf",urgency="high"}, "_c", "0", "", "")
        or
        label_replace(sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate5m{le="+Inf",urgency="low"}, "_c", "1", "", "")
        or
        label_replace(sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate5m{le="+Inf",urgency="throttled"}, "_c", "2", "", "")
      )
    record: gitlab_background_jobs:execution:apdex:weight:score_5m
  - expr: |
      sum by (environment,tier,type,stage,shard,queue,feature_category,urgency,worker) (
        sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate5m{le="+Inf"}
      )
    record: gitlab_background_jobs:execution:ops:rate_5m
  - expr: |
      sum by (environment,tier,type,stage,shard,queue,feature_category,urgency,worker) (
        sli_aggregations:sidekiq_jobs_failed_total_rate5m{}
      )
      or
      (
        0 * group by (environment,tier,type,stage,shard,queue,feature_category,urgency,worker) (
          gitlab_background_jobs:execution:ops:rate_5m{}
        )
      )
    record: gitlab_background_jobs:execution:error:rate_5m
- interval: 2m
  name: 'Component-Level SLIs: sidekiq - 30m burn-rate'
  rules:
  - expr: |
      sum by (environment,feature_category,le,queue,shard,stage,tier,type,urgency,worker) (
        rate(sidekiq_jobs_completion_seconds_bucket[30m])
      )
    record: sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate30m
  - expr: |
      sum by (environment,feature_category,le,queue,shard,stage,tier,type,urgency,worker) (
        rate(sidekiq_jobs_queue_duration_seconds_bucket[30m])
      )
    record: sli_aggregations:sidekiq_jobs_queue_duration_seconds_bucket_rate30m
  - expr: |
      sum by (environment,feature_category,queue,shard,stage,tier,type,urgency,worker) (
        rate(sidekiq_jobs_failed_total[30m])
      )
    record: sli_aggregations:sidekiq_jobs_failed_total_rate30m
  - expr: |
      sum by () (
        rate(sidekiq_jobs_completion_seconds_count{worker=~"EmailReceiverWorker|ServiceDeskEmailReceiverWorker"}[30m])
      )
    labels:
      component: email_receiver
      tier: sv
      type: sidekiq
    record: gitlab_component_ops:rate_30m
  - expr: |
      (
        sum by () (
          rate(gitlab_transaction_event_email_receiver_error_total{error!="Gitlab::Email::AutoGeneratedEmailError"}[30m])
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_30m{component="email_receiver",tier="sv",type="sidekiq"}
        )
      )
    labels:
      component: email_receiver
      tier: sv
      type: sidekiq
    record: gitlab_component_errors:rate_30m
  - expr: |
      sum by () (
        label_replace(sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate30m{le="10",shard="catchall",urgency="high"}, "_c", "0", "", "")
        or
        label_replace(sli_aggregations:sidekiq_jobs_queue_duration_seconds_bucket_rate30m{le="10",shard="catchall",urgency="high"}, "_c", "1", "", "")
        or
        label_replace(sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate30m{le="300",shard="catchall",urgency="low"}, "_c", "2", "", "")
        or
        label_replace(sli_aggregations:sidekiq_jobs_queue_duration_seconds_bucket_rate30m{le="60",shard="catchall",urgency="low"}, "_c", "3", "", "")
        or
        label_replace(sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate30m{le="300",shard="catchall",urgency="throttled"}, "_c", "4", "", "")
        or
        label_replace(sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate30m{le="300",shard="catchall",urgency=""}, "_c", "5", "", "")
        or
        label_replace(sli_aggregations:sidekiq_jobs_queue_duration_seconds_bucket_rate30m{le="60",shard="catchall",urgency=""}, "_c", "6", "", "")
      )
    labels:
      component: shard_catchall
      tier: sv
      type: sidekiq
    record: gitlab_component_apdex:success:rate_30m
  - expr: |
      sum by () (
        label_replace(sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate30m{le="+Inf",shard="catchall",urgency="high"}, "_c", "0", "", "")
        or
        label_replace(sli_aggregations:sidekiq_jobs_queue_duration_seconds_bucket_rate30m{le="+Inf",shard="catchall",urgency="high"}, "_c", "1", "", "")
        or
        label_replace(sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate30m{le="+Inf",shard="catchall",urgency="low"}, "_c", "2", "", "")
        or
        label_replace(sli_aggregations:sidekiq_jobs_queue_duration_seconds_bucket_rate30m{le="+Inf",shard="catchall",urgency="low"}, "_c", "3", "", "")
        or
        label_replace(sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate30m{le="+Inf",shard="catchall",urgency="throttled"}, "_c", "4", "", "")
        or
        label_replace(sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate30m{le="+Inf",shard="catchall",urgency=""}, "_c", "5", "", "")
        or
        label_replace(sli_aggregations:sidekiq_jobs_queue_duration_seconds_bucket_rate30m{le="+Inf",shard="catchall",urgency=""}, "_c", "6", "", "")
      )
    labels:
      component: shard_catchall
      tier: sv
      type: sidekiq
    record: gitlab_component_apdex:weight:score_30m
  - expr: |
      sum by () (
        sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate30m{le="+Inf",shard="catchall"}
      )
    labels:
      component: shard_catchall
      tier: sv
      type: sidekiq
    record: gitlab_component_ops:rate_30m
  - expr: |
      (
        sum by () (
          sli_aggregations:sidekiq_jobs_failed_total_rate30m{shard="catchall"}
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_30m{component="shard_catchall",tier="sv",type="sidekiq"}
        )
      )
    labels:
      component: shard_catchall
      tier: sv
      type: sidekiq
    record: gitlab_component_errors:rate_30m
  - expr: |
      sum by (environment,tier,type,stage,shard,queue,feature_category,urgency,worker) (
        label_replace(sli_aggregations:sidekiq_jobs_queue_duration_seconds_bucket_rate30m{le="10",urgency="high"}, "_c", "0", "", "")
        or
        label_replace(sli_aggregations:sidekiq_jobs_queue_duration_seconds_bucket_rate30m{le="60",urgency="low"}, "_c", "1", "", "")
      )
    record: gitlab_background_jobs:queue:apdex:success:rate_30m
  - expr: |
      sum by (environment,tier,type,stage,shard,queue,feature_category,urgency,worker) (
        label_replace(sli_aggregations:sidekiq_jobs_queue_duration_seconds_bucket_rate30m{le="+Inf",urgency="high"}, "_c", "0", "", "")
        or
        label_replace(sli_aggregations:sidekiq_jobs_queue_duration_seconds_bucket_rate30m{le="+Inf",urgency="low"}, "_c", "1", "", "")
      )
    record: gitlab_background_jobs:queue:apdex:weight:score_30m
  - expr: |
      sum by (environment,tier,type,stage,shard,queue,feature_category,urgency,worker) (
        rate(sidekiq_enqueued_jobs_total{}[30m])
      )
    record: gitlab_background_jobs:queue:ops:rate_30m
  - expr: |
      sum by (environment,tier,type,stage,shard,queue,feature_category,urgency,worker) (
        label_replace(sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate30m{le="10",urgency="high"}, "_c", "0", "", "")
        or
        label_replace(sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate30m{le="300",urgency="low"}, "_c", "1", "", "")
        or
        label_replace(sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate30m{le="300",urgency="throttled"}, "_c", "2", "", "")
      )
    record: gitlab_background_jobs:execution:apdex:success:rate_30m
  - expr: |
      sum by (environment,tier,type,stage,shard,queue,feature_category,urgency,worker) (
        label_replace(sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate30m{le="+Inf",urgency="high"}, "_c", "0", "", "")
        or
        label_replace(sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate30m{le="+Inf",urgency="low"}, "_c", "1", "", "")
        or
        label_replace(sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate30m{le="+Inf",urgency="throttled"}, "_c", "2", "", "")
      )
    record: gitlab_background_jobs:execution:apdex:weight:score_30m
  - expr: |
      sum by (environment,tier,type,stage,shard,queue,feature_category,urgency,worker) (
        sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate30m{le="+Inf"}
      )
    record: gitlab_background_jobs:execution:ops:rate_30m
  - expr: |
      sum by (environment,tier,type,stage,shard,queue,feature_category,urgency,worker) (
        sli_aggregations:sidekiq_jobs_failed_total_rate30m{}
      )
      or
      (
        0 * group by (environment,tier,type,stage,shard,queue,feature_category,urgency,worker) (
          gitlab_background_jobs:execution:ops:rate_30m{}
        )
      )
    record: gitlab_background_jobs:execution:error:rate_30m
- interval: 1m
  name: 'Component-Level SLIs: sidekiq - 1h burn-rate'
  rules:
  - expr: |
      sum by (environment,feature_category,le,queue,shard,stage,tier,type,urgency,worker) (
        rate(sidekiq_jobs_completion_seconds_bucket[1h])
      )
    record: sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate1h
  - expr: |
      sum by (environment,feature_category,le,queue,shard,stage,tier,type,urgency,worker) (
        rate(sidekiq_jobs_queue_duration_seconds_bucket[1h])
      )
    record: sli_aggregations:sidekiq_jobs_queue_duration_seconds_bucket_rate1h
  - expr: |
      sum by (environment,feature_category,queue,shard,stage,tier,type,urgency,worker) (
        rate(sidekiq_jobs_failed_total[1h])
      )
    record: sli_aggregations:sidekiq_jobs_failed_total_rate1h
  - expr: |
      sum by () (
        rate(sidekiq_jobs_completion_seconds_count{worker=~"EmailReceiverWorker|ServiceDeskEmailReceiverWorker"}[1h])
      )
    labels:
      component: email_receiver
      tier: sv
      type: sidekiq
    record: gitlab_component_ops:rate_1h
  - expr: |
      (
        sum by () (
          rate(gitlab_transaction_event_email_receiver_error_total{error!="Gitlab::Email::AutoGeneratedEmailError"}[1h])
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_1h{component="email_receiver",tier="sv",type="sidekiq"}
        )
      )
    labels:
      component: email_receiver
      tier: sv
      type: sidekiq
    record: gitlab_component_errors:rate_1h
  - expr: |
      sum by () (
        label_replace(sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate1h{le="10",shard="catchall",urgency="high"}, "_c", "0", "", "")
        or
        label_replace(sli_aggregations:sidekiq_jobs_queue_duration_seconds_bucket_rate1h{le="10",shard="catchall",urgency="high"}, "_c", "1", "", "")
        or
        label_replace(sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate1h{le="300",shard="catchall",urgency="low"}, "_c", "2", "", "")
        or
        label_replace(sli_aggregations:sidekiq_jobs_queue_duration_seconds_bucket_rate1h{le="60",shard="catchall",urgency="low"}, "_c", "3", "", "")
        or
        label_replace(sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate1h{le="300",shard="catchall",urgency="throttled"}, "_c", "4", "", "")
        or
        label_replace(sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate1h{le="300",shard="catchall",urgency=""}, "_c", "5", "", "")
        or
        label_replace(sli_aggregations:sidekiq_jobs_queue_duration_seconds_bucket_rate1h{le="60",shard="catchall",urgency=""}, "_c", "6", "", "")
      )
    labels:
      component: shard_catchall
      tier: sv
      type: sidekiq
      upscale_source: "yes"
    record: gitlab_component_apdex:success:rate_1h
  - expr: |
      sum by () (
        label_replace(sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate1h{le="+Inf",shard="catchall",urgency="high"}, "_c", "0", "", "")
        or
        label_replace(sli_aggregations:sidekiq_jobs_queue_duration_seconds_bucket_rate1h{le="+Inf",shard="catchall",urgency="high"}, "_c", "1", "", "")
        or
        label_replace(sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate1h{le="+Inf",shard="catchall",urgency="low"}, "_c", "2", "", "")
        or
        label_replace(sli_aggregations:sidekiq_jobs_queue_duration_seconds_bucket_rate1h{le="+Inf",shard="catchall",urgency="low"}, "_c", "3", "", "")
        or
        label_replace(sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate1h{le="+Inf",shard="catchall",urgency="throttled"}, "_c", "4", "", "")
        or
        label_replace(sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate1h{le="+Inf",shard="catchall",urgency=""}, "_c", "5", "", "")
        or
        label_replace(sli_aggregations:sidekiq_jobs_queue_duration_seconds_bucket_rate1h{le="+Inf",shard="catchall",urgency=""}, "_c", "6", "", "")
      )
    labels:
      component: shard_catchall
      tier: sv
      type: sidekiq
      upscale_source: "yes"
    record: gitlab_component_apdex:weight:score_1h
  - expr: |
      sum by () (
        sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate1h{le="+Inf",shard="catchall"}
      )
    labels:
      component: shard_catchall
      tier: sv
      type: sidekiq
      upscale_source: "yes"
    record: gitlab_component_ops:rate_1h
  - expr: |
      (
        sum by () (
          sli_aggregations:sidekiq_jobs_failed_total_rate1h{shard="catchall"}
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_1h{component="shard_catchall",tier="sv",type="sidekiq",upscale_source="yes"}
        )
      )
    labels:
      component: shard_catchall
      tier: sv
      type: sidekiq
      upscale_source: "yes"
    record: gitlab_component_errors:rate_1h
  - expr: |
      sum by (environment,tier,type,stage,shard,queue,feature_category,urgency,worker) (
        label_replace(sli_aggregations:sidekiq_jobs_queue_duration_seconds_bucket_rate1h{le="10",urgency="high"}, "_c", "0", "", "")
        or
        label_replace(sli_aggregations:sidekiq_jobs_queue_duration_seconds_bucket_rate1h{le="60",urgency="low"}, "_c", "1", "", "")
      )
    record: gitlab_background_jobs:queue:apdex:success:rate_1h
  - expr: |
      sum by (environment,tier,type,stage,shard,queue,feature_category,urgency,worker) (
        label_replace(sli_aggregations:sidekiq_jobs_queue_duration_seconds_bucket_rate1h{le="+Inf",urgency="high"}, "_c", "0", "", "")
        or
        label_replace(sli_aggregations:sidekiq_jobs_queue_duration_seconds_bucket_rate1h{le="+Inf",urgency="low"}, "_c", "1", "", "")
      )
    record: gitlab_background_jobs:queue:apdex:weight:score_1h
  - expr: |
      sum by (environment,tier,type,stage,shard,queue,feature_category,urgency,worker) (
        rate(sidekiq_enqueued_jobs_total{}[1h])
      )
    record: gitlab_background_jobs:queue:ops:rate_1h
  - expr: |
      sum by (environment,tier,type,stage,shard,queue,feature_category,urgency,worker) (
        label_replace(sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate1h{le="10",urgency="high"}, "_c", "0", "", "")
        or
        label_replace(sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate1h{le="300",urgency="low"}, "_c", "1", "", "")
        or
        label_replace(sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate1h{le="300",urgency="throttled"}, "_c", "2", "", "")
      )
    record: gitlab_background_jobs:execution:apdex:success:rate_1h
  - expr: |
      sum by (environment,tier,type,stage,shard,queue,feature_category,urgency,worker) (
        label_replace(sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate1h{le="+Inf",urgency="high"}, "_c", "0", "", "")
        or
        label_replace(sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate1h{le="+Inf",urgency="low"}, "_c", "1", "", "")
        or
        label_replace(sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate1h{le="+Inf",urgency="throttled"}, "_c", "2", "", "")
      )
    record: gitlab_background_jobs:execution:apdex:weight:score_1h
  - expr: |
      sum by (environment,tier,type,stage,shard,queue,feature_category,urgency,worker) (
        sli_aggregations:sidekiq_jobs_completion_seconds_bucket_rate1h{le="+Inf"}
      )
    record: gitlab_background_jobs:execution:ops:rate_1h
  - expr: |
      sum by (environment,tier,type,stage,shard,queue,feature_category,urgency,worker) (
        sli_aggregations:sidekiq_jobs_failed_total_rate1h{}
      )
      or
      (
        0 * group by (environment,tier,type,stage,shard,queue,feature_category,urgency,worker) (
          gitlab_background_jobs:execution:ops:rate_1h{}
        )
      )
    record: gitlab_background_jobs:execution:error:rate_1h
- interval: 2m
  name: 'Component-Level SLIs: sidekiq - 6h burn-rate'
  rules:
  - expr: |
      sum by () (
        rate(sidekiq_jobs_completion_seconds_count{worker=~"EmailReceiverWorker|ServiceDeskEmailReceiverWorker"}[6h])
      )
    labels:
      component: email_receiver
      tier: sv
      type: sidekiq
    record: gitlab_component_ops:rate_6h
  - expr: |
      (
        sum by () (
          rate(gitlab_transaction_event_email_receiver_error_total{error!="Gitlab::Email::AutoGeneratedEmailError"}[6h])
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_6h{component="email_receiver",tier="sv",type="sidekiq"}
        )
      )
    labels:
      component: email_receiver
      tier: sv
      type: sidekiq
    record: gitlab_component_errors:rate_6h
- interval: 1m
  name: 'Component mapping: sidekiq'
  rules:
  - expr: "1"
    labels:
      component: email_receiver
      regional_aggregation: "no"
      service_aggregation: "yes"
      tier: sv
      type: sidekiq
    record: gitlab_component_service:mapping
  - expr: "1"
    labels:
      component: shard_catchall
      regional_aggregation: "no"
      service_aggregation: "yes"
      tier: sv
      type: sidekiq
    record: gitlab_component_service:mapping
- interval: 1m
  name: Global Service-Aggregated Metrics (fast burn)
  rules:
  - expr: |
      sum by (type) (
        (gitlab_component_errors:rate_5m{} >= 0) and on(component, type) (gitlab_component_service:mapping{service_aggregation="yes"})
      )
    record: gitlab_service_errors:rate_5m
  - expr: |
      sum by (type) (
        (gitlab_component_ops:rate_5m{} >= 0) and on(component, type) (gitlab_component_service:mapping{service_aggregation="yes"})
      )
    record: gitlab_service_ops:rate_5m
  - expr: |
      sum by (type) (
        gitlab_service_errors:rate_5m{}
      )
      /
      sum by (type) (
        gitlab_service_ops:rate_5m{}
      )
    record: gitlab_service_errors:ratio_5m
  - expr: |
      sum by (type) (
        (gitlab_component_apdex:weight:score_5m{} >= 0) and on(component, type) (gitlab_component_service:mapping{service_aggregation="yes"})
      )
    record: gitlab_service_apdex:weight:score_5m
  - expr: |
      sum by (type) (
        (gitlab_component_apdex:success:rate_5m{} >= 0) and on(component, type) (gitlab_component_service:mapping{service_aggregation="yes"})
      )
    record: gitlab_service_apdex:success:rate_5m
  - expr: |
      sum by (type) (
        (gitlab_component_apdex:success:rate_5m{} >= 0) and on(component, type) (gitlab_component_service:mapping{service_aggregation="yes"})
      )
      /
      sum by (type) (
        (gitlab_component_apdex:weight:score_5m{} >= 0) and on(component, type) (gitlab_component_service:mapping{service_aggregation="yes"})
      )
    record: gitlab_service_apdex:ratio_5m
  - expr: |
      sum by (type) (
        (gitlab_component_errors:rate_1h{} >= 0) and on(component, type) (gitlab_component_service:mapping{service_aggregation="yes"})
      )
    record: gitlab_service_errors:rate_1h
  - expr: |
      sum by (type) (
        (gitlab_component_ops:rate_1h{} >= 0) and on(component, type) (gitlab_component_service:mapping{service_aggregation="yes"})
      )
    record: gitlab_service_ops:rate_1h
  - expr: |
      sum by (type) (
        gitlab_service_errors:rate_1h{}
      )
      /
      sum by (type) (
        gitlab_service_ops:rate_1h{}
      )
    record: gitlab_service_errors:ratio_1h
  - expr: |
      sum by (type) (
        (gitlab_component_apdex:weight:score_1h{} >= 0) and on(component, type) (gitlab_component_service:mapping{service_aggregation="yes"})
      )
    record: gitlab_service_apdex:weight:score_1h
  - expr: |
      sum by (type) (
        (gitlab_component_apdex:success:rate_1h{} >= 0) and on(component, type) (gitlab_component_service:mapping{service_aggregation="yes"})
      )
    record: gitlab_service_apdex:success:rate_1h
  - expr: |
      sum by (type) (
        (gitlab_component_apdex:success:rate_1h{} >= 0) and on(component, type) (gitlab_component_service:mapping{service_aggregation="yes"})
      )
      /
      sum by (type) (
        (gitlab_component_apdex:weight:score_1h{} >= 0) and on(component, type) (gitlab_component_service:mapping{service_aggregation="yes"})
      )
    record: gitlab_service_apdex:ratio_1h
- interval: 2m
  name: Global Service-Aggregated Metrics (slow burn)
  rules:
  - expr: |
      sum by (type) (
        (gitlab_component_errors:rate_30m{} >= 0) and on(component, type) (gitlab_component_service:mapping{service_aggregation="yes"})
      )
    record: gitlab_service_errors:rate_30m
  - expr: |
      sum by (type) (
        (gitlab_component_ops:rate_30m{} >= 0) and on(component, type) (gitlab_component_service:mapping{service_aggregation="yes"})
      )
    record: gitlab_service_ops:rate_30m
  - expr: |
      sum by (type) (
        gitlab_service_errors:rate_30m{}
      )
      /
      sum by (type) (
        gitlab_service_ops:rate_30m{}
      )
    record: gitlab_service_errors:ratio_30m
  - expr: |
      sum by (type) (
        (gitlab_component_apdex:weight:score_30m{} >= 0) and on(component, type) (gitlab_component_service:mapping{service_aggregation="yes"})
      )
    record: gitlab_service_apdex:weight:score_30m
  - expr: |
      sum by (type) (
        (gitlab_component_apdex:success:rate_30m{} >= 0) and on(component, type) (gitlab_component_service:mapping{service_aggregation="yes"})
      )
    record: gitlab_service_apdex:success:rate_30m
  - expr: |
      sum by (type) (
        (gitlab_component_apdex:success:rate_30m{} >= 0) and on(component, type) (gitlab_component_service:mapping{service_aggregation="yes"})
      )
      /
      sum by (type) (
        (gitlab_component_apdex:weight:score_30m{} >= 0) and on(component, type) (gitlab_component_service:mapping{service_aggregation="yes"})
      )
    record: gitlab_service_apdex:ratio_30m
  - expr: |
      (
        sum by (type) (
          (gitlab_component_errors:rate_6h{} >= 0) and on(component, type) (gitlab_component_service:mapping{service_aggregation="yes"})
        )
      )
      or
      (
        sum by (type) (
          avg_over_time(gitlab_component_errors:rate_1h{upscale_source="yes"}[6h]) and on(component, type) (gitlab_component_service:mapping{service_aggregation="yes"})
        )
      )
    record: gitlab_service_errors:rate_6h
  - expr: |
      (
        sum by (type) (
          (gitlab_component_ops:rate_6h{} >= 0) and on(component, type) (gitlab_component_service:mapping{service_aggregation="yes"})
        )
      )
      or
      (
        sum by (type) (
          avg_over_time(gitlab_component_ops:rate_1h{upscale_source="yes"}[6h]) and on(component, type) (gitlab_component_service:mapping{service_aggregation="yes"})
        )
      )
    record: gitlab_service_ops:rate_6h
  - expr: |
      (
        sum by (type) (
          gitlab_service_errors:rate_6h{}
        )
        /
        sum by (type) (
          gitlab_service_ops:rate_6h{}
        )
      )
      or
      (
        sum by (type) (
          sum_over_time(gitlab_component_errors:rate_1h{upscale_source="yes"}[6h]) and on(component, type) (gitlab_component_service:mapping{service_aggregation="yes"})
        )
        /
        sum by (type) (
          sum_over_time(gitlab_component_ops:rate_1h{upscale_source="yes"}[6h]) and on(component, type) (gitlab_component_service:mapping{service_aggregation="yes"})
        )
      )
    record: gitlab_service_errors:ratio_6h
  - expr: |
      (
        sum by (type) (
          (gitlab_component_apdex:weight:score_6h{} >= 0) and on(component, type) (gitlab_component_service:mapping{service_aggregation="yes"})
        )
      )
      or
      (
        sum by (type) (
          avg_over_time(gitlab_component_apdex:weight:score_1h{upscale_source="yes"}[6h]) and on(component, type) (gitlab_component_service:mapping{service_aggregation="yes"})
        )
      )
    record: gitlab_service_apdex:weight:score_6h
  - expr: |
      (
        sum by (type) (
          (gitlab_component_apdex:success:rate_6h{} >= 0) and on(component, type) (gitlab_component_service:mapping{service_aggregation="yes"})
        )
      )
      or
      (
        sum by (type) (
          avg_over_time(gitlab_component_apdex:success:rate_1h{upscale_source="yes"}[6h]) and on(component, type) (gitlab_component_service:mapping{service_aggregation="yes"})
        )
      )
    record: gitlab_service_apdex:success:rate_6h
  - expr: |
      (
        sum by (type) (
          (gitlab_component_apdex:success:rate_6h{} >= 0) and on(component, type) (gitlab_component_service:mapping{service_aggregation="yes"})
        )
        /
        sum by (type) (
          (gitlab_component_apdex:weight:score_6h{} >= 0) and on(component, type) (gitlab_component_service:mapping{service_aggregation="yes"})
        )
      )
      or
      (
        sum by (type) (
          sum_over_time(gitlab_component_apdex:success:rate_1h{upscale_source="yes"}[6h]) and on(component, type) (gitlab_component_service:mapping{service_aggregation="yes"})
        )
        /
        sum by (type) (
          sum_over_time(gitlab_component_apdex:weight:score_1h{upscale_source="yes"}[6h]) and on(component, type) (gitlab_component_service:mapping{service_aggregation="yes"})
        )
      )
    record: gitlab_service_apdex:ratio_6h
- interval: 1m
  name: Global Component SLI Metrics (fast burn)
  rules:
  - expr: |
      sum by (type,component) (
        gitlab_component_errors:rate_5m{}
      )
      /
      sum by (type,component) (
        gitlab_component_ops:rate_5m{}
      )
    record: gitlab_component_errors:ratio_5m
  - expr: |
      sum by (type,component) (
        gitlab_component_apdex:success:rate_5m{}
      )
      /
      sum by (type,component) (
        gitlab_component_apdex:weight:score_5m{}
      )
    record: gitlab_component_apdex:ratio_5m
  - expr: |
      sum by (type,component) (
        gitlab_component_errors:rate_1h{}
      )
      /
      sum by (type,component) (
        gitlab_component_ops:rate_1h{}
      )
    record: gitlab_component_errors:ratio_1h
  - expr: |
      sum by (type,component) (
        gitlab_component_apdex:success:rate_1h{}
      )
      /
      sum by (type,component) (
        gitlab_component_apdex:weight:score_1h{}
      )
    record: gitlab_component_apdex:ratio_1h
- interval: 2m
  name: Global Component SLI Metrics (slow burn)
  rules:
  - expr: |
      sum by (type,component) (
        gitlab_component_errors:rate_30m{}
      )
      /
      sum by (type,component) (
        gitlab_component_ops:rate_30m{}
      )
    record: gitlab_component_errors:ratio_30m
  - expr: |
      sum by (type,component) (
        gitlab_component_apdex:success:rate_30m{}
      )
      /
      sum by (type,component) (
        gitlab_component_apdex:weight:score_30m{}
      )
    record: gitlab_component_apdex:ratio_30m
  - expr: |
      sum by (type,component) (
        gitlab_component_errors:rate_6h{}
      )
      /
      sum by (type,component) (
        gitlab_component_ops:rate_6h{}
      )
    record: gitlab_component_errors:ratio_6h
  - expr: |
      sum by (type,component) (
        gitlab_component_apdex:success:rate_6h{}
      )
      /
      sum by (type,component) (
        gitlab_component_apdex:weight:score_6h{}
      )
    record: gitlab_component_apdex:ratio_6h
- interval: 5m
  name: Autogenerated Service SLOs
  rules:
  - expr: "0.995000"
    labels:
      tier: sv
      type: sidekiq
    record: slo:min:events:gitlab_service_apdex:ratio
  - expr: "0.005000"
    labels:
      tier: sv
      type: sidekiq
    record: slo:max:events:gitlab_service_errors:ratio
  - expr: "0.995000"
    labels:
      component: email_receiver
      tier: sv
      type: sidekiq
    record: slo:min:events:gitlab_service_apdex:ratio
  - expr: "0.300000"
    labels:
      component: email_receiver
      tier: sv
      type: sidekiq
    record: slo:max:events:gitlab_service_errors:ratio
  - expr: "0.995000"
    labels:
      component: shard_catchall
      tier: sv
      type: sidekiq
    record: slo:min:events:gitlab_service_apdex:ratio
  - expr: "0.005000"
    labels:
      component: shard_catchall
      tier: sv
      type: sidekiq
    record: slo:max:events:gitlab_service_errors:ratio
  - expr: "0.995000"
    labels:
      tier: sv
      type: sidekiq
    record: slo:min:deployment:gitlab_service_apdex:ratio
  - expr: "0.005000"
    labels:
      tier: sv
      type: sidekiq
    record: slo:max:deployment:gitlab_service_errors:ratio
- interval: 1m
  name: Saturation Rules (autogenerated)
  rules: []
- interval: 5m
  name: GitLab Component Saturation Max SLOs
  rules: []
- interval: 5m
  name: GitLab Component Saturation Metadata
  rules: []
- interval: 5m
  name: GitLab Component Saturation Statistics
  rules:
  - expr: quantile_over_time(0.95, gitlab_component_saturation:ratio{monitor="global"}[1w])
    record: gitlab_component_saturation:ratio_quantile95_1w
  - expr: quantile_over_time(0.99, gitlab_component_saturation:ratio{monitor="global"}[1w])
    record: gitlab_component_saturation:ratio_quantile99_1w
  - expr: quantile_over_time(0.95, gitlab_component_saturation:ratio{monitor="global"}[1h])
    record: gitlab_component_saturation:ratio_quantile95_1h
  - expr: quantile_over_time(0.99, gitlab_component_saturation:ratio{monitor="global"}[1h])
    record: gitlab_component_saturation:ratio_quantile99_1h
  - expr: avg_over_time(gitlab_component_saturation:ratio{monitor="global"}[1h])
    record: gitlab_component_saturation:ratio_avg_1h
- interval: 1m
  name: GitLab Saturation Alerts
  rules: []
- interval: 1m
  name: 'kube-state-metrics-recording-rules: sidekiq'
  rules:
  - expr: |
      group without(label_deployment) (
        label_replace(
          topk by(cluster,pod) (1, kube_pod_labels{label_type="sidekiq"}),
          "deployment", "$0", "label_deployment", ".*"
        )
      )
    labels:
      stage: catchall
      tier: sv
      type: sidekiq
    record: kube_pod_labels:labeled
  - expr: topk by(cluster,horizontalpodautoscaler) (1, kube_horizontalpodautoscaler_labels{label_type="sidekiq"})
    labels:
      tier: sv
      type: sidekiq
    record: kube_horizontalpodautoscaler_labels:labeled
  - expr: topk by(cluster,node) (1, kube_node_labels{label_type=~"catchall"})
    labels:
      stage: main
      tier: sv
      type: sidekiq
    record: kube_node_labels:labeled
  - expr: topk by(cluster,deployment) (1, kube_deployment_labels{label_type="sidekiq"})
    labels:
      tier: sv
      type: sidekiq
    record: kube_deployment_labels:labeled
- interval: 1m
  name: 'kube-state-metrics-recording-rules: enriched label recording rules'
  rules:
  - expr: |
      container_start_time_seconds{metrics_path="/metrics/cadvisor"}
      *
      on(cluster,pod) group_left(type,deployment)
      topk by (cluster,pod) (1, kube_pod_labels:labeled{type!=""})
    record: container_start_time_seconds:labeled
  - expr: |
      container_cpu_cfs_periods_total{metrics_path="/metrics/cadvisor"}
      *
      on(cluster,pod) group_left(type,deployment)
      topk by (cluster,pod) (1, kube_pod_labels:labeled{type!=""})
    record: container_cpu_cfs_periods_total:labeled
  - expr: |
      container_cpu_cfs_throttled_periods_total{metrics_path="/metrics/cadvisor"}
      *
      on(cluster,pod) group_left(type,deployment)
      topk by (cluster,pod) (1, kube_pod_labels:labeled{type!=""})
    record: container_cpu_cfs_throttled_periods_total:labeled
  - expr: |
      container_cpu_usage_seconds_total{metrics_path="/metrics/cadvisor"}
      *
      on(cluster,pod) group_left(type,deployment)
      topk by (cluster,pod) (1, kube_pod_labels:labeled{type!=""})
    record: container_cpu_usage_seconds_total:labeled
  - expr: |
      container_memory_cache{metrics_path="/metrics/cadvisor"}
      *
      on(cluster,pod) group_left(type,deployment)
      topk by (cluster,pod) (1, kube_pod_labels:labeled{type!=""})
    record: container_memory_cache:labeled
  - expr: |
      container_memory_swap{metrics_path="/metrics/cadvisor"}
      *
      on(cluster,pod) group_left(type,deployment)
      topk by (cluster,pod) (1, kube_pod_labels:labeled{type!=""})
    record: container_memory_swap:labeled
  - expr: |
      container_memory_usage_bytes{metrics_path="/metrics/cadvisor"}
      *
      on(cluster,pod) group_left(type,deployment)
      topk by (cluster,pod) (1, kube_pod_labels:labeled{type!=""})
    record: container_memory_usage_bytes:labeled
  - expr: |
      container_memory_working_set_bytes{metrics_path="/metrics/cadvisor"}
      *
      on(cluster,pod) group_left(type,deployment)
      topk by (cluster,pod) (1, kube_pod_labels:labeled{type!=""})
    record: container_memory_working_set_bytes:labeled
  - expr: |
      container_network_receive_bytes_total{metrics_path="/metrics/cadvisor"}
      *
      on(cluster,pod) group_left(type,deployment)
      topk by (cluster,pod) (1, kube_pod_labels:labeled{type!=""})
    record: container_network_receive_bytes_total:labeled
  - expr: |
      container_network_transmit_bytes_total{metrics_path="/metrics/cadvisor"}
      *
      on(cluster,pod) group_left(type,deployment)
      topk by (cluster,pod) (1, kube_pod_labels:labeled{type!=""})
    record: container_network_transmit_bytes_total:labeled
  - expr: |
      container_spec_cpu_period{metrics_path="/metrics/cadvisor"}
      *
      on(cluster,pod) group_left(type,deployment)
      topk by (cluster,pod) (1, kube_pod_labels:labeled{type!=""})
    record: container_spec_cpu_period:labeled
  - expr: |
      container_spec_cpu_quota{metrics_path="/metrics/cadvisor"}
      *
      on(cluster,pod) group_left(type,deployment)
      topk by (cluster,pod) (1, kube_pod_labels:labeled{type!=""})
    record: container_spec_cpu_quota:labeled
  - expr: |
      container_spec_cpu_shares{metrics_path="/metrics/cadvisor"}
      *
      on(cluster,pod) group_left(type,deployment)
      topk by (cluster,pod) (1, kube_pod_labels:labeled{type!=""})
    record: container_spec_cpu_shares:labeled
  - expr: |
      container_spec_memory_limit_bytes{metrics_path="/metrics/cadvisor"}
      *
      on(cluster,pod) group_left(type,deployment)
      topk by (cluster,pod) (1, kube_pod_labels:labeled{type!=""})
    record: container_spec_memory_limit_bytes:labeled
  - expr: |
      kube_pod_container_status_running
      *
      on(cluster,pod) group_left(type,deployment)
      topk by (cluster,pod) (1, kube_pod_labels:labeled{type!=""})
    record: kube_pod_container_status_running:labeled
  - expr: |
      kube_pod_container_resource_limits
      *
      on(cluster,pod) group_left(type,deployment)
      topk by (cluster,pod) (1, kube_pod_labels:labeled{type!=""})
    record: kube_pod_container_resource_limits:labeled
  - expr: |
      kube_pod_container_resource_requests
      *
      on(cluster,pod) group_left(type,deployment)
      topk by (cluster,pod) (1, kube_pod_labels:labeled{type!=""})
    record: kube_pod_container_resource_requests:labeled
  - expr: |
      kube_pod_container_status_last_terminated_reason
      *
      on(cluster,pod) group_left(type,deployment)
      topk by (cluster,pod) (1, kube_pod_labels:labeled{type!=""})
    record: kube_pod_container_status_last_terminated_reason:labeled
  - expr: |
      kube_pod_container_status_ready
      *
      on(cluster,pod) group_left(type,deployment)
      topk by (cluster,pod) (1, kube_pod_labels:labeled{type!=""})
    record: kube_pod_container_status_ready:labeled
  - expr: |
      kube_pod_container_status_restarts_total
      *
      on(cluster,pod) group_left(type,deployment)
      topk by (cluster,pod) (1, kube_pod_labels:labeled{type!=""})
    record: kube_pod_container_status_restarts_total:labeled
  - expr: |
      kube_pod_container_status_running
      *
      on(cluster,pod) group_left(type,deployment)
      topk by (cluster,pod) (1, kube_pod_labels:labeled{type!=""})
    record: kube_pod_container_status_running:labeled
  - expr: |
      kube_pod_container_status_terminated
      *
      on(cluster,pod) group_left(type,deployment)
      topk by (cluster,pod) (1, kube_pod_labels:labeled{type!=""})
    record: kube_pod_container_status_terminated:labeled
  - expr: |
      kube_pod_container_status_terminated_reason
      *
      on(cluster,pod) group_left(type,deployment)
      topk by (cluster,pod) (1, kube_pod_labels:labeled{type!=""})
    record: kube_pod_container_status_terminated_reason:labeled
  - expr: |
      kube_pod_container_status_waiting
      *
      on(cluster,pod) group_left(type,deployment)
      topk by (cluster,pod) (1, kube_pod_labels:labeled{type!=""})
    record: kube_pod_container_status_waiting:labeled
  - expr: |
      kube_pod_container_status_waiting_reason
      *
      on(cluster,pod) group_left(type,deployment)
      topk by (cluster,pod) (1, kube_pod_labels:labeled{type!=""})
    record: kube_pod_container_status_waiting_reason:labeled
  - expr: |
      kube_horizontalpodautoscaler_spec_target_metric
      *
      on(cluster,horizontalpodautoscaler) group_left(type)
      topk by (cluster,horizontalpodautoscaler) (1, kube_horizontalpodautoscaler_labels:labeled{type!=""})
    record: kube_horizontalpodautoscaler_spec_target_metric:labeled
  - expr: |
      kube_horizontalpodautoscaler_status_condition
      *
      on(cluster,horizontalpodautoscaler) group_left(type)
      topk by (cluster,horizontalpodautoscaler) (1, kube_horizontalpodautoscaler_labels:labeled{type!=""})
    record: kube_horizontalpodautoscaler_status_condition:labeled
  - expr: |
      kube_horizontalpodautoscaler_status_current_replicas
      *
      on(cluster,horizontalpodautoscaler) group_left(type)
      topk by (cluster,horizontalpodautoscaler) (1, kube_horizontalpodautoscaler_labels:labeled{type!=""})
    record: kube_horizontalpodautoscaler_status_current_replicas:labeled
  - expr: |
      kube_horizontalpodautoscaler_status_desired_replicas
      *
      on(cluster,horizontalpodautoscaler) group_left(type)
      topk by (cluster,horizontalpodautoscaler) (1, kube_horizontalpodautoscaler_labels:labeled{type!=""})
    record: kube_horizontalpodautoscaler_status_desired_replicas:labeled
  - expr: |
      kube_horizontalpodautoscaler_metadata_generation
      *
      on(cluster,horizontalpodautoscaler) group_left(type)
      topk by (cluster,horizontalpodautoscaler) (1, kube_horizontalpodautoscaler_labels:labeled{type!=""})
    record: kube_horizontalpodautoscaler_metadata_generation:labeled
  - expr: |
      kube_horizontalpodautoscaler_spec_max_replicas
      *
      on(cluster,horizontalpodautoscaler) group_left(type)
      topk by (cluster,horizontalpodautoscaler) (1, kube_horizontalpodautoscaler_labels:labeled{type!=""})
    record: kube_horizontalpodautoscaler_spec_max_replicas:labeled
  - expr: |
      kube_horizontalpodautoscaler_spec_min_replicas
      *
      on(cluster,horizontalpodautoscaler) group_left(type)
      topk by (cluster,horizontalpodautoscaler) (1, kube_horizontalpodautoscaler_labels:labeled{type!=""})
    record: kube_horizontalpodautoscaler_spec_min_replicas:labeled
  - expr: |
      kube_node_status_capacity
      *
      on(cluster,node) group_left(type)
      topk by (cluster,node) (1, kube_node_labels:labeled{type!=""})
    record: kube_node_status_capacity:labeled
  - expr: |
      kube_node_status_allocatable
      *
      on(cluster,node) group_left(type)
      topk by (cluster,node) (1, kube_node_labels:labeled{type!=""})
    record: kube_node_status_allocatable:labeled
  - expr: |
      kube_node_status_condition
      *
      on(cluster,node) group_left(type)
      topk by (cluster,node) (1, kube_node_labels:labeled{type!=""})
    record: kube_node_status_condition:labeled
  - expr: |
      node_schedstat_waiting_seconds_total
      *
      on(cluster,node) group_left(type)
      topk by (cluster,node) (1, kube_node_labels:labeled{type!=""})
    record: node_schedstat_waiting_seconds_total:labeled
  - expr: |
      node_cpu_seconds_total
      *
      on(cluster,node) group_left(type)
      topk by (cluster,node) (1, kube_node_labels:labeled{type!=""})
    record: node_cpu_seconds_total:labeled
  - expr: |
      node_network_transmit_bytes_total
      *
      on(cluster,node) group_left(type)
      topk by (cluster,node) (1, kube_node_labels:labeled{type!=""})
    record: node_network_transmit_bytes_total:labeled
  - expr: |
      node_network_receive_bytes_total
      *
      on(cluster,node) group_left(type)
      topk by (cluster,node) (1, kube_node_labels:labeled{type!=""})
    record: node_network_receive_bytes_total:labeled
  - expr: |
      node_disk_reads_completed_total
      *
      on(cluster,node) group_left(type)
      topk by (cluster,node) (1, kube_node_labels:labeled{type!=""})
    record: node_disk_reads_completed_total:labeled
  - expr: |
      node_disk_writes_completed_total
      *
      on(cluster,node) group_left(type)
      topk by (cluster,node) (1, kube_node_labels:labeled{type!=""})
    record: node_disk_writes_completed_total:labeled
  - expr: |
      node_disk_read_bytes_total
      *
      on(cluster,node) group_left(type)
      topk by (cluster,node) (1, kube_node_labels:labeled{type!=""})
    record: node_disk_read_bytes_total:labeled
  - expr: |
      node_disk_written_bytes_total
      *
      on(cluster,node) group_left(type)
      topk by (cluster,node) (1, kube_node_labels:labeled{type!=""})
    record: node_disk_written_bytes_total:labeled
  - expr: |
      node_disk_read_time_seconds_total
      *
      on(cluster,node) group_left(type)
      topk by (cluster,node) (1, kube_node_labels:labeled{type!=""})
    record: node_disk_read_time_seconds_total:labeled
  - expr: |
      node_disk_write_time_seconds_total
      *
      on(cluster,node) group_left(type)
      topk by (cluster,node) (1, kube_node_labels:labeled{type!=""})
    record: node_disk_write_time_seconds_total:labeled
  - expr: |
      node_load1
      *
      on(cluster,node) group_left(type)
      topk by (cluster,node) (1, kube_node_labels:labeled{type!=""})
    record: node_load1:labeled
  - expr: |
      node_load5
      *
      on(cluster,node) group_left(type)
      topk by (cluster,node) (1, kube_node_labels:labeled{type!=""})
    record: node_load5:labeled
  - expr: |
      node_load15
      *
      on(cluster,node) group_left(type)
      topk by (cluster,node) (1, kube_node_labels:labeled{type!=""})
    record: node_load15:labeled
  - expr: |
      node_vmstat_oom_kill
      *
      on(cluster,node) group_left(type)
      topk by (cluster,node) (1, kube_node_labels:labeled{type!=""})
    record: node_vmstat_oom_kill:labeled
  - expr: |
      nginx_ingress_controller_bytes_sent_count
      *
      on(cluster,ingress) group_left(type)
      topk by (cluster,ingress) (1, kube_ingress_labels:labeled{type!=""})
    record: nginx_ingress_controller_bytes_sent_count:labeled
  - expr: |
      nginx_ingress_controller_request_duration_seconds_bucket
      *
      on(cluster,ingress) group_left(type)
      topk by (cluster,ingress) (1, kube_ingress_labels:labeled{type!=""})
    record: nginx_ingress_controller_request_duration_seconds_bucket:labeled
  - expr: |
      nginx_ingress_controller_request_duration_seconds_sum
      *
      on(cluster,ingress) group_left(type)
      topk by (cluster,ingress) (1, kube_ingress_labels:labeled{type!=""})
    record: nginx_ingress_controller_request_duration_seconds_sum:labeled
  - expr: |
      nginx_ingress_controller_response_size_count
      *
      on(cluster,ingress) group_left(type)
      topk by (cluster,ingress) (1, kube_ingress_labels:labeled{type!=""})
    record: nginx_ingress_controller_response_size_count:labeled
  - expr: |
      nginx_ingress_controller_ingress_upstream_latency_seconds
      *
      on(cluster,ingress) group_left(type)
      topk by (cluster,ingress) (1, kube_ingress_labels:labeled{type!=""})
    record: nginx_ingress_controller_ingress_upstream_latency_seconds:labeled
  - expr: |
      nginx_ingress_controller_ingress_upstream_latency_seconds_count
      *
      on(cluster,ingress) group_left(type)
      topk by (cluster,ingress) (1, kube_ingress_labels:labeled{type!=""})
    record: nginx_ingress_controller_ingress_upstream_latency_seconds_count:labeled
  - expr: |
      nginx_ingress_controller_ingress_upstream_latency_seconds_sum
      *
      on(cluster,ingress) group_left(type)
      topk by (cluster,ingress) (1, kube_ingress_labels:labeled{type!=""})
    record: nginx_ingress_controller_ingress_upstream_latency_seconds_sum:labeled
  - expr: |
      nginx_ingress_controller_request_duration_seconds_count
      *
      on(cluster,ingress) group_left(type)
      topk by (cluster,ingress) (1, kube_ingress_labels:labeled{type!=""})
    record: nginx_ingress_controller_request_duration_seconds_count:labeled
  - expr: |
      nginx_ingress_controller_request_size_bucket
      *
      on(cluster,ingress) group_left(type)
      topk by (cluster,ingress) (1, kube_ingress_labels:labeled{type!=""})
    record: nginx_ingress_controller_request_size_bucket:labeled
  - expr: |
      nginx_ingress_controller_response_duration_seconds_bucket
      *
      on(cluster,ingress) group_left(type)
      topk by (cluster,ingress) (1, kube_ingress_labels:labeled{type!=""})
    record: nginx_ingress_controller_response_duration_seconds_bucket:labeled
  - expr: |
      nginx_ingress_controller_bytes_sent_bucket
      *
      on(cluster,ingress) group_left(type)
      topk by (cluster,ingress) (1, kube_ingress_labels:labeled{type!=""})
    record: nginx_ingress_controller_bytes_sent_bucket:labeled
  - expr: |
      nginx_ingress_controller_bytes_sent_sum
      *
      on(cluster,ingress) group_left(type)
      topk by (cluster,ingress) (1, kube_ingress_labels:labeled{type!=""})
    record: nginx_ingress_controller_bytes_sent_sum:labeled
  - expr: |
      nginx_ingress_controller_request_size_count
      *
      on(cluster,ingress) group_left(type)
      topk by (cluster,ingress) (1, kube_ingress_labels:labeled{type!=""})
    record: nginx_ingress_controller_request_size_count:labeled
  - expr: |
      nginx_ingress_controller_response_duration_seconds_sum
      *
      on(cluster,ingress) group_left(type)
      topk by (cluster,ingress) (1, kube_ingress_labels:labeled{type!=""})
    record: nginx_ingress_controller_response_duration_seconds_sum:labeled
  - expr: |
      nginx_ingress_controller_request_size_sum
      *
      on(cluster,ingress) group_left(type)
      topk by (cluster,ingress) (1, kube_ingress_labels:labeled{type!=""})
    record: nginx_ingress_controller_request_size_sum:labeled
  - expr: |
      nginx_ingress_controller_requests
      *
      on(cluster,ingress) group_left(type)
      topk by (cluster,ingress) (1, kube_ingress_labels:labeled{type!=""})
    record: nginx_ingress_controller_requests:labeled
  - expr: |
      nginx_ingress_controller_response_duration_seconds_count
      *
      on(cluster,ingress) group_left(type)
      topk by (cluster,ingress) (1, kube_ingress_labels:labeled{type!=""})
    record: nginx_ingress_controller_response_duration_seconds_count:labeled
  - expr: |
      nginx_ingress_controller_response_size_bucket
      *
      on(cluster,ingress) group_left(type)
      topk by (cluster,ingress) (1, kube_ingress_labels:labeled{type!=""})
    record: nginx_ingress_controller_response_size_bucket:labeled
  - expr: |
      nginx_ingress_controller_response_size_sum
      *
      on(cluster,ingress) group_left(type)
      topk by (cluster,ingress) (1, kube_ingress_labels:labeled{type!=""})
    record: nginx_ingress_controller_response_size_sum:labeled
  - expr: |
      kube_deployment_status_replicas_unavailable
      *
      on(cluster,deployment) group_left(type)
      topk by (cluster,deployment) (1, kube_deployment_labels:labeled{type!=""})
    record: kube_deployment_status_replicas_unavailable:labeled
  - expr: |
      kube_deployment_status_replicas_updated
      *
      on(cluster,deployment) group_left(type)
      topk by (cluster,deployment) (1, kube_deployment_labels:labeled{type!=""})
    record: kube_deployment_status_replicas_updated:labeled
  - expr: |
      kube_deployment_spec_paused
      *
      on(cluster,deployment) group_left(type)
      topk by (cluster,deployment) (1, kube_deployment_labels:labeled{type!=""})
    record: kube_deployment_spec_paused:labeled
  - expr: |
      kube_deployment_spec_replicas
      *
      on(cluster,deployment) group_left(type)
      topk by (cluster,deployment) (1, kube_deployment_labels:labeled{type!=""})
    record: kube_deployment_spec_replicas:labeled
  - expr: |
      kube_deployment_spec_strategy_rollingupdate_max_surge
      *
      on(cluster,deployment) group_left(type)
      topk by (cluster,deployment) (1, kube_deployment_labels:labeled{type!=""})
    record: kube_deployment_spec_strategy_rollingupdate_max_surge:labeled
  - expr: |
      kube_deployment_spec_strategy_rollingupdate_max_unavailable
      *
      on(cluster,deployment) group_left(type)
      topk by (cluster,deployment) (1, kube_deployment_labels:labeled{type!=""})
    record: kube_deployment_spec_strategy_rollingupdate_max_unavailable:labeled
  - expr: |
      kube_deployment_status_condition
      *
      on(cluster,deployment) group_left(type)
      topk by (cluster,deployment) (1, kube_deployment_labels:labeled{type!=""})
    record: kube_deployment_status_condition:labeled
  - expr: |
      kube_deployment_status_replicas_available
      *
      on(cluster,deployment) group_left(type)
      topk by (cluster,deployment) (1, kube_deployment_labels:labeled{type!=""})
    record: kube_deployment_status_replicas_available:labeled
  - expr: |
      kube_deployment_created
      *
      on(cluster,deployment) group_left(type)
      topk by (cluster,deployment) (1, kube_deployment_labels:labeled{type!=""})
    record: kube_deployment_created:labeled
  - expr: |
      kube_deployment_metadata_generation
      *
      on(cluster,deployment) group_left(type)
      topk by (cluster,deployment) (1, kube_deployment_labels:labeled{type!=""})
    record: kube_deployment_metadata_generation:labeled
  - expr: |
      kube_deployment_status_observed_generation
      *
      on(cluster,deployment) group_left(type)
      topk by (cluster,deployment) (1, kube_deployment_labels:labeled{type!=""})
    record: kube_deployment_status_observed_generation:labeled
  - expr: |
      kube_deployment_status_replicas
      *
      on(cluster,deployment) group_left(type)
      topk by (cluster,deployment) (1, kube_deployment_labels:labeled{type!=""})
    record: kube_deployment_status_replicas:labeled
