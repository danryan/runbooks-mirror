# WARNING. DO NOT EDIT THIS FILE BY HAND. USE ./rules-jsonnet/kube-state-metrics-recording-rules.jsonnet TO GENERATE IT
# YOUR CHANGES WILL BE OVERRIDDEN
groups:
- name: 'kube-state-metrics-recording-rules: api'
  interval: 1m
  rules:
  - record: kube_pod_labels:labeled
    labels:
      tier: sv
      type: api
    expr: |
      group without(label_deployment,label_shard,label_stage) (
        label_replace(
          label_replace(
            label_replace(
              topk by(environment, cluster, pod) (1, kube_pod_labels{label_type="api"}),
              "deployment", "$0", "label_deployment", ".*"
            ),
            "shard", "$0", "label_shard", ".*"
          ),
          "stage", "$0", "label_stage", ".*"
        )
      )
  - record: kube_horizontalpodautoscaler_labels:labeled
    labels:
      tier: sv
      type: api
    expr: |
      group without(label_shard,label_stage) (
        label_replace(
          label_replace(
            topk by(environment, cluster, horizontalpodautoscaler) (1, kube_horizontalpodautoscaler_labels{label_type="api"}),
            "shard", "$0", "label_shard", ".*"
          ),
          "stage", "$0", "label_stage", ".*"
        )
      )
  - record: kube_ingress_labels:labeled
    labels:
      tier: sv
      type: api
    expr: |
      group without(label_stage,service_shard) (
        label_replace(
          label_replace(
            topk by(environment, cluster, ingress) (1, kube_ingress_labels{label_type="api"}),
            "stage", "$0", "label_stage", ".*"
          ),
          "shard", "$0", "service_shard", ".*"
        )
      )
  - record: kube_deployment_labels:labeled
    labels:
      tier: sv
      type: api
    expr: |
      group without(label_stage,service_shard) (
        label_replace(
          label_replace(
            topk by(environment, cluster, deployment) (1, kube_deployment_labels{label_type="api"}),
            "stage", "$0", "label_stage", ".*"
          ),
          "shard", "$0", "service_shard", ".*"
        )
      )
- name: 'kube-state-metrics-recording-rules: consul'
  interval: 1m
  rules:
  - record: kube_pod_labels:labeled
    labels:
      tier: sv
      type: consul
    expr: |
      group without(label_deployment,label_shard,label_stage) (
        label_replace(
          label_replace(
            label_replace(
              topk by(environment, cluster, pod) (1, kube_pod_labels{label_type="consul"}),
              "deployment", "$0", "label_deployment", ".*"
            ),
            "shard", "$0", "label_shard", ".*"
          ),
          "stage", "$0", "label_stage", ".*"
        )
      )
- name: 'kube-state-metrics-recording-rules: git'
  interval: 1m
  rules:
  - record: kube_pod_labels:labeled
    labels:
      tier: sv
      type: git
    expr: |
      group without(label_deployment,label_shard,label_stage) (
        label_replace(
          label_replace(
            label_replace(
              topk by(environment, cluster, pod) (1, kube_pod_labels{label_type="git"}),
              "deployment", "$0", "label_deployment", ".*"
            ),
            "shard", "$0", "label_shard", ".*"
          ),
          "stage", "$0", "label_stage", ".*"
        )
      )
  - record: kube_horizontalpodautoscaler_labels:labeled
    labels:
      tier: sv
      type: git
    expr: |
      group without(label_shard,label_stage) (
        label_replace(
          label_replace(
            topk by(environment, cluster, horizontalpodautoscaler) (1, kube_horizontalpodautoscaler_labels{label_type="git"}),
            "shard", "$0", "label_shard", ".*"
          ),
          "stage", "$0", "label_stage", ".*"
        )
      )
  - record: kube_node_labels:labeled
    labels:
      stage: main
      tier: sv
      type: git
    expr: |
      group without(service_shard,service_stage) (
        label_replace(
          label_replace(
            topk by(environment, cluster, node) (1, kube_node_labels{label_type=~"git-https|shell"}),
            "shard", "$0", "service_shard", ".*"
          ),
          "stage", "$0", "service_stage", ".*"
        )
      )
  - record: kube_deployment_labels:labeled
    labels:
      tier: sv
      type: git
    expr: |
      group without(label_stage,service_shard) (
        label_replace(
          label_replace(
            topk by(environment, cluster, deployment) (1, kube_deployment_labels{label_type="git"}),
            "stage", "$0", "label_stage", ".*"
          ),
          "shard", "$0", "service_shard", ".*"
        )
      )
- name: 'kube-state-metrics-recording-rules: kas'
  interval: 1m
  rules:
  - record: kube_pod_labels:labeled
    labels:
      tier: sv
      type: kas
    expr: |
      group without(label_deployment,label_shard,label_stage) (
        label_replace(
          label_replace(
            label_replace(
              topk by(environment, cluster, pod) (1, kube_pod_labels{label_type="kas"}),
              "deployment", "$0", "label_deployment", ".*"
            ),
            "shard", "$0", "label_shard", ".*"
          ),
          "stage", "$0", "label_stage", ".*"
        )
      )
  - record: kube_horizontalpodautoscaler_labels:labeled
    labels:
      tier: sv
      type: kas
    expr: |
      group without(label_shard,label_stage) (
        label_replace(
          label_replace(
            topk by(environment, cluster, horizontalpodautoscaler) (1, kube_horizontalpodautoscaler_labels{label_type="kas"}),
            "shard", "$0", "label_shard", ".*"
          ),
          "stage", "$0", "label_stage", ".*"
        )
      )
  - record: kube_ingress_labels:labeled
    labels:
      tier: sv
      type: kas
    expr: |
      group without(label_stage,service_shard) (
        label_replace(
          label_replace(
            topk by(environment, cluster, ingress) (1, kube_ingress_labels{label_type="kas"}),
            "stage", "$0", "label_stage", ".*"
          ),
          "shard", "$0", "service_shard", ".*"
        )
      )
  - record: kube_deployment_labels:labeled
    labels:
      tier: sv
      type: kas
    expr: |
      group without(label_stage,service_shard) (
        label_replace(
          label_replace(
            topk by(environment, cluster, deployment) (1, kube_deployment_labels{label_type="kas"}),
            "stage", "$0", "label_stage", ".*"
          ),
          "shard", "$0", "service_shard", ".*"
        )
      )
- name: 'kube-state-metrics-recording-rules: kube'
  interval: 1m
  rules:
  - record: kube_node_labels:labeled
    labels:
      stage: main
      tier: inf
      type: kube
    expr: |
      group without(service_shard,service_stage) (
        label_replace(
          label_replace(
            topk by(environment, cluster, node) (1, kube_node_labels{label_type=~"|default|highmem"}),
            "shard", "$0", "service_shard", ".*"
          ),
          "stage", "$0", "service_stage", ".*"
        )
      )
- name: 'kube-state-metrics-recording-rules: logging'
  interval: 1m
  rules:
  - record: kube_pod_labels:labeled
    labels:
      tier: inf
      type: logging
    expr: |
      group without(label_deployment,label_shard,label_stage) (
        label_replace(
          label_replace(
            label_replace(
              topk by(environment, cluster, pod) (1, kube_pod_labels{label_type="logging"}),
              "deployment", "$0", "label_deployment", ".*"
            ),
            "shard", "$0", "label_shard", ".*"
          ),
          "stage", "$0", "label_stage", ".*"
        )
      )
- name: 'kube-state-metrics-recording-rules: mailroom'
  interval: 1m
  rules:
  - record: kube_pod_labels:labeled
    labels:
      tier: sv
      type: mailroom
    expr: |
      group without(label_deployment,label_shard,label_stage) (
        label_replace(
          label_replace(
            label_replace(
              topk by(environment, cluster, pod) (1, kube_pod_labels{label_type="mailroom"}),
              "deployment", "$0", "label_deployment", ".*"
            ),
            "shard", "$0", "label_shard", ".*"
          ),
          "stage", "$0", "label_stage", ".*"
        )
      )
  - record: kube_horizontalpodautoscaler_labels:labeled
    labels:
      tier: sv
      type: mailroom
    expr: |
      group without(label_shard,label_stage) (
        label_replace(
          label_replace(
            topk by(environment, cluster, horizontalpodautoscaler) (1, kube_horizontalpodautoscaler_labels{label_type="mailroom"}),
            "shard", "$0", "label_shard", ".*"
          ),
          "stage", "$0", "label_stage", ".*"
        )
      )
  - record: kube_deployment_labels:labeled
    labels:
      tier: sv
      type: mailroom
    expr: |
      group without(label_stage,service_shard) (
        label_replace(
          label_replace(
            topk by(environment, cluster, deployment) (1, kube_deployment_labels{label_type="mailroom"}),
            "stage", "$0", "label_stage", ".*"
          ),
          "shard", "$0", "service_shard", ".*"
        )
      )
- name: 'kube-state-metrics-recording-rules: monitoring'
  interval: 1m
  rules:
  - record: kube_pod_labels:labeled
    labels:
      stage: main
      tier: inf
      type: monitoring
    expr: |
      group without(label_deployment,label_shard,label_stage) (
        label_replace(
          label_replace(
            label_replace(
              topk by(environment, cluster, pod) (1, kube_pod_labels{namespace="monitoring"}),
              "deployment", "$0", "label_deployment", ".*"
            ),
            "shard", "$0", "label_shard", ".*"
          ),
          "stage", "$0", "label_stage", ".*"
        )
      )
  - record: kube_horizontalpodautoscaler_labels:labeled
    labels:
      stage: main
      tier: inf
      type: monitoring
    expr: |
      group without(label_shard,label_stage) (
        label_replace(
          label_replace(
            topk by(environment, cluster, horizontalpodautoscaler) (1, kube_horizontalpodautoscaler_labels{namespace="monitoring"}),
            "shard", "$0", "label_shard", ".*"
          ),
          "stage", "$0", "label_stage", ".*"
        )
      )
  - record: kube_ingress_labels:labeled
    labels:
      stage: main
      tier: inf
      type: monitoring
    expr: |
      group without(label_stage,service_shard) (
        label_replace(
          label_replace(
            topk by(environment, cluster, ingress) (1, kube_ingress_labels{namespace="monitoring"}),
            "stage", "$0", "label_stage", ".*"
          ),
          "shard", "$0", "service_shard", ".*"
        )
      )
  - record: kube_deployment_labels:labeled
    labels:
      stage: main
      tier: inf
      type: monitoring
    expr: |
      group without(label_stage,service_shard) (
        label_replace(
          label_replace(
            topk by(environment, cluster, deployment) (1, kube_deployment_labels{namespace="monitoring"}),
            "stage", "$0", "label_stage", ".*"
          ),
          "shard", "$0", "service_shard", ".*"
        )
      )
- name: 'kube-state-metrics-recording-rules: nginx'
  interval: 1m
  rules:
  - record: kube_pod_labels:labeled
    labels:
      tier: sv
      type: nginx
    expr: |
      group without(label_deployment,label_shard,label_stage) (
        label_replace(
          label_replace(
            label_replace(
              topk by(environment, cluster, pod) (1, kube_pod_labels{label_type="nginx"}),
              "deployment", "$0", "label_deployment", ".*"
            ),
            "shard", "$0", "label_shard", ".*"
          ),
          "stage", "$0", "label_stage", ".*"
        )
      )
  - record: kube_horizontalpodautoscaler_labels:labeled
    labels:
      tier: sv
      type: nginx
    expr: |
      group without(label_shard,label_stage) (
        label_replace(
          label_replace(
            topk by(environment, cluster, horizontalpodautoscaler) (1, kube_horizontalpodautoscaler_labels{label_app="nginx-ingress"}),
            "shard", "$0", "label_shard", ".*"
          ),
          "stage", "$0", "label_stage", ".*"
        )
      )
  - record: kube_deployment_labels:labeled
    labels:
      tier: sv
      type: nginx
    expr: |
      group without(label_stage,service_shard) (
        label_replace(
          label_replace(
            topk by(environment, cluster, deployment) (1, kube_deployment_labels{label_type="nginx"}),
            "stage", "$0", "label_stage", ".*"
          ),
          "shard", "$0", "service_shard", ".*"
        )
      )
- name: 'kube-state-metrics-recording-rules: plantuml'
  interval: 1m
  rules:
  - record: kube_pod_labels:labeled
    labels:
      tier: sv
      type: plantuml
    expr: |
      group without(label_deployment,label_shard,label_stage) (
        label_replace(
          label_replace(
            label_replace(
              topk by(environment, cluster, pod) (1, kube_pod_labels{label_type="plantuml"}),
              "deployment", "$0", "label_deployment", ".*"
            ),
            "shard", "$0", "label_shard", ".*"
          ),
          "stage", "$0", "label_stage", ".*"
        )
      )
  - record: kube_horizontalpodautoscaler_labels:labeled
    labels:
      tier: sv
      type: plantuml
    expr: |
      group without(label_shard,label_stage) (
        label_replace(
          label_replace(
            topk by(environment, cluster, horizontalpodautoscaler) (1, kube_horizontalpodautoscaler_labels{label_type="plantuml"}),
            "shard", "$0", "label_shard", ".*"
          ),
          "stage", "$0", "label_stage", ".*"
        )
      )
  - record: kube_ingress_labels:labeled
    labels:
      tier: sv
      type: plantuml
    expr: |
      group without(label_stage,service_shard) (
        label_replace(
          label_replace(
            topk by(environment, cluster, ingress) (1, kube_ingress_labels{label_type="plantuml"}),
            "stage", "$0", "label_stage", ".*"
          ),
          "shard", "$0", "service_shard", ".*"
        )
      )
  - record: kube_deployment_labels:labeled
    labels:
      tier: sv
      type: plantuml
    expr: |
      group without(label_stage,service_shard) (
        label_replace(
          label_replace(
            topk by(environment, cluster, deployment) (1, kube_deployment_labels{label_type="plantuml"}),
            "stage", "$0", "label_stage", ".*"
          ),
          "shard", "$0", "service_shard", ".*"
        )
      )
- name: 'kube-state-metrics-recording-rules: registry'
  interval: 1m
  rules:
  - record: kube_pod_labels:labeled
    labels:
      tier: sv
      type: registry
    expr: |
      group without(label_deployment,label_shard,label_stage) (
        label_replace(
          label_replace(
            label_replace(
              topk by(environment, cluster, pod) (1, kube_pod_labels{label_type="registry"}),
              "deployment", "$0", "label_deployment", ".*"
            ),
            "shard", "$0", "label_shard", ".*"
          ),
          "stage", "$0", "label_stage", ".*"
        )
      )
  - record: kube_horizontalpodautoscaler_labels:labeled
    labels:
      tier: sv
      type: registry
    expr: |
      group without(label_shard,label_stage) (
        label_replace(
          label_replace(
            topk by(environment, cluster, horizontalpodautoscaler) (1, kube_horizontalpodautoscaler_labels{label_type="registry"}),
            "shard", "$0", "label_shard", ".*"
          ),
          "stage", "$0", "label_stage", ".*"
        )
      )
  - record: kube_node_labels:labeled
    labels:
      stage: main
      tier: sv
      type: registry
    expr: |
      group without(service_shard,service_stage) (
        label_replace(
          label_replace(
            topk by(environment, cluster, node) (1, kube_node_labels{label_type="registry"}),
            "shard", "$0", "service_shard", ".*"
          ),
          "stage", "$0", "service_stage", ".*"
        )
      )
  - record: kube_deployment_labels:labeled
    labels:
      tier: sv
      type: registry
    expr: |
      group without(label_stage,service_shard) (
        label_replace(
          label_replace(
            topk by(environment, cluster, deployment) (1, kube_deployment_labels{label_type="registry"}),
            "stage", "$0", "label_stage", ".*"
          ),
          "shard", "$0", "service_shard", ".*"
        )
      )
- name: 'kube-state-metrics-recording-rules: sidekiq'
  interval: 1m
  rules:
  - record: kube_pod_labels:labeled
    labels:
      tier: sv
      type: sidekiq
    expr: |
      group without(label_deployment,label_shard,label_stage) (
        label_replace(
          label_replace(
            label_replace(
              topk by(environment, cluster, pod) (1, kube_pod_labels{label_type="sidekiq"}),
              "deployment", "$0", "label_deployment", ".*"
            ),
            "shard", "$0", "label_shard", ".*"
          ),
          "stage", "$0", "label_stage", ".*"
        )
      )
  - record: kube_horizontalpodautoscaler_labels:labeled
    labels:
      tier: sv
      type: sidekiq
    expr: |
      group without(label_shard,label_stage) (
        label_replace(
          label_replace(
            topk by(environment, cluster, horizontalpodautoscaler) (1, kube_horizontalpodautoscaler_labels{label_type="sidekiq"}),
            "shard", "$0", "label_shard", ".*"
          ),
          "stage", "$0", "label_stage", ".*"
        )
      )
  - record: kube_node_labels:labeled
    labels:
      stage: main
      tier: sv
      type: sidekiq
    expr: |
      group without(service_shard,service_stage) (
        label_replace(
          label_replace(
            topk by(environment, cluster, node) (1, kube_node_labels{label_type=~"catchall|database-throttled|elasticsearch|gitaly-throttled|imports|low-urgency-cpu-bound|memory-bound|quarantine|urgent-cpu-bound|urgent-other"}),
            "shard", "$0", "service_shard", ".*"
          ),
          "stage", "$0", "service_stage", ".*"
        )
      )
  - record: kube_deployment_labels:labeled
    labels:
      tier: sv
      type: sidekiq
    expr: |
      group without(label_stage,service_shard) (
        label_replace(
          label_replace(
            topk by(environment, cluster, deployment) (1, kube_deployment_labels{label_type="sidekiq"}),
            "stage", "$0", "label_stage", ".*"
          ),
          "shard", "$0", "service_shard", ".*"
        )
      )
- name: 'kube-state-metrics-recording-rules: web-pages'
  interval: 1m
  rules:
  - record: kube_pod_labels:labeled
    labels:
      tier: sv
      type: web-pages
    expr: |
      group without(label_deployment,label_shard,label_stage) (
        label_replace(
          label_replace(
            label_replace(
              topk by(environment, cluster, pod) (1, kube_pod_labels{label_type="web-pages"}),
              "deployment", "$0", "label_deployment", ".*"
            ),
            "shard", "$0", "label_shard", ".*"
          ),
          "stage", "$0", "label_stage", ".*"
        )
      )
  - record: kube_horizontalpodautoscaler_labels:labeled
    labels:
      tier: sv
      type: web-pages
    expr: |
      group without(label_shard,label_stage) (
        label_replace(
          label_replace(
            topk by(environment, cluster, horizontalpodautoscaler) (1, kube_horizontalpodautoscaler_labels{label_type="web-pages"}),
            "shard", "$0", "label_shard", ".*"
          ),
          "stage", "$0", "label_stage", ".*"
        )
      )
  - record: kube_node_labels:labeled
    labels:
      stage: main
      tier: sv
      type: web-pages
    expr: |
      group without(service_shard,service_stage) (
        label_replace(
          label_replace(
            topk by(environment, cluster, node) (1, kube_node_labels{label_type="web-pages"}),
            "shard", "$0", "service_shard", ".*"
          ),
          "stage", "$0", "service_stage", ".*"
        )
      )
  - record: kube_deployment_labels:labeled
    labels:
      tier: sv
      type: web-pages
    expr: |
      group without(label_stage,service_shard) (
        label_replace(
          label_replace(
            topk by(environment, cluster, deployment) (1, kube_deployment_labels{label_type="web-pages"}),
            "stage", "$0", "label_stage", ".*"
          ),
          "shard", "$0", "service_shard", ".*"
        )
      )
- name: 'kube-state-metrics-recording-rules: web'
  interval: 1m
  rules:
  - record: kube_pod_labels:labeled
    labels:
      tier: sv
      type: web
    expr: |
      group without(label_deployment,label_shard,label_stage) (
        label_replace(
          label_replace(
            label_replace(
              topk by(environment, cluster, pod) (1, kube_pod_labels{label_type="web"}),
              "deployment", "$0", "label_deployment", ".*"
            ),
            "shard", "$0", "label_shard", ".*"
          ),
          "stage", "$0", "label_stage", ".*"
        )
      )
  - record: kube_horizontalpodautoscaler_labels:labeled
    labels:
      tier: sv
      type: web
    expr: |
      group without(label_shard,label_stage) (
        label_replace(
          label_replace(
            topk by(environment, cluster, horizontalpodautoscaler) (1, kube_horizontalpodautoscaler_labels{label_type="web"}),
            "shard", "$0", "label_shard", ".*"
          ),
          "stage", "$0", "label_stage", ".*"
        )
      )
  - record: kube_ingress_labels:labeled
    labels:
      tier: sv
      type: web
    expr: |
      group without(label_stage,service_shard) (
        label_replace(
          label_replace(
            topk by(environment, cluster, ingress) (1, kube_ingress_labels{label_type="web"}),
            "stage", "$0", "label_stage", ".*"
          ),
          "shard", "$0", "service_shard", ".*"
        )
      )
  - record: kube_deployment_labels:labeled
    labels:
      tier: sv
      type: web
    expr: |
      group without(label_stage,service_shard) (
        label_replace(
          label_replace(
            topk by(environment, cluster, deployment) (1, kube_deployment_labels{label_type="web"}),
            "stage", "$0", "label_stage", ".*"
          ),
          "shard", "$0", "service_shard", ".*"
        )
      )
- name: 'kube-state-metrics-recording-rules: websockets'
  interval: 1m
  rules:
  - record: kube_pod_labels:labeled
    labels:
      tier: sv
      type: websockets
    expr: |
      group without(label_deployment,label_shard,label_stage) (
        label_replace(
          label_replace(
            label_replace(
              topk by(environment, cluster, pod) (1, kube_pod_labels{label_type="websockets"}),
              "deployment", "$0", "label_deployment", ".*"
            ),
            "shard", "$0", "label_shard", ".*"
          ),
          "stage", "$0", "label_stage", ".*"
        )
      )
  - record: kube_horizontalpodautoscaler_labels:labeled
    labels:
      tier: sv
      type: websockets
    expr: |
      group without(label_shard,label_stage) (
        label_replace(
          label_replace(
            topk by(environment, cluster, horizontalpodautoscaler) (1, kube_horizontalpodautoscaler_labels{label_type="websockets"}),
            "shard", "$0", "label_shard", ".*"
          ),
          "stage", "$0", "label_stage", ".*"
        )
      )
  - record: kube_node_labels:labeled
    labels:
      stage: main
      tier: sv
      type: websockets
    expr: |
      group without(service_shard,service_stage) (
        label_replace(
          label_replace(
            topk by(environment, cluster, node) (1, kube_node_labels{label_type="websockets"}),
            "shard", "$0", "service_shard", ".*"
          ),
          "stage", "$0", "service_stage", ".*"
        )
      )
  - record: kube_deployment_labels:labeled
    labels:
      tier: sv
      type: websockets
    expr: |
      group without(label_stage,service_shard) (
        label_replace(
          label_replace(
            topk by(environment, cluster, deployment) (1, kube_deployment_labels{label_type="websockets"}),
            "stage", "$0", "label_stage", ".*"
          ),
          "shard", "$0", "service_shard", ".*"
        )
      )
- name: 'kube-state-metrics-recording-rules: woodhouse'
  interval: 1m
  rules:
  - record: kube_pod_labels:labeled
    labels:
      tier: sv
      type: woodhouse
    expr: |
      group without(label_deployment,label_shard,label_stage) (
        label_replace(
          label_replace(
            label_replace(
              topk by(environment, cluster, pod) (1, kube_pod_labels{namespace="woodhouse"}),
              "deployment", "$0", "label_deployment", ".*"
            ),
            "shard", "$0", "label_shard", ".*"
          ),
          "stage", "$0", "label_stage", ".*"
        )
      )
  - record: kube_ingress_labels:labeled
    labels:
      tier: sv
      type: woodhouse
    expr: |
      group without(label_stage,service_shard) (
        label_replace(
          label_replace(
            topk by(environment, cluster, ingress) (1, kube_ingress_labels{namespace="woodhouse"}),
            "stage", "$0", "label_stage", ".*"
          ),
          "shard", "$0", "service_shard", ".*"
        )
      )
  - record: kube_deployment_labels:labeled
    labels:
      tier: sv
      type: woodhouse
    expr: |
      group without(label_stage,service_shard) (
        label_replace(
          label_replace(
            topk by(environment, cluster, deployment) (1, kube_deployment_labels{namespace="woodhouse"}),
            "stage", "$0", "label_stage", ".*"
          ),
          "shard", "$0", "service_shard", ".*"
        )
      )
- name: 'kube-state-metrics-recording-rules: global rules'
  interval: 1m
  rules:
  - record: container_start_time_seconds:labeled
    expr: |
      container_start_time_seconds{metrics_path="/metrics/cadvisor"}
      *
      on(environment, cluster, pod) group_left(tier, type, stage, shard, deployment)
      topk by (environment, cluster, pod) (1, kube_pod_labels:labeled{type!=""})
  - record: container_cpu_cfs_periods_total:labeled
    expr: |
      container_cpu_cfs_periods_total{metrics_path="/metrics/cadvisor"}
      *
      on(environment, cluster, pod) group_left(tier, type, stage, shard, deployment)
      topk by (environment, cluster, pod) (1, kube_pod_labels:labeled{type!=""})
  - record: container_cpu_cfs_throttled_periods_total:labeled
    expr: |
      container_cpu_cfs_throttled_periods_total{metrics_path="/metrics/cadvisor"}
      *
      on(environment, cluster, pod) group_left(tier, type, stage, shard, deployment)
      topk by (environment, cluster, pod) (1, kube_pod_labels:labeled{type!=""})
  - record: container_cpu_usage_seconds_total:labeled
    expr: |
      container_cpu_usage_seconds_total{metrics_path="/metrics/cadvisor"}
      *
      on(environment, cluster, pod) group_left(tier, type, stage, shard, deployment)
      topk by (environment, cluster, pod) (1, kube_pod_labels:labeled{type!=""})
  - record: container_memory_cache:labeled
    expr: |
      container_memory_cache{metrics_path="/metrics/cadvisor"}
      *
      on(environment, cluster, pod) group_left(tier, type, stage, shard, deployment)
      topk by (environment, cluster, pod) (1, kube_pod_labels:labeled{type!=""})
  - record: container_memory_swap:labeled
    expr: |
      container_memory_swap{metrics_path="/metrics/cadvisor"}
      *
      on(environment, cluster, pod) group_left(tier, type, stage, shard, deployment)
      topk by (environment, cluster, pod) (1, kube_pod_labels:labeled{type!=""})
  - record: container_memory_usage_bytes:labeled
    expr: |
      container_memory_usage_bytes{metrics_path="/metrics/cadvisor"}
      *
      on(environment, cluster, pod) group_left(tier, type, stage, shard, deployment)
      topk by (environment, cluster, pod) (1, kube_pod_labels:labeled{type!=""})
  - record: container_memory_working_set_bytes:labeled
    expr: |
      container_memory_working_set_bytes{metrics_path="/metrics/cadvisor"}
      *
      on(environment, cluster, pod) group_left(tier, type, stage, shard, deployment)
      topk by (environment, cluster, pod) (1, kube_pod_labels:labeled{type!=""})
  - record: container_network_receive_bytes_total:labeled
    expr: |
      container_network_receive_bytes_total{metrics_path="/metrics/cadvisor"}
      *
      on(environment, cluster, pod) group_left(tier, type, stage, shard, deployment)
      topk by (environment, cluster, pod) (1, kube_pod_labels:labeled{type!=""})
  - record: container_network_transmit_bytes_total:labeled
    expr: |
      container_network_transmit_bytes_total{metrics_path="/metrics/cadvisor"}
      *
      on(environment, cluster, pod) group_left(tier, type, stage, shard, deployment)
      topk by (environment, cluster, pod) (1, kube_pod_labels:labeled{type!=""})
  - record: container_spec_cpu_period:labeled
    expr: |
      container_spec_cpu_period{metrics_path="/metrics/cadvisor"}
      *
      on(environment, cluster, pod) group_left(tier, type, stage, shard, deployment)
      topk by (environment, cluster, pod) (1, kube_pod_labels:labeled{type!=""})
  - record: container_spec_cpu_quota:labeled
    expr: |
      container_spec_cpu_quota{metrics_path="/metrics/cadvisor"}
      *
      on(environment, cluster, pod) group_left(tier, type, stage, shard, deployment)
      topk by (environment, cluster, pod) (1, kube_pod_labels:labeled{type!=""})
  - record: container_spec_cpu_shares:labeled
    expr: |
      container_spec_cpu_shares{metrics_path="/metrics/cadvisor"}
      *
      on(environment, cluster, pod) group_left(tier, type, stage, shard, deployment)
      topk by (environment, cluster, pod) (1, kube_pod_labels:labeled{type!=""})
  - record: container_spec_memory_limit_bytes:labeled
    expr: |
      container_spec_memory_limit_bytes{metrics_path="/metrics/cadvisor"}
      *
      on(environment, cluster, pod) group_left(tier, type, stage, shard, deployment)
      topk by (environment, cluster, pod) (1, kube_pod_labels:labeled{type!=""})
  - record: kube_pod_container_status_running:labeled
    expr: |
      kube_pod_container_status_running
      *
      on(environment, cluster, pod) group_left(tier, type, stage, shard, deployment)
      topk by (environment, cluster, pod) (1, kube_pod_labels:labeled{type!=""})
  - record: kube_pod_container_resource_limits:labeled
    expr: |
      kube_pod_container_resource_limits
      *
      on(environment, cluster, pod) group_left(tier, type, stage, shard, deployment)
      topk by (environment, cluster, pod) (1, kube_pod_labels:labeled{type!=""})
  - record: kube_pod_container_resource_requests:labeled
    expr: |
      kube_pod_container_resource_requests
      *
      on(environment, cluster, pod) group_left(tier, type, stage, shard, deployment)
      topk by (environment, cluster, pod) (1, kube_pod_labels:labeled{type!=""})
  - record: kube_pod_container_status_last_terminated_reason:labeled
    expr: |
      kube_pod_container_status_last_terminated_reason
      *
      on(environment, cluster, pod) group_left(tier, type, stage, shard, deployment)
      topk by (environment, cluster, pod) (1, kube_pod_labels:labeled{type!=""})
  - record: kube_pod_container_status_ready:labeled
    expr: |
      kube_pod_container_status_ready
      *
      on(environment, cluster, pod) group_left(tier, type, stage, shard, deployment)
      topk by (environment, cluster, pod) (1, kube_pod_labels:labeled{type!=""})
  - record: kube_pod_container_status_restarts_total:labeled
    expr: |
      kube_pod_container_status_restarts_total
      *
      on(environment, cluster, pod) group_left(tier, type, stage, shard, deployment)
      topk by (environment, cluster, pod) (1, kube_pod_labels:labeled{type!=""})
  - record: kube_pod_container_status_running:labeled
    expr: |
      kube_pod_container_status_running
      *
      on(environment, cluster, pod) group_left(tier, type, stage, shard, deployment)
      topk by (environment, cluster, pod) (1, kube_pod_labels:labeled{type!=""})
  - record: kube_pod_container_status_terminated:labeled
    expr: |
      kube_pod_container_status_terminated
      *
      on(environment, cluster, pod) group_left(tier, type, stage, shard, deployment)
      topk by (environment, cluster, pod) (1, kube_pod_labels:labeled{type!=""})
  - record: kube_pod_container_status_terminated_reason:labeled
    expr: |
      kube_pod_container_status_terminated_reason
      *
      on(environment, cluster, pod) group_left(tier, type, stage, shard, deployment)
      topk by (environment, cluster, pod) (1, kube_pod_labels:labeled{type!=""})
  - record: kube_pod_container_status_waiting:labeled
    expr: |
      kube_pod_container_status_waiting
      *
      on(environment, cluster, pod) group_left(tier, type, stage, shard, deployment)
      topk by (environment, cluster, pod) (1, kube_pod_labels:labeled{type!=""})
  - record: kube_pod_container_status_waiting_reason:labeled
    expr: |
      kube_pod_container_status_waiting_reason
      *
      on(environment, cluster, pod) group_left(tier, type, stage, shard, deployment)
      topk by (environment, cluster, pod) (1, kube_pod_labels:labeled{type!=""})
  - record: kube_horizontalpodautoscaler_spec_target_metric:labeled
    expr: |
      kube_horizontalpodautoscaler_spec_target_metric
      *
      on(environment, cluster, horizontalpodautoscaler) group_left(tier, type, stage, shard)
      topk by (environment, cluster, horizontalpodautoscaler) (1, kube_horizontalpodautoscaler_labels:labeled{type!=""})
  - record: kube_horizontalpodautoscaler_status_condition:labeled
    expr: |
      kube_horizontalpodautoscaler_status_condition
      *
      on(environment, cluster, horizontalpodautoscaler) group_left(tier, type, stage, shard)
      topk by (environment, cluster, horizontalpodautoscaler) (1, kube_horizontalpodautoscaler_labels:labeled{type!=""})
  - record: kube_horizontalpodautoscaler_status_current_replicas:labeled
    expr: |
      kube_horizontalpodautoscaler_status_current_replicas
      *
      on(environment, cluster, horizontalpodautoscaler) group_left(tier, type, stage, shard)
      topk by (environment, cluster, horizontalpodautoscaler) (1, kube_horizontalpodautoscaler_labels:labeled{type!=""})
  - record: kube_horizontalpodautoscaler_status_desired_replicas:labeled
    expr: |
      kube_horizontalpodautoscaler_status_desired_replicas
      *
      on(environment, cluster, horizontalpodautoscaler) group_left(tier, type, stage, shard)
      topk by (environment, cluster, horizontalpodautoscaler) (1, kube_horizontalpodautoscaler_labels:labeled{type!=""})
  - record: kube_horizontalpodautoscaler_metadata_generation:labeled
    expr: |
      kube_horizontalpodautoscaler_metadata_generation
      *
      on(environment, cluster, horizontalpodautoscaler) group_left(tier, type, stage, shard)
      topk by (environment, cluster, horizontalpodautoscaler) (1, kube_horizontalpodautoscaler_labels:labeled{type!=""})
  - record: kube_horizontalpodautoscaler_spec_max_replicas:labeled
    expr: |
      kube_horizontalpodautoscaler_spec_max_replicas
      *
      on(environment, cluster, horizontalpodautoscaler) group_left(tier, type, stage, shard)
      topk by (environment, cluster, horizontalpodautoscaler) (1, kube_horizontalpodautoscaler_labels:labeled{type!=""})
  - record: kube_horizontalpodautoscaler_spec_min_replicas:labeled
    expr: |
      kube_horizontalpodautoscaler_spec_min_replicas
      *
      on(environment, cluster, horizontalpodautoscaler) group_left(tier, type, stage, shard)
      topk by (environment, cluster, horizontalpodautoscaler) (1, kube_horizontalpodautoscaler_labels:labeled{type!=""})
  - record: nginx_ingress_controller_bytes_sent_count:labeled
    expr: |
      nginx_ingress_controller_bytes_sent_count
      *
      on(environment, cluster, ingress) group_left(shard, stage, type, tier)
      topk by (environment, cluster, ingress) (1, kube_ingress_labels:labeled)
  - record: nginx_ingress_controller_request_duration_seconds_bucket:labeled
    expr: |
      nginx_ingress_controller_request_duration_seconds_bucket
      *
      on(environment, cluster, ingress) group_left(shard, stage, type, tier)
      topk by (environment, cluster, ingress) (1, kube_ingress_labels:labeled)
  - record: nginx_ingress_controller_request_duration_seconds_sum:labeled
    expr: |
      nginx_ingress_controller_request_duration_seconds_sum
      *
      on(environment, cluster, ingress) group_left(shard, stage, type, tier)
      topk by (environment, cluster, ingress) (1, kube_ingress_labels:labeled)
  - record: nginx_ingress_controller_response_size_count:labeled
    expr: |
      nginx_ingress_controller_response_size_count
      *
      on(environment, cluster, ingress) group_left(shard, stage, type, tier)
      topk by (environment, cluster, ingress) (1, kube_ingress_labels:labeled)
  - record: nginx_ingress_controller_ingress_upstream_latency_seconds:labeled
    expr: |
      nginx_ingress_controller_ingress_upstream_latency_seconds
      *
      on(environment, cluster, ingress) group_left(shard, stage, type, tier)
      topk by (environment, cluster, ingress) (1, kube_ingress_labels:labeled)
  - record: nginx_ingress_controller_ingress_upstream_latency_seconds_count:labeled
    expr: |
      nginx_ingress_controller_ingress_upstream_latency_seconds_count
      *
      on(environment, cluster, ingress) group_left(shard, stage, type, tier)
      topk by (environment, cluster, ingress) (1, kube_ingress_labels:labeled)
  - record: nginx_ingress_controller_ingress_upstream_latency_seconds_sum:labeled
    expr: |
      nginx_ingress_controller_ingress_upstream_latency_seconds_sum
      *
      on(environment, cluster, ingress) group_left(shard, stage, type, tier)
      topk by (environment, cluster, ingress) (1, kube_ingress_labels:labeled)
  - record: nginx_ingress_controller_request_duration_seconds_count:labeled
    expr: |
      nginx_ingress_controller_request_duration_seconds_count
      *
      on(environment, cluster, ingress) group_left(shard, stage, type, tier)
      topk by (environment, cluster, ingress) (1, kube_ingress_labels:labeled)
  - record: nginx_ingress_controller_request_size_bucket:labeled
    expr: |
      nginx_ingress_controller_request_size_bucket
      *
      on(environment, cluster, ingress) group_left(shard, stage, type, tier)
      topk by (environment, cluster, ingress) (1, kube_ingress_labels:labeled)
  - record: nginx_ingress_controller_response_duration_seconds_bucket:labeled
    expr: |
      nginx_ingress_controller_response_duration_seconds_bucket
      *
      on(environment, cluster, ingress) group_left(shard, stage, type, tier)
      topk by (environment, cluster, ingress) (1, kube_ingress_labels:labeled)
  - record: nginx_ingress_controller_bytes_sent_bucket:labeled
    expr: |
      nginx_ingress_controller_bytes_sent_bucket
      *
      on(environment, cluster, ingress) group_left(shard, stage, type, tier)
      topk by (environment, cluster, ingress) (1, kube_ingress_labels:labeled)
  - record: nginx_ingress_controller_bytes_sent_sum:labeled
    expr: |
      nginx_ingress_controller_bytes_sent_sum
      *
      on(environment, cluster, ingress) group_left(shard, stage, type, tier)
      topk by (environment, cluster, ingress) (1, kube_ingress_labels:labeled)
  - record: nginx_ingress_controller_request_size_count:labeled
    expr: |
      nginx_ingress_controller_request_size_count
      *
      on(environment, cluster, ingress) group_left(shard, stage, type, tier)
      topk by (environment, cluster, ingress) (1, kube_ingress_labels:labeled)
  - record: nginx_ingress_controller_response_duration_seconds_sum:labeled
    expr: |
      nginx_ingress_controller_response_duration_seconds_sum
      *
      on(environment, cluster, ingress) group_left(shard, stage, type, tier)
      topk by (environment, cluster, ingress) (1, kube_ingress_labels:labeled)
  - record: nginx_ingress_controller_request_size_sum:labeled
    expr: |
      nginx_ingress_controller_request_size_sum
      *
      on(environment, cluster, ingress) group_left(shard, stage, type, tier)
      topk by (environment, cluster, ingress) (1, kube_ingress_labels:labeled)
  - record: nginx_ingress_controller_requests:labeled
    expr: |
      nginx_ingress_controller_requests
      *
      on(environment, cluster, ingress) group_left(shard, stage, type, tier)
      topk by (environment, cluster, ingress) (1, kube_ingress_labels:labeled)
  - record: nginx_ingress_controller_response_duration_seconds_count:labeled
    expr: |
      nginx_ingress_controller_response_duration_seconds_count
      *
      on(environment, cluster, ingress) group_left(shard, stage, type, tier)
      topk by (environment, cluster, ingress) (1, kube_ingress_labels:labeled)
  - record: nginx_ingress_controller_response_size_bucket:labeled
    expr: |
      nginx_ingress_controller_response_size_bucket
      *
      on(environment, cluster, ingress) group_left(shard, stage, type, tier)
      topk by (environment, cluster, ingress) (1, kube_ingress_labels:labeled)
  - record: nginx_ingress_controller_response_size_sum:labeled
    expr: |
      nginx_ingress_controller_response_size_sum
      *
      on(environment, cluster, ingress) group_left(shard, stage, type, tier)
      topk by (environment, cluster, ingress) (1, kube_ingress_labels:labeled)
  - record: kube_deployment_status_replicas_unavailable:labeled
    expr: |
      kube_deployment_status_replicas_unavailable
      *
      on(environment, cluster, deployment) group_left(shard, stage, type, tier)
      topk by (environment, cluster, deployment) (1, kube_deployment_labels:labeled)
  - record: kube_deployment_status_replicas_updated:labeled
    expr: |
      kube_deployment_status_replicas_updated
      *
      on(environment, cluster, deployment) group_left(shard, stage, type, tier)
      topk by (environment, cluster, deployment) (1, kube_deployment_labels:labeled)
  - record: kube_deployment_spec_paused:labeled
    expr: |
      kube_deployment_spec_paused
      *
      on(environment, cluster, deployment) group_left(shard, stage, type, tier)
      topk by (environment, cluster, deployment) (1, kube_deployment_labels:labeled)
  - record: kube_deployment_spec_replicas:labeled
    expr: |
      kube_deployment_spec_replicas
      *
      on(environment, cluster, deployment) group_left(shard, stage, type, tier)
      topk by (environment, cluster, deployment) (1, kube_deployment_labels:labeled)
  - record: kube_deployment_spec_strategy_rollingupdate_max_surge:labeled
    expr: |
      kube_deployment_spec_strategy_rollingupdate_max_surge
      *
      on(environment, cluster, deployment) group_left(shard, stage, type, tier)
      topk by (environment, cluster, deployment) (1, kube_deployment_labels:labeled)
  - record: kube_deployment_spec_strategy_rollingupdate_max_unavailable:labeled
    expr: |
      kube_deployment_spec_strategy_rollingupdate_max_unavailable
      *
      on(environment, cluster, deployment) group_left(shard, stage, type, tier)
      topk by (environment, cluster, deployment) (1, kube_deployment_labels:labeled)
  - record: kube_deployment_status_condition:labeled
    expr: |
      kube_deployment_status_condition
      *
      on(environment, cluster, deployment) group_left(shard, stage, type, tier)
      topk by (environment, cluster, deployment) (1, kube_deployment_labels:labeled)
  - record: kube_deployment_status_replicas_available:labeled
    expr: |
      kube_deployment_status_replicas_available
      *
      on(environment, cluster, deployment) group_left(shard, stage, type, tier)
      topk by (environment, cluster, deployment) (1, kube_deployment_labels:labeled)
  - record: kube_deployment_created:labeled
    expr: |
      kube_deployment_created
      *
      on(environment, cluster, deployment) group_left(shard, stage, type, tier)
      topk by (environment, cluster, deployment) (1, kube_deployment_labels:labeled)
  - record: kube_deployment_metadata_generation:labeled
    expr: |
      kube_deployment_metadata_generation
      *
      on(environment, cluster, deployment) group_left(shard, stage, type, tier)
      topk by (environment, cluster, deployment) (1, kube_deployment_labels:labeled)
  - record: kube_deployment_status_observed_generation:labeled
    expr: |
      kube_deployment_status_observed_generation
      *
      on(environment, cluster, deployment) group_left(shard, stage, type, tier)
      topk by (environment, cluster, deployment) (1, kube_deployment_labels:labeled)
  - record: kube_deployment_status_replicas:labeled
    expr: |
      kube_deployment_status_replicas
      *
      on(environment, cluster, deployment) group_left(shard, stage, type, tier)
      topk by (environment, cluster, deployment) (1, kube_deployment_labels:labeled)
