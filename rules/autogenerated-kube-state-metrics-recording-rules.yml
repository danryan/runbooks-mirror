# WARNING. DO NOT EDIT THIS FILE BY HAND. USE ./rules-jsonnet/kube-state-metrics-recording-rules.jsonnet TO GENERATE IT
# YOUR CHANGES WILL BE OVERRIDDEN
groups:
- name: kube-state-metrics-recording-rules
  interval: 1m
  rules:
  - record: container_start_time_seconds:labeled
    expr: |
      min without(label_queue_pod_name, label_stage, label_type, label_deployment)
      (
        label_replace(
          label_replace(
            label_replace(
              label_replace(
                container_start_time_seconds{metrics_path="/metrics/cadvisor"}
                *
                on(pod, cluster) group_left(label_type, label_stage, label_queue_pod_name, label_deployment)
                topk by (pod, cluster, label_type, label_stage, label_queue_pod_name, label_deployment) (1, kube_pod_labels{
                  label_type!=""
                }),
                "shard", "$1", "label_queue_pod_name", "(.*)"
              ),
              "stage", "$1", "label_stage", "(.*)"
            ),
            "type", "$1", "label_type", "(.*)"
          ),
          "deployment", "$1", "label_deployment", "(.*)"
        )
      )
  - record: container_cpu_cfs_periods_total:labeled
    expr: |
      min without(label_queue_pod_name, label_stage, label_type, label_deployment)
      (
        label_replace(
          label_replace(
            label_replace(
              label_replace(
                container_cpu_cfs_periods_total{metrics_path="/metrics/cadvisor"}
                *
                on(pod, cluster) group_left(label_type, label_stage, label_queue_pod_name, label_deployment)
                topk by (pod, cluster, label_type, label_stage, label_queue_pod_name, label_deployment) (1, kube_pod_labels{
                  label_type!=""
                }),
                "shard", "$1", "label_queue_pod_name", "(.*)"
              ),
              "stage", "$1", "label_stage", "(.*)"
            ),
            "type", "$1", "label_type", "(.*)"
          ),
          "deployment", "$1", "label_deployment", "(.*)"
        )
      )
  - record: container_cpu_cfs_throttled_periods_total:labeled
    expr: |
      min without(label_queue_pod_name, label_stage, label_type, label_deployment)
      (
        label_replace(
          label_replace(
            label_replace(
              label_replace(
                container_cpu_cfs_throttled_periods_total{metrics_path="/metrics/cadvisor"}
                *
                on(pod, cluster) group_left(label_type, label_stage, label_queue_pod_name, label_deployment)
                topk by (pod, cluster, label_type, label_stage, label_queue_pod_name, label_deployment) (1, kube_pod_labels{
                  label_type!=""
                }),
                "shard", "$1", "label_queue_pod_name", "(.*)"
              ),
              "stage", "$1", "label_stage", "(.*)"
            ),
            "type", "$1", "label_type", "(.*)"
          ),
          "deployment", "$1", "label_deployment", "(.*)"
        )
      )
  - record: container_cpu_usage_seconds_total:labeled
    expr: |
      min without(label_queue_pod_name, label_stage, label_type, label_deployment)
      (
        label_replace(
          label_replace(
            label_replace(
              label_replace(
                container_cpu_usage_seconds_total{metrics_path="/metrics/cadvisor"}
                *
                on(pod, cluster) group_left(label_type, label_stage, label_queue_pod_name, label_deployment)
                topk by (pod, cluster, label_type, label_stage, label_queue_pod_name, label_deployment) (1, kube_pod_labels{
                  label_type!=""
                }),
                "shard", "$1", "label_queue_pod_name", "(.*)"
              ),
              "stage", "$1", "label_stage", "(.*)"
            ),
            "type", "$1", "label_type", "(.*)"
          ),
          "deployment", "$1", "label_deployment", "(.*)"
        )
      )
  - record: container_memory_cache:labeled
    expr: |
      min without(label_queue_pod_name, label_stage, label_type, label_deployment)
      (
        label_replace(
          label_replace(
            label_replace(
              label_replace(
                container_memory_cache{metrics_path="/metrics/cadvisor"}
                *
                on(pod, cluster) group_left(label_type, label_stage, label_queue_pod_name, label_deployment)
                topk by (pod, cluster, label_type, label_stage, label_queue_pod_name, label_deployment) (1, kube_pod_labels{
                  label_type!=""
                }),
                "shard", "$1", "label_queue_pod_name", "(.*)"
              ),
              "stage", "$1", "label_stage", "(.*)"
            ),
            "type", "$1", "label_type", "(.*)"
          ),
          "deployment", "$1", "label_deployment", "(.*)"
        )
      )
  - record: container_memory_swap:labeled
    expr: |
      min without(label_queue_pod_name, label_stage, label_type, label_deployment)
      (
        label_replace(
          label_replace(
            label_replace(
              label_replace(
                container_memory_swap{metrics_path="/metrics/cadvisor"}
                *
                on(pod, cluster) group_left(label_type, label_stage, label_queue_pod_name, label_deployment)
                topk by (pod, cluster, label_type, label_stage, label_queue_pod_name, label_deployment) (1, kube_pod_labels{
                  label_type!=""
                }),
                "shard", "$1", "label_queue_pod_name", "(.*)"
              ),
              "stage", "$1", "label_stage", "(.*)"
            ),
            "type", "$1", "label_type", "(.*)"
          ),
          "deployment", "$1", "label_deployment", "(.*)"
        )
      )
  - record: container_memory_usage_bytes:labeled
    expr: |
      min without(label_queue_pod_name, label_stage, label_type, label_deployment)
      (
        label_replace(
          label_replace(
            label_replace(
              label_replace(
                container_memory_usage_bytes{metrics_path="/metrics/cadvisor"}
                *
                on(pod, cluster) group_left(label_type, label_stage, label_queue_pod_name, label_deployment)
                topk by (pod, cluster, label_type, label_stage, label_queue_pod_name, label_deployment) (1, kube_pod_labels{
                  label_type!=""
                }),
                "shard", "$1", "label_queue_pod_name", "(.*)"
              ),
              "stage", "$1", "label_stage", "(.*)"
            ),
            "type", "$1", "label_type", "(.*)"
          ),
          "deployment", "$1", "label_deployment", "(.*)"
        )
      )
  - record: container_memory_working_set_bytes:labeled
    expr: |
      min without(label_queue_pod_name, label_stage, label_type, label_deployment)
      (
        label_replace(
          label_replace(
            label_replace(
              label_replace(
                container_memory_working_set_bytes{metrics_path="/metrics/cadvisor"}
                *
                on(pod, cluster) group_left(label_type, label_stage, label_queue_pod_name, label_deployment)
                topk by (pod, cluster, label_type, label_stage, label_queue_pod_name, label_deployment) (1, kube_pod_labels{
                  label_type!=""
                }),
                "shard", "$1", "label_queue_pod_name", "(.*)"
              ),
              "stage", "$1", "label_stage", "(.*)"
            ),
            "type", "$1", "label_type", "(.*)"
          ),
          "deployment", "$1", "label_deployment", "(.*)"
        )
      )
  - record: container_network_receive_bytes_total:labeled
    expr: |
      min without(label_queue_pod_name, label_stage, label_type, label_deployment)
      (
        label_replace(
          label_replace(
            label_replace(
              label_replace(
                container_network_receive_bytes_total{metrics_path="/metrics/cadvisor"}
                *
                on(pod, cluster) group_left(label_type, label_stage, label_queue_pod_name, label_deployment)
                topk by (pod, cluster, label_type, label_stage, label_queue_pod_name, label_deployment) (1, kube_pod_labels{
                  label_type!=""
                }),
                "shard", "$1", "label_queue_pod_name", "(.*)"
              ),
              "stage", "$1", "label_stage", "(.*)"
            ),
            "type", "$1", "label_type", "(.*)"
          ),
          "deployment", "$1", "label_deployment", "(.*)"
        )
      )
  - record: container_network_transmit_bytes_total:labeled
    expr: |
      min without(label_queue_pod_name, label_stage, label_type, label_deployment)
      (
        label_replace(
          label_replace(
            label_replace(
              label_replace(
                container_network_transmit_bytes_total{metrics_path="/metrics/cadvisor"}
                *
                on(pod, cluster) group_left(label_type, label_stage, label_queue_pod_name, label_deployment)
                topk by (pod, cluster, label_type, label_stage, label_queue_pod_name, label_deployment) (1, kube_pod_labels{
                  label_type!=""
                }),
                "shard", "$1", "label_queue_pod_name", "(.*)"
              ),
              "stage", "$1", "label_stage", "(.*)"
            ),
            "type", "$1", "label_type", "(.*)"
          ),
          "deployment", "$1", "label_deployment", "(.*)"
        )
      )
  - record: container_spec_cpu_period:labeled
    expr: |
      min without(label_queue_pod_name, label_stage, label_type, label_deployment)
      (
        label_replace(
          label_replace(
            label_replace(
              label_replace(
                container_spec_cpu_period{metrics_path="/metrics/cadvisor"}
                *
                on(pod, cluster) group_left(label_type, label_stage, label_queue_pod_name, label_deployment)
                topk by (pod, cluster, label_type, label_stage, label_queue_pod_name, label_deployment) (1, kube_pod_labels{
                  label_type!=""
                }),
                "shard", "$1", "label_queue_pod_name", "(.*)"
              ),
              "stage", "$1", "label_stage", "(.*)"
            ),
            "type", "$1", "label_type", "(.*)"
          ),
          "deployment", "$1", "label_deployment", "(.*)"
        )
      )
  - record: container_spec_cpu_quota:labeled
    expr: |
      min without(label_queue_pod_name, label_stage, label_type, label_deployment)
      (
        label_replace(
          label_replace(
            label_replace(
              label_replace(
                container_spec_cpu_quota{metrics_path="/metrics/cadvisor"}
                *
                on(pod, cluster) group_left(label_type, label_stage, label_queue_pod_name, label_deployment)
                topk by (pod, cluster, label_type, label_stage, label_queue_pod_name, label_deployment) (1, kube_pod_labels{
                  label_type!=""
                }),
                "shard", "$1", "label_queue_pod_name", "(.*)"
              ),
              "stage", "$1", "label_stage", "(.*)"
            ),
            "type", "$1", "label_type", "(.*)"
          ),
          "deployment", "$1", "label_deployment", "(.*)"
        )
      )
  - record: container_spec_memory_limit_bytes:labeled
    expr: |
      min without(label_queue_pod_name, label_stage, label_type, label_deployment)
      (
        label_replace(
          label_replace(
            label_replace(
              label_replace(
                container_spec_memory_limit_bytes{metrics_path="/metrics/cadvisor"}
                *
                on(pod, cluster) group_left(label_type, label_stage, label_queue_pod_name, label_deployment)
                topk by (pod, cluster, label_type, label_stage, label_queue_pod_name, label_deployment) (1, kube_pod_labels{
                  label_type!=""
                }),
                "shard", "$1", "label_queue_pod_name", "(.*)"
              ),
              "stage", "$1", "label_stage", "(.*)"
            ),
            "type", "$1", "label_type", "(.*)"
          ),
          "deployment", "$1", "label_deployment", "(.*)"
        )
      )
  - record: kube_pod_container_status_running:labeled
    expr: |
      min without(label_queue_pod_name, label_stage, label_type, label_deployment)
      (
        label_replace(
          label_replace(
            label_replace(
              label_replace(
                kube_pod_container_status_running
                *
                on(pod, cluster) group_left(label_type, label_stage, label_queue_pod_name, label_deployment)
                topk by (pod, cluster, label_type, label_stage, label_queue_pod_name, label_deployment) (1, kube_pod_labels{
                  label_type!=""
                }),
                "shard", "$1", "label_queue_pod_name", "(.*)"
              ),
              "stage", "$1", "label_stage", "(.*)"
            ),
            "type", "$1", "label_type", "(.*)"
          ),
          "deployment", "$1", "label_deployment", "(.*)"
        )
      )
  - record: kube_pod_container_resource_limits_cpu_cores:labeled
    expr: |
      min without(label_queue_pod_name, label_stage, label_type, label_deployment)
      (
        label_replace(
          label_replace(
            label_replace(
              label_replace(
                kube_pod_container_resource_limits_cpu_cores
                *
                on(pod, cluster) group_left(label_type, label_stage, label_queue_pod_name, label_deployment)
                topk by (pod, cluster, label_type, label_stage, label_queue_pod_name, label_deployment) (1, kube_pod_labels{
                  label_type!=""
                }),
                "shard", "$1", "label_queue_pod_name", "(.*)"
              ),
              "stage", "$1", "label_stage", "(.*)"
            ),
            "type", "$1", "label_type", "(.*)"
          ),
          "deployment", "$1", "label_deployment", "(.*)"
        )
      )
  - record: kube_pod_container_resource_limits_memory_bytes:labeled
    expr: |
      min without(label_queue_pod_name, label_stage, label_type, label_deployment)
      (
        label_replace(
          label_replace(
            label_replace(
              label_replace(
                kube_pod_container_resource_limits_memory_bytes
                *
                on(pod, cluster) group_left(label_type, label_stage, label_queue_pod_name, label_deployment)
                topk by (pod, cluster, label_type, label_stage, label_queue_pod_name, label_deployment) (1, kube_pod_labels{
                  label_type!=""
                }),
                "shard", "$1", "label_queue_pod_name", "(.*)"
              ),
              "stage", "$1", "label_stage", "(.*)"
            ),
            "type", "$1", "label_type", "(.*)"
          ),
          "deployment", "$1", "label_deployment", "(.*)"
        )
      )
  - record: kube_pod_container_resource_requests_cpu_cores:labeled
    expr: |
      min without(label_queue_pod_name, label_stage, label_type, label_deployment)
      (
        label_replace(
          label_replace(
            label_replace(
              label_replace(
                kube_pod_container_resource_requests_cpu_cores
                *
                on(pod, cluster) group_left(label_type, label_stage, label_queue_pod_name, label_deployment)
                topk by (pod, cluster, label_type, label_stage, label_queue_pod_name, label_deployment) (1, kube_pod_labels{
                  label_type!=""
                }),
                "shard", "$1", "label_queue_pod_name", "(.*)"
              ),
              "stage", "$1", "label_stage", "(.*)"
            ),
            "type", "$1", "label_type", "(.*)"
          ),
          "deployment", "$1", "label_deployment", "(.*)"
        )
      )
  - record: kube_pod_container_resource_requests_memory_bytes:labeled
    expr: |
      min without(label_queue_pod_name, label_stage, label_type, label_deployment)
      (
        label_replace(
          label_replace(
            label_replace(
              label_replace(
                kube_pod_container_resource_requests_memory_bytes
                *
                on(pod, cluster) group_left(label_type, label_stage, label_queue_pod_name, label_deployment)
                topk by (pod, cluster, label_type, label_stage, label_queue_pod_name, label_deployment) (1, kube_pod_labels{
                  label_type!=""
                }),
                "shard", "$1", "label_queue_pod_name", "(.*)"
              ),
              "stage", "$1", "label_stage", "(.*)"
            ),
            "type", "$1", "label_type", "(.*)"
          ),
          "deployment", "$1", "label_deployment", "(.*)"
        )
      )
  - record: kube_pod_container_status_last_terminated_reason:labeled
    expr: |
      min without(label_queue_pod_name, label_stage, label_type, label_deployment)
      (
        label_replace(
          label_replace(
            label_replace(
              label_replace(
                kube_pod_container_status_last_terminated_reason
                *
                on(pod, cluster) group_left(label_type, label_stage, label_queue_pod_name, label_deployment)
                topk by (pod, cluster, label_type, label_stage, label_queue_pod_name, label_deployment) (1, kube_pod_labels{
                  label_type!=""
                }),
                "shard", "$1", "label_queue_pod_name", "(.*)"
              ),
              "stage", "$1", "label_stage", "(.*)"
            ),
            "type", "$1", "label_type", "(.*)"
          ),
          "deployment", "$1", "label_deployment", "(.*)"
        )
      )
  - record: kube_pod_container_status_ready:labeled
    expr: |
      min without(label_queue_pod_name, label_stage, label_type, label_deployment)
      (
        label_replace(
          label_replace(
            label_replace(
              label_replace(
                kube_pod_container_status_ready
                *
                on(pod, cluster) group_left(label_type, label_stage, label_queue_pod_name, label_deployment)
                topk by (pod, cluster, label_type, label_stage, label_queue_pod_name, label_deployment) (1, kube_pod_labels{
                  label_type!=""
                }),
                "shard", "$1", "label_queue_pod_name", "(.*)"
              ),
              "stage", "$1", "label_stage", "(.*)"
            ),
            "type", "$1", "label_type", "(.*)"
          ),
          "deployment", "$1", "label_deployment", "(.*)"
        )
      )
  - record: kube_pod_container_status_restarts_total:labeled
    expr: |
      min without(label_queue_pod_name, label_stage, label_type, label_deployment)
      (
        label_replace(
          label_replace(
            label_replace(
              label_replace(
                kube_pod_container_status_restarts_total
                *
                on(pod, cluster) group_left(label_type, label_stage, label_queue_pod_name, label_deployment)
                topk by (pod, cluster, label_type, label_stage, label_queue_pod_name, label_deployment) (1, kube_pod_labels{
                  label_type!=""
                }),
                "shard", "$1", "label_queue_pod_name", "(.*)"
              ),
              "stage", "$1", "label_stage", "(.*)"
            ),
            "type", "$1", "label_type", "(.*)"
          ),
          "deployment", "$1", "label_deployment", "(.*)"
        )
      )
  - record: kube_pod_container_status_running:labeled
    expr: |
      min without(label_queue_pod_name, label_stage, label_type, label_deployment)
      (
        label_replace(
          label_replace(
            label_replace(
              label_replace(
                kube_pod_container_status_running
                *
                on(pod, cluster) group_left(label_type, label_stage, label_queue_pod_name, label_deployment)
                topk by (pod, cluster, label_type, label_stage, label_queue_pod_name, label_deployment) (1, kube_pod_labels{
                  label_type!=""
                }),
                "shard", "$1", "label_queue_pod_name", "(.*)"
              ),
              "stage", "$1", "label_stage", "(.*)"
            ),
            "type", "$1", "label_type", "(.*)"
          ),
          "deployment", "$1", "label_deployment", "(.*)"
        )
      )
  - record: kube_pod_container_status_terminated:labeled
    expr: |
      min without(label_queue_pod_name, label_stage, label_type, label_deployment)
      (
        label_replace(
          label_replace(
            label_replace(
              label_replace(
                kube_pod_container_status_terminated
                *
                on(pod, cluster) group_left(label_type, label_stage, label_queue_pod_name, label_deployment)
                topk by (pod, cluster, label_type, label_stage, label_queue_pod_name, label_deployment) (1, kube_pod_labels{
                  label_type!=""
                }),
                "shard", "$1", "label_queue_pod_name", "(.*)"
              ),
              "stage", "$1", "label_stage", "(.*)"
            ),
            "type", "$1", "label_type", "(.*)"
          ),
          "deployment", "$1", "label_deployment", "(.*)"
        )
      )
  - record: kube_pod_container_status_terminated_reason:labeled
    expr: |
      min without(label_queue_pod_name, label_stage, label_type, label_deployment)
      (
        label_replace(
          label_replace(
            label_replace(
              label_replace(
                kube_pod_container_status_terminated_reason
                *
                on(pod, cluster) group_left(label_type, label_stage, label_queue_pod_name, label_deployment)
                topk by (pod, cluster, label_type, label_stage, label_queue_pod_name, label_deployment) (1, kube_pod_labels{
                  label_type!=""
                }),
                "shard", "$1", "label_queue_pod_name", "(.*)"
              ),
              "stage", "$1", "label_stage", "(.*)"
            ),
            "type", "$1", "label_type", "(.*)"
          ),
          "deployment", "$1", "label_deployment", "(.*)"
        )
      )
  - record: kube_pod_container_status_waiting:labeled
    expr: |
      min without(label_queue_pod_name, label_stage, label_type, label_deployment)
      (
        label_replace(
          label_replace(
            label_replace(
              label_replace(
                kube_pod_container_status_waiting
                *
                on(pod, cluster) group_left(label_type, label_stage, label_queue_pod_name, label_deployment)
                topk by (pod, cluster, label_type, label_stage, label_queue_pod_name, label_deployment) (1, kube_pod_labels{
                  label_type!=""
                }),
                "shard", "$1", "label_queue_pod_name", "(.*)"
              ),
              "stage", "$1", "label_stage", "(.*)"
            ),
            "type", "$1", "label_type", "(.*)"
          ),
          "deployment", "$1", "label_deployment", "(.*)"
        )
      )
  - record: kube_pod_container_status_waiting_reason:labeled
    expr: |
      min without(label_queue_pod_name, label_stage, label_type, label_deployment)
      (
        label_replace(
          label_replace(
            label_replace(
              label_replace(
                kube_pod_container_status_waiting_reason
                *
                on(pod, cluster) group_left(label_type, label_stage, label_queue_pod_name, label_deployment)
                topk by (pod, cluster, label_type, label_stage, label_queue_pod_name, label_deployment) (1, kube_pod_labels{
                  label_type!=""
                }),
                "shard", "$1", "label_queue_pod_name", "(.*)"
              ),
              "stage", "$1", "label_stage", "(.*)"
            ),
            "type", "$1", "label_type", "(.*)"
          ),
          "deployment", "$1", "label_deployment", "(.*)"
        )
      )
  - record: kube_hpa_spec_target_metric:labeled
    expr: |
      min without(label_shard, label_stage, label_type, label_tier)
      (
        label_replace(
          label_replace(
            label_replace(
              label_replace(
                kube_hpa_spec_target_metric
                *
                on(hpa, cluster) group_left(label_shard, label_stage, label_type, label_tier)
                topk by (hpa, cluster) (1, kube_hpa_labels{
                  label_type!=""
                }),
                "shard", "$1", "label_shard", "(.*)"
              ),
              "stage", "$1", "label_stage", "(.*)"
            ),
            "type", "$1", "label_type", "(.*)"
          ),
          "tier", "$1", "label_tier", "(.*)"
        )
      )
  - record: kube_hpa_status_condition:labeled
    expr: |
      min without(label_shard, label_stage, label_type, label_tier)
      (
        label_replace(
          label_replace(
            label_replace(
              label_replace(
                kube_hpa_status_condition
                *
                on(hpa, cluster) group_left(label_shard, label_stage, label_type, label_tier)
                topk by (hpa, cluster) (1, kube_hpa_labels{
                  label_type!=""
                }),
                "shard", "$1", "label_shard", "(.*)"
              ),
              "stage", "$1", "label_stage", "(.*)"
            ),
            "type", "$1", "label_type", "(.*)"
          ),
          "tier", "$1", "label_tier", "(.*)"
        )
      )
  - record: kube_hpa_status_current_replicas:labeled
    expr: |
      min without(label_shard, label_stage, label_type, label_tier)
      (
        label_replace(
          label_replace(
            label_replace(
              label_replace(
                kube_hpa_status_current_replicas
                *
                on(hpa, cluster) group_left(label_shard, label_stage, label_type, label_tier)
                topk by (hpa, cluster) (1, kube_hpa_labels{
                  label_type!=""
                }),
                "shard", "$1", "label_shard", "(.*)"
              ),
              "stage", "$1", "label_stage", "(.*)"
            ),
            "type", "$1", "label_type", "(.*)"
          ),
          "tier", "$1", "label_tier", "(.*)"
        )
      )
  - record: kube_hpa_status_desired_replicas:labeled
    expr: |
      min without(label_shard, label_stage, label_type, label_tier)
      (
        label_replace(
          label_replace(
            label_replace(
              label_replace(
                kube_hpa_status_desired_replicas
                *
                on(hpa, cluster) group_left(label_shard, label_stage, label_type, label_tier)
                topk by (hpa, cluster) (1, kube_hpa_labels{
                  label_type!=""
                }),
                "shard", "$1", "label_shard", "(.*)"
              ),
              "stage", "$1", "label_stage", "(.*)"
            ),
            "type", "$1", "label_type", "(.*)"
          ),
          "tier", "$1", "label_tier", "(.*)"
        )
      )
  - record: kube_hpa_metadata_generation:labeled
    expr: |
      min without(label_shard, label_stage, label_type, label_tier)
      (
        label_replace(
          label_replace(
            label_replace(
              label_replace(
                kube_hpa_metadata_generation
                *
                on(hpa, cluster) group_left(label_shard, label_stage, label_type, label_tier)
                topk by (hpa, cluster) (1, kube_hpa_labels{
                  label_type!=""
                }),
                "shard", "$1", "label_shard", "(.*)"
              ),
              "stage", "$1", "label_stage", "(.*)"
            ),
            "type", "$1", "label_type", "(.*)"
          ),
          "tier", "$1", "label_tier", "(.*)"
        )
      )
  - record: kube_hpa_spec_max_replicas:labeled
    expr: |
      min without(label_shard, label_stage, label_type, label_tier)
      (
        label_replace(
          label_replace(
            label_replace(
              label_replace(
                kube_hpa_spec_max_replicas
                *
                on(hpa, cluster) group_left(label_shard, label_stage, label_type, label_tier)
                topk by (hpa, cluster) (1, kube_hpa_labels{
                  label_type!=""
                }),
                "shard", "$1", "label_shard", "(.*)"
              ),
              "stage", "$1", "label_stage", "(.*)"
            ),
            "type", "$1", "label_type", "(.*)"
          ),
          "tier", "$1", "label_tier", "(.*)"
        )
      )
  - record: kube_hpa_spec_min_replicas:labeled
    expr: |
      min without(label_shard, label_stage, label_type, label_tier)
      (
        label_replace(
          label_replace(
            label_replace(
              label_replace(
                kube_hpa_spec_min_replicas
                *
                on(hpa, cluster) group_left(label_shard, label_stage, label_type, label_tier)
                topk by (hpa, cluster) (1, kube_hpa_labels{
                  label_type!=""
                }),
                "shard", "$1", "label_shard", "(.*)"
              ),
              "stage", "$1", "label_stage", "(.*)"
            ),
            "type", "$1", "label_type", "(.*)"
          ),
          "tier", "$1", "label_tier", "(.*)"
        )
      )
