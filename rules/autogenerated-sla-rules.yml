# WARNING. DO NOT EDIT THIS FILE BY HAND. USE ./scripts/generate-sla-recording-rules.sh TO GENERATE IT
# YOUR CHANGES WILL BE OVERRIDDEN
groups:
- name: SLA weight calculations
  interval: 5m
  rules:
  - record: sla:gitlab:score
    expr: |
      sum by (environment, stage) (
        min without(slo) (avg_over_time(slo_observation_status{type="api"}[5m])) * 3
        or
        min without(slo) (avg_over_time(slo_observation_status{type="ci-runners"}[5m])) * 3
        or
        min without(slo) (avg_over_time(slo_observation_status{type="git"}[5m])) * 3
        or
        min without(slo) (avg_over_time(slo_observation_status{type="registry"}[5m])) * 1
        or
        min without(slo) (avg_over_time(slo_observation_status{type="sidekiq"}[5m])) * 2
        or
        min without(slo) (avg_over_time(slo_observation_status{type="web"}[5m])) * 5
      )
  - record: sla:gitlab:weights
    expr: |
      sum by (environment, stage) (
        max without(slo) (slo_observation_status{type="api"} / slo_observation_status{type="api"}) * 3
        or
        max without(slo) (slo_observation_status{type="ci-runners"} / slo_observation_status{type="ci-runners"}) * 3
        or
        max without(slo) (slo_observation_status{type="git"} / slo_observation_status{type="git"}) * 3
        or
        max without(slo) (slo_observation_status{type="registry"} / slo_observation_status{type="registry"}) * 1
        or
        max without(slo) (slo_observation_status{type="sidekiq"} / slo_observation_status{type="sidekiq"}) * 2
        or
        max without(slo) (slo_observation_status{type="web"} / slo_observation_status{type="web"}) * 5
      )
