groups:
# Derived from rules in: rules/autogenerated-key-metrics-web.yml
- name: 'Experimental Component-Level SLIs: web - 1h burn-rate'
  interval: 1m
  rules:
  - record: offset_experiment:gitlab_component_apdex:success:rate_1h
    labels:
      component: rails_request
      tier: sv
      type: web
    expr: |
      sum by (env,environment,stage) (
        offset_experiment:sli_aggregations:gitlab_sli_rails_request_apdex_success_total_rate1h{job="gitlab-rails",type="web"} offset 30s
      )
  - record: offset_experiment:gitlab_component_apdex:weight:score_1h
    labels:
      component: rails_request
      tier: sv
      type: web
    expr: |
      sum by (env,environment,stage) (
        offset_experiment:sli_aggregations:gitlab_sli_rails_request_apdex_total_rate1h{job="gitlab-rails",type="web"} offset 30s
      )
  - record: offset_experiment:sli_aggregations:gitlab_sli_rails_request_apdex_total_rate1h
    expr: |
      sum by (endpoint_id,environment,feature_category,job,request_urgency,shard,stage,tier,type) (
        rate(gitlab_sli_rails_request_apdex_total{ type="web"}[1h] offset 30s)
      )
  - record: offset_experiment:sli_aggregations:gitlab_sli_rails_request_apdex_success_total_rate1h
    expr: |
      sum by (endpoint_id,environment,feature_category,job,request_urgency,shard,stage,tier,type) (
        rate(gitlab_sli_rails_request_apdex_success_total{ type="web"}[1h] offset 30s)
      )
