# Recording rules

The files in here are [Prometheus recording rules][rr] generated by the
files in [rules-jsonnet/recording-rules.jsonnet][rr.jsonnet]

[rr]: https://prometheus.io/docs/prometheus/latest/configuration/recording_rules/
[rr.jsonnet]: /rules-jsonnet/recording-rules.jsonnet

## Autogenerated key metrics

Many of the files here are autogenerated key metrics. These contain
component-level SLIs, and these feed up to our [overall SLAs][slas].

When one of these files changes, please try to avoid any impact to the
overall SLAs. When changing a recording rule to match a server change
(for instance, new labels for a particular metric), use the [`combined`
function][combined] to avoid having a break in the recorded SLI:

1. Use `combined([oldQuery, newQuery])` and merge this change.
1. Apply the change to the underlying service.
1. Once the old query is no longer matching any results, change to
   simply using `newQuery`.

See [scalability#206][issue-206] for an example of where this went
wrong!

[slas]: https://about.gitlab.com/handbook/engineering/infrastructure/performance-indicators/#gitlab-com-availability
[combined]: /metrics-catalog/lib/combined.libsonnet
[issue-206]: https://gitlab.com/gitlab-com/gl-infra/scalability/-/issues/206
