# WARNING. DO NOT EDIT THIS FILE BY HAND. USE ./rules-jsonnet/utilization.jsonnet TO GENERATE IT
# YOUR CHANGES WILL BE OVERRIDDEN
groups:
- name: Utilization Rules (autogenerated)
  interval: 5m
  rules:
  - record: gitlab_component_saturation:ratio
    labels:
      component: cloudflare_data_transfer
    expr: |
      topk by(environment, tier, type, stage) (10,
        sum by (environment, tier, type, stage, zone) (
          rate(cloudflare_zones_http_country_bytes_total{type="waf"}[1h])
        )
      )
  - record: gitlab_component_saturation:ratio
    labels:
      component: pg_table_size
    expr: |
      topk by(environment, tier, type, stage) (10,
        avg by (environment, tier, type, stage, relname) (
          avg_over_time(pg_total_relation_size_bytes{type=~"patroni|sentry"}[1h])
          and on (job, instance) (
            pg_replication_is_replica{type=~"patroni|sentry"} == 0
          )
        )
      )
