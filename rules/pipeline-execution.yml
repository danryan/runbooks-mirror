groups:
  - name: Pipeline Execution metrics
    rules:
      - record: pipeline_creation_step_duration:p50
        expr: |
          histogram_quantile(
            0.50,
            sum(
              rate(
                gitlab_ci_pipeline_creation_step_duration_seconds_bucket[1m]
              )
            )
            by (le, step, env, stage)
          )

      - record: pipeline_creation_step_duration:p90
        expr: |
          histogram_quantile(
            0.90,
            sum(
              rate(
                gitlab_ci_pipeline_creation_step_duration_seconds_bucket[1m]
              )
            )
            by (le, step, env, stage)
          )
      - record: pipeline_creation_step_duration:p99
        expr: |
          histogram_quantile(
            0.99,
            sum(
              rate(
                gitlab_ci_pipeline_creation_step_duration_seconds_bucket[1m]
              )
            )
            by (le, step, env, stage)
          )
