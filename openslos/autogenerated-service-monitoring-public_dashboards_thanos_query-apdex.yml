# HEADER
apiVersion: openslo/v1alpha
kind: SLO
metadata:
  name: service-monitoring-public_dashboards_thanos_query-apdex
spec:
  budgetingMethod: Occurrences
  description: |
    Thanos query gathers the data needed to evaluate Prometheus queries from multiple underlying prometheus and thanos instances.
    This SLI monitors the Thanos query HTTP interface for GitLab's public Thanos instance, which is used by the public Grafana
    instance. 5xx responses are considered failures.
  objectives:
  - ratioMetrics:
      good:
        query: sum(rate(apiserver_request_total{code!~"(5..|429)"}[{{.window}}]))
        queryType: promql
        source: prometheus
      target: 0.999
      total:
        query: sum(rate(apiserver_request_total[{{.window}}]))
        queryType: promql
        source: prometheus
  service: monitoring
  timeWindows:
  - count: 30
    unit: Day
