{"__inputs":[],"__requires":[],"annotations":{"list":[{"builtIn":1,"datasource":"-- Grafana --","enable":true,"hide":false,"iconColor":"#96D98D","name":"deploy","showIn":0,"tags":["deploy","$environment"],"type":"tags"},{"builtIn":1,"datasource":"-- Grafana --","enable":false,"hide":false,"iconColor":"#FFEE52","name":"canary-deploy","showIn":0,"tags":["deploy","${environment}-cny"],"type":"tags"},{"builtIn":1,"datasource":"-- Grafana --","enable":false,"hide":false,"iconColor":"#CA95E5","name":"feature-flags","showIn":0,"tags":["feature-flag","${environment}"],"type":"tags"}]},"editable":false,"gnetId":null,"graphTooltip":1,"hideControls":false,"id":null,"links":[{"asDropdown":true,"icon":"external link","includeVars":false,"keepTime":true,"tags":"","targetBlank":false,"title":"Platform Triage","type":"link","url":"https://dashboards.gitlab.net/d/general-triage/platform-triage?orgId=1"},{"asDropdown":true,"icon":"external link","includeVars":true,"keepTime":true,"tags":["managed","service overview"],"targetBlank":false,"title":"Service Overview Dashboards","type":"dashboards","url":""},{"asDropdown":true,"icon":"dashboard","includeVars":true,"keepTime":true,"tags":"type:sentry","targetBlank":false,"title":"sentry Detail","type":"dashboards","url":""},{"asDropdown":true,"icon":"external link","includeVars":true,"keepTime":true,"tags":["managed","type:sentry","kube detail"],"targetBlank":false,"title":"☸️ sentry Kubernetes Detail","type":"dashboards","url":""}],"panels":[{"collapse":false,"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":0},"id":2,"panels":[],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"🌡️ Aggregated Service Level Indicators (𝙎𝙇𝙄𝙨)","titleSize":"h6","type":"row"},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Error rates are a measure of unhandled service exceptions per second. Client errors are excluded when possible. Lower is better","fill":0,"fillGradient":0,"gridPos":{"h":9,"w":8,"x":0,"y":1},"id":188042935,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","options":{"dataLinks":[{"targetBlank":true,"title":"sentry Service Error-Rate SLO Analysis","url":"/d/alerts-service_slo_error?${__url_time_range}&${__all_variables}&var-type=sentry&var-stage=$stage"}]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/6h Degradation SLO \\(5% of monthly error budget\\).*/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/1h Outage SLO \\(2% of monthly error budget\\).*/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/.*shard (apdex|error ratio|RPS)$/","color":"#E7D551"},{"alias":"sentry error ratio avg","color":"#5794F2","dashLength":1,"fillGradient":10,"linewidth":1,"spaceLength":1,"zindex":-3},{"alias":"last week","color":"#dddddd80","dashLength":4,"dashes":true,"fill":0,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":2,"zindex":-3},{"alias":"sentry error ratio","color":"#E7D551","fillBelowTo":"sentry error ratio avg","zindex":3}],"spaceLength":10,"stableId":"service-sentry-error-rate","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_max(\n  max_over_time(gitlab_service_errors:ratio_5m{env=\"ops\",environment=\"ops\",monitor=\"global\",stage=\"$stage\",type=\"sentry\"}[$__interval])\n,\n  1\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"sentry error ratio","refId":"A"},{"expr":"(6 * avg(slo:max:events:gitlab_service_errors:ratio{component=\"\",monitor=\"global\",type=\"sentry\"})\n)\n","format":"time_series","interval":"5m","intervalFactor":1,"legendFormat":"6h Degradation SLO (5% of monthly error budget)","refId":"B"},{"expr":"(14.4 * avg(slo:max:events:gitlab_service_errors:ratio{component=\"\",monitor=\"global\",type=\"sentry\"})\n)\n","format":"time_series","interval":"5m","intervalFactor":1,"legendFormat":"1h Outage SLO (2% of monthly error budget)","refId":"C"},{"expr":"clamp_max(\n  avg_over_time(gitlab_service_errors:ratio_5m{env=\"ops\",environment=\"ops\",monitor=\"global\",stage=\"$stage\",type=\"sentry\"}[$__interval])\n,\n  1\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"sentry error ratio avg","refId":"D"},{"expr":"clamp_max(\n  gitlab_service_errors:ratio_5m{env=\"ops\",environment=\"ops\",monitor=\"global\",stage=\"$stage\",type=\"sentry\"} offset 1w\n,\n  scalar(max((14.4 * avg(slo:max:events:gitlab_service_errors:ratio{component=\"\",monitor=\"global\",type=\"sentry\"})\n)\n))\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"last week","refId":"E"}],"title":"sentry Service Error Ratio","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"percentunit","label":"Error %","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"datasource":"$PROMETHEUS_DS","description":"","fieldConfig":{"defaults":{"decimals":0,"displayName":"Status","mappings":[{"id":0,"options":{"0":{"color":"black","index":0,"text":"Healthy"},"1":{"color":"orange","index":1,"text":"Warning: 1h deteriorating"},"10":{"color":"orange","index":10,"text":"Warning: 6h recovering, 1h recovering"},"11":{"color":"red","index":11,"text":"Degraded: 6h recovering, 1h degraded"},"12":{"color":"red","index":12,"text":"Degraded: 6h degraded"},"13":{"color":"red","index":13,"text":"Degraded: 6h degraded, 1h deteriorating"},"14":{"color":"red","index":14,"text":"Degraded: 6h degraded, 1h recovering"},"15":{"color":"red","index":15,"text":"Degraded: 6h degraded, 1h degraded"},"2":{"color":"orange","index":2,"text":"Warning: 1h recovering"},"3":{"color":"red","index":3,"text":"Degraded: 1h degraded"},"4":{"color":"orange","index":4,"text":"Warning: 6h deteriorating"},"5":{"color":"orange","index":5,"text":"Warning: 6h deteriorating, 1h deteriorating"},"6":{"color":"orange","index":6,"text":"Warning: 6h deteriorating, 1h recovering"},"7":{"color":"red","index":7,"text":"Degraded: 6h deteriorating, 1h degraded"},"8":{"color":"orange","index":8,"text":"Warning: 6h recovering"},"9":{"color":"orange","index":9,"text":"Warning: 6h recovering, 1h deteriorating"}},"type":"value"}],"thresholds":{"mode":"absolute","steps":[{"color":"black","value":0},{"color":"orange","value":1},{"color":"orange","value":2},{"color":"red","value":3},{"color":"orange","value":4},{"color":"orange","value":5},{"color":"orange","value":6},{"color":"red","value":7},{"color":"orange","value":8},{"color":"orange","value":9},{"color":"orange","value":10},{"color":"red","value":11},{"color":"red","value":12},{"color":"red","value":13},{"color":"red","value":14},{"color":"red","value":15}]},"unit":"none"}},"gridPos":{"h":1,"w":8,"x":0,"y":10},"id":4,"options":{"colorMode":"background","graphMode":"none","justifyMode":"auto","orientation":"vertical","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"7","targets":[{"expr":"sum(\n  label_replace(\n    vector(0) and on() (gitlab_service_errors:ratio_1h{env=\"ops\",environment=\"ops\",monitor=\"global\",stage=\"$stage\",type=\"sentry\"}),\n    \"period\", \"na\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(1) and on () (gitlab_service_errors:ratio_5m{env=\"ops\",environment=\"ops\",monitor=\"global\",stage=\"$stage\",type=\"sentry\"} > on(tier, type, __tenant_id__) group_left() (14.4 * slo:max:events:gitlab_service_errors:ratio{component=\"\",monitor=\"global\",type=\"sentry\"})),\n    \"period\", \"5m\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(2) and on () (gitlab_service_errors:ratio_1h{env=\"ops\",environment=\"ops\",monitor=\"global\",stage=\"$stage\",type=\"sentry\"} > on(tier, type, __tenant_id__) group_left() (14.4 * slo:max:events:gitlab_service_errors:ratio{component=\"\",monitor=\"global\",type=\"sentry\"})),\n    \"period\", \"1h\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(4) and on () (gitlab_service_errors:ratio_30m{env=\"ops\",environment=\"ops\",monitor=\"global\",stage=\"$stage\",type=\"sentry\"} > on(tier, type, __tenant_id__) group_left() (6 * slo:max:events:gitlab_service_errors:ratio{component=\"\",monitor=\"global\",type=\"sentry\"})),\n    \"period\", \"30m\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(8) and on () (gitlab_service_errors:ratio_6h{env=\"ops\",environment=\"ops\",monitor=\"global\",stage=\"$stage\",type=\"sentry\"} > on(tier, type, __tenant_id__) group_left() (6 * slo:max:events:gitlab_service_errors:ratio{component=\"\",monitor=\"global\",type=\"sentry\"})),\n    \"period\", \"6h\", \"\", \"\"\n  )\n)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":1,"legendFormat":"sentry Service | Errors","refId":"A"}],"title":"","transparent":false,"type":"stat"},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"The operation rate is the sum total of all requests being handle for all components within this service. Note that a single user request can lead to requests to multiple components. Higher is busier.","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":8,"x":8,"y":1},"id":1509854405,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/.*shard (apdex|error ratio|RPS)$/","color":"#E7D551"},{"alias":"sentry RPS","color":"#E7D551","zindex":3},{"alias":"last week","color":"#dddddd80","dashLength":4,"dashes":true,"fill":0,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":2,"zindex":-3},{"alias":"upper normal","color":"#73BF69","dashLength":8,"dashes":true,"fillBelowTo":"lower normal","legend":false,"lines":false,"linewidth":1,"nullPointMode":"connected","spaceLength":8,"zindex":-3},{"alias":"lower normal","color":"#73BF69","dashLength":8,"dashes":true,"legend":false,"lines":false,"linewidth":1,"nullPointMode":"connected","spaceLength":8,"zindex":-3}],"spaceLength":10,"stableId":"service-sentry-ops-rate","stack":false,"steppedLine":false,"targets":[{"expr":"avg_over_time(gitlab_service_ops:rate_5m{env=\"ops\",environment=\"ops\",monitor=\"global\",stage=\"$stage\",type=\"sentry\"}[$__interval])\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"sentry RPS","refId":"A"},{"expr":"gitlab_service_ops:rate_5m{env=\"ops\",environment=\"ops\",monitor=\"global\",stage=\"$stage\",type=\"sentry\"} offset 1w\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"last week","refId":"B"},{"expr":"clamp_min(\n  avg by (type) (\n    gitlab_service_ops:rate:prediction{env=\"ops\",environment=\"ops\",monitor=\"global\",stage=\"$stage\",type=\"sentry\"}\n    + (1) *\n    gitlab_service_ops:rate:stddev_over_time_1w{env=\"ops\",environment=\"ops\",monitor=\"global\",stage=\"$stage\",type=\"sentry\"}\n  ),\n  0\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"upper normal","refId":"C"},{"expr":"clamp_min(\n  avg by (type) (\n    gitlab_service_ops:rate:prediction{env=\"ops\",environment=\"ops\",monitor=\"global\",stage=\"$stage\",type=\"sentry\"}\n    + (-1) *\n    gitlab_service_ops:rate:stddev_over_time_1w{env=\"ops\",environment=\"ops\",monitor=\"global\",stage=\"$stage\",type=\"sentry\"}\n  ),\n  0\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"lower normal","refId":"D"}],"title":"sentry Service RPS - Requests per Second","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Operations per Second","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Saturation is a measure of what ratio of a finite resource is currently being utilized. Lower is better.","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":8,"x":16,"y":1},"id":1217942947,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[{"title":"sentry Service | kube_container_cpu resource Dashboard","url":"https://dashboards.gitlab.net/d/alerts-sat_kube_container_cpu/?var-environment=gprd&var-type=sentry&var-stage=main&var-component=kube_container_cpu"},{"title":"sentry Service | kube_container_cpu_limit resource Dashboard","url":"https://dashboards.gitlab.net/d/alerts-sat_kube_container_cpu_limit/?var-environment=gprd&var-type=sentry&var-stage=main&var-component=kube_container_cpu_limit"},{"title":"sentry Service | kube_container_memory resource Dashboard","url":"https://dashboards.gitlab.net/d/alerts-sat_kube_container_memory/?var-environment=gprd&var-type=sentry&var-stage=main&var-component=kube_container_memory"},{"title":"sentry Service | kube_container_throttling resource Dashboard","url":"https://dashboards.gitlab.net/d/alerts-kube_container_throttling/?var-environment=gprd&var-type=sentry&var-stage=main&var-component=kube_container_throttling"},{"title":"sentry Service | kube_horizontalpodautoscaler_desired_replicas resource Dashboard","url":"https://dashboards.gitlab.net/d/alerts-sat_kube_horizontalpodautoscaler/?var-environment=gprd&var-type=sentry&var-stage=main&var-component=kube_horizontalpodautoscaler_desired_replicas"},{"title":"sentry Service | open_fds resource Dashboard","url":"https://dashboards.gitlab.net/d/alerts-sat_open_fds/?var-environment=gprd&var-type=sentry&var-stage=main&var-component=open_fds"},{"title":"sentry Service | pg_primary_cpu resource Dashboard","url":"https://dashboards.gitlab.net/d/alerts-sat_pg_primary_cpu/?var-environment=gprd&var-type=sentry&var-stage=main&var-component=pg_primary_cpu"},{"title":"sentry Service | pg_xid_wraparound resource Dashboard","url":"https://dashboards.gitlab.net/d/alerts-sat_pg_xid_wraparound/?var-environment=gprd&var-type=sentry&var-stage=main&var-component=pg_xid_wraparound"}],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stableId":"service-utilization","stack":false,"steppedLine":false,"targets":[{"expr":"max(\n  max_over_time(\n    gitlab_component_saturation:ratio{env=\"ops\",environment=\"ops\",stage=\"$stage\",type=\"sentry\"}[$__interval]\n  )\n) by (component)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{ component }} component","refId":"A"}],"title":"Saturation","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"percentunit","label":"Saturation %","logBase":1,"max":1,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"collapse":false,"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":20},"id":7,"panels":[],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"🔬 Service Level Indicators","titleSize":"h6","type":"row"},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Error rates are a measure of unhandled service exceptions per second. Client errors are excluded when possible. Lower is better","fill":0,"fillGradient":0,"gridPos":{"h":7,"w":8,"x":0,"y":21},"id":4240567518,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","options":{"dataLinks":[{"targetBlank":true,"title":"kafka_topics SLI Error-Rate SLO Analysis","url":"/d/alerts-component_slo_error?${__url_time_range}&${__all_variables}&var-component=kafka_topics&var-type=sentry&var-stage=$stage"}]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/6h Degradation SLO \\(5% of monthly error budget\\).*/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/1h Outage SLO \\(2% of monthly error budget\\).*/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/.*shard (apdex|error ratio|RPS)$/","color":"#E7D551"},{"alias":"kafka_topics error ratio avg","color":"#5794F2","dashLength":1,"fillGradient":10,"linewidth":1,"spaceLength":1,"zindex":-3},{"alias":"last week","color":"#dddddd80","dashLength":4,"dashes":true,"fill":0,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":2,"zindex":-3},{"alias":"kafka_topics error ratio","color":"#E7D551","fillBelowTo":"kafka_topics error ratio avg","zindex":3}],"spaceLength":10,"stableId":"sli-kafka_topics-error-rate","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_max(\n  max_over_time(gitlab_component_errors:ratio_5m{component=\"kafka_topics\",env=\"ops\",environment=\"ops\",monitor=\"global\",stage=\"$stage\",type=\"sentry\"}[$__interval])\n,\n  1\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"kafka_topics error ratio","refId":"A"},{"expr":"(6 * avg(slo:max:events:gitlab_service_errors:ratio{component=\"kafka_topics\",monitor=\"global\",type=\"sentry\"})\n)\n","format":"time_series","interval":"5m","intervalFactor":1,"legendFormat":"6h Degradation SLO (5% of monthly error budget)","refId":"B"},{"expr":"(14.4 * avg(slo:max:events:gitlab_service_errors:ratio{component=\"kafka_topics\",monitor=\"global\",type=\"sentry\"})\n)\n","format":"time_series","interval":"5m","intervalFactor":1,"legendFormat":"1h Outage SLO (2% of monthly error budget)","refId":"C"},{"expr":"clamp_max(\n  avg_over_time(gitlab_component_errors:ratio_5m{component=\"kafka_topics\",env=\"ops\",environment=\"ops\",monitor=\"global\",stage=\"$stage\",type=\"sentry\"}[$__interval])\n,\n  1\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"kafka_topics error ratio avg","refId":"D"},{"expr":"clamp_max(\n  gitlab_component_errors:ratio_5m{component=\"kafka_topics\",env=\"ops\",environment=\"ops\",monitor=\"global\",stage=\"$stage\",type=\"sentry\"} offset 1w\n,\n  scalar(max((14.4 * avg(slo:max:events:gitlab_service_errors:ratio{component=\"kafka_topics\",monitor=\"global\",type=\"sentry\"})\n)\n))\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"last week","refId":"E"}],"title":"kafka_topics SLI Error Ratio","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"percentunit","label":"Error %","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"datasource":"$PROMETHEUS_DS","description":"","fieldConfig":{"defaults":{"decimals":0,"displayName":"Status","mappings":[{"id":0,"options":{"0":{"color":"black","index":0,"text":"Healthy"},"1":{"color":"orange","index":1,"text":"Warning: 1h deteriorating"},"10":{"color":"orange","index":10,"text":"Warning: 6h recovering, 1h recovering"},"11":{"color":"red","index":11,"text":"Degraded: 6h recovering, 1h degraded"},"12":{"color":"red","index":12,"text":"Degraded: 6h degraded"},"13":{"color":"red","index":13,"text":"Degraded: 6h degraded, 1h deteriorating"},"14":{"color":"red","index":14,"text":"Degraded: 6h degraded, 1h recovering"},"15":{"color":"red","index":15,"text":"Degraded: 6h degraded, 1h degraded"},"2":{"color":"orange","index":2,"text":"Warning: 1h recovering"},"3":{"color":"red","index":3,"text":"Degraded: 1h degraded"},"4":{"color":"orange","index":4,"text":"Warning: 6h deteriorating"},"5":{"color":"orange","index":5,"text":"Warning: 6h deteriorating, 1h deteriorating"},"6":{"color":"orange","index":6,"text":"Warning: 6h deteriorating, 1h recovering"},"7":{"color":"red","index":7,"text":"Degraded: 6h deteriorating, 1h degraded"},"8":{"color":"orange","index":8,"text":"Warning: 6h recovering"},"9":{"color":"orange","index":9,"text":"Warning: 6h recovering, 1h deteriorating"}},"type":"value"}],"thresholds":{"mode":"absolute","steps":[{"color":"black","value":0},{"color":"orange","value":1},{"color":"orange","value":2},{"color":"red","value":3},{"color":"orange","value":4},{"color":"orange","value":5},{"color":"orange","value":6},{"color":"red","value":7},{"color":"orange","value":8},{"color":"orange","value":9},{"color":"orange","value":10},{"color":"red","value":11},{"color":"red","value":12},{"color":"red","value":13},{"color":"red","value":14},{"color":"red","value":15}]},"unit":"none"}},"gridPos":{"h":1,"w":8,"x":0,"y":28},"id":9,"options":{"colorMode":"background","graphMode":"none","justifyMode":"auto","orientation":"vertical","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"7","targets":[{"expr":"sum(\n  label_replace(\n    vector(0) and on() (gitlab_component_errors:ratio_1h{component=\"kafka_topics\",env=\"ops\",environment=\"ops\",monitor=\"global\",stage=\"$stage\",type=\"sentry\"}),\n    \"period\", \"na\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(1) and on () (gitlab_component_errors:ratio_5m{component=\"kafka_topics\",env=\"ops\",environment=\"ops\",monitor=\"global\",stage=\"$stage\",type=\"sentry\"} > on(tier, type, __tenant_id__) group_left() (14.4 * slo:max:events:gitlab_service_errors:ratio{component=\"kafka_topics\",monitor=\"global\",type=\"sentry\"})),\n    \"period\", \"5m\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(2) and on () (gitlab_component_errors:ratio_1h{component=\"kafka_topics\",env=\"ops\",environment=\"ops\",monitor=\"global\",stage=\"$stage\",type=\"sentry\"} > on(tier, type, __tenant_id__) group_left() (14.4 * slo:max:events:gitlab_service_errors:ratio{component=\"kafka_topics\",monitor=\"global\",type=\"sentry\"})),\n    \"period\", \"1h\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(4) and on () (gitlab_component_errors:ratio_30m{component=\"kafka_topics\",env=\"ops\",environment=\"ops\",monitor=\"global\",stage=\"$stage\",type=\"sentry\"} > on(tier, type, __tenant_id__) group_left() (6 * slo:max:events:gitlab_service_errors:ratio{component=\"kafka_topics\",monitor=\"global\",type=\"sentry\"})),\n    \"period\", \"30m\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(8) and on () (gitlab_component_errors:ratio_6h{component=\"kafka_topics\",env=\"ops\",environment=\"ops\",monitor=\"global\",stage=\"$stage\",type=\"sentry\"} > on(tier, type, __tenant_id__) group_left() (6 * slo:max:events:gitlab_service_errors:ratio{component=\"kafka_topics\",monitor=\"global\",type=\"sentry\"})),\n    \"period\", \"6h\", \"\", \"\"\n  )\n)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":1,"legendFormat":"kafka_topics SLI | Errors","refId":"A"}],"title":"","transparent":false,"type":"stat"},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"The operation rate is the sum total of all requests being handle for all components within this service. Note that a single user request can lead to requests to multiple components. Higher is busier.","fill":0,"fillGradient":0,"gridPos":{"h":8,"w":8,"x":8,"y":21},"id":2486832686,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/.*shard (apdex|error ratio|RPS)$/","color":"#E7D551"},{"alias":"kafka_topics RPS","color":"#E7D551","zindex":3},{"alias":"last week","color":"#dddddd80","dashLength":4,"dashes":true,"fill":0,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":2,"zindex":-3}],"spaceLength":10,"stableId":"sli-kafka_topics-ops-rate","stack":false,"steppedLine":false,"targets":[{"expr":"avg_over_time(gitlab_component_ops:rate_5m{component=\"kafka_topics\",env=\"ops\",environment=\"ops\",monitor=\"global\",stage=\"$stage\",type=\"sentry\"}[$__interval])\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"kafka_topics RPS","refId":"A"},{"expr":"gitlab_component_ops:rate_5m{component=\"kafka_topics\",env=\"ops\",environment=\"ops\",monitor=\"global\",stage=\"$stage\",type=\"sentry\"} offset 1w\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"last week","refId":"B"}],"title":"kafka_topics SLI RPS - Requests per Second","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Operations per Second","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"content":"### Description\n\nRepresents all messages the Sentry Kafka pods processed.\nErrors represent all failed requests the Sentry Kafka pods failed to process.\n\n","gridPos":{"h":8,"w":8,"x":16,"y":21},"id":11,"mode":"markdown","title":"Details","type":"text"},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Error rates are a measure of unhandled service exceptions per second. Client errors are excluded when possible. Lower is better","fill":0,"fillGradient":0,"gridPos":{"h":7,"w":8,"x":0,"y":31},"id":1180426400,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","options":{"dataLinks":[{"targetBlank":true,"title":"memcached_commands SLI Error-Rate SLO Analysis","url":"/d/alerts-component_slo_error?${__url_time_range}&${__all_variables}&var-component=memcached_commands&var-type=sentry&var-stage=$stage"}]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/6h Degradation SLO \\(5% of monthly error budget\\).*/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/1h Outage SLO \\(2% of monthly error budget\\).*/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/.*shard (apdex|error ratio|RPS)$/","color":"#E7D551"},{"alias":"memcached_commands error ratio avg","color":"#5794F2","dashLength":1,"fillGradient":10,"linewidth":1,"spaceLength":1,"zindex":-3},{"alias":"last week","color":"#dddddd80","dashLength":4,"dashes":true,"fill":0,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":2,"zindex":-3},{"alias":"memcached_commands error ratio","color":"#E7D551","fillBelowTo":"memcached_commands error ratio avg","zindex":3}],"spaceLength":10,"stableId":"sli-memcached_commands-error-rate","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_max(\n  max_over_time(gitlab_component_errors:ratio_5m{component=\"memcached_commands\",env=\"ops\",environment=\"ops\",monitor=\"global\",stage=\"$stage\",type=\"sentry\"}[$__interval])\n,\n  1\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"memcached_commands error ratio","refId":"A"},{"expr":"(6 * avg(slo:max:events:gitlab_service_errors:ratio{component=\"memcached_commands\",monitor=\"global\",type=\"sentry\"})\n)\n","format":"time_series","interval":"5m","intervalFactor":1,"legendFormat":"6h Degradation SLO (5% of monthly error budget)","refId":"B"},{"expr":"(14.4 * avg(slo:max:events:gitlab_service_errors:ratio{component=\"memcached_commands\",monitor=\"global\",type=\"sentry\"})\n)\n","format":"time_series","interval":"5m","intervalFactor":1,"legendFormat":"1h Outage SLO (2% of monthly error budget)","refId":"C"},{"expr":"clamp_max(\n  avg_over_time(gitlab_component_errors:ratio_5m{component=\"memcached_commands\",env=\"ops\",environment=\"ops\",monitor=\"global\",stage=\"$stage\",type=\"sentry\"}[$__interval])\n,\n  1\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"memcached_commands error ratio avg","refId":"D"},{"expr":"clamp_max(\n  gitlab_component_errors:ratio_5m{component=\"memcached_commands\",env=\"ops\",environment=\"ops\",monitor=\"global\",stage=\"$stage\",type=\"sentry\"} offset 1w\n,\n  scalar(max((14.4 * avg(slo:max:events:gitlab_service_errors:ratio{component=\"memcached_commands\",monitor=\"global\",type=\"sentry\"})\n)\n))\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"last week","refId":"E"}],"title":"memcached_commands SLI Error Ratio","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"percentunit","label":"Error %","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"datasource":"$PROMETHEUS_DS","description":"","fieldConfig":{"defaults":{"decimals":0,"displayName":"Status","mappings":[{"id":0,"options":{"0":{"color":"black","index":0,"text":"Healthy"},"1":{"color":"orange","index":1,"text":"Warning: 1h deteriorating"},"10":{"color":"orange","index":10,"text":"Warning: 6h recovering, 1h recovering"},"11":{"color":"red","index":11,"text":"Degraded: 6h recovering, 1h degraded"},"12":{"color":"red","index":12,"text":"Degraded: 6h degraded"},"13":{"color":"red","index":13,"text":"Degraded: 6h degraded, 1h deteriorating"},"14":{"color":"red","index":14,"text":"Degraded: 6h degraded, 1h recovering"},"15":{"color":"red","index":15,"text":"Degraded: 6h degraded, 1h degraded"},"2":{"color":"orange","index":2,"text":"Warning: 1h recovering"},"3":{"color":"red","index":3,"text":"Degraded: 1h degraded"},"4":{"color":"orange","index":4,"text":"Warning: 6h deteriorating"},"5":{"color":"orange","index":5,"text":"Warning: 6h deteriorating, 1h deteriorating"},"6":{"color":"orange","index":6,"text":"Warning: 6h deteriorating, 1h recovering"},"7":{"color":"red","index":7,"text":"Degraded: 6h deteriorating, 1h degraded"},"8":{"color":"orange","index":8,"text":"Warning: 6h recovering"},"9":{"color":"orange","index":9,"text":"Warning: 6h recovering, 1h deteriorating"}},"type":"value"}],"thresholds":{"mode":"absolute","steps":[{"color":"black","value":0},{"color":"orange","value":1},{"color":"orange","value":2},{"color":"red","value":3},{"color":"orange","value":4},{"color":"orange","value":5},{"color":"orange","value":6},{"color":"red","value":7},{"color":"orange","value":8},{"color":"orange","value":9},{"color":"orange","value":10},{"color":"red","value":11},{"color":"red","value":12},{"color":"red","value":13},{"color":"red","value":14},{"color":"red","value":15}]},"unit":"none"}},"gridPos":{"h":1,"w":8,"x":0,"y":38},"id":13,"options":{"colorMode":"background","graphMode":"none","justifyMode":"auto","orientation":"vertical","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"7","targets":[{"expr":"sum(\n  label_replace(\n    vector(0) and on() (gitlab_component_errors:ratio_1h{component=\"memcached_commands\",env=\"ops\",environment=\"ops\",monitor=\"global\",stage=\"$stage\",type=\"sentry\"}),\n    \"period\", \"na\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(1) and on () (gitlab_component_errors:ratio_5m{component=\"memcached_commands\",env=\"ops\",environment=\"ops\",monitor=\"global\",stage=\"$stage\",type=\"sentry\"} > on(tier, type, __tenant_id__) group_left() (14.4 * slo:max:events:gitlab_service_errors:ratio{component=\"memcached_commands\",monitor=\"global\",type=\"sentry\"})),\n    \"period\", \"5m\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(2) and on () (gitlab_component_errors:ratio_1h{component=\"memcached_commands\",env=\"ops\",environment=\"ops\",monitor=\"global\",stage=\"$stage\",type=\"sentry\"} > on(tier, type, __tenant_id__) group_left() (14.4 * slo:max:events:gitlab_service_errors:ratio{component=\"memcached_commands\",monitor=\"global\",type=\"sentry\"})),\n    \"period\", \"1h\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(4) and on () (gitlab_component_errors:ratio_30m{component=\"memcached_commands\",env=\"ops\",environment=\"ops\",monitor=\"global\",stage=\"$stage\",type=\"sentry\"} > on(tier, type, __tenant_id__) group_left() (6 * slo:max:events:gitlab_service_errors:ratio{component=\"memcached_commands\",monitor=\"global\",type=\"sentry\"})),\n    \"period\", \"30m\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(8) and on () (gitlab_component_errors:ratio_6h{component=\"memcached_commands\",env=\"ops\",environment=\"ops\",monitor=\"global\",stage=\"$stage\",type=\"sentry\"} > on(tier, type, __tenant_id__) group_left() (6 * slo:max:events:gitlab_service_errors:ratio{component=\"memcached_commands\",monitor=\"global\",type=\"sentry\"})),\n    \"period\", \"6h\", \"\", \"\"\n  )\n)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":1,"legendFormat":"memcached_commands SLI | Errors","refId":"A"}],"title":"","transparent":false,"type":"stat"},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"The operation rate is the sum total of all requests being handle for all components within this service. Note that a single user request can lead to requests to multiple components. Higher is busier.","fill":0,"fillGradient":0,"gridPos":{"h":8,"w":8,"x":8,"y":31},"id":2645661313,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/.*shard (apdex|error ratio|RPS)$/","color":"#E7D551"},{"alias":"memcached_commands RPS","color":"#E7D551","zindex":3},{"alias":"last week","color":"#dddddd80","dashLength":4,"dashes":true,"fill":0,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":2,"zindex":-3}],"spaceLength":10,"stableId":"sli-memcached_commands-ops-rate","stack":false,"steppedLine":false,"targets":[{"expr":"avg_over_time(gitlab_component_ops:rate_5m{component=\"memcached_commands\",env=\"ops\",environment=\"ops\",monitor=\"global\",stage=\"$stage\",type=\"sentry\"}[$__interval])\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"memcached_commands RPS","refId":"A"},{"expr":"gitlab_component_ops:rate_5m{component=\"memcached_commands\",env=\"ops\",environment=\"ops\",monitor=\"global\",stage=\"$stage\",type=\"sentry\"} offset 1w\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"last week","refId":"B"}],"title":"memcached_commands SLI RPS - Requests per Second","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Operations per Second","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"content":"### Description\n\nRepresents all commands the Sentry Memcached pods processed with a hit status.\nErrors represent all commands the Sentry Memcached pods failed to process with a badval status.\n\n","gridPos":{"h":8,"w":8,"x":16,"y":31},"id":15,"mode":"markdown","title":"Details","type":"text"},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Error rates are a measure of unhandled service exceptions per second. Client errors are excluded when possible. Lower is better","fill":0,"fillGradient":0,"gridPos":{"h":7,"w":8,"x":0,"y":41},"id":1332032662,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","options":{"dataLinks":[{"targetBlank":true,"title":"postgresql_transactions SLI Error-Rate SLO Analysis","url":"/d/alerts-component_slo_error?${__url_time_range}&${__all_variables}&var-component=postgresql_transactions&var-type=sentry&var-stage=$stage"}]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/6h Degradation SLO \\(5% of monthly error budget\\).*/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/1h Outage SLO \\(2% of monthly error budget\\).*/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/.*shard (apdex|error ratio|RPS)$/","color":"#E7D551"},{"alias":"postgresql_transactions error ratio avg","color":"#5794F2","dashLength":1,"fillGradient":10,"linewidth":1,"spaceLength":1,"zindex":-3},{"alias":"last week","color":"#dddddd80","dashLength":4,"dashes":true,"fill":0,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":2,"zindex":-3},{"alias":"postgresql_transactions error ratio","color":"#E7D551","fillBelowTo":"postgresql_transactions error ratio avg","zindex":3}],"spaceLength":10,"stableId":"sli-postgresql_transactions-error-rate","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_max(\n  max_over_time(gitlab_component_errors:ratio_5m{component=\"postgresql_transactions\",env=\"ops\",environment=\"ops\",monitor=\"global\",stage=\"$stage\",type=\"sentry\"}[$__interval])\n,\n  1\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"postgresql_transactions error ratio","refId":"A"},{"expr":"(6 * avg(slo:max:events:gitlab_service_errors:ratio{component=\"postgresql_transactions\",monitor=\"global\",type=\"sentry\"})\n)\n","format":"time_series","interval":"5m","intervalFactor":1,"legendFormat":"6h Degradation SLO (5% of monthly error budget)","refId":"B"},{"expr":"(14.4 * avg(slo:max:events:gitlab_service_errors:ratio{component=\"postgresql_transactions\",monitor=\"global\",type=\"sentry\"})\n)\n","format":"time_series","interval":"5m","intervalFactor":1,"legendFormat":"1h Outage SLO (2% of monthly error budget)","refId":"C"},{"expr":"clamp_max(\n  avg_over_time(gitlab_component_errors:ratio_5m{component=\"postgresql_transactions\",env=\"ops\",environment=\"ops\",monitor=\"global\",stage=\"$stage\",type=\"sentry\"}[$__interval])\n,\n  1\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"postgresql_transactions error ratio avg","refId":"D"},{"expr":"clamp_max(\n  gitlab_component_errors:ratio_5m{component=\"postgresql_transactions\",env=\"ops\",environment=\"ops\",monitor=\"global\",stage=\"$stage\",type=\"sentry\"} offset 1w\n,\n  scalar(max((14.4 * avg(slo:max:events:gitlab_service_errors:ratio{component=\"postgresql_transactions\",monitor=\"global\",type=\"sentry\"})\n)\n))\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"last week","refId":"E"}],"title":"postgresql_transactions SLI Error Ratio","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"percentunit","label":"Error %","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"datasource":"$PROMETHEUS_DS","description":"","fieldConfig":{"defaults":{"decimals":0,"displayName":"Status","mappings":[{"id":0,"options":{"0":{"color":"black","index":0,"text":"Healthy"},"1":{"color":"orange","index":1,"text":"Warning: 1h deteriorating"},"10":{"color":"orange","index":10,"text":"Warning: 6h recovering, 1h recovering"},"11":{"color":"red","index":11,"text":"Degraded: 6h recovering, 1h degraded"},"12":{"color":"red","index":12,"text":"Degraded: 6h degraded"},"13":{"color":"red","index":13,"text":"Degraded: 6h degraded, 1h deteriorating"},"14":{"color":"red","index":14,"text":"Degraded: 6h degraded, 1h recovering"},"15":{"color":"red","index":15,"text":"Degraded: 6h degraded, 1h degraded"},"2":{"color":"orange","index":2,"text":"Warning: 1h recovering"},"3":{"color":"red","index":3,"text":"Degraded: 1h degraded"},"4":{"color":"orange","index":4,"text":"Warning: 6h deteriorating"},"5":{"color":"orange","index":5,"text":"Warning: 6h deteriorating, 1h deteriorating"},"6":{"color":"orange","index":6,"text":"Warning: 6h deteriorating, 1h recovering"},"7":{"color":"red","index":7,"text":"Degraded: 6h deteriorating, 1h degraded"},"8":{"color":"orange","index":8,"text":"Warning: 6h recovering"},"9":{"color":"orange","index":9,"text":"Warning: 6h recovering, 1h deteriorating"}},"type":"value"}],"thresholds":{"mode":"absolute","steps":[{"color":"black","value":0},{"color":"orange","value":1},{"color":"orange","value":2},{"color":"red","value":3},{"color":"orange","value":4},{"color":"orange","value":5},{"color":"orange","value":6},{"color":"red","value":7},{"color":"orange","value":8},{"color":"orange","value":9},{"color":"orange","value":10},{"color":"red","value":11},{"color":"red","value":12},{"color":"red","value":13},{"color":"red","value":14},{"color":"red","value":15}]},"unit":"none"}},"gridPos":{"h":1,"w":8,"x":0,"y":48},"id":17,"options":{"colorMode":"background","graphMode":"none","justifyMode":"auto","orientation":"vertical","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"7","targets":[{"expr":"sum(\n  label_replace(\n    vector(0) and on() (gitlab_component_errors:ratio_1h{component=\"postgresql_transactions\",env=\"ops\",environment=\"ops\",monitor=\"global\",stage=\"$stage\",type=\"sentry\"}),\n    \"period\", \"na\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(1) and on () (gitlab_component_errors:ratio_5m{component=\"postgresql_transactions\",env=\"ops\",environment=\"ops\",monitor=\"global\",stage=\"$stage\",type=\"sentry\"} > on(tier, type, __tenant_id__) group_left() (14.4 * slo:max:events:gitlab_service_errors:ratio{component=\"postgresql_transactions\",monitor=\"global\",type=\"sentry\"})),\n    \"period\", \"5m\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(2) and on () (gitlab_component_errors:ratio_1h{component=\"postgresql_transactions\",env=\"ops\",environment=\"ops\",monitor=\"global\",stage=\"$stage\",type=\"sentry\"} > on(tier, type, __tenant_id__) group_left() (14.4 * slo:max:events:gitlab_service_errors:ratio{component=\"postgresql_transactions\",monitor=\"global\",type=\"sentry\"})),\n    \"period\", \"1h\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(4) and on () (gitlab_component_errors:ratio_30m{component=\"postgresql_transactions\",env=\"ops\",environment=\"ops\",monitor=\"global\",stage=\"$stage\",type=\"sentry\"} > on(tier, type, __tenant_id__) group_left() (6 * slo:max:events:gitlab_service_errors:ratio{component=\"postgresql_transactions\",monitor=\"global\",type=\"sentry\"})),\n    \"period\", \"30m\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(8) and on () (gitlab_component_errors:ratio_6h{component=\"postgresql_transactions\",env=\"ops\",environment=\"ops\",monitor=\"global\",stage=\"$stage\",type=\"sentry\"} > on(tier, type, __tenant_id__) group_left() (6 * slo:max:events:gitlab_service_errors:ratio{component=\"postgresql_transactions\",monitor=\"global\",type=\"sentry\"})),\n    \"period\", \"6h\", \"\", \"\"\n  )\n)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":1,"legendFormat":"postgresql_transactions SLI | Errors","refId":"A"}],"title":"","transparent":false,"type":"stat"},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"The operation rate is the sum total of all requests being handle for all components within this service. Note that a single user request can lead to requests to multiple components. Higher is busier.","fill":0,"fillGradient":0,"gridPos":{"h":8,"w":8,"x":8,"y":41},"id":1508333268,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/.*shard (apdex|error ratio|RPS)$/","color":"#E7D551"},{"alias":"postgresql_transactions RPS","color":"#E7D551","zindex":3},{"alias":"last week","color":"#dddddd80","dashLength":4,"dashes":true,"fill":0,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":2,"zindex":-3}],"spaceLength":10,"stableId":"sli-postgresql_transactions-ops-rate","stack":false,"steppedLine":false,"targets":[{"expr":"avg_over_time(gitlab_component_ops:rate_5m{component=\"postgresql_transactions\",env=\"ops\",environment=\"ops\",monitor=\"global\",stage=\"$stage\",type=\"sentry\"}[$__interval])\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"postgresql_transactions RPS","refId":"A"},{"expr":"gitlab_component_ops:rate_5m{component=\"postgresql_transactions\",env=\"ops\",environment=\"ops\",monitor=\"global\",stage=\"$stage\",type=\"sentry\"} offset 1w\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"last week","refId":"B"}],"title":"postgresql_transactions SLI RPS - Requests per Second","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Operations per Second","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"content":"### Description\n\nRepresents all SQL transactions issued to the sentry Postgres instance.\nErrors represent transaction rollbacks.\n\n\n\n### Observability Tools\n\n* [Stackdriver Logs: Sentry](https://console.cloud.google.com/logs/query;query=resource%2Elabels%2Edatabase%5Fid%3A%22sentry%22%0Aresource%2Etype%3D%22cloudsql%5Fdatabase%22;timeRange=PT30M?project=gitlab-ops)\n\n","gridPos":{"h":8,"w":8,"x":16,"y":41},"id":19,"mode":"markdown","title":"Details","type":"text"},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Error rates are a measure of unhandled service exceptions per second. Client errors are excluded when possible. Lower is better","fill":0,"fillGradient":0,"gridPos":{"h":7,"w":8,"x":0,"y":51},"id":2185897737,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","options":{"dataLinks":[{"targetBlank":true,"title":"rabbitmq_messages SLI Error-Rate SLO Analysis","url":"/d/alerts-component_slo_error?${__url_time_range}&${__all_variables}&var-component=rabbitmq_messages&var-type=sentry&var-stage=$stage"}]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/6h Degradation SLO \\(5% of monthly error budget\\).*/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/1h Outage SLO \\(2% of monthly error budget\\).*/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/.*shard (apdex|error ratio|RPS)$/","color":"#E7D551"},{"alias":"rabbitmq_messages error ratio avg","color":"#5794F2","dashLength":1,"fillGradient":10,"linewidth":1,"spaceLength":1,"zindex":-3},{"alias":"last week","color":"#dddddd80","dashLength":4,"dashes":true,"fill":0,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":2,"zindex":-3},{"alias":"rabbitmq_messages error ratio","color":"#E7D551","fillBelowTo":"rabbitmq_messages error ratio avg","zindex":3}],"spaceLength":10,"stableId":"sli-rabbitmq_messages-error-rate","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_max(\n  max_over_time(gitlab_component_errors:ratio_5m{component=\"rabbitmq_messages\",env=\"ops\",environment=\"ops\",monitor=\"global\",stage=\"$stage\",type=\"sentry\"}[$__interval])\n,\n  1\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"rabbitmq_messages error ratio","refId":"A"},{"expr":"(6 * avg(slo:max:events:gitlab_service_errors:ratio{component=\"rabbitmq_messages\",monitor=\"global\",type=\"sentry\"})\n)\n","format":"time_series","interval":"5m","intervalFactor":1,"legendFormat":"6h Degradation SLO (5% of monthly error budget)","refId":"B"},{"expr":"(14.4 * avg(slo:max:events:gitlab_service_errors:ratio{component=\"rabbitmq_messages\",monitor=\"global\",type=\"sentry\"})\n)\n","format":"time_series","interval":"5m","intervalFactor":1,"legendFormat":"1h Outage SLO (2% of monthly error budget)","refId":"C"},{"expr":"clamp_max(\n  avg_over_time(gitlab_component_errors:ratio_5m{component=\"rabbitmq_messages\",env=\"ops\",environment=\"ops\",monitor=\"global\",stage=\"$stage\",type=\"sentry\"}[$__interval])\n,\n  1\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"rabbitmq_messages error ratio avg","refId":"D"},{"expr":"clamp_max(\n  gitlab_component_errors:ratio_5m{component=\"rabbitmq_messages\",env=\"ops\",environment=\"ops\",monitor=\"global\",stage=\"$stage\",type=\"sentry\"} offset 1w\n,\n  scalar(max((14.4 * avg(slo:max:events:gitlab_service_errors:ratio{component=\"rabbitmq_messages\",monitor=\"global\",type=\"sentry\"})\n)\n))\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"last week","refId":"E"}],"title":"rabbitmq_messages SLI Error Ratio","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"percentunit","label":"Error %","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"datasource":"$PROMETHEUS_DS","description":"","fieldConfig":{"defaults":{"decimals":0,"displayName":"Status","mappings":[{"id":0,"options":{"0":{"color":"black","index":0,"text":"Healthy"},"1":{"color":"orange","index":1,"text":"Warning: 1h deteriorating"},"10":{"color":"orange","index":10,"text":"Warning: 6h recovering, 1h recovering"},"11":{"color":"red","index":11,"text":"Degraded: 6h recovering, 1h degraded"},"12":{"color":"red","index":12,"text":"Degraded: 6h degraded"},"13":{"color":"red","index":13,"text":"Degraded: 6h degraded, 1h deteriorating"},"14":{"color":"red","index":14,"text":"Degraded: 6h degraded, 1h recovering"},"15":{"color":"red","index":15,"text":"Degraded: 6h degraded, 1h degraded"},"2":{"color":"orange","index":2,"text":"Warning: 1h recovering"},"3":{"color":"red","index":3,"text":"Degraded: 1h degraded"},"4":{"color":"orange","index":4,"text":"Warning: 6h deteriorating"},"5":{"color":"orange","index":5,"text":"Warning: 6h deteriorating, 1h deteriorating"},"6":{"color":"orange","index":6,"text":"Warning: 6h deteriorating, 1h recovering"},"7":{"color":"red","index":7,"text":"Degraded: 6h deteriorating, 1h degraded"},"8":{"color":"orange","index":8,"text":"Warning: 6h recovering"},"9":{"color":"orange","index":9,"text":"Warning: 6h recovering, 1h deteriorating"}},"type":"value"}],"thresholds":{"mode":"absolute","steps":[{"color":"black","value":0},{"color":"orange","value":1},{"color":"orange","value":2},{"color":"red","value":3},{"color":"orange","value":4},{"color":"orange","value":5},{"color":"orange","value":6},{"color":"red","value":7},{"color":"orange","value":8},{"color":"orange","value":9},{"color":"orange","value":10},{"color":"red","value":11},{"color":"red","value":12},{"color":"red","value":13},{"color":"red","value":14},{"color":"red","value":15}]},"unit":"none"}},"gridPos":{"h":1,"w":8,"x":0,"y":58},"id":21,"options":{"colorMode":"background","graphMode":"none","justifyMode":"auto","orientation":"vertical","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"7","targets":[{"expr":"sum(\n  label_replace(\n    vector(0) and on() (gitlab_component_errors:ratio_1h{component=\"rabbitmq_messages\",env=\"ops\",environment=\"ops\",monitor=\"global\",stage=\"$stage\",type=\"sentry\"}),\n    \"period\", \"na\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(1) and on () (gitlab_component_errors:ratio_5m{component=\"rabbitmq_messages\",env=\"ops\",environment=\"ops\",monitor=\"global\",stage=\"$stage\",type=\"sentry\"} > on(tier, type, __tenant_id__) group_left() (14.4 * slo:max:events:gitlab_service_errors:ratio{component=\"rabbitmq_messages\",monitor=\"global\",type=\"sentry\"})),\n    \"period\", \"5m\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(2) and on () (gitlab_component_errors:ratio_1h{component=\"rabbitmq_messages\",env=\"ops\",environment=\"ops\",monitor=\"global\",stage=\"$stage\",type=\"sentry\"} > on(tier, type, __tenant_id__) group_left() (14.4 * slo:max:events:gitlab_service_errors:ratio{component=\"rabbitmq_messages\",monitor=\"global\",type=\"sentry\"})),\n    \"period\", \"1h\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(4) and on () (gitlab_component_errors:ratio_30m{component=\"rabbitmq_messages\",env=\"ops\",environment=\"ops\",monitor=\"global\",stage=\"$stage\",type=\"sentry\"} > on(tier, type, __tenant_id__) group_left() (6 * slo:max:events:gitlab_service_errors:ratio{component=\"rabbitmq_messages\",monitor=\"global\",type=\"sentry\"})),\n    \"period\", \"30m\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(8) and on () (gitlab_component_errors:ratio_6h{component=\"rabbitmq_messages\",env=\"ops\",environment=\"ops\",monitor=\"global\",stage=\"$stage\",type=\"sentry\"} > on(tier, type, __tenant_id__) group_left() (6 * slo:max:events:gitlab_service_errors:ratio{component=\"rabbitmq_messages\",monitor=\"global\",type=\"sentry\"})),\n    \"period\", \"6h\", \"\", \"\"\n  )\n)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":1,"legendFormat":"rabbitmq_messages SLI | Errors","refId":"A"}],"title":"","transparent":false,"type":"stat"},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"The operation rate is the sum total of all requests being handle for all components within this service. Note that a single user request can lead to requests to multiple components. Higher is busier.","fill":0,"fillGradient":0,"gridPos":{"h":8,"w":8,"x":8,"y":51},"id":1717086075,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/.*shard (apdex|error ratio|RPS)$/","color":"#E7D551"},{"alias":"rabbitmq_messages RPS","color":"#E7D551","zindex":3},{"alias":"last week","color":"#dddddd80","dashLength":4,"dashes":true,"fill":0,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":2,"zindex":-3}],"spaceLength":10,"stableId":"sli-rabbitmq_messages-ops-rate","stack":false,"steppedLine":false,"targets":[{"expr":"avg_over_time(gitlab_component_ops:rate_5m{component=\"rabbitmq_messages\",env=\"ops\",environment=\"ops\",monitor=\"global\",stage=\"$stage\",type=\"sentry\"}[$__interval])\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"rabbitmq_messages RPS","refId":"A"},{"expr":"gitlab_component_ops:rate_5m{component=\"rabbitmq_messages\",env=\"ops\",environment=\"ops\",monitor=\"global\",stage=\"$stage\",type=\"sentry\"} offset 1w\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"last week","refId":"B"}],"title":"rabbitmq_messages SLI RPS - Requests per Second","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Operations per Second","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"content":"### Description\n\nRepresents all messages the Sentry RabbitMQ pods processed.\nErrors represent all the messages the Sentry RabbitMQ pods attempted to process but were unroutable.\n\n","gridPos":{"h":8,"w":8,"x":16,"y":51},"id":23,"mode":"markdown","title":"Details","type":"text"},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"The operation rate is the sum total of all requests being handle for all components within this service. Note that a single user request can lead to requests to multiple components. Higher is busier.","fill":0,"fillGradient":0,"gridPos":{"h":8,"w":12,"x":0,"y":61},"id":2778770723,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/.*shard (apdex|error ratio|RPS)$/","color":"#E7D551"},{"alias":"sentry_events RPS","color":"#E7D551","zindex":3},{"alias":"last week","color":"#dddddd80","dashLength":4,"dashes":true,"fill":0,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":2,"zindex":-3}],"spaceLength":10,"stableId":"sli-sentry_events-ops-rate","stack":false,"steppedLine":false,"targets":[{"expr":"avg_over_time(gitlab_component_ops:rate_5m{component=\"sentry_events\",env=\"ops\",environment=\"ops\",monitor=\"global\",stage=\"$stage\",type=\"sentry\"}[$__interval])\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"sentry_events RPS","refId":"A"},{"expr":"gitlab_component_ops:rate_5m{component=\"sentry_events\",env=\"ops\",environment=\"ops\",monitor=\"global\",stage=\"$stage\",type=\"sentry\"} offset 1w\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"last week","refId":"B"}],"title":"sentry_events SLI RPS - Requests per Second","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Operations per Second","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"content":"### Description\n\nSentry is an application monitoring platform.\nThis SLI monitors the sentry API. 5xx responses are considered failures.\n\n","gridPos":{"h":8,"w":12,"x":12,"y":61},"id":25,"mode":"markdown","title":"Details","type":"text"},{"collapse":true,"collapsed":true,"gridPos":{"h":10,"w":24,"x":0,"y":200},"id":26,"panels":[{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":12,"x":0,"y":0},"id":27,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by () (\n  sli_aggregations:kafka_server_brokertopicmetrics_total_failedproducerequestspersec_count:rate_5m{env=\"ops\",environment=\"ops\",stage=\"$stage\",type=\"sentry\"}\n)\n > 0","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"overall","refId":"A"}],"title":"kafka_topics Errors - Overall","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Errors","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":12,"x":12,"y":0},"id":28,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by () (\n  sli_aggregations:kafka_server_brokertopicmetrics_total_totalproducerequestspersec_count:rate_5m{env=\"ops\",environment=\"ops\",stage=\"$stage\",type=\"sentry\"}\n)\n > 0","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"overall","refId":"A"}],"title":"kafka_topics RPS - Overall","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Requests per Second","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"🔬 SLI Detail: kafka_topics","titleSize":"h6","type":"row"},{"collapse":true,"collapsed":true,"gridPos":{"h":10,"w":24,"x":0,"y":210},"id":29,"panels":[{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":12,"x":0,"y":0},"id":30,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by () (\n  sli_aggregations:memcached_commands_total:rate_5m{env=\"ops\",environment=\"ops\",job=\"sentry-memcached-metrics\",stage=\"$stage\",status=\"badval\"}\n)\n > 0","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"overall","refId":"A"}],"title":"memcached_commands Errors - Overall","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Errors","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":12,"x":12,"y":0},"id":31,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by () (\n  sli_aggregations:memcached_commands_total:rate_5m{env=\"ops\",environment=\"ops\",job=\"sentry-memcached-metrics\",stage=\"$stage\"}\n)\n > 0","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"overall","refId":"A"}],"title":"memcached_commands RPS - Overall","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Requests per Second","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"🔬 SLI Detail: memcached_commands","titleSize":"h6","type":"row"},{"collapse":true,"collapsed":true,"gridPos":{"h":10,"w":24,"x":0,"y":220},"id":32,"panels":[{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":12,"x":0,"y":0},"id":33,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by () (\n  sli_aggregations:stackdriver_cloudsql_database_cloudsql_googleapis_com_database_postgresql_transaction_count:rate_5m{database_id=\"gitlab-ops:sentry-63\",env=\"ops\",environment=\"ops\",stage=\"$stage\",transaction_type=\"rollback\"}\n)\n > 0","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"overall","refId":"A"}],"title":"postgresql_transactions Errors - Overall","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Errors","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":12,"x":12,"y":0},"id":34,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by () (\n  sli_aggregations:stackdriver_cloudsql_database_cloudsql_googleapis_com_database_postgresql_transaction_count:rate_5m{database_id=\"gitlab-ops:sentry-63\",env=\"ops\",environment=\"ops\",stage=\"$stage\"}\n)\n > 0","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"overall","refId":"A"}],"title":"postgresql_transactions RPS - Overall","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Requests per Second","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"🔬 SLI Detail: postgresql_transactions","titleSize":"h6","type":"row"},{"collapse":true,"collapsed":true,"gridPos":{"h":10,"w":24,"x":0,"y":230},"id":35,"panels":[{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":12,"x":0,"y":0},"id":36,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by () (\n  sli_aggregations:rabbitmq_global_messages_unroutable_returned_total:rate_5m{env=\"ops\",environment=\"ops\",job=\"sentry-rabbitmq\",stage=\"$stage\"}\n)\n > 0","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"overall","refId":"A"}],"title":"rabbitmq_messages Errors - Overall","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Errors","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":12,"x":12,"y":0},"id":37,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by () (\n  sli_aggregations:rabbitmq_global_messages_acknowledged_total:rate_5m{env=\"ops\",environment=\"ops\",job=\"sentry-rabbitmq\",stage=\"$stage\"}\n)\n > 0","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"overall","refId":"A"}],"title":"rabbitmq_messages RPS - Overall","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Requests per Second","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"🔬 SLI Detail: rabbitmq_messages","titleSize":"h6","type":"row"},{"collapse":true,"collapsed":true,"gridPos":{"h":10,"w":24,"x":0,"y":240},"id":38,"panels":[{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":24,"x":0,"y":0},"id":39,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by () (\n  sli_aggregations:sentry_events_processed:rate_5m{env=\"ops\",environment=\"ops\",job=\"sentry-metrics\",stage=\"$stage\"}\n)\n > 0","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"overall","refId":"A"}],"title":"sentry_events RPS - Overall","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Requests per Second","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"🔬 SLI Detail: sentry_events","titleSize":"h6","type":"row"},{"collapse":true,"collapsed":true,"gridPos":{"h":1,"w":24,"x":0,"y":400},"id":40,"panels":[],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"☸️ Kubernetes Overview","titleSize":"h6","type":"row"},{"collapse":true,"collapsed":true,"gridPos":{"h":1,"w":24,"x":0,"y":500},"id":41,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Kubernetes containers are allocated a share of CPU. Configured using resource requests.\n\nThis is the amount of CPU that a container should always have available,\nthough it can briefly utilize more. However, if a lot of pods on the same\nhost exceed their requested CPU the container could be throttled earlier.\n\nThis monitors utilization/allocated requests over a 1 hour period, and takes\nthe 99th quantile of that utilization percentage in that period.\nWe want the worst case to be around 80%-90% utilization,\nmeaning we've sized the container correctly. If utilization is much higher than that\nthe container could already be throttled because the host is overused, if it\nis much lower, then we could be underutilizing a host.\n\nThis saturation point is only used for capacity planning.\nContainers that have a quota specified are excluded here and can be monitored using\nthe `kube_container_throttling` saturation component.\nThe burst utilization of a CPU is monitored and alerted upon using the\n`kube_container_cpu_limit` saturation point.\n Lower is better.","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":12,"x":0,"y":0},"id":2713861591,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"sort":"max","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[{"alias":"/^Soft SLO/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^Hard SLO/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/aggregated /","color":"#E7D551","linewidth":2,"zindex":3},{"alias":"/^95th quantile for week/","color":"#37872D","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^99th quantile for week/","color":"#56A64B","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":4,"zindex":-2}],"spaceLength":10,"stableId":"saturation-kube_container_cpu","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_min(\n  clamp_max(\n    quantile by(environment, tier, type, stage, shard, pod, container) (\n  0.99,\n  clamp_min(\n    clamp_max(\n      (\n        sum by (environment, tier, type, stage, shard, pod, container) (\n          rate(container_cpu_usage_seconds_total:labeled{container!=\"\", container!=\"POD\", env=\"$environment\",environment=\"$environment\",stage=\"$stage\",type=\"sentry\"}[1h])\n        )\n        unless on(environment, tier, type, stage, shard, pod, container) (\n          last_over_time(container_spec_cpu_quota:labeled{container!=\"\", container!=\"POD\", env=\"$environment\",environment=\"$environment\",stage=\"$stage\",type=\"sentry\"}[1h])\n        )\n      )\n      /\n      sum by(environment, tier, type, stage, shard, pod, container) (\n        kube_pod_container_resource_requests:labeled{container!=\"\", container!=\"POD\", resource=\"cpu\", env=\"$environment\",environment=\"$environment\",stage=\"$stage\",type=\"sentry\"}\n      )\n      ,\n      1)\n  ,\n  0)\n)\n\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{ pod }} {{ container }}","refId":"A"},{"expr":"clamp_min(\n  clamp_max(\n    max(\n      max_over_time(gitlab_component_saturation:ratio{env=\"$environment\",environment=\"$environment\",stage=\"$stage\",type=\"sentry\", component=\"kube_container_cpu\"}[$__interval])\n    ) by (component)\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"aggregated {{ component }}","refId":"B"},{"expr":"max(\n  gitlab_component_saturation:ratio_quantile95_1w{env=\"$environment\",environment=\"$environment\",stage=\"$stage\",type=\"sentry\", component=\"kube_container_cpu\"}\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"95th quantile for week {{ component }}","refId":"C"},{"expr":"max(\n  gitlab_component_saturation:ratio_quantile99_1w{env=\"$environment\",environment=\"$environment\",stage=\"$stage\",type=\"sentry\", component=\"kube_container_cpu\"}\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"99th quantile for week {{ component }}","refId":"D"},{"expr":"avg(slo:max:soft:gitlab_component_saturation:ratio{component=\"kube_container_cpu\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"Soft SLO: {{ component }}","refId":"E"},{"expr":"avg(slo:max:hard:gitlab_component_saturation:ratio{component=\"kube_container_cpu\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"Hard SLO: {{ component }}","refId":"F"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"kube_container_cpu component saturation: Kube Container CPU Utilization","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"Saturation %","logBase":1,"max":1,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Kubernetes containers can have a limit configured on how much CPU they can consume in\na burst. If we are at this limit, exceeding the allocated requested resources, we\nshould consider revisting the container's HPA configuration.\n\nWhen a container is utilizing CPU resources up-to it's configured limit for\nextended periods of time, this could cause it and other running containers to be\nthrottled.\n Lower is better.","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":12,"x":12,"y":0},"id":1262336683,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"sort":"max","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[{"alias":"/^Soft SLO/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^Hard SLO/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/aggregated /","color":"#E7D551","linewidth":2,"zindex":3},{"alias":"/^95th quantile for week/","color":"#37872D","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^99th quantile for week/","color":"#56A64B","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":4,"zindex":-2}],"spaceLength":10,"stableId":"saturation-kube_container_cpu_limit","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_min(\n  clamp_max(\n    max by(environment, tier, type, stage, shard, pod, container) (\n  clamp_min(\n    clamp_max(\n      sum by (environment, tier, type, stage, shard, pod, container) (\n        rate(container_cpu_usage_seconds_total:labeled{container!=\"\", container!=\"POD\", env=\"$environment\",environment=\"$environment\",stage=\"$stage\",type=\"sentry\"}[5m])\n      )\n      /\n      sum by(environment, tier, type, stage, shard, pod, container) (\n        container_spec_cpu_quota:labeled{container!=\"\", container!=\"POD\", env=\"$environment\",environment=\"$environment\",stage=\"$stage\",type=\"sentry\"}\n        /\n        container_spec_cpu_period:labeled{container!=\"\", container!=\"POD\", env=\"$environment\",environment=\"$environment\",stage=\"$stage\",type=\"sentry\"}\n      )\n      ,\n      1)\n  ,\n  0)\n)\n\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{ pod }} {{ container }}","refId":"A"},{"expr":"clamp_min(\n  clamp_max(\n    max(\n      max_over_time(gitlab_component_saturation:ratio{env=\"$environment\",environment=\"$environment\",stage=\"$stage\",type=\"sentry\", component=\"kube_container_cpu_limit\"}[$__interval])\n    ) by (component)\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"aggregated {{ component }}","refId":"B"},{"expr":"max(\n  gitlab_component_saturation:ratio_quantile95_1w{env=\"$environment\",environment=\"$environment\",stage=\"$stage\",type=\"sentry\", component=\"kube_container_cpu_limit\"}\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"95th quantile for week {{ component }}","refId":"C"},{"expr":"max(\n  gitlab_component_saturation:ratio_quantile99_1w{env=\"$environment\",environment=\"$environment\",stage=\"$stage\",type=\"sentry\", component=\"kube_container_cpu_limit\"}\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"99th quantile for week {{ component }}","refId":"D"},{"expr":"avg(slo:max:soft:gitlab_component_saturation:ratio{component=\"kube_container_cpu_limit\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"Soft SLO: {{ component }}","refId":"E"},{"expr":"avg(slo:max:hard:gitlab_component_saturation:ratio{component=\"kube_container_cpu_limit\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"Hard SLO: {{ component }}","refId":"F"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"kube_container_cpu_limit component saturation: Kube Container CPU over-utilization","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"Saturation %","logBase":1,"max":1,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"This uses the working set size from cAdvisor for the cgroup's memory usage. That may\nnot be a good measure as it includes filesystem cache pages that are not necessarily\nattributable to the application inside the cgroup, and are permitted to be evicted\ninstead of being OOM killed.\n Lower is better.","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":12,"x":0,"y":10},"id":172578411,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"sort":"max","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[{"alias":"/^Soft SLO/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^Hard SLO/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/aggregated /","color":"#E7D551","linewidth":2,"zindex":3},{"alias":"/^95th quantile for week/","color":"#37872D","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^99th quantile for week/","color":"#56A64B","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":4,"zindex":-2}],"spaceLength":10,"stableId":"saturation-kube_container_memory","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_min(\n  clamp_max(\n    max by(environment, tier, type, stage, shard, deployment) (\n  clamp_min(\n    clamp_max(\n      container_memory_working_set_bytes:labeled{container!=\"\", container!=\"POD\", env=\"$environment\",environment=\"$environment\",stage=\"$stage\",type=\"sentry\"}\n      /\n      (container_spec_memory_limit_bytes:labeled{container!=\"\", container!=\"POD\", env=\"$environment\",environment=\"$environment\",stage=\"$stage\",type=\"sentry\"} > 0)\n      ,\n      1)\n  ,\n  0)\n)\n\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{ deployment }}","refId":"A"},{"expr":"clamp_min(\n  clamp_max(\n    max(\n      max_over_time(gitlab_component_saturation:ratio{env=\"$environment\",environment=\"$environment\",stage=\"$stage\",type=\"sentry\", component=\"kube_container_memory\"}[$__interval])\n    ) by (component)\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"aggregated {{ component }}","refId":"B"},{"expr":"max(\n  gitlab_component_saturation:ratio_quantile95_1w{env=\"$environment\",environment=\"$environment\",stage=\"$stage\",type=\"sentry\", component=\"kube_container_memory\"}\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"95th quantile for week {{ component }}","refId":"C"},{"expr":"max(\n  gitlab_component_saturation:ratio_quantile99_1w{env=\"$environment\",environment=\"$environment\",stage=\"$stage\",type=\"sentry\", component=\"kube_container_memory\"}\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"99th quantile for week {{ component }}","refId":"D"},{"expr":"avg(slo:max:soft:gitlab_component_saturation:ratio{component=\"kube_container_memory\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"Soft SLO: {{ component }}","refId":"E"},{"expr":"avg(slo:max:hard:gitlab_component_saturation:ratio{component=\"kube_container_memory\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"Hard SLO: {{ component }}","refId":"F"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"kube_container_memory component saturation: Kube Container Memory Utilization","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"Saturation %","logBase":1,"max":1,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Kube container throttling\n\nA container will be throttled if it reaches the configured cpu limit for the\nhorizontal pod autoscaler. Or when other containers on the node are overutilizing\nthe the CPU.\n\nTo get around this, consider increasing the limit for this workload, taking\ninto consideration the requested resources.\n Lower is better.","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":12,"x":12,"y":10},"id":54512634,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"sort":"max","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[{"alias":"/^Soft SLO/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^Hard SLO/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/aggregated /","color":"#E7D551","linewidth":2,"zindex":3},{"alias":"/^95th quantile for week/","color":"#37872D","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^99th quantile for week/","color":"#56A64B","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":4,"zindex":-2}],"spaceLength":10,"stableId":"saturation-kube_container_throttling","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_min(\n  clamp_max(\n    quantile by(environment, tier, type, stage, shard, pod, container) (\n  0.99,\n  clamp_min(\n    clamp_max(\n      avg by (environment, tier, type, stage, shard, pod, container)(\n        rate(container_cpu_cfs_throttled_periods_total:labeled{container!=\"\", env=\"$environment\",environment=\"$environment\",stage=\"$stage\",type=\"sentry\"}[5m])\n        /\n        rate(container_cpu_cfs_periods_total:labeled{container!=\"\", env=\"$environment\",environment=\"$environment\",stage=\"$stage\",type=\"sentry\"}[5m])\n      )\n      ,\n      1)\n  ,\n  0)\n)\n\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{ pod }} {{ container }}","refId":"A"},{"expr":"clamp_min(\n  clamp_max(\n    max(\n      max_over_time(gitlab_component_saturation:ratio{env=\"$environment\",environment=\"$environment\",stage=\"$stage\",type=\"sentry\", component=\"kube_container_throttling\"}[$__interval])\n    ) by (component)\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"aggregated {{ component }}","refId":"B"},{"expr":"max(\n  gitlab_component_saturation:ratio_quantile95_1w{env=\"$environment\",environment=\"$environment\",stage=\"$stage\",type=\"sentry\", component=\"kube_container_throttling\"}\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"95th quantile for week {{ component }}","refId":"C"},{"expr":"max(\n  gitlab_component_saturation:ratio_quantile99_1w{env=\"$environment\",environment=\"$environment\",stage=\"$stage\",type=\"sentry\", component=\"kube_container_throttling\"}\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"99th quantile for week {{ component }}","refId":"D"},{"expr":"avg(slo:max:soft:gitlab_component_saturation:ratio{component=\"kube_container_throttling\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"Soft SLO: {{ component }}","refId":"E"},{"expr":"avg(slo:max:hard:gitlab_component_saturation:ratio{component=\"kube_container_throttling\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"Hard SLO: {{ component }}","refId":"F"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"kube_container_throttling component saturation: Kube container throttling","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"Saturation %","logBase":1,"max":1,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"The [Horizontal Pod Autoscaler](https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/)\nautomatically scales the number of Pods in a deployment based on metrics.\n\nThe Horizontal Pod Autoscaler has a configured upper maximum. When this\nlimit is reached, the HPA will not increase the number of pods and other\nresource saturation (eg, CPU, memory) may occur.\n Lower is better.","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":12,"x":0,"y":20},"id":351198712,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"sort":"max","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[{"alias":"/^Soft SLO/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^Hard SLO/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/aggregated /","color":"#E7D551","linewidth":2,"zindex":3},{"alias":"/^95th quantile for week/","color":"#37872D","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^99th quantile for week/","color":"#56A64B","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":4,"zindex":-2}],"spaceLength":10,"stableId":"saturation-kube_horizontalpodautoscaler_desired_replicas","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_min(\n  clamp_max(\n    max by(environment, tier, type, stage, shard, horizontalpodautoscaler, shard) (\n  clamp_min(\n    clamp_max(\n      kube_horizontalpodautoscaler_status_desired_replicas:labeled{env=\"$environment\",environment=\"$environment\",stage=\"$stage\",type=\"sentry\", shard!~\"ai-abstraction-layer|database-throttled|elasticsearch|gitaly-throttled|urgent-authorized-projects\", namespace!~\"pubsubbeat\"}\n      /\n      kube_horizontalpodautoscaler_spec_max_replicas:labeled{env=\"$environment\",environment=\"$environment\",stage=\"$stage\",type=\"sentry\", shard!~\"ai-abstraction-layer|database-throttled|elasticsearch|gitaly-throttled|urgent-authorized-projects\", namespace!~\"pubsubbeat\"}\n      ,\n      1)\n  ,\n  0)\n)\n\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{ horizontalpodautoscaler }} {{ shard }}","refId":"A"},{"expr":"clamp_min(\n  clamp_max(\n    max(\n      max_over_time(gitlab_component_saturation:ratio{env=\"$environment\",environment=\"$environment\",stage=\"$stage\",type=\"sentry\", component=\"kube_horizontalpodautoscaler_desired_replicas\"}[$__interval])\n    ) by (component)\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"aggregated {{ component }}","refId":"B"},{"expr":"max(\n  gitlab_component_saturation:ratio_quantile95_1w{env=\"$environment\",environment=\"$environment\",stage=\"$stage\",type=\"sentry\", component=\"kube_horizontalpodautoscaler_desired_replicas\"}\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"95th quantile for week {{ component }}","refId":"C"},{"expr":"max(\n  gitlab_component_saturation:ratio_quantile99_1w{env=\"$environment\",environment=\"$environment\",stage=\"$stage\",type=\"sentry\", component=\"kube_horizontalpodautoscaler_desired_replicas\"}\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"99th quantile for week {{ component }}","refId":"D"},{"expr":"avg(slo:max:soft:gitlab_component_saturation:ratio{component=\"kube_horizontalpodautoscaler_desired_replicas\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"Soft SLO: {{ component }}","refId":"E"},{"expr":"avg(slo:max:hard:gitlab_component_saturation:ratio{component=\"kube_horizontalpodautoscaler_desired_replicas\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"Hard SLO: {{ component }}","refId":"F"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"kube_horizontalpodautoscaler_desired_replicas component saturation: Horizontal Pod Autoscaler Desired Replicas","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"Saturation %","logBase":1,"max":1,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Open file descriptor utilization per instance.\n\nSaturation on file descriptor limits may indicate a resource-descriptor leak in the application.\n\nAs a temporary fix, you may want to consider restarting the affected process.\n Lower is better.","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":12,"x":12,"y":20},"id":1001792825,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"sort":"max","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[{"alias":"/^Soft SLO/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^Hard SLO/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/aggregated /","color":"#E7D551","linewidth":2,"zindex":3},{"alias":"/^95th quantile for week/","color":"#37872D","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^99th quantile for week/","color":"#56A64B","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":4,"zindex":-2}],"spaceLength":10,"stableId":"saturation-open_fds","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_min(\n  clamp_max(\n    max by(environment, tier, type, stage, shard, job, instance) (\n  clamp_min(\n    clamp_max(\n      (\n        process_open_fds{env=\"$environment\",environment=\"$environment\",stage=\"$stage\",type=\"sentry\"}\n        /\n        process_max_fds{env=\"$environment\",environment=\"$environment\",stage=\"$stage\",type=\"sentry\"}\n      )\n      or\n      (\n        ruby_file_descriptors{env=\"$environment\",environment=\"$environment\",stage=\"$stage\",type=\"sentry\"}\n        /\n        ruby_process_max_fds{env=\"$environment\",environment=\"$environment\",stage=\"$stage\",type=\"sentry\"}\n      )\n      ,\n      1)\n  ,\n  0)\n)\n\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{ job }} {{ instance }}","refId":"A"},{"expr":"clamp_min(\n  clamp_max(\n    max(\n      max_over_time(gitlab_component_saturation:ratio{env=\"$environment\",environment=\"$environment\",stage=\"$stage\",type=\"sentry\", component=\"open_fds\"}[$__interval])\n    ) by (component)\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"aggregated {{ component }}","refId":"B"},{"expr":"max(\n  gitlab_component_saturation:ratio_quantile95_1w{env=\"$environment\",environment=\"$environment\",stage=\"$stage\",type=\"sentry\", component=\"open_fds\"}\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"95th quantile for week {{ component }}","refId":"C"},{"expr":"max(\n  gitlab_component_saturation:ratio_quantile99_1w{env=\"$environment\",environment=\"$environment\",stage=\"$stage\",type=\"sentry\", component=\"open_fds\"}\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"99th quantile for week {{ component }}","refId":"D"},{"expr":"avg(slo:max:soft:gitlab_component_saturation:ratio{component=\"open_fds\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"Soft SLO: {{ component }}","refId":"E"},{"expr":"avg(slo:max:hard:gitlab_component_saturation:ratio{component=\"open_fds\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"Hard SLO: {{ component }}","refId":"F"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"open_fds component saturation: Open file descriptor utilization per instance","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"Saturation %","logBase":1,"max":1,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Average CPU utilization across all cores on the Postgres primary instance.\n Lower is better.","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":12,"x":0,"y":30},"id":3989464622,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"sort":"max","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[{"alias":"/^Soft SLO/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^Hard SLO/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/aggregated /","color":"#E7D551","linewidth":2,"zindex":3},{"alias":"/^95th quantile for week/","color":"#37872D","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^99th quantile for week/","color":"#56A64B","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":4,"zindex":-2}],"spaceLength":10,"stableId":"saturation-pg_primary_cpu","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_min(\n  clamp_max(\n    max by(env, environment, tier, type, stage, shard, fqdn) (\n  clamp_min(\n    clamp_max(\n      avg without(cpu, mode) (\n        1\n        -\n        (\n          rate(node_cpu_seconds_total{mode=\"idle\", env=\"$environment\",environment=\"$environment\",stage=\"$stage\",type=\"sentry\"}[5m])\n          and on(fqdn)\n          pg_replication_is_replica{env=\"$environment\",environment=\"$environment\",stage=\"$stage\",type=\"sentry\"} == 0\n        )\n      )\n      ,\n      1)\n  ,\n  0)\n)\n\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{ fqdn }}","refId":"A"},{"expr":"clamp_min(\n  clamp_max(\n    max(\n      max_over_time(gitlab_component_saturation:ratio{env=\"$environment\",environment=\"$environment\",stage=\"$stage\",type=\"sentry\", component=\"pg_primary_cpu\"}[$__interval])\n    ) by (component)\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"aggregated {{ component }}","refId":"B"},{"expr":"max(\n  gitlab_component_saturation:ratio_quantile95_1w{env=\"$environment\",environment=\"$environment\",stage=\"$stage\",type=\"sentry\", component=\"pg_primary_cpu\"}\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"95th quantile for week {{ component }}","refId":"C"},{"expr":"max(\n  gitlab_component_saturation:ratio_quantile99_1w{env=\"$environment\",environment=\"$environment\",stage=\"$stage\",type=\"sentry\", component=\"pg_primary_cpu\"}\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"99th quantile for week {{ component }}","refId":"D"},{"expr":"avg(slo:max:soft:gitlab_component_saturation:ratio{component=\"pg_primary_cpu\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"Soft SLO: {{ component }}","refId":"E"},{"expr":"avg(slo:max:hard:gitlab_component_saturation:ratio{component=\"pg_primary_cpu\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"Hard SLO: {{ component }}","refId":"F"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"pg_primary_cpu component saturation: Average CPU Utilization on Postgres Primary Instance","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"Saturation %","logBase":1,"max":1,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Risk of DB shutdown in the near future, approaching transaction ID wraparound.\n\nThis is a critical situation.\n\nThis saturation metric measures how close the database is to Transaction ID wraparound.\n\nWhen wraparound occurs, the database will automatically shutdown to prevent data loss, causing a full outage.\n\nRecovery would require entering single-user mode to run vacuum, taking the site down for a potentially multi-hour maintenance session.\n\nTo avoid reaching the db shutdown threshold, consider the following short-term actions:\n\n1. Escalate to the SRE Datastores team, and then,\n\n2. Find and terminate any very old transactions. The runbook for this alert has details.  Do this first.  It is the most critical step and may be all that is necessary to let autovacuum do its job.\n\n3. Run a manual vacuum on tables with oldest relfrozenxid.  Manual vacuums run faster than autovacuum.\n\n4. Add autovacuum workers or reduce autovacuum cost delay, if autovacuum is chronically unable to keep up with the transaction rate.\n\nLong running transaction dashboard: https://dashboards.gitlab.net/d/alerts-long_running_transactions/alerts-long-running-transactions?orgId=1\n Lower is better.","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":12,"x":12,"y":30},"id":3666116359,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"sort":"max","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[{"alias":"/^Soft SLO/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^Hard SLO/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/aggregated /","color":"#E7D551","linewidth":2,"zindex":3},{"alias":"/^95th quantile for week/","color":"#37872D","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^99th quantile for week/","color":"#56A64B","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":4,"zindex":-2}],"spaceLength":10,"stableId":"saturation-pg_xid_wraparound","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_min(\n  clamp_max(\n    max by(environment, tier, type, stage, shard, datname) (\n  clamp_min(\n    clamp_max(\n      (\n        max without (series) (\n          label_replace(pg_database_wraparound_age_datfrozenxid{env=\"$environment\",environment=\"$environment\",stage=\"$stage\",type=\"sentry\"}, \"series\", \"datfrozenxid\", \"\", \"\")\n          or\n          label_replace(pg_database_wraparound_age_datminmxid{env=\"$environment\",environment=\"$environment\",stage=\"$stage\",type=\"sentry\"}, \"series\", \"datminmxid\", \"\", \"\")\n        )\n        and on (instance, job) (pg_replication_is_replica{env=\"$environment\",environment=\"$environment\",stage=\"$stage\",type=\"sentry\"} == 0)\n      )\n      /\n      (2^31 - 3000000)\n      ,\n      1)\n  ,\n  0)\n)\n\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{ datname }}","refId":"A"},{"expr":"clamp_min(\n  clamp_max(\n    max(\n      max_over_time(gitlab_component_saturation:ratio{env=\"$environment\",environment=\"$environment\",stage=\"$stage\",type=\"sentry\", component=\"pg_xid_wraparound\"}[$__interval])\n    ) by (component)\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"aggregated {{ component }}","refId":"B"},{"expr":"max(\n  gitlab_component_saturation:ratio_quantile95_1w{env=\"$environment\",environment=\"$environment\",stage=\"$stage\",type=\"sentry\", component=\"pg_xid_wraparound\"}\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"95th quantile for week {{ component }}","refId":"C"},{"expr":"max(\n  gitlab_component_saturation:ratio_quantile99_1w{env=\"$environment\",environment=\"$environment\",stage=\"$stage\",type=\"sentry\", component=\"pg_xid_wraparound\"}\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"99th quantile for week {{ component }}","refId":"D"},{"expr":"avg(slo:max:soft:gitlab_component_saturation:ratio{component=\"pg_xid_wraparound\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"Soft SLO: {{ component }}","refId":"E"},{"expr":"avg(slo:max:hard:gitlab_component_saturation:ratio{component=\"pg_xid_wraparound\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"Hard SLO: {{ component }}","refId":"F"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"pg_xid_wraparound component saturation: Transaction ID Wraparound","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"Saturation %","logBase":1,"max":1,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"🌡 Saturation Details","titleSize":"h6","type":"row"},{"collapse":true,"collapsed":true,"gridPos":{"x":0,"y":100010},"id":50,"panels":[{"colors":["rgba(50, 172, 45, 0.97)","rgba(237, 129, 40, 0.89)","rgba(245, 54, 54, 0.9)"],"composites":[],"datasource":"$PROMETHEUS_DS","decimals":3,"format":"percentunit","graphId":"diagram_errors","gridPos":{"h":10,"w":24,"x":0,"y":0},"id":51,"init":{"arrowMarkerAbsolute":true,"cloneCssStyles":true,"flowchart":{"htmlLabels":true,"useMaxWidth":true},"gantt":{"barGap":4,"barHeight":20,"fontFamily":"\"Open-Sans\", \"sans-serif\"","fontSize":11,"gridLineStartPadding":35,"leftPadding":75,"numberSectionStyles":3,"titleTopMargin":25,"topPadding":50},"logLevel":3,"sequenceDiagram":{"actorMargin":50,"bottomMarginAdj":1,"boxMargin":10,"boxTextMargin":5,"diagramMarginX":50,"diagramMarginY":10,"height":65,"messageMargin":35,"mirrorActors":true,"noteMargin":10,"useMaxWidth":true,"width":150},"startOnLoad":false},"interval":"","legend":{"avg":true,"current":true,"gradient":{"enabled":true,"show":true},"max":true,"min":true,"show":false,"total":true},"mappingType":1,"mappingTypes":[],"maxDataPoints":100,"maxWidth":false,"mermaidServiceUrl":"","metricCharacterReplacements":[],"moddedSeriesVal":0,"mode":"content","nullPointMode":"connected","options":{"content":"graph TD\n  subgraph inf\n  sentry\nend\n\n\n  \n"},"seriesOverrides":[],"style":"","targets":[{"expr":"clamp_max(\n  max_over_time(gitlab_service_errors:ratio_5m{environment=\"$environment\",monitor=\"global\",stage=\"$stage\"}[$__range])\n,\n  1\n)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":1,"legendFormat":"{{ type }}"}],"thresholds":"0,0.001","title":"System Diagram (Keyed by Error Rates)","type":"jdbranham-diagram-panel","valueMaps":[],"valueName":"current","valueOptions":["avg","min","max","total","current"]},{"colors":["rgba(245, 54, 54, 0.9)","#FF9830","#73BF69"],"composites":[],"datasource":"$PROMETHEUS_DS","decimals":3,"format":"percentunit","graphId":"diagram_apdex","gridPos":{"h":10,"w":24,"x":0,"y":10},"id":52,"init":{"arrowMarkerAbsolute":true,"cloneCssStyles":true,"flowchart":{"htmlLabels":true,"useMaxWidth":true},"gantt":{"barGap":4,"barHeight":20,"fontFamily":"\"Open-Sans\", \"sans-serif\"","fontSize":11,"gridLineStartPadding":35,"leftPadding":75,"numberSectionStyles":3,"titleTopMargin":25,"topPadding":50},"logLevel":3,"sequenceDiagram":{"actorMargin":50,"bottomMarginAdj":1,"boxMargin":10,"boxTextMargin":5,"diagramMarginX":50,"diagramMarginY":10,"height":65,"messageMargin":35,"mirrorActors":true,"noteMargin":10,"useMaxWidth":true,"width":150},"startOnLoad":false},"interval":"","legend":{"avg":true,"current":true,"gradient":{"enabled":true,"show":true},"max":true,"min":true,"show":false,"total":true},"mappingType":1,"mappingTypes":[],"maxDataPoints":100,"maxWidth":false,"mermaidServiceUrl":"","metricCharacterReplacements":[],"moddedSeriesVal":0,"mode":"content","nullPointMode":"connected","options":{"content":"graph TD\n  subgraph inf\n  sentry\nend\n\n\n  \n"},"seriesOverrides":[],"style":"","targets":[{"expr":"min_over_time(gitlab_service_apdex:ratio_5m{environment=\"$environment\",monitor=\"global\",stage=\"$stage\"}[$__range])\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":1,"legendFormat":"{{ type }}"}],"thresholds":"0.99,0.995,0.999","title":"System Diagram (Keyed by Apdex/Latency Scores)","type":"jdbranham-diagram-panel","valueMaps":[],"valueName":"current","valueOptions":["avg","min","max","total","current"]},{"colors":[],"composites":[],"datasource":"$PROMETHEUS_DS","decimals":3,"format":"percentunit","graphId":"diagram_maturity","gridPos":{"h":10,"w":24,"x":0,"y":20},"id":53,"init":{"arrowMarkerAbsolute":true,"cloneCssStyles":true,"flowchart":{"htmlLabels":true,"useMaxWidth":true},"gantt":{"barGap":4,"barHeight":20,"fontFamily":"\"Open-Sans\", \"sans-serif\"","fontSize":11,"gridLineStartPadding":35,"leftPadding":75,"numberSectionStyles":3,"titleTopMargin":25,"topPadding":50},"logLevel":3,"sequenceDiagram":{"actorMargin":50,"bottomMarginAdj":1,"boxMargin":10,"boxTextMargin":5,"diagramMarginX":50,"diagramMarginY":10,"height":65,"messageMargin":35,"mirrorActors":true,"noteMargin":10,"useMaxWidth":true,"width":150},"startOnLoad":false},"interval":"","legend":{"avg":true,"current":true,"gradient":{"enabled":true,"show":true},"max":true,"min":true,"show":false,"total":true},"mappingType":1,"mappingTypes":[],"maxDataPoints":100,"maxWidth":false,"mermaidServiceUrl":"","metricCharacterReplacements":[],"moddedSeriesVal":0,"mode":"content","nullPointMode":"connected","options":{"content":"graph TD\n  subgraph inf\n  sentry[\"sentry (Level 1)\"]\nend\n\n\n  \n"},"seriesOverrides":[],"style":"","targets":[],"thresholds":"","title":"System Diagram (Keyed by Maturity Model)","type":"jdbranham-diagram-panel","valueMaps":[],"valueName":"current","valueOptions":["avg","min","max","total","current"]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"🗺️ System Diagrams","titleSize":"h6","type":"row"},{"content":"Made with ❤️ and [Grafonnet](https://github.com/grafana/grafonnet-lib). [Contribute to this dashboard on GitLab.com](https://gitlab.com/gitlab-com/runbooks/blob/master/dashboards)\n","datasource":null,"gridPos":{"h":2,"w":24,"x":0,"y":110000},"id":54,"mode":"markdown","title":"Source","type":"text"}],"refresh":"","rows":[],"schemaVersion":16,"style":"light","tags":["managed","sentry","gitlab","type:sentry","sentry","service overview"],"templating":{"list":[{"current":{"text":"Mimir - Gitlab Ops","value":"Mimir - Gitlab Ops"},"hide":0,"label":null,"name":"PROMETHEUS_DS","options":[],"query":"prometheus","refresh":1,"regex":"","type":"datasource"},{"allValue":null,"current":{"text":"gprd","value":"gprd"},"datasource":"$PROMETHEUS_DS","hide":0,"includeAll":false,"label":null,"multi":false,"name":"environment","options":[],"query":"label_values(gitlab_service_ops:rate_1h, environment)","refresh":1,"regex":"","sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":null,"current":{"text":"main","value":"main"},"hide":0,"includeAll":false,"label":"","multi":false,"name":"stage","options":[{"text":"main","value":"main"},{"text":"cny","value":"cny"},{"text":"","value":""}],"query":"main,cny,","refresh":0,"type":"custom"}]},"time":{"from":"now-6h/m","to":"now/m"},"timepicker":{"refresh_intervals":["1m","5m","10m","15m","30m"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"utc","title":"sentry: Overview","version":0,"uid":"sentry-main","description":"Uploaded by https://gitlab.com/gitlab-com/runbooks/-/jobs/8397766929 at Mon Nov 18 09:15:52 UTC 2024"}
