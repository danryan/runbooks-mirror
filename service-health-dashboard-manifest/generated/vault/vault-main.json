{"__inputs":[],"__requires":[],"annotations":{"list":[{"builtIn":1,"datasource":"-- Grafana --","enable":true,"hide":false,"iconColor":"#96D98D","name":"deploy","showIn":0,"tags":["deploy","$environment"],"type":"tags"},{"builtIn":1,"datasource":"-- Grafana --","enable":false,"hide":false,"iconColor":"#FFEE52","name":"canary-deploy","showIn":0,"tags":["deploy","${environment}-cny"],"type":"tags"},{"builtIn":1,"datasource":"-- Grafana --","enable":false,"hide":false,"iconColor":"#CA95E5","name":"feature-flags","showIn":0,"tags":["feature-flag","${environment}"],"type":"tags"}]},"editable":false,"gnetId":null,"graphTooltip":1,"hideControls":false,"id":null,"links":[{"asDropdown":true,"icon":"external link","includeVars":false,"keepTime":true,"tags":"","targetBlank":false,"title":"Platform Triage","type":"link","url":"https://dashboards.gitlab.net/d/general-triage/platform-triage?orgId=1"},{"asDropdown":true,"icon":"external link","includeVars":true,"keepTime":true,"tags":["managed","service overview"],"targetBlank":false,"title":"Service Overview Dashboards","type":"dashboards","url":""},{"asDropdown":true,"icon":"dashboard","includeVars":true,"keepTime":true,"tags":"type:vault","targetBlank":false,"title":"vault Detail","type":"dashboards","url":""},{"asDropdown":true,"icon":"external link","includeVars":true,"keepTime":true,"tags":["managed","type:vault","kube detail"],"targetBlank":false,"title":"‚ò∏Ô∏è vault Kubernetes Detail","type":"dashboards","url":""}],"panels":[{"collapse":false,"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":1},"id":2,"panels":[],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"üå°Ô∏è Aggregated Service Level Indicators (ùôéùôáùôÑùô®)","titleSize":"h6","type":"row"},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Apdex is a measure of requests that complete within a tolerable period of time for the service. Higher is better.","fill":0,"fillGradient":0,"gridPos":{"h":9,"w":6,"x":0,"y":2},"id":768803083,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","options":{"dataLinks":[{"targetBlank":true,"title":"vault Service Apdex SLO Analysis","url":"/d/alerts-service_slo_apdex?${__url_time_range}&${__all_variables}&var-type=vault"}]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/6h Degradation SLO \\(5% of monthly error budget\\).*/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/1h Outage SLO \\(2% of monthly error budget\\).*/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/.*shard (apdex|error ratio|RPS)$/","color":"#E7D551"},{"alias":"vault apdex avg","color":"#5794F2","dashLength":1,"fillBelowTo":"vault apdex","linewidth":1,"spaceLength":1,"zindex":-3},{"alias":"last week","color":"#dddddd80","dashLength":4,"dashes":true,"fill":0,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":2,"zindex":-3},{"alias":"vault apdex","color":"#E7D551","zindex":3}],"spaceLength":10,"stableId":"service-vault-apdex","stack":false,"steppedLine":false,"targets":[{"expr":"min_over_time(gitlab_service_apdex:ratio_5m{env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"}[$__interval])\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"vault apdex","refId":"A"},{"expr":"(1 - 6 * (1 - avg(slo:min:events:gitlab_service_apdex:ratio{component=\"\",monitor=\"global\",type=\"vault\"})\n))\n","format":"time_series","interval":"5m","intervalFactor":1,"legendFormat":"6h Degradation SLO (5% of monthly error budget)","refId":"B"},{"expr":"(1 - 14.4 * (1 - avg(slo:min:events:gitlab_service_apdex:ratio{component=\"\",monitor=\"global\",type=\"vault\"})\n))\n","format":"time_series","interval":"5m","intervalFactor":1,"legendFormat":"1h Outage SLO (2% of monthly error budget)","refId":"C"},{"expr":"avg_over_time(gitlab_service_apdex:ratio_5m{env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"}[$__interval])\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"vault apdex avg","refId":"D"},{"expr":"clamp_min(\n  gitlab_service_apdex:ratio_5m{env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"} offset 1w\n,\n  scalar(min((1 - 14.4 * (1 - avg(slo:min:events:gitlab_service_apdex:ratio{component=\"\",monitor=\"global\",type=\"vault\"})\n))\n))\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"last week","refId":"E"}],"title":"vault Service Apdex","tooltip":{"shared":true,"sort":1,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"percentunit","label":"Apdex %","logBase":1,"max":1,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"datasource":"$PROMETHEUS_DS","description":"","fieldConfig":{"defaults":{"decimals":0,"displayName":"Status","mappings":[{"id":0,"options":{"0":{"color":"black","index":0,"text":"Healthy"},"1":{"color":"orange","index":1,"text":"Warning: 1h deteriorating"},"10":{"color":"orange","index":10,"text":"Warning: 6h recovering, 1h recovering"},"11":{"color":"red","index":11,"text":"Degraded: 6h recovering, 1h degraded"},"12":{"color":"red","index":12,"text":"Degraded: 6h degraded"},"13":{"color":"red","index":13,"text":"Degraded: 6h degraded, 1h deteriorating"},"14":{"color":"red","index":14,"text":"Degraded: 6h degraded, 1h recovering"},"15":{"color":"red","index":15,"text":"Degraded: 6h degraded, 1h degraded"},"2":{"color":"orange","index":2,"text":"Warning: 1h recovering"},"3":{"color":"red","index":3,"text":"Degraded: 1h degraded"},"4":{"color":"orange","index":4,"text":"Warning: 6h deteriorating"},"5":{"color":"orange","index":5,"text":"Warning: 6h deteriorating, 1h deteriorating"},"6":{"color":"orange","index":6,"text":"Warning: 6h deteriorating, 1h recovering"},"7":{"color":"red","index":7,"text":"Degraded: 6h deteriorating, 1h degraded"},"8":{"color":"orange","index":8,"text":"Warning: 6h recovering"},"9":{"color":"orange","index":9,"text":"Warning: 6h recovering, 1h deteriorating"}},"type":"value"}],"thresholds":{"mode":"absolute","steps":[{"color":"black","value":0},{"color":"orange","value":1},{"color":"orange","value":2},{"color":"red","value":3},{"color":"orange","value":4},{"color":"orange","value":5},{"color":"orange","value":6},{"color":"red","value":7},{"color":"orange","value":8},{"color":"orange","value":9},{"color":"orange","value":10},{"color":"red","value":11},{"color":"red","value":12},{"color":"red","value":13},{"color":"red","value":14},{"color":"red","value":15}]},"unit":"none"}},"gridPos":{"h":1,"w":6,"x":0,"y":11},"id":4,"options":{"colorMode":"background","graphMode":"none","justifyMode":"auto","orientation":"vertical","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"7","targets":[{"expr":"sum(\n  label_replace(\n    vector(0) and on() (gitlab_service_apdex:ratio_1h{env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"}),\n    \"period\", \"na\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(1) and on () (gitlab_service_apdex:ratio_5m{env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"} < on(tier, type, __tenant_id__) group_left() (1 - (14.4 * (1 - slo:min:events:gitlab_service_apdex:ratio{component=\"\",monitor=\"global\",type=\"vault\"})))),\n    \"period\", \"5m\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(2) and on () (gitlab_service_apdex:ratio_1h{env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"} < on(tier, type, __tenant_id__) group_left() (1 - (14.4 * (1 - slo:min:events:gitlab_service_apdex:ratio{component=\"\",monitor=\"global\",type=\"vault\"})))),\n    \"period\", \"1h\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(4) and on () (gitlab_service_apdex:ratio_30m{env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"} < on(tier, type, __tenant_id__) group_left() (1 - (6 * (1 - slo:min:events:gitlab_service_apdex:ratio{component=\"\",monitor=\"global\",type=\"vault\"})))),\n    \"period\", \"30m\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(8) and on () (gitlab_service_apdex:ratio_6h{env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"} < on(tier, type, __tenant_id__) group_left() (1 - (6 * (1 - slo:min:events:gitlab_service_apdex:ratio{component=\"\",monitor=\"global\",type=\"vault\"})))),\n    \"period\", \"6h\", \"\", \"\"\n  )\n)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":1,"legendFormat":"vault Service | Latency/Apdex","refId":"A"}],"title":"","transparent":false,"type":"stat"},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Error rates are a measure of unhandled service exceptions per second. Client errors are excluded when possible. Lower is better","fill":0,"fillGradient":0,"gridPos":{"h":9,"w":6,"x":6,"y":2},"id":454784853,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","options":{"dataLinks":[{"targetBlank":true,"title":"vault Service Error-Rate SLO Analysis","url":"/d/alerts-service_slo_error?${__url_time_range}&${__all_variables}&var-type=vault"}]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/6h Degradation SLO \\(5% of monthly error budget\\).*/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/1h Outage SLO \\(2% of monthly error budget\\).*/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/.*shard (apdex|error ratio|RPS)$/","color":"#E7D551"},{"alias":"vault error ratio avg","color":"#5794F2","dashLength":1,"fillGradient":10,"linewidth":1,"spaceLength":1,"zindex":-3},{"alias":"last week","color":"#dddddd80","dashLength":4,"dashes":true,"fill":0,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":2,"zindex":-3},{"alias":"vault error ratio","color":"#E7D551","fillBelowTo":"vault error ratio avg","zindex":3}],"spaceLength":10,"stableId":"service-vault-error-rate","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_max(\n  max_over_time(gitlab_service_errors:ratio_5m{env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"}[$__interval])\n,\n  1\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"vault error ratio","refId":"A"},{"expr":"(6 * avg(slo:max:events:gitlab_service_errors:ratio{component=\"\",monitor=\"global\",type=\"vault\"})\n)\n","format":"time_series","interval":"5m","intervalFactor":1,"legendFormat":"6h Degradation SLO (5% of monthly error budget)","refId":"B"},{"expr":"(14.4 * avg(slo:max:events:gitlab_service_errors:ratio{component=\"\",monitor=\"global\",type=\"vault\"})\n)\n","format":"time_series","interval":"5m","intervalFactor":1,"legendFormat":"1h Outage SLO (2% of monthly error budget)","refId":"C"},{"expr":"clamp_max(\n  avg_over_time(gitlab_service_errors:ratio_5m{env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"}[$__interval])\n,\n  1\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"vault error ratio avg","refId":"D"},{"expr":"clamp_max(\n  gitlab_service_errors:ratio_5m{env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"} offset 1w\n,\n  scalar(max((14.4 * avg(slo:max:events:gitlab_service_errors:ratio{component=\"\",monitor=\"global\",type=\"vault\"})\n)\n))\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"last week","refId":"E"}],"title":"vault Service Error Ratio","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"percentunit","label":"Error %","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"datasource":"$PROMETHEUS_DS","description":"","fieldConfig":{"defaults":{"decimals":0,"displayName":"Status","mappings":[{"id":0,"options":{"0":{"color":"black","index":0,"text":"Healthy"},"1":{"color":"orange","index":1,"text":"Warning: 1h deteriorating"},"10":{"color":"orange","index":10,"text":"Warning: 6h recovering, 1h recovering"},"11":{"color":"red","index":11,"text":"Degraded: 6h recovering, 1h degraded"},"12":{"color":"red","index":12,"text":"Degraded: 6h degraded"},"13":{"color":"red","index":13,"text":"Degraded: 6h degraded, 1h deteriorating"},"14":{"color":"red","index":14,"text":"Degraded: 6h degraded, 1h recovering"},"15":{"color":"red","index":15,"text":"Degraded: 6h degraded, 1h degraded"},"2":{"color":"orange","index":2,"text":"Warning: 1h recovering"},"3":{"color":"red","index":3,"text":"Degraded: 1h degraded"},"4":{"color":"orange","index":4,"text":"Warning: 6h deteriorating"},"5":{"color":"orange","index":5,"text":"Warning: 6h deteriorating, 1h deteriorating"},"6":{"color":"orange","index":6,"text":"Warning: 6h deteriorating, 1h recovering"},"7":{"color":"red","index":7,"text":"Degraded: 6h deteriorating, 1h degraded"},"8":{"color":"orange","index":8,"text":"Warning: 6h recovering"},"9":{"color":"orange","index":9,"text":"Warning: 6h recovering, 1h deteriorating"}},"type":"value"}],"thresholds":{"mode":"absolute","steps":[{"color":"black","value":0},{"color":"orange","value":1},{"color":"orange","value":2},{"color":"red","value":3},{"color":"orange","value":4},{"color":"orange","value":5},{"color":"orange","value":6},{"color":"red","value":7},{"color":"orange","value":8},{"color":"orange","value":9},{"color":"orange","value":10},{"color":"red","value":11},{"color":"red","value":12},{"color":"red","value":13},{"color":"red","value":14},{"color":"red","value":15}]},"unit":"none"}},"gridPos":{"h":1,"w":6,"x":6,"y":11},"id":6,"options":{"colorMode":"background","graphMode":"none","justifyMode":"auto","orientation":"vertical","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"7","targets":[{"expr":"sum(\n  label_replace(\n    vector(0) and on() (gitlab_service_errors:ratio_1h{env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"}),\n    \"period\", \"na\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(1) and on () (gitlab_service_errors:ratio_5m{env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"} > on(tier, type, __tenant_id__) group_left() (14.4 * slo:max:events:gitlab_service_errors:ratio{component=\"\",monitor=\"global\",type=\"vault\"})),\n    \"period\", \"5m\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(2) and on () (gitlab_service_errors:ratio_1h{env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"} > on(tier, type, __tenant_id__) group_left() (14.4 * slo:max:events:gitlab_service_errors:ratio{component=\"\",monitor=\"global\",type=\"vault\"})),\n    \"period\", \"1h\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(4) and on () (gitlab_service_errors:ratio_30m{env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"} > on(tier, type, __tenant_id__) group_left() (6 * slo:max:events:gitlab_service_errors:ratio{component=\"\",monitor=\"global\",type=\"vault\"})),\n    \"period\", \"30m\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(8) and on () (gitlab_service_errors:ratio_6h{env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"} > on(tier, type, __tenant_id__) group_left() (6 * slo:max:events:gitlab_service_errors:ratio{component=\"\",monitor=\"global\",type=\"vault\"})),\n    \"period\", \"6h\", \"\", \"\"\n  )\n)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":1,"legendFormat":"vault Service | Errors","refId":"A"}],"title":"","transparent":false,"type":"stat"},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"The operation rate is the sum total of all requests being handle for all components within this service. Note that a single user request can lead to requests to multiple components. Higher is busier.","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":6,"x":12,"y":2},"id":90828367,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/.*shard (apdex|error ratio|RPS)$/","color":"#E7D551"},{"alias":"vault RPS","color":"#E7D551","zindex":3},{"alias":"last week","color":"#dddddd80","dashLength":4,"dashes":true,"fill":0,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":2,"zindex":-3},{"alias":"upper normal","color":"#73BF69","dashLength":8,"dashes":true,"fillBelowTo":"lower normal","legend":false,"lines":false,"linewidth":1,"nullPointMode":"connected","spaceLength":8,"zindex":-3},{"alias":"lower normal","color":"#73BF69","dashLength":8,"dashes":true,"legend":false,"lines":false,"linewidth":1,"nullPointMode":"connected","spaceLength":8,"zindex":-3}],"spaceLength":10,"stableId":"service-vault-ops-rate","stack":false,"steppedLine":false,"targets":[{"expr":"avg_over_time(gitlab_service_ops:rate_5m{env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"}[$__interval])\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"vault RPS","refId":"A"},{"expr":"gitlab_service_ops:rate_5m{env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"} offset 1w\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"last week","refId":"B"},{"expr":"clamp_min(\n  avg by (type) (\n    gitlab_service_ops:rate:prediction{env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"}\n    + (1) *\n    gitlab_service_ops:rate:stddev_over_time_1w{env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"}\n  ),\n  0\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"upper normal","refId":"C"},{"expr":"clamp_min(\n  avg by (type) (\n    gitlab_service_ops:rate:prediction{env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"}\n    + (-1) *\n    gitlab_service_ops:rate:stddev_over_time_1w{env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"}\n  ),\n  0\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"lower normal","refId":"D"}],"title":"vault Service RPS - Requests per Second","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Operations per Second","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Saturation is a measure of what ratio of a finite resource is currently being utilized. Lower is better.","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":6,"x":18,"y":2},"id":1217942947,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[{"title":"vault Service | kube_container_cpu resource Dashboard","url":"https://dashboards.gitlab.net/d/alerts-sat_kube_container_cpu/?var-environment=gprd&var-type=vault&var-stage=main&var-component=kube_container_cpu"},{"title":"vault Service | kube_container_cpu_limit resource Dashboard","url":"https://dashboards.gitlab.net/d/alerts-sat_kube_container_cpu_limit/?var-environment=gprd&var-type=vault&var-stage=main&var-component=kube_container_cpu_limit"},{"title":"vault Service | kube_container_memory resource Dashboard","url":"https://dashboards.gitlab.net/d/alerts-sat_kube_container_memory/?var-environment=gprd&var-type=vault&var-stage=main&var-component=kube_container_memory"},{"title":"vault Service | kube_container_throttling resource Dashboard","url":"https://dashboards.gitlab.net/d/alerts-kube_container_throttling/?var-environment=gprd&var-type=vault&var-stage=main&var-component=kube_container_throttling"},{"title":"vault Service | kube_go_memory resource Dashboard","url":"https://dashboards.gitlab.net/d/alerts-sat_kube_go_memory/?var-environment=gprd&var-type=vault&var-stage=main&var-component=kube_go_memory"},{"title":"vault Service | kube_horizontalpodautoscaler_desired_replicas resource Dashboard","url":"https://dashboards.gitlab.net/d/alerts-sat_kube_horizontalpodautoscaler/?var-environment=gprd&var-type=vault&var-stage=main&var-component=kube_horizontalpodautoscaler_desired_replicas"},{"title":"vault Service | kube_pool_cpu resource Dashboard","url":"https://dashboards.gitlab.net/d/alerts-sat_kube_pool_cpu/?var-environment=gprd&var-type=vault&var-stage=main&var-component=kube_pool_cpu"},{"title":"vault Service | kube_pool_max_nodes resource Dashboard","url":"https://dashboards.gitlab.net/d/alerts-sat_kube_pool_max_nodes/?var-environment=gprd&var-type=vault&var-stage=main&var-component=kube_pool_max_nodes"},{"title":"vault Service | open_fds resource Dashboard","url":"https://dashboards.gitlab.net/d/alerts-sat_open_fds/?var-environment=gprd&var-type=vault&var-stage=main&var-component=open_fds"}],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stableId":"service-utilization","stack":false,"steppedLine":false,"targets":[{"expr":"max(\n  max_over_time(\n    gitlab_component_saturation:ratio{env=\"$environment\",environment=\"$environment\",type=\"vault\"}[$__interval]\n  )\n) by (component)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{ component }} component","refId":"A"}],"title":"Saturation","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"percentunit","label":"Saturation %","logBase":1,"max":1,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"collapse":false,"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":20},"id":9,"panels":[],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"üî¨ Service Level Indicators","titleSize":"h6","type":"row"},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Apdex is a measure of requests that complete within a tolerable period of time for the service. Higher is better.","fill":0,"fillGradient":0,"gridPos":{"h":7,"w":8,"x":0,"y":21},"id":1564844886,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","options":{"dataLinks":[{"targetBlank":true,"title":"istio_internal_ingress SLI Apdex SLO Analysis","url":"/d/alerts-component_slo_apdex?${__url_time_range}&${__all_variables}&var-component=istio_internal_ingress&var-type=vault"}]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/6h Degradation SLO \\(5% of monthly error budget\\).*/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/1h Outage SLO \\(2% of monthly error budget\\).*/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/.*shard (apdex|error ratio|RPS)$/","color":"#E7D551"},{"alias":"istio_internal_ingress apdex avg","color":"#5794F2","dashLength":1,"fillBelowTo":"istio_internal_ingress apdex","linewidth":1,"spaceLength":1,"zindex":-3},{"alias":"last week","color":"#dddddd80","dashLength":4,"dashes":true,"fill":0,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":2,"zindex":-3},{"alias":"istio_internal_ingress apdex","color":"#E7D551","zindex":3}],"spaceLength":10,"stableId":"sli-istio_internal_ingress-apdex","stack":false,"steppedLine":false,"targets":[{"expr":"min_over_time(gitlab_component_apdex:ratio_5m{component=\"istio_internal_ingress\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"}[$__interval])\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"istio_internal_ingress apdex","refId":"A"},{"expr":"(1 - 6 * (1 - avg(slo:min:events:gitlab_service_apdex:ratio{component=\"istio_internal_ingress\",monitor=\"global\",type=\"vault\"})\n))\n","format":"time_series","interval":"5m","intervalFactor":1,"legendFormat":"6h Degradation SLO (5% of monthly error budget)","refId":"B"},{"expr":"(1 - 14.4 * (1 - avg(slo:min:events:gitlab_service_apdex:ratio{component=\"istio_internal_ingress\",monitor=\"global\",type=\"vault\"})\n))\n","format":"time_series","interval":"5m","intervalFactor":1,"legendFormat":"1h Outage SLO (2% of monthly error budget)","refId":"C"},{"expr":"avg_over_time(gitlab_component_apdex:ratio_5m{component=\"istio_internal_ingress\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"}[$__interval])\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"istio_internal_ingress apdex avg","refId":"D"},{"expr":"clamp_min(\n  gitlab_component_apdex:ratio_5m{component=\"istio_internal_ingress\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"} offset 1w\n,\n  scalar(min((1 - 14.4 * (1 - avg(slo:min:events:gitlab_service_apdex:ratio{component=\"istio_internal_ingress\",monitor=\"global\",type=\"vault\"})\n))\n))\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"last week","refId":"E"}],"title":"istio_internal_ingress SLI Apdex","tooltip":{"shared":true,"sort":1,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"percentunit","label":"Apdex %","logBase":1,"max":1,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"datasource":"$PROMETHEUS_DS","description":"","fieldConfig":{"defaults":{"decimals":0,"displayName":"Status","mappings":[{"id":0,"options":{"0":{"color":"black","index":0,"text":"Healthy"},"1":{"color":"orange","index":1,"text":"Warning: 1h deteriorating"},"10":{"color":"orange","index":10,"text":"Warning: 6h recovering, 1h recovering"},"11":{"color":"red","index":11,"text":"Degraded: 6h recovering, 1h degraded"},"12":{"color":"red","index":12,"text":"Degraded: 6h degraded"},"13":{"color":"red","index":13,"text":"Degraded: 6h degraded, 1h deteriorating"},"14":{"color":"red","index":14,"text":"Degraded: 6h degraded, 1h recovering"},"15":{"color":"red","index":15,"text":"Degraded: 6h degraded, 1h degraded"},"2":{"color":"orange","index":2,"text":"Warning: 1h recovering"},"3":{"color":"red","index":3,"text":"Degraded: 1h degraded"},"4":{"color":"orange","index":4,"text":"Warning: 6h deteriorating"},"5":{"color":"orange","index":5,"text":"Warning: 6h deteriorating, 1h deteriorating"},"6":{"color":"orange","index":6,"text":"Warning: 6h deteriorating, 1h recovering"},"7":{"color":"red","index":7,"text":"Degraded: 6h deteriorating, 1h degraded"},"8":{"color":"orange","index":8,"text":"Warning: 6h recovering"},"9":{"color":"orange","index":9,"text":"Warning: 6h recovering, 1h deteriorating"}},"type":"value"}],"thresholds":{"mode":"absolute","steps":[{"color":"black","value":0},{"color":"orange","value":1},{"color":"orange","value":2},{"color":"red","value":3},{"color":"orange","value":4},{"color":"orange","value":5},{"color":"orange","value":6},{"color":"red","value":7},{"color":"orange","value":8},{"color":"orange","value":9},{"color":"orange","value":10},{"color":"red","value":11},{"color":"red","value":12},{"color":"red","value":13},{"color":"red","value":14},{"color":"red","value":15}]},"unit":"none"}},"gridPos":{"h":1,"w":8,"x":0,"y":28},"id":11,"options":{"colorMode":"background","graphMode":"none","justifyMode":"auto","orientation":"vertical","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"7","targets":[{"expr":"sum(\n  label_replace(\n    vector(0) and on() (gitlab_component_apdex:ratio_1h{component=\"istio_internal_ingress\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"}),\n    \"period\", \"na\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(1) and on () (gitlab_component_apdex:ratio_5m{component=\"istio_internal_ingress\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"} < on(tier, type, __tenant_id__) group_left() (1 - (14.4 * (1 - slo:min:events:gitlab_service_apdex:ratio{component=\"istio_internal_ingress\",monitor=\"global\",type=\"vault\"})))),\n    \"period\", \"5m\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(2) and on () (gitlab_component_apdex:ratio_1h{component=\"istio_internal_ingress\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"} < on(tier, type, __tenant_id__) group_left() (1 - (14.4 * (1 - slo:min:events:gitlab_service_apdex:ratio{component=\"istio_internal_ingress\",monitor=\"global\",type=\"vault\"})))),\n    \"period\", \"1h\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(4) and on () (gitlab_component_apdex:ratio_30m{component=\"istio_internal_ingress\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"} < on(tier, type, __tenant_id__) group_left() (1 - (6 * (1 - slo:min:events:gitlab_service_apdex:ratio{component=\"istio_internal_ingress\",monitor=\"global\",type=\"vault\"})))),\n    \"period\", \"30m\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(8) and on () (gitlab_component_apdex:ratio_6h{component=\"istio_internal_ingress\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"} < on(tier, type, __tenant_id__) group_left() (1 - (6 * (1 - slo:min:events:gitlab_service_apdex:ratio{component=\"istio_internal_ingress\",monitor=\"global\",type=\"vault\"})))),\n    \"period\", \"6h\", \"\", \"\"\n  )\n)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":1,"legendFormat":"istio_internal_ingress SLI | Latency/Apdex","refId":"A"}],"title":"","transparent":false,"type":"stat"},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Error rates are a measure of unhandled service exceptions per second. Client errors are excluded when possible. Lower is better","fill":0,"fillGradient":0,"gridPos":{"h":7,"w":8,"x":8,"y":21},"id":623521050,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","options":{"dataLinks":[{"targetBlank":true,"title":"istio_internal_ingress SLI Error-Rate SLO Analysis","url":"/d/alerts-component_slo_error?${__url_time_range}&${__all_variables}&var-component=istio_internal_ingress&var-type=vault"}]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/6h Degradation SLO \\(5% of monthly error budget\\).*/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/1h Outage SLO \\(2% of monthly error budget\\).*/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/.*shard (apdex|error ratio|RPS)$/","color":"#E7D551"},{"alias":"istio_internal_ingress error ratio avg","color":"#5794F2","dashLength":1,"fillGradient":10,"linewidth":1,"spaceLength":1,"zindex":-3},{"alias":"last week","color":"#dddddd80","dashLength":4,"dashes":true,"fill":0,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":2,"zindex":-3},{"alias":"istio_internal_ingress error ratio","color":"#E7D551","fillBelowTo":"istio_internal_ingress error ratio avg","zindex":3}],"spaceLength":10,"stableId":"sli-istio_internal_ingress-error-rate","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_max(\n  max_over_time(gitlab_component_errors:ratio_5m{component=\"istio_internal_ingress\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"}[$__interval])\n,\n  1\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"istio_internal_ingress error ratio","refId":"A"},{"expr":"(6 * avg(slo:max:events:gitlab_service_errors:ratio{component=\"istio_internal_ingress\",monitor=\"global\",type=\"vault\"})\n)\n","format":"time_series","interval":"5m","intervalFactor":1,"legendFormat":"6h Degradation SLO (5% of monthly error budget)","refId":"B"},{"expr":"(14.4 * avg(slo:max:events:gitlab_service_errors:ratio{component=\"istio_internal_ingress\",monitor=\"global\",type=\"vault\"})\n)\n","format":"time_series","interval":"5m","intervalFactor":1,"legendFormat":"1h Outage SLO (2% of monthly error budget)","refId":"C"},{"expr":"clamp_max(\n  avg_over_time(gitlab_component_errors:ratio_5m{component=\"istio_internal_ingress\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"}[$__interval])\n,\n  1\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"istio_internal_ingress error ratio avg","refId":"D"},{"expr":"clamp_max(\n  gitlab_component_errors:ratio_5m{component=\"istio_internal_ingress\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"} offset 1w\n,\n  scalar(max((14.4 * avg(slo:max:events:gitlab_service_errors:ratio{component=\"istio_internal_ingress\",monitor=\"global\",type=\"vault\"})\n)\n))\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"last week","refId":"E"}],"title":"istio_internal_ingress SLI Error Ratio","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"percentunit","label":"Error %","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"datasource":"$PROMETHEUS_DS","description":"","fieldConfig":{"defaults":{"decimals":0,"displayName":"Status","mappings":[{"id":0,"options":{"0":{"color":"black","index":0,"text":"Healthy"},"1":{"color":"orange","index":1,"text":"Warning: 1h deteriorating"},"10":{"color":"orange","index":10,"text":"Warning: 6h recovering, 1h recovering"},"11":{"color":"red","index":11,"text":"Degraded: 6h recovering, 1h degraded"},"12":{"color":"red","index":12,"text":"Degraded: 6h degraded"},"13":{"color":"red","index":13,"text":"Degraded: 6h degraded, 1h deteriorating"},"14":{"color":"red","index":14,"text":"Degraded: 6h degraded, 1h recovering"},"15":{"color":"red","index":15,"text":"Degraded: 6h degraded, 1h degraded"},"2":{"color":"orange","index":2,"text":"Warning: 1h recovering"},"3":{"color":"red","index":3,"text":"Degraded: 1h degraded"},"4":{"color":"orange","index":4,"text":"Warning: 6h deteriorating"},"5":{"color":"orange","index":5,"text":"Warning: 6h deteriorating, 1h deteriorating"},"6":{"color":"orange","index":6,"text":"Warning: 6h deteriorating, 1h recovering"},"7":{"color":"red","index":7,"text":"Degraded: 6h deteriorating, 1h degraded"},"8":{"color":"orange","index":8,"text":"Warning: 6h recovering"},"9":{"color":"orange","index":9,"text":"Warning: 6h recovering, 1h deteriorating"}},"type":"value"}],"thresholds":{"mode":"absolute","steps":[{"color":"black","value":0},{"color":"orange","value":1},{"color":"orange","value":2},{"color":"red","value":3},{"color":"orange","value":4},{"color":"orange","value":5},{"color":"orange","value":6},{"color":"red","value":7},{"color":"orange","value":8},{"color":"orange","value":9},{"color":"orange","value":10},{"color":"red","value":11},{"color":"red","value":12},{"color":"red","value":13},{"color":"red","value":14},{"color":"red","value":15}]},"unit":"none"}},"gridPos":{"h":1,"w":8,"x":8,"y":28},"id":13,"options":{"colorMode":"background","graphMode":"none","justifyMode":"auto","orientation":"vertical","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"7","targets":[{"expr":"sum(\n  label_replace(\n    vector(0) and on() (gitlab_component_errors:ratio_1h{component=\"istio_internal_ingress\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"}),\n    \"period\", \"na\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(1) and on () (gitlab_component_errors:ratio_5m{component=\"istio_internal_ingress\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"} > on(tier, type, __tenant_id__) group_left() (14.4 * slo:max:events:gitlab_service_errors:ratio{component=\"istio_internal_ingress\",monitor=\"global\",type=\"vault\"})),\n    \"period\", \"5m\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(2) and on () (gitlab_component_errors:ratio_1h{component=\"istio_internal_ingress\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"} > on(tier, type, __tenant_id__) group_left() (14.4 * slo:max:events:gitlab_service_errors:ratio{component=\"istio_internal_ingress\",monitor=\"global\",type=\"vault\"})),\n    \"period\", \"1h\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(4) and on () (gitlab_component_errors:ratio_30m{component=\"istio_internal_ingress\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"} > on(tier, type, __tenant_id__) group_left() (6 * slo:max:events:gitlab_service_errors:ratio{component=\"istio_internal_ingress\",monitor=\"global\",type=\"vault\"})),\n    \"period\", \"30m\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(8) and on () (gitlab_component_errors:ratio_6h{component=\"istio_internal_ingress\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"} > on(tier, type, __tenant_id__) group_left() (6 * slo:max:events:gitlab_service_errors:ratio{component=\"istio_internal_ingress\",monitor=\"global\",type=\"vault\"})),\n    \"period\", \"6h\", \"\", \"\"\n  )\n)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":1,"legendFormat":"istio_internal_ingress SLI | Errors","refId":"A"}],"title":"","transparent":false,"type":"stat"},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"The operation rate is the sum total of all requests being handle for all components within this service. Note that a single user request can lead to requests to multiple components. Higher is busier.","fill":0,"fillGradient":0,"gridPos":{"h":8,"w":8,"x":16,"y":21},"id":3940117429,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/.*shard (apdex|error ratio|RPS)$/","color":"#E7D551"},{"alias":"istio_internal_ingress RPS","color":"#E7D551","zindex":3},{"alias":"last week","color":"#dddddd80","dashLength":4,"dashes":true,"fill":0,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":2,"zindex":-3}],"spaceLength":10,"stableId":"sli-istio_internal_ingress-ops-rate","stack":false,"steppedLine":false,"targets":[{"expr":"avg_over_time(gitlab_component_ops:rate_5m{component=\"istio_internal_ingress\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"}[$__interval])\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"istio_internal_ingress RPS","refId":"A"},{"expr":"gitlab_component_ops:rate_5m{component=\"istio_internal_ingress\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"} offset 1w\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"last week","refId":"B"}],"title":"istio_internal_ingress SLI RPS - Requests per Second","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Operations per Second","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Apdex is a measure of requests that complete within a tolerable period of time for the service. Higher is better.","fill":0,"fillGradient":0,"gridPos":{"h":7,"w":8,"x":0,"y":31},"id":1170118037,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","options":{"dataLinks":[{"targetBlank":true,"title":"istio_public_ingress SLI Apdex SLO Analysis","url":"/d/alerts-component_slo_apdex?${__url_time_range}&${__all_variables}&var-component=istio_public_ingress&var-type=vault"}]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/6h Degradation SLO \\(5% of monthly error budget\\).*/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/1h Outage SLO \\(2% of monthly error budget\\).*/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/.*shard (apdex|error ratio|RPS)$/","color":"#E7D551"},{"alias":"istio_public_ingress apdex avg","color":"#5794F2","dashLength":1,"fillBelowTo":"istio_public_ingress apdex","linewidth":1,"spaceLength":1,"zindex":-3},{"alias":"last week","color":"#dddddd80","dashLength":4,"dashes":true,"fill":0,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":2,"zindex":-3},{"alias":"istio_public_ingress apdex","color":"#E7D551","zindex":3}],"spaceLength":10,"stableId":"sli-istio_public_ingress-apdex","stack":false,"steppedLine":false,"targets":[{"expr":"min_over_time(gitlab_component_apdex:ratio_5m{component=\"istio_public_ingress\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"}[$__interval])\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"istio_public_ingress apdex","refId":"A"},{"expr":"(1 - 6 * (1 - avg(slo:min:events:gitlab_service_apdex:ratio{component=\"istio_public_ingress\",monitor=\"global\",type=\"vault\"})\n))\n","format":"time_series","interval":"5m","intervalFactor":1,"legendFormat":"6h Degradation SLO (5% of monthly error budget)","refId":"B"},{"expr":"(1 - 14.4 * (1 - avg(slo:min:events:gitlab_service_apdex:ratio{component=\"istio_public_ingress\",monitor=\"global\",type=\"vault\"})\n))\n","format":"time_series","interval":"5m","intervalFactor":1,"legendFormat":"1h Outage SLO (2% of monthly error budget)","refId":"C"},{"expr":"avg_over_time(gitlab_component_apdex:ratio_5m{component=\"istio_public_ingress\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"}[$__interval])\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"istio_public_ingress apdex avg","refId":"D"},{"expr":"clamp_min(\n  gitlab_component_apdex:ratio_5m{component=\"istio_public_ingress\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"} offset 1w\n,\n  scalar(min((1 - 14.4 * (1 - avg(slo:min:events:gitlab_service_apdex:ratio{component=\"istio_public_ingress\",monitor=\"global\",type=\"vault\"})\n))\n))\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"last week","refId":"E"}],"title":"istio_public_ingress SLI Apdex","tooltip":{"shared":true,"sort":1,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"percentunit","label":"Apdex %","logBase":1,"max":1,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"datasource":"$PROMETHEUS_DS","description":"","fieldConfig":{"defaults":{"decimals":0,"displayName":"Status","mappings":[{"id":0,"options":{"0":{"color":"black","index":0,"text":"Healthy"},"1":{"color":"orange","index":1,"text":"Warning: 1h deteriorating"},"10":{"color":"orange","index":10,"text":"Warning: 6h recovering, 1h recovering"},"11":{"color":"red","index":11,"text":"Degraded: 6h recovering, 1h degraded"},"12":{"color":"red","index":12,"text":"Degraded: 6h degraded"},"13":{"color":"red","index":13,"text":"Degraded: 6h degraded, 1h deteriorating"},"14":{"color":"red","index":14,"text":"Degraded: 6h degraded, 1h recovering"},"15":{"color":"red","index":15,"text":"Degraded: 6h degraded, 1h degraded"},"2":{"color":"orange","index":2,"text":"Warning: 1h recovering"},"3":{"color":"red","index":3,"text":"Degraded: 1h degraded"},"4":{"color":"orange","index":4,"text":"Warning: 6h deteriorating"},"5":{"color":"orange","index":5,"text":"Warning: 6h deteriorating, 1h deteriorating"},"6":{"color":"orange","index":6,"text":"Warning: 6h deteriorating, 1h recovering"},"7":{"color":"red","index":7,"text":"Degraded: 6h deteriorating, 1h degraded"},"8":{"color":"orange","index":8,"text":"Warning: 6h recovering"},"9":{"color":"orange","index":9,"text":"Warning: 6h recovering, 1h deteriorating"}},"type":"value"}],"thresholds":{"mode":"absolute","steps":[{"color":"black","value":0},{"color":"orange","value":1},{"color":"orange","value":2},{"color":"red","value":3},{"color":"orange","value":4},{"color":"orange","value":5},{"color":"orange","value":6},{"color":"red","value":7},{"color":"orange","value":8},{"color":"orange","value":9},{"color":"orange","value":10},{"color":"red","value":11},{"color":"red","value":12},{"color":"red","value":13},{"color":"red","value":14},{"color":"red","value":15}]},"unit":"none"}},"gridPos":{"h":1,"w":8,"x":0,"y":38},"id":16,"options":{"colorMode":"background","graphMode":"none","justifyMode":"auto","orientation":"vertical","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"7","targets":[{"expr":"sum(\n  label_replace(\n    vector(0) and on() (gitlab_component_apdex:ratio_1h{component=\"istio_public_ingress\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"}),\n    \"period\", \"na\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(1) and on () (gitlab_component_apdex:ratio_5m{component=\"istio_public_ingress\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"} < on(tier, type, __tenant_id__) group_left() (1 - (14.4 * (1 - slo:min:events:gitlab_service_apdex:ratio{component=\"istio_public_ingress\",monitor=\"global\",type=\"vault\"})))),\n    \"period\", \"5m\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(2) and on () (gitlab_component_apdex:ratio_1h{component=\"istio_public_ingress\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"} < on(tier, type, __tenant_id__) group_left() (1 - (14.4 * (1 - slo:min:events:gitlab_service_apdex:ratio{component=\"istio_public_ingress\",monitor=\"global\",type=\"vault\"})))),\n    \"period\", \"1h\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(4) and on () (gitlab_component_apdex:ratio_30m{component=\"istio_public_ingress\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"} < on(tier, type, __tenant_id__) group_left() (1 - (6 * (1 - slo:min:events:gitlab_service_apdex:ratio{component=\"istio_public_ingress\",monitor=\"global\",type=\"vault\"})))),\n    \"period\", \"30m\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(8) and on () (gitlab_component_apdex:ratio_6h{component=\"istio_public_ingress\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"} < on(tier, type, __tenant_id__) group_left() (1 - (6 * (1 - slo:min:events:gitlab_service_apdex:ratio{component=\"istio_public_ingress\",monitor=\"global\",type=\"vault\"})))),\n    \"period\", \"6h\", \"\", \"\"\n  )\n)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":1,"legendFormat":"istio_public_ingress SLI | Latency/Apdex","refId":"A"}],"title":"","transparent":false,"type":"stat"},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Error rates are a measure of unhandled service exceptions per second. Client errors are excluded when possible. Lower is better","fill":0,"fillGradient":0,"gridPos":{"h":7,"w":8,"x":8,"y":31},"id":2481683697,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","options":{"dataLinks":[{"targetBlank":true,"title":"istio_public_ingress SLI Error-Rate SLO Analysis","url":"/d/alerts-component_slo_error?${__url_time_range}&${__all_variables}&var-component=istio_public_ingress&var-type=vault"}]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/6h Degradation SLO \\(5% of monthly error budget\\).*/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/1h Outage SLO \\(2% of monthly error budget\\).*/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/.*shard (apdex|error ratio|RPS)$/","color":"#E7D551"},{"alias":"istio_public_ingress error ratio avg","color":"#5794F2","dashLength":1,"fillGradient":10,"linewidth":1,"spaceLength":1,"zindex":-3},{"alias":"last week","color":"#dddddd80","dashLength":4,"dashes":true,"fill":0,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":2,"zindex":-3},{"alias":"istio_public_ingress error ratio","color":"#E7D551","fillBelowTo":"istio_public_ingress error ratio avg","zindex":3}],"spaceLength":10,"stableId":"sli-istio_public_ingress-error-rate","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_max(\n  max_over_time(gitlab_component_errors:ratio_5m{component=\"istio_public_ingress\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"}[$__interval])\n,\n  1\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"istio_public_ingress error ratio","refId":"A"},{"expr":"(6 * avg(slo:max:events:gitlab_service_errors:ratio{component=\"istio_public_ingress\",monitor=\"global\",type=\"vault\"})\n)\n","format":"time_series","interval":"5m","intervalFactor":1,"legendFormat":"6h Degradation SLO (5% of monthly error budget)","refId":"B"},{"expr":"(14.4 * avg(slo:max:events:gitlab_service_errors:ratio{component=\"istio_public_ingress\",monitor=\"global\",type=\"vault\"})\n)\n","format":"time_series","interval":"5m","intervalFactor":1,"legendFormat":"1h Outage SLO (2% of monthly error budget)","refId":"C"},{"expr":"clamp_max(\n  avg_over_time(gitlab_component_errors:ratio_5m{component=\"istio_public_ingress\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"}[$__interval])\n,\n  1\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"istio_public_ingress error ratio avg","refId":"D"},{"expr":"clamp_max(\n  gitlab_component_errors:ratio_5m{component=\"istio_public_ingress\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"} offset 1w\n,\n  scalar(max((14.4 * avg(slo:max:events:gitlab_service_errors:ratio{component=\"istio_public_ingress\",monitor=\"global\",type=\"vault\"})\n)\n))\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"last week","refId":"E"}],"title":"istio_public_ingress SLI Error Ratio","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"percentunit","label":"Error %","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"datasource":"$PROMETHEUS_DS","description":"","fieldConfig":{"defaults":{"decimals":0,"displayName":"Status","mappings":[{"id":0,"options":{"0":{"color":"black","index":0,"text":"Healthy"},"1":{"color":"orange","index":1,"text":"Warning: 1h deteriorating"},"10":{"color":"orange","index":10,"text":"Warning: 6h recovering, 1h recovering"},"11":{"color":"red","index":11,"text":"Degraded: 6h recovering, 1h degraded"},"12":{"color":"red","index":12,"text":"Degraded: 6h degraded"},"13":{"color":"red","index":13,"text":"Degraded: 6h degraded, 1h deteriorating"},"14":{"color":"red","index":14,"text":"Degraded: 6h degraded, 1h recovering"},"15":{"color":"red","index":15,"text":"Degraded: 6h degraded, 1h degraded"},"2":{"color":"orange","index":2,"text":"Warning: 1h recovering"},"3":{"color":"red","index":3,"text":"Degraded: 1h degraded"},"4":{"color":"orange","index":4,"text":"Warning: 6h deteriorating"},"5":{"color":"orange","index":5,"text":"Warning: 6h deteriorating, 1h deteriorating"},"6":{"color":"orange","index":6,"text":"Warning: 6h deteriorating, 1h recovering"},"7":{"color":"red","index":7,"text":"Degraded: 6h deteriorating, 1h degraded"},"8":{"color":"orange","index":8,"text":"Warning: 6h recovering"},"9":{"color":"orange","index":9,"text":"Warning: 6h recovering, 1h deteriorating"}},"type":"value"}],"thresholds":{"mode":"absolute","steps":[{"color":"black","value":0},{"color":"orange","value":1},{"color":"orange","value":2},{"color":"red","value":3},{"color":"orange","value":4},{"color":"orange","value":5},{"color":"orange","value":6},{"color":"red","value":7},{"color":"orange","value":8},{"color":"orange","value":9},{"color":"orange","value":10},{"color":"red","value":11},{"color":"red","value":12},{"color":"red","value":13},{"color":"red","value":14},{"color":"red","value":15}]},"unit":"none"}},"gridPos":{"h":1,"w":8,"x":8,"y":38},"id":18,"options":{"colorMode":"background","graphMode":"none","justifyMode":"auto","orientation":"vertical","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"7","targets":[{"expr":"sum(\n  label_replace(\n    vector(0) and on() (gitlab_component_errors:ratio_1h{component=\"istio_public_ingress\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"}),\n    \"period\", \"na\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(1) and on () (gitlab_component_errors:ratio_5m{component=\"istio_public_ingress\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"} > on(tier, type, __tenant_id__) group_left() (14.4 * slo:max:events:gitlab_service_errors:ratio{component=\"istio_public_ingress\",monitor=\"global\",type=\"vault\"})),\n    \"period\", \"5m\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(2) and on () (gitlab_component_errors:ratio_1h{component=\"istio_public_ingress\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"} > on(tier, type, __tenant_id__) group_left() (14.4 * slo:max:events:gitlab_service_errors:ratio{component=\"istio_public_ingress\",monitor=\"global\",type=\"vault\"})),\n    \"period\", \"1h\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(4) and on () (gitlab_component_errors:ratio_30m{component=\"istio_public_ingress\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"} > on(tier, type, __tenant_id__) group_left() (6 * slo:max:events:gitlab_service_errors:ratio{component=\"istio_public_ingress\",monitor=\"global\",type=\"vault\"})),\n    \"period\", \"30m\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(8) and on () (gitlab_component_errors:ratio_6h{component=\"istio_public_ingress\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"} > on(tier, type, __tenant_id__) group_left() (6 * slo:max:events:gitlab_service_errors:ratio{component=\"istio_public_ingress\",monitor=\"global\",type=\"vault\"})),\n    \"period\", \"6h\", \"\", \"\"\n  )\n)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":1,"legendFormat":"istio_public_ingress SLI | Errors","refId":"A"}],"title":"","transparent":false,"type":"stat"},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"The operation rate is the sum total of all requests being handle for all components within this service. Note that a single user request can lead to requests to multiple components. Higher is busier.","fill":0,"fillGradient":0,"gridPos":{"h":8,"w":8,"x":16,"y":31},"id":247829603,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/.*shard (apdex|error ratio|RPS)$/","color":"#E7D551"},{"alias":"istio_public_ingress RPS","color":"#E7D551","zindex":3},{"alias":"last week","color":"#dddddd80","dashLength":4,"dashes":true,"fill":0,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":2,"zindex":-3}],"spaceLength":10,"stableId":"sli-istio_public_ingress-ops-rate","stack":false,"steppedLine":false,"targets":[{"expr":"avg_over_time(gitlab_component_ops:rate_5m{component=\"istio_public_ingress\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"}[$__interval])\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"istio_public_ingress RPS","refId":"A"},{"expr":"gitlab_component_ops:rate_5m{component=\"istio_public_ingress\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"} offset 1w\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"last week","refId":"B"}],"title":"istio_public_ingress SLI RPS - Requests per Second","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Operations per Second","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"The operation rate is the sum total of all requests being handle for all components within this service. Note that a single user request can lead to requests to multiple components. Higher is busier.","fill":0,"fillGradient":0,"gridPos":{"h":8,"w":12,"x":0,"y":41},"id":1463015640,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/.*shard (apdex|error ratio|RPS)$/","color":"#E7D551"},{"alias":"vault RPS","color":"#E7D551","zindex":3},{"alias":"last week","color":"#dddddd80","dashLength":4,"dashes":true,"fill":0,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":2,"zindex":-3}],"spaceLength":10,"stableId":"sli-vault-ops-rate","stack":false,"steppedLine":false,"targets":[{"expr":"avg_over_time(gitlab_component_ops:rate_5m{component=\"vault\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"}[$__interval])\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"vault RPS","refId":"A"},{"expr":"gitlab_component_ops:rate_5m{component=\"vault\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"} offset 1w\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"last week","refId":"B"}],"title":"vault SLI RPS - Requests per Second","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Operations per Second","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"content":"### Description\n\nHashicorp Vault is a secret management service that provides secrets for Kubernetes and provisioning pipelines.\nThis SLI monitors the Vault HTTP interface. 5xx responses are considered failures.\n\n","gridPos":{"h":8,"w":12,"x":12,"y":41},"id":21,"mode":"markdown","title":"Details","type":"text"},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Error rates are a measure of unhandled service exceptions per second. Client errors are excluded when possible. Lower is better","fill":0,"fillGradient":0,"gridPos":{"h":7,"w":8,"x":0,"y":51},"id":4110925204,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","options":{"dataLinks":[{"targetBlank":true,"title":"vault_audit_log_request SLI Error-Rate SLO Analysis","url":"/d/alerts-component_slo_error?${__url_time_range}&${__all_variables}&var-component=vault_audit_log_request&var-type=vault"}]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/6h Degradation SLO \\(5% of monthly error budget\\).*/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/1h Outage SLO \\(2% of monthly error budget\\).*/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/.*shard (apdex|error ratio|RPS)$/","color":"#E7D551"},{"alias":"vault_audit_log_request error ratio avg","color":"#5794F2","dashLength":1,"fillGradient":10,"linewidth":1,"spaceLength":1,"zindex":-3},{"alias":"last week","color":"#dddddd80","dashLength":4,"dashes":true,"fill":0,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":2,"zindex":-3},{"alias":"vault_audit_log_request error ratio","color":"#E7D551","fillBelowTo":"vault_audit_log_request error ratio avg","zindex":3}],"spaceLength":10,"stableId":"sli-vault_audit_log_request-error-rate","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_max(\n  max_over_time(gitlab_component_errors:ratio_5m{component=\"vault_audit_log_request\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"}[$__interval])\n,\n  1\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"vault_audit_log_request error ratio","refId":"A"},{"expr":"(6 * avg(slo:max:events:gitlab_service_errors:ratio{component=\"vault_audit_log_request\",monitor=\"global\",type=\"vault\"})\n)\n","format":"time_series","interval":"5m","intervalFactor":1,"legendFormat":"6h Degradation SLO (5% of monthly error budget)","refId":"B"},{"expr":"(14.4 * avg(slo:max:events:gitlab_service_errors:ratio{component=\"vault_audit_log_request\",monitor=\"global\",type=\"vault\"})\n)\n","format":"time_series","interval":"5m","intervalFactor":1,"legendFormat":"1h Outage SLO (2% of monthly error budget)","refId":"C"},{"expr":"clamp_max(\n  avg_over_time(gitlab_component_errors:ratio_5m{component=\"vault_audit_log_request\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"}[$__interval])\n,\n  1\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"vault_audit_log_request error ratio avg","refId":"D"},{"expr":"clamp_max(\n  gitlab_component_errors:ratio_5m{component=\"vault_audit_log_request\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"} offset 1w\n,\n  scalar(max((14.4 * avg(slo:max:events:gitlab_service_errors:ratio{component=\"vault_audit_log_request\",monitor=\"global\",type=\"vault\"})\n)\n))\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"last week","refId":"E"}],"title":"vault_audit_log_request SLI Error Ratio","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"percentunit","label":"Error %","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"datasource":"$PROMETHEUS_DS","description":"","fieldConfig":{"defaults":{"decimals":0,"displayName":"Status","mappings":[{"id":0,"options":{"0":{"color":"black","index":0,"text":"Healthy"},"1":{"color":"orange","index":1,"text":"Warning: 1h deteriorating"},"10":{"color":"orange","index":10,"text":"Warning: 6h recovering, 1h recovering"},"11":{"color":"red","index":11,"text":"Degraded: 6h recovering, 1h degraded"},"12":{"color":"red","index":12,"text":"Degraded: 6h degraded"},"13":{"color":"red","index":13,"text":"Degraded: 6h degraded, 1h deteriorating"},"14":{"color":"red","index":14,"text":"Degraded: 6h degraded, 1h recovering"},"15":{"color":"red","index":15,"text":"Degraded: 6h degraded, 1h degraded"},"2":{"color":"orange","index":2,"text":"Warning: 1h recovering"},"3":{"color":"red","index":3,"text":"Degraded: 1h degraded"},"4":{"color":"orange","index":4,"text":"Warning: 6h deteriorating"},"5":{"color":"orange","index":5,"text":"Warning: 6h deteriorating, 1h deteriorating"},"6":{"color":"orange","index":6,"text":"Warning: 6h deteriorating, 1h recovering"},"7":{"color":"red","index":7,"text":"Degraded: 6h deteriorating, 1h degraded"},"8":{"color":"orange","index":8,"text":"Warning: 6h recovering"},"9":{"color":"orange","index":9,"text":"Warning: 6h recovering, 1h deteriorating"}},"type":"value"}],"thresholds":{"mode":"absolute","steps":[{"color":"black","value":0},{"color":"orange","value":1},{"color":"orange","value":2},{"color":"red","value":3},{"color":"orange","value":4},{"color":"orange","value":5},{"color":"orange","value":6},{"color":"red","value":7},{"color":"orange","value":8},{"color":"orange","value":9},{"color":"orange","value":10},{"color":"red","value":11},{"color":"red","value":12},{"color":"red","value":13},{"color":"red","value":14},{"color":"red","value":15}]},"unit":"none"}},"gridPos":{"h":1,"w":8,"x":0,"y":58},"id":23,"options":{"colorMode":"background","graphMode":"none","justifyMode":"auto","orientation":"vertical","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"7","targets":[{"expr":"sum(\n  label_replace(\n    vector(0) and on() (gitlab_component_errors:ratio_1h{component=\"vault_audit_log_request\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"}),\n    \"period\", \"na\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(1) and on () (gitlab_component_errors:ratio_5m{component=\"vault_audit_log_request\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"} > on(tier, type, __tenant_id__) group_left() (14.4 * slo:max:events:gitlab_service_errors:ratio{component=\"vault_audit_log_request\",monitor=\"global\",type=\"vault\"})),\n    \"period\", \"5m\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(2) and on () (gitlab_component_errors:ratio_1h{component=\"vault_audit_log_request\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"} > on(tier, type, __tenant_id__) group_left() (14.4 * slo:max:events:gitlab_service_errors:ratio{component=\"vault_audit_log_request\",monitor=\"global\",type=\"vault\"})),\n    \"period\", \"1h\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(4) and on () (gitlab_component_errors:ratio_30m{component=\"vault_audit_log_request\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"} > on(tier, type, __tenant_id__) group_left() (6 * slo:max:events:gitlab_service_errors:ratio{component=\"vault_audit_log_request\",monitor=\"global\",type=\"vault\"})),\n    \"period\", \"30m\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(8) and on () (gitlab_component_errors:ratio_6h{component=\"vault_audit_log_request\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"} > on(tier, type, __tenant_id__) group_left() (6 * slo:max:events:gitlab_service_errors:ratio{component=\"vault_audit_log_request\",monitor=\"global\",type=\"vault\"})),\n    \"period\", \"6h\", \"\", \"\"\n  )\n)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":1,"legendFormat":"vault_audit_log_request SLI | Errors","refId":"A"}],"title":"","transparent":false,"type":"stat"},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"The operation rate is the sum total of all requests being handle for all components within this service. Note that a single user request can lead to requests to multiple components. Higher is busier.","fill":0,"fillGradient":0,"gridPos":{"h":8,"w":8,"x":8,"y":51},"id":4071490537,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/.*shard (apdex|error ratio|RPS)$/","color":"#E7D551"},{"alias":"vault_audit_log_request RPS","color":"#E7D551","zindex":3},{"alias":"last week","color":"#dddddd80","dashLength":4,"dashes":true,"fill":0,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":2,"zindex":-3}],"spaceLength":10,"stableId":"sli-vault_audit_log_request-ops-rate","stack":false,"steppedLine":false,"targets":[{"expr":"avg_over_time(gitlab_component_ops:rate_5m{component=\"vault_audit_log_request\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"}[$__interval])\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"vault_audit_log_request RPS","refId":"A"},{"expr":"gitlab_component_ops:rate_5m{component=\"vault_audit_log_request\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"} offset 1w\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"last week","refId":"B"}],"title":"vault_audit_log_request SLI RPS - Requests per Second","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Operations per Second","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"content":"### Description\n\nVault failed to make an audit log request to any of the configured\naudit log devices, ceasing all user operations.\n\n","gridPos":{"h":8,"w":8,"x":16,"y":51},"id":25,"mode":"markdown","title":"Details","type":"text"},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Error rates are a measure of unhandled service exceptions per second. Client errors are excluded when possible. Lower is better","fill":0,"fillGradient":0,"gridPos":{"h":7,"w":8,"x":0,"y":61},"id":298512225,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","options":{"dataLinks":[{"targetBlank":true,"title":"vault_audit_log_response SLI Error-Rate SLO Analysis","url":"/d/alerts-component_slo_error?${__url_time_range}&${__all_variables}&var-component=vault_audit_log_response&var-type=vault"}]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/6h Degradation SLO \\(5% of monthly error budget\\).*/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/1h Outage SLO \\(2% of monthly error budget\\).*/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/.*shard (apdex|error ratio|RPS)$/","color":"#E7D551"},{"alias":"vault_audit_log_response error ratio avg","color":"#5794F2","dashLength":1,"fillGradient":10,"linewidth":1,"spaceLength":1,"zindex":-3},{"alias":"last week","color":"#dddddd80","dashLength":4,"dashes":true,"fill":0,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":2,"zindex":-3},{"alias":"vault_audit_log_response error ratio","color":"#E7D551","fillBelowTo":"vault_audit_log_response error ratio avg","zindex":3}],"spaceLength":10,"stableId":"sli-vault_audit_log_response-error-rate","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_max(\n  max_over_time(gitlab_component_errors:ratio_5m{component=\"vault_audit_log_response\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"}[$__interval])\n,\n  1\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"vault_audit_log_response error ratio","refId":"A"},{"expr":"(6 * avg(slo:max:events:gitlab_service_errors:ratio{component=\"vault_audit_log_response\",monitor=\"global\",type=\"vault\"})\n)\n","format":"time_series","interval":"5m","intervalFactor":1,"legendFormat":"6h Degradation SLO (5% of monthly error budget)","refId":"B"},{"expr":"(14.4 * avg(slo:max:events:gitlab_service_errors:ratio{component=\"vault_audit_log_response\",monitor=\"global\",type=\"vault\"})\n)\n","format":"time_series","interval":"5m","intervalFactor":1,"legendFormat":"1h Outage SLO (2% of monthly error budget)","refId":"C"},{"expr":"clamp_max(\n  avg_over_time(gitlab_component_errors:ratio_5m{component=\"vault_audit_log_response\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"}[$__interval])\n,\n  1\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"vault_audit_log_response error ratio avg","refId":"D"},{"expr":"clamp_max(\n  gitlab_component_errors:ratio_5m{component=\"vault_audit_log_response\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"} offset 1w\n,\n  scalar(max((14.4 * avg(slo:max:events:gitlab_service_errors:ratio{component=\"vault_audit_log_response\",monitor=\"global\",type=\"vault\"})\n)\n))\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"last week","refId":"E"}],"title":"vault_audit_log_response SLI Error Ratio","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"percentunit","label":"Error %","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"datasource":"$PROMETHEUS_DS","description":"","fieldConfig":{"defaults":{"decimals":0,"displayName":"Status","mappings":[{"id":0,"options":{"0":{"color":"black","index":0,"text":"Healthy"},"1":{"color":"orange","index":1,"text":"Warning: 1h deteriorating"},"10":{"color":"orange","index":10,"text":"Warning: 6h recovering, 1h recovering"},"11":{"color":"red","index":11,"text":"Degraded: 6h recovering, 1h degraded"},"12":{"color":"red","index":12,"text":"Degraded: 6h degraded"},"13":{"color":"red","index":13,"text":"Degraded: 6h degraded, 1h deteriorating"},"14":{"color":"red","index":14,"text":"Degraded: 6h degraded, 1h recovering"},"15":{"color":"red","index":15,"text":"Degraded: 6h degraded, 1h degraded"},"2":{"color":"orange","index":2,"text":"Warning: 1h recovering"},"3":{"color":"red","index":3,"text":"Degraded: 1h degraded"},"4":{"color":"orange","index":4,"text":"Warning: 6h deteriorating"},"5":{"color":"orange","index":5,"text":"Warning: 6h deteriorating, 1h deteriorating"},"6":{"color":"orange","index":6,"text":"Warning: 6h deteriorating, 1h recovering"},"7":{"color":"red","index":7,"text":"Degraded: 6h deteriorating, 1h degraded"},"8":{"color":"orange","index":8,"text":"Warning: 6h recovering"},"9":{"color":"orange","index":9,"text":"Warning: 6h recovering, 1h deteriorating"}},"type":"value"}],"thresholds":{"mode":"absolute","steps":[{"color":"black","value":0},{"color":"orange","value":1},{"color":"orange","value":2},{"color":"red","value":3},{"color":"orange","value":4},{"color":"orange","value":5},{"color":"orange","value":6},{"color":"red","value":7},{"color":"orange","value":8},{"color":"orange","value":9},{"color":"orange","value":10},{"color":"red","value":11},{"color":"red","value":12},{"color":"red","value":13},{"color":"red","value":14},{"color":"red","value":15}]},"unit":"none"}},"gridPos":{"h":1,"w":8,"x":0,"y":68},"id":27,"options":{"colorMode":"background","graphMode":"none","justifyMode":"auto","orientation":"vertical","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"7","targets":[{"expr":"sum(\n  label_replace(\n    vector(0) and on() (gitlab_component_errors:ratio_1h{component=\"vault_audit_log_response\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"}),\n    \"period\", \"na\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(1) and on () (gitlab_component_errors:ratio_5m{component=\"vault_audit_log_response\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"} > on(tier, type, __tenant_id__) group_left() (14.4 * slo:max:events:gitlab_service_errors:ratio{component=\"vault_audit_log_response\",monitor=\"global\",type=\"vault\"})),\n    \"period\", \"5m\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(2) and on () (gitlab_component_errors:ratio_1h{component=\"vault_audit_log_response\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"} > on(tier, type, __tenant_id__) group_left() (14.4 * slo:max:events:gitlab_service_errors:ratio{component=\"vault_audit_log_response\",monitor=\"global\",type=\"vault\"})),\n    \"period\", \"1h\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(4) and on () (gitlab_component_errors:ratio_30m{component=\"vault_audit_log_response\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"} > on(tier, type, __tenant_id__) group_left() (6 * slo:max:events:gitlab_service_errors:ratio{component=\"vault_audit_log_response\",monitor=\"global\",type=\"vault\"})),\n    \"period\", \"30m\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(8) and on () (gitlab_component_errors:ratio_6h{component=\"vault_audit_log_response\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"} > on(tier, type, __tenant_id__) group_left() (6 * slo:max:events:gitlab_service_errors:ratio{component=\"vault_audit_log_response\",monitor=\"global\",type=\"vault\"})),\n    \"period\", \"6h\", \"\", \"\"\n  )\n)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":1,"legendFormat":"vault_audit_log_response SLI | Errors","refId":"A"}],"title":"","transparent":false,"type":"stat"},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"The operation rate is the sum total of all requests being handle for all components within this service. Note that a single user request can lead to requests to multiple components. Higher is busier.","fill":0,"fillGradient":0,"gridPos":{"h":8,"w":8,"x":8,"y":61},"id":1904301381,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/.*shard (apdex|error ratio|RPS)$/","color":"#E7D551"},{"alias":"vault_audit_log_response RPS","color":"#E7D551","zindex":3},{"alias":"last week","color":"#dddddd80","dashLength":4,"dashes":true,"fill":0,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":2,"zindex":-3}],"spaceLength":10,"stableId":"sli-vault_audit_log_response-ops-rate","stack":false,"steppedLine":false,"targets":[{"expr":"avg_over_time(gitlab_component_ops:rate_5m{component=\"vault_audit_log_response\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"}[$__interval])\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"vault_audit_log_response RPS","refId":"A"},{"expr":"gitlab_component_ops:rate_5m{component=\"vault_audit_log_response\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"} offset 1w\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"last week","refId":"B"}],"title":"vault_audit_log_response SLI RPS - Requests per Second","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Operations per Second","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"content":"### Description\n\nVault failed to make an audit log responses to any of the configured\naudit log devices, ceasing all user operations.\n\n","gridPos":{"h":8,"w":8,"x":16,"y":61},"id":29,"mode":"markdown","title":"Details","type":"text"},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Error rates are a measure of unhandled service exceptions per second. Client errors are excluded when possible. Lower is better","fill":0,"fillGradient":0,"gridPos":{"h":7,"w":8,"x":0,"y":71},"id":3274927083,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","options":{"dataLinks":[{"targetBlank":true,"title":"vault_google_lb SLI Error-Rate SLO Analysis","url":"/d/alerts-component_slo_error?${__url_time_range}&${__all_variables}&var-component=vault_google_lb&var-type=vault"}]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/6h Degradation SLO \\(5% of monthly error budget\\).*/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/1h Outage SLO \\(2% of monthly error budget\\).*/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/.*shard (apdex|error ratio|RPS)$/","color":"#E7D551"},{"alias":"vault_google_lb error ratio avg","color":"#5794F2","dashLength":1,"fillGradient":10,"linewidth":1,"spaceLength":1,"zindex":-3},{"alias":"last week","color":"#dddddd80","dashLength":4,"dashes":true,"fill":0,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":2,"zindex":-3},{"alias":"vault_google_lb error ratio","color":"#E7D551","fillBelowTo":"vault_google_lb error ratio avg","zindex":3}],"spaceLength":10,"stableId":"sli-vault_google_lb-error-rate","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_max(\n  max_over_time(gitlab_component_errors:ratio_5m{component=\"vault_google_lb\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"}[$__interval])\n,\n  1\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"vault_google_lb error ratio","refId":"A"},{"expr":"(6 * avg(slo:max:events:gitlab_service_errors:ratio{component=\"vault_google_lb\",monitor=\"global\",type=\"vault\"})\n)\n","format":"time_series","interval":"5m","intervalFactor":1,"legendFormat":"6h Degradation SLO (5% of monthly error budget)","refId":"B"},{"expr":"(14.4 * avg(slo:max:events:gitlab_service_errors:ratio{component=\"vault_google_lb\",monitor=\"global\",type=\"vault\"})\n)\n","format":"time_series","interval":"5m","intervalFactor":1,"legendFormat":"1h Outage SLO (2% of monthly error budget)","refId":"C"},{"expr":"clamp_max(\n  avg_over_time(gitlab_component_errors:ratio_5m{component=\"vault_google_lb\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"}[$__interval])\n,\n  1\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"vault_google_lb error ratio avg","refId":"D"},{"expr":"clamp_max(\n  gitlab_component_errors:ratio_5m{component=\"vault_google_lb\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"} offset 1w\n,\n  scalar(max((14.4 * avg(slo:max:events:gitlab_service_errors:ratio{component=\"vault_google_lb\",monitor=\"global\",type=\"vault\"})\n)\n))\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"last week","refId":"E"}],"title":"vault_google_lb SLI Error Ratio","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"percentunit","label":"Error %","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"datasource":"$PROMETHEUS_DS","description":"","fieldConfig":{"defaults":{"decimals":0,"displayName":"Status","mappings":[{"id":0,"options":{"0":{"color":"black","index":0,"text":"Healthy"},"1":{"color":"orange","index":1,"text":"Warning: 1h deteriorating"},"10":{"color":"orange","index":10,"text":"Warning: 6h recovering, 1h recovering"},"11":{"color":"red","index":11,"text":"Degraded: 6h recovering, 1h degraded"},"12":{"color":"red","index":12,"text":"Degraded: 6h degraded"},"13":{"color":"red","index":13,"text":"Degraded: 6h degraded, 1h deteriorating"},"14":{"color":"red","index":14,"text":"Degraded: 6h degraded, 1h recovering"},"15":{"color":"red","index":15,"text":"Degraded: 6h degraded, 1h degraded"},"2":{"color":"orange","index":2,"text":"Warning: 1h recovering"},"3":{"color":"red","index":3,"text":"Degraded: 1h degraded"},"4":{"color":"orange","index":4,"text":"Warning: 6h deteriorating"},"5":{"color":"orange","index":5,"text":"Warning: 6h deteriorating, 1h deteriorating"},"6":{"color":"orange","index":6,"text":"Warning: 6h deteriorating, 1h recovering"},"7":{"color":"red","index":7,"text":"Degraded: 6h deteriorating, 1h degraded"},"8":{"color":"orange","index":8,"text":"Warning: 6h recovering"},"9":{"color":"orange","index":9,"text":"Warning: 6h recovering, 1h deteriorating"}},"type":"value"}],"thresholds":{"mode":"absolute","steps":[{"color":"black","value":0},{"color":"orange","value":1},{"color":"orange","value":2},{"color":"red","value":3},{"color":"orange","value":4},{"color":"orange","value":5},{"color":"orange","value":6},{"color":"red","value":7},{"color":"orange","value":8},{"color":"orange","value":9},{"color":"orange","value":10},{"color":"red","value":11},{"color":"red","value":12},{"color":"red","value":13},{"color":"red","value":14},{"color":"red","value":15}]},"unit":"none"}},"gridPos":{"h":1,"w":8,"x":0,"y":78},"id":31,"options":{"colorMode":"background","graphMode":"none","justifyMode":"auto","orientation":"vertical","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"7","targets":[{"expr":"sum(\n  label_replace(\n    vector(0) and on() (gitlab_component_errors:ratio_1h{component=\"vault_google_lb\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"}),\n    \"period\", \"na\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(1) and on () (gitlab_component_errors:ratio_5m{component=\"vault_google_lb\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"} > on(tier, type, __tenant_id__) group_left() (14.4 * slo:max:events:gitlab_service_errors:ratio{component=\"vault_google_lb\",monitor=\"global\",type=\"vault\"})),\n    \"period\", \"5m\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(2) and on () (gitlab_component_errors:ratio_1h{component=\"vault_google_lb\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"} > on(tier, type, __tenant_id__) group_left() (14.4 * slo:max:events:gitlab_service_errors:ratio{component=\"vault_google_lb\",monitor=\"global\",type=\"vault\"})),\n    \"period\", \"1h\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(4) and on () (gitlab_component_errors:ratio_30m{component=\"vault_google_lb\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"} > on(tier, type, __tenant_id__) group_left() (6 * slo:max:events:gitlab_service_errors:ratio{component=\"vault_google_lb\",monitor=\"global\",type=\"vault\"})),\n    \"period\", \"30m\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(8) and on () (gitlab_component_errors:ratio_6h{component=\"vault_google_lb\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"} > on(tier, type, __tenant_id__) group_left() (6 * slo:max:events:gitlab_service_errors:ratio{component=\"vault_google_lb\",monitor=\"global\",type=\"vault\"})),\n    \"period\", \"6h\", \"\", \"\"\n  )\n)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":1,"legendFormat":"vault_google_lb SLI | Errors","refId":"A"}],"title":"","transparent":false,"type":"stat"},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"The operation rate is the sum total of all requests being handle for all components within this service. Note that a single user request can lead to requests to multiple components. Higher is busier.","fill":0,"fillGradient":0,"gridPos":{"h":8,"w":8,"x":8,"y":71},"id":1421919235,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/.*shard (apdex|error ratio|RPS)$/","color":"#E7D551"},{"alias":"vault_google_lb RPS","color":"#E7D551","zindex":3},{"alias":"last week","color":"#dddddd80","dashLength":4,"dashes":true,"fill":0,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":2,"zindex":-3}],"spaceLength":10,"stableId":"sli-vault_google_lb-ops-rate","stack":false,"steppedLine":false,"targets":[{"expr":"avg_over_time(gitlab_component_ops:rate_5m{component=\"vault_google_lb\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"}[$__interval])\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"vault_google_lb RPS","refId":"A"},{"expr":"gitlab_component_ops:rate_5m{component=\"vault_google_lb\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"vault\"} offset 1w\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"last week","refId":"B"}],"title":"vault_google_lb SLI RPS - Requests per Second","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Operations per Second","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"content":"### Observability Tools\n\n* [Google Load Balancer](https://console.cloud.google.com/net-services/loadbalancing/details/http/k8s2-um-4zodnh0s-vault-vault-g7tjn6qu?project=gitlab-ops)\n* [Stackdriver Logs: Loadbalancer Access Logs](https://console.cloud.google.com/logs/query;query=resource%2Elabels%2Eurl%5Fmap%5Fname%3D%22k8s2%2Dum%2D4zodnh0s%2Dvault%2Dvault%2Dg7tjn6qu%22%0Aresource%2Etype%3D%22http%5Fload%5Fbalancer%22;timeRange=PT30M?project=gitlab-ops)\n* [Stackdriver Logs: Loadbalancer Access 5xx Logs](https://console.cloud.google.com/logs/query;query=httpRequest%2Estatus%3E%3D500%0Aresource%2Elabels%2Eurl%5Fmap%5Fname%3D%22k8s2%2Dum%2D4zodnh0s%2Dvault%2Dvault%2Dg7tjn6qu%22%0Aresource%2Etype%3D%22http%5Fload%5Fbalancer%22;timeRange=PT30M?project=gitlab-ops)\n\n","gridPos":{"h":8,"w":8,"x":16,"y":71},"id":33,"mode":"markdown","title":"Details","type":"text"},{"collapse":true,"collapsed":true,"gridPos":{"h":10,"w":24,"x":0,"y":200},"id":34,"panels":[{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":8,"x":0,"y":0},"id":35,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"histogram_quantile(\n  0.950000,\n  sum by (le) (\n    sli_aggregations:istio_request_duration_milliseconds_bucket:rate_5m{destination_workload=\"vault\",env=\"$environment\",environment=\"$environment\",source_workload=\"istio-internal-gateway\"}\n  )\n)\n > 0","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"p95 overall","refId":"A"}],"thresholds":[{"colorMode":"custom","fill":true,"fillColor":"rgba(242, 73, 92, 0.25)","line":false,"op":"gt","value":1000,"yaxis":"left"}],"title":"Estimated p95 istio_internal_ingress Latency - Overall","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"s","label":"Duration","logBase":10,"min":0.01,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":8,"x":8,"y":0},"id":36,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by () (\n  sli_aggregations:istio_requests_total:rate_5m{destination_workload=\"vault\",env=\"$environment\",environment=\"$environment\",response_code=~\"^5.*\",source_workload=\"istio-internal-gateway\"}\n)\n > 0","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"overall","refId":"A"}],"title":"istio_internal_ingress Errors - Overall","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Errors","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":8,"x":16,"y":0},"id":37,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by () (\n  sli_aggregations:istio_requests_total:rate_5m{destination_workload=\"vault\",env=\"$environment\",environment=\"$environment\",source_workload=\"istio-internal-gateway\"}\n)\n > 0","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"overall","refId":"A"}],"title":"istio_internal_ingress RPS - Overall","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Requests per Second","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":6,"x":0,"y":10},"id":38,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"histogram_quantile(\n  0.950000,\n  sum by (destination_service,le) (\n    sli_aggregations:istio_request_duration_milliseconds_bucket:rate_5m{destination_service!=\"\",destination_workload=\"vault\",env=\"$environment\",environment=\"$environment\",source_workload=\"istio-internal-gateway\"}\n  )\n)\n > 0","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"p95 {{destination_service}}","refId":"A"}],"thresholds":[{"colorMode":"custom","fill":true,"fillColor":"rgba(242, 73, 92, 0.25)","line":false,"op":"gt","value":1000,"yaxis":"left"}],"title":"Estimated p95 istio_internal_ingress Latency - per destination_service","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"s","label":"Duration","logBase":10,"min":0.01,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Attributes apdex downscoring","fill":4,"fillGradient":0,"gridPos":{"h":10,"w":6,"x":6,"y":10},"id":39,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/.*/","transform":"negative-Y"}],"spaceLength":10,"stack":true,"steppedLine":false,"targets":[{"expr":"clamp_min(clamp_max((\n  (\n    sum by (destination_service) (\n  sli_aggregations:istio_request_duration_milliseconds_bucket:rate_5m{destination_service!=\"\",destination_workload=\"vault\",env=\"$environment\",environment=\"$environment\",le=\"+Inf\",source_workload=\"istio-internal-gateway\"}\n)\n\n    -\n    (\n      sum by (destination_service) (\n  sli_aggregations:istio_request_duration_milliseconds_bucket:rate_5m{destination_service!=\"\",destination_workload=\"vault\",env=\"$environment\",environment=\"$environment\",le=\"1000\",source_workload=\"istio-internal-gateway\"}\n)\n\n    )\n  )\n  / ignoring(destination_service) group_left()\n  (\n    sum by () (\n  sli_aggregations:istio_request_duration_milliseconds_bucket:rate_5m{destination_service!=\"\",destination_workload=\"vault\",env=\"$environment\",environment=\"$environment\",le=\"+Inf\",source_workload=\"istio-internal-gateway\"}\n)\n\n  )\n) > 0\n,1),0)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{destination_service}}","refId":"A"}],"title":"Apdex attribution for istio_internal_ingress Latency - per destination_service","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"percentunit","label":"Percent","logBase":1,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":6,"x":12,"y":10},"id":40,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by (destination_service) (\n  sli_aggregations:istio_requests_total:rate_5m{destination_service!=\"\",destination_workload=\"vault\",env=\"$environment\",environment=\"$environment\",response_code=~\"^5.*\",source_workload=\"istio-internal-gateway\"}\n)\n > 0","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{destination_service}}","refId":"A"}],"title":"istio_internal_ingress Errors - per destination_service","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Errors","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":6,"x":18,"y":10},"id":41,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by (destination_service) (\n  sli_aggregations:istio_requests_total:rate_5m{destination_service!=\"\",destination_workload=\"vault\",env=\"$environment\",environment=\"$environment\",source_workload=\"istio-internal-gateway\"}\n)\n > 0","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{destination_service}}","refId":"A"}],"title":"istio_internal_ingress RPS - per destination_service","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Requests per Second","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":6,"x":0,"y":20},"id":42,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"histogram_quantile(\n  0.950000,\n  sum by (le,response_code) (\n    sli_aggregations:istio_request_duration_milliseconds_bucket:rate_5m{destination_workload=\"vault\",env=\"$environment\",environment=\"$environment\",response_code!=\"\",source_workload=\"istio-internal-gateway\"}\n  )\n)\n > 0","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"p95 {{response_code}}","refId":"A"}],"thresholds":[{"colorMode":"custom","fill":true,"fillColor":"rgba(242, 73, 92, 0.25)","line":false,"op":"gt","value":1000,"yaxis":"left"}],"title":"Estimated p95 istio_internal_ingress Latency - per response_code","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"s","label":"Duration","logBase":10,"min":0.01,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Attributes apdex downscoring","fill":4,"fillGradient":0,"gridPos":{"h":10,"w":6,"x":6,"y":20},"id":43,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/.*/","transform":"negative-Y"}],"spaceLength":10,"stack":true,"steppedLine":false,"targets":[{"expr":"clamp_min(clamp_max((\n  (\n    sum by (response_code) (\n  sli_aggregations:istio_request_duration_milliseconds_bucket:rate_5m{destination_workload=\"vault\",env=\"$environment\",environment=\"$environment\",le=\"+Inf\",response_code!=\"\",source_workload=\"istio-internal-gateway\"}\n)\n\n    -\n    (\n      sum by (response_code) (\n  sli_aggregations:istio_request_duration_milliseconds_bucket:rate_5m{destination_workload=\"vault\",env=\"$environment\",environment=\"$environment\",le=\"1000\",response_code!=\"\",source_workload=\"istio-internal-gateway\"}\n)\n\n    )\n  )\n  / ignoring(response_code) group_left()\n  (\n    sum by () (\n  sli_aggregations:istio_request_duration_milliseconds_bucket:rate_5m{destination_workload=\"vault\",env=\"$environment\",environment=\"$environment\",le=\"+Inf\",response_code!=\"\",source_workload=\"istio-internal-gateway\"}\n)\n\n  )\n) > 0\n,1),0)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{response_code}}","refId":"A"}],"title":"Apdex attribution for istio_internal_ingress Latency - per response_code","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"percentunit","label":"Percent","logBase":1,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":6,"x":12,"y":20},"id":44,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by (response_code) (\n  sli_aggregations:istio_requests_total:rate_5m{destination_workload=\"vault\",env=\"$environment\",environment=\"$environment\",response_code!=\"\",source_workload=\"istio-internal-gateway\"}\n)\n > 0","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{response_code}}","refId":"A"}],"title":"istio_internal_ingress Errors - per response_code","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Errors","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":6,"x":18,"y":20},"id":45,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by (response_code) (\n  sli_aggregations:istio_requests_total:rate_5m{destination_workload=\"vault\",env=\"$environment\",environment=\"$environment\",response_code!=\"\",source_workload=\"istio-internal-gateway\"}\n)\n > 0","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{response_code}}","refId":"A"}],"title":"istio_internal_ingress RPS - per response_code","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Requests per Second","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"üî¨ SLI Detail: istio_internal_ingress","titleSize":"h6","type":"row"},{"collapse":true,"collapsed":true,"gridPos":{"h":10,"w":24,"x":0,"y":210},"id":46,"panels":[{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":8,"x":0,"y":0},"id":47,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"histogram_quantile(\n  0.950000,\n  sum by (le) (\n    sli_aggregations:istio_request_duration_milliseconds_bucket:rate_5m{destination_workload=\"vault\",env=\"$environment\",environment=\"$environment\",source_workload=\"istio-gateway\"}\n  )\n)\n > 0","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"p95 overall","refId":"A"}],"thresholds":[{"colorMode":"custom","fill":true,"fillColor":"rgba(242, 73, 92, 0.25)","line":false,"op":"gt","value":1000,"yaxis":"left"}],"title":"Estimated p95 istio_public_ingress Latency - Overall","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"s","label":"Duration","logBase":10,"min":0.01,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":8,"x":8,"y":0},"id":48,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by () (\n  sli_aggregations:istio_requests_total:rate_5m{destination_workload=\"vault\",env=\"$environment\",environment=\"$environment\",response_code=~\"^5.*\",source_workload=\"istio-gateway\"}\n)\n > 0","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"overall","refId":"A"}],"title":"istio_public_ingress Errors - Overall","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Errors","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":8,"x":16,"y":0},"id":49,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by () (\n  sli_aggregations:istio_requests_total:rate_5m{destination_workload=\"vault\",env=\"$environment\",environment=\"$environment\",source_workload=\"istio-gateway\"}\n)\n > 0","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"overall","refId":"A"}],"title":"istio_public_ingress RPS - Overall","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Requests per Second","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":6,"x":0,"y":10},"id":50,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"histogram_quantile(\n  0.950000,\n  sum by (destination_service,le) (\n    sli_aggregations:istio_request_duration_milliseconds_bucket:rate_5m{destination_service!=\"\",destination_workload=\"vault\",env=\"$environment\",environment=\"$environment\",source_workload=\"istio-gateway\"}\n  )\n)\n > 0","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"p95 {{destination_service}}","refId":"A"}],"thresholds":[{"colorMode":"custom","fill":true,"fillColor":"rgba(242, 73, 92, 0.25)","line":false,"op":"gt","value":1000,"yaxis":"left"}],"title":"Estimated p95 istio_public_ingress Latency - per destination_service","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"s","label":"Duration","logBase":10,"min":0.01,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Attributes apdex downscoring","fill":4,"fillGradient":0,"gridPos":{"h":10,"w":6,"x":6,"y":10},"id":51,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/.*/","transform":"negative-Y"}],"spaceLength":10,"stack":true,"steppedLine":false,"targets":[{"expr":"clamp_min(clamp_max((\n  (\n    sum by (destination_service) (\n  sli_aggregations:istio_request_duration_milliseconds_bucket:rate_5m{destination_service!=\"\",destination_workload=\"vault\",env=\"$environment\",environment=\"$environment\",le=\"+Inf\",source_workload=\"istio-gateway\"}\n)\n\n    -\n    (\n      sum by (destination_service) (\n  sli_aggregations:istio_request_duration_milliseconds_bucket:rate_5m{destination_service!=\"\",destination_workload=\"vault\",env=\"$environment\",environment=\"$environment\",le=\"1000\",source_workload=\"istio-gateway\"}\n)\n\n    )\n  )\n  / ignoring(destination_service) group_left()\n  (\n    sum by () (\n  sli_aggregations:istio_request_duration_milliseconds_bucket:rate_5m{destination_service!=\"\",destination_workload=\"vault\",env=\"$environment\",environment=\"$environment\",le=\"+Inf\",source_workload=\"istio-gateway\"}\n)\n\n  )\n) > 0\n,1),0)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{destination_service}}","refId":"A"}],"title":"Apdex attribution for istio_public_ingress Latency - per destination_service","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"percentunit","label":"Percent","logBase":1,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":6,"x":12,"y":10},"id":52,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by (destination_service) (\n  sli_aggregations:istio_requests_total:rate_5m{destination_service!=\"\",destination_workload=\"vault\",env=\"$environment\",environment=\"$environment\",response_code=~\"^5.*\",source_workload=\"istio-gateway\"}\n)\n > 0","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{destination_service}}","refId":"A"}],"title":"istio_public_ingress Errors - per destination_service","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Errors","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":6,"x":18,"y":10},"id":53,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by (destination_service) (\n  sli_aggregations:istio_requests_total:rate_5m{destination_service!=\"\",destination_workload=\"vault\",env=\"$environment\",environment=\"$environment\",source_workload=\"istio-gateway\"}\n)\n > 0","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{destination_service}}","refId":"A"}],"title":"istio_public_ingress RPS - per destination_service","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Requests per Second","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":6,"x":0,"y":20},"id":54,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"histogram_quantile(\n  0.950000,\n  sum by (le,response_code) (\n    sli_aggregations:istio_request_duration_milliseconds_bucket:rate_5m{destination_workload=\"vault\",env=\"$environment\",environment=\"$environment\",response_code!=\"\",source_workload=\"istio-gateway\"}\n  )\n)\n > 0","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"p95 {{response_code}}","refId":"A"}],"thresholds":[{"colorMode":"custom","fill":true,"fillColor":"rgba(242, 73, 92, 0.25)","line":false,"op":"gt","value":1000,"yaxis":"left"}],"title":"Estimated p95 istio_public_ingress Latency - per response_code","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"s","label":"Duration","logBase":10,"min":0.01,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Attributes apdex downscoring","fill":4,"fillGradient":0,"gridPos":{"h":10,"w":6,"x":6,"y":20},"id":55,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/.*/","transform":"negative-Y"}],"spaceLength":10,"stack":true,"steppedLine":false,"targets":[{"expr":"clamp_min(clamp_max((\n  (\n    sum by (response_code) (\n  sli_aggregations:istio_request_duration_milliseconds_bucket:rate_5m{destination_workload=\"vault\",env=\"$environment\",environment=\"$environment\",le=\"+Inf\",response_code!=\"\",source_workload=\"istio-gateway\"}\n)\n\n    -\n    (\n      sum by (response_code) (\n  sli_aggregations:istio_request_duration_milliseconds_bucket:rate_5m{destination_workload=\"vault\",env=\"$environment\",environment=\"$environment\",le=\"1000\",response_code!=\"\",source_workload=\"istio-gateway\"}\n)\n\n    )\n  )\n  / ignoring(response_code) group_left()\n  (\n    sum by () (\n  sli_aggregations:istio_request_duration_milliseconds_bucket:rate_5m{destination_workload=\"vault\",env=\"$environment\",environment=\"$environment\",le=\"+Inf\",response_code!=\"\",source_workload=\"istio-gateway\"}\n)\n\n  )\n) > 0\n,1),0)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{response_code}}","refId":"A"}],"title":"Apdex attribution for istio_public_ingress Latency - per response_code","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"percentunit","label":"Percent","logBase":1,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":6,"x":12,"y":20},"id":56,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by (response_code) (\n  sli_aggregations:istio_requests_total:rate_5m{destination_workload=\"vault\",env=\"$environment\",environment=\"$environment\",response_code!=\"\",source_workload=\"istio-gateway\"}\n)\n > 0","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{response_code}}","refId":"A"}],"title":"istio_public_ingress Errors - per response_code","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Errors","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":6,"x":18,"y":20},"id":57,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by (response_code) (\n  sli_aggregations:istio_requests_total:rate_5m{destination_workload=\"vault\",env=\"$environment\",environment=\"$environment\",response_code!=\"\",source_workload=\"istio-gateway\"}\n)\n > 0","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{response_code}}","refId":"A"}],"title":"istio_public_ingress RPS - per response_code","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Requests per Second","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"üî¨ SLI Detail: istio_public_ingress","titleSize":"h6","type":"row"},{"collapse":true,"collapsed":true,"gridPos":{"h":10,"w":24,"x":0,"y":220},"id":58,"panels":[{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":24,"x":0,"y":0},"id":59,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by () (\n  sli_aggregations:vault_core_handle_request_count:rate_5m{env=\"$environment\",environment=\"$environment\",job=\"vault-active\"}\n)\n > 0","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"overall","refId":"A"}],"title":"vault RPS - Overall","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Requests per Second","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":24,"x":0,"y":10},"id":60,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by (pod) (\n  sli_aggregations:vault_core_handle_request_count:rate_5m{env=\"$environment\",environment=\"$environment\",job=\"vault-active\",pod!=\"\"}\n)\n > 0","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{pod}}","refId":"A"}],"title":"vault RPS - per pod","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Requests per Second","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"üî¨ SLI Detail: vault","titleSize":"h6","type":"row"},{"collapse":true,"collapsed":true,"gridPos":{"h":10,"w":24,"x":0,"y":230},"id":61,"panels":[{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":12,"x":0,"y":0},"id":62,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by () (\n  sli_aggregations:vault_audit_log_request_failure:rate_5m{env=\"$environment\",environment=\"$environment\",job=\"vault-active\"}\n)\n > 0","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"overall","refId":"A"}],"title":"vault_audit_log_request Errors - Overall","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Errors","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":12,"x":12,"y":0},"id":63,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by () (\n  sli_aggregations:vault_audit_log_request_count:rate_5m{env=\"$environment\",environment=\"$environment\",job=\"vault-active\"}\n)\n > 0","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"overall","refId":"A"}],"title":"vault_audit_log_request RPS - Overall","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Requests per Second","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":12,"x":0,"y":10},"id":64,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by (pod) (\n  sli_aggregations:vault_audit_log_request_failure:rate_5m{env=\"$environment\",environment=\"$environment\",job=\"vault-active\",pod!=\"\"}\n)\n > 0","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{pod}}","refId":"A"}],"title":"vault_audit_log_request Errors - per pod","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Errors","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":12,"x":12,"y":10},"id":65,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by (pod) (\n  sli_aggregations:vault_audit_log_request_count:rate_5m{env=\"$environment\",environment=\"$environment\",job=\"vault-active\",pod!=\"\"}\n)\n > 0","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{pod}}","refId":"A"}],"title":"vault_audit_log_request RPS - per pod","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Requests per Second","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"üî¨ SLI Detail: vault_audit_log_request","titleSize":"h6","type":"row"},{"collapse":true,"collapsed":true,"gridPos":{"h":10,"w":24,"x":0,"y":240},"id":66,"panels":[{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":12,"x":0,"y":0},"id":67,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by () (\n  sli_aggregations:vault_audit_log_response_failure:rate_5m{env=\"$environment\",environment=\"$environment\",job=\"vault-active\"}\n)\n > 0","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"overall","refId":"A"}],"title":"vault_audit_log_response Errors - Overall","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Errors","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":12,"x":12,"y":0},"id":68,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by () (\n  sli_aggregations:vault_audit_log_response_count:rate_5m{env=\"$environment\",environment=\"$environment\",job=\"vault-active\"}\n)\n > 0","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"overall","refId":"A"}],"title":"vault_audit_log_response RPS - Overall","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Requests per Second","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":12,"x":0,"y":10},"id":69,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by (pod) (\n  sli_aggregations:vault_audit_log_response_failure:rate_5m{env=\"$environment\",environment=\"$environment\",job=\"vault-active\",pod!=\"\"}\n)\n > 0","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{pod}}","refId":"A"}],"title":"vault_audit_log_response Errors - per pod","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Errors","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":12,"x":12,"y":10},"id":70,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by (pod) (\n  sli_aggregations:vault_audit_log_response_count:rate_5m{env=\"$environment\",environment=\"$environment\",job=\"vault-active\",pod!=\"\"}\n)\n > 0","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{pod}}","refId":"A"}],"title":"vault_audit_log_response RPS - per pod","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Requests per Second","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"üî¨ SLI Detail: vault_audit_log_response","titleSize":"h6","type":"row"},{"collapse":true,"collapsed":true,"gridPos":{"h":10,"w":24,"x":0,"y":250},"id":71,"panels":[{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":12,"x":0,"y":0},"id":72,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by () (\n  sli_aggregations:stackdriver_https_lb_rule_loadbalancing_googleapis_com_https_request_count:rate_5m{env=\"$environment\",environment=\"$environment\",project_id=\"gitlab-ops\",response_code_class=\"500\",url_map_name=\"k8s2-um-4zodnh0s-vault-vault-g7tjn6qu\"}\n)\n > 0","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"overall","refId":"A"}],"title":"vault_google_lb Errors - Overall","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Errors","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":12,"x":12,"y":0},"id":73,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by () (\n  sli_aggregations:stackdriver_https_lb_rule_loadbalancing_googleapis_com_https_request_count:rate_5m{env=\"$environment\",environment=\"$environment\",project_id=\"gitlab-ops\",url_map_name=\"k8s2-um-4zodnh0s-vault-vault-g7tjn6qu\"}\n)\n > 0","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"overall","refId":"A"}],"title":"vault_google_lb RPS - Overall","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Requests per Second","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":12,"x":0,"y":10},"id":74,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by (proxy_continent) (\n  sli_aggregations:stackdriver_https_lb_rule_loadbalancing_googleapis_com_https_request_count:rate_5m{env=\"$environment\",environment=\"$environment\",project_id=\"gitlab-ops\",proxy_continent!=\"\",response_code_class=\"500\",url_map_name=\"k8s2-um-4zodnh0s-vault-vault-g7tjn6qu\"}\n)\n > 0","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{proxy_continent}}","refId":"A"}],"title":"vault_google_lb Errors - per proxy_continent","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Errors","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":12,"x":12,"y":10},"id":75,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by (proxy_continent) (\n  sli_aggregations:stackdriver_https_lb_rule_loadbalancing_googleapis_com_https_request_count:rate_5m{env=\"$environment\",environment=\"$environment\",project_id=\"gitlab-ops\",proxy_continent!=\"\",url_map_name=\"k8s2-um-4zodnh0s-vault-vault-g7tjn6qu\"}\n)\n > 0","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{proxy_continent}}","refId":"A"}],"title":"vault_google_lb RPS - per proxy_continent","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Requests per Second","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":12,"x":0,"y":20},"id":76,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by (response_code) (\n  sli_aggregations:stackdriver_https_lb_rule_loadbalancing_googleapis_com_https_request_count:rate_5m{env=\"$environment\",environment=\"$environment\",project_id=\"gitlab-ops\",response_code!=\"\",response_code_class=\"500\",url_map_name=\"k8s2-um-4zodnh0s-vault-vault-g7tjn6qu\"}\n)\n > 0","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{response_code}}","refId":"A"}],"title":"vault_google_lb Errors - per response_code","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Errors","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":12,"x":12,"y":20},"id":77,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by (response_code) (\n  sli_aggregations:stackdriver_https_lb_rule_loadbalancing_googleapis_com_https_request_count:rate_5m{env=\"$environment\",environment=\"$environment\",project_id=\"gitlab-ops\",response_code!=\"\",url_map_name=\"k8s2-um-4zodnh0s-vault-vault-g7tjn6qu\"}\n)\n > 0","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{response_code}}","refId":"A"}],"title":"vault_google_lb RPS - per response_code","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Requests per Second","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"üî¨ SLI Detail: vault_google_lb","titleSize":"h6","type":"row"},{"collapse":true,"collapsed":true,"gridPos":{"h":1,"w":24,"x":0,"y":400},"id":78,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"","fill":0,"fillGradient":0,"gridPos":{"h":8,"w":8,"x":0,"y":1},"id":79,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":1,"links":[{"title":"‚ò∏Ô∏è vault Kubernetes Deployment Detail","url":"/d/vault-kube-deployments?${__url_time_range}&${__all_variables}"},{"title":"‚ò∏Ô∏è vault Kubernetes Container Detail","url":"/d/vault-kube-containers?${__url_time_range}&${__all_variables}"}],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by(cluster) (\n  rate(\n    container_cpu_usage_seconds_total:labeled{\n      container!=\"\",container!=\"POD\",deployment=\"vault\",env=\"$environment\",environment=\"$environment\",type=\"vault\"\n    }[$__rate_interval]\n  )\n)\n","format":"time_series","interval":"1m","intervalFactor":2,"legendFormat":"{{ cluster }}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"vault Deployment: CPU","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"","fill":0,"fillGradient":0,"gridPos":{"h":8,"w":8,"x":8,"y":1},"id":80,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":1,"links":[{"title":"‚ò∏Ô∏è vault Kubernetes Deployment Detail","url":"/d/vault-kube-deployments?${__url_time_range}&${__all_variables}"},{"title":"‚ò∏Ô∏è vault Kubernetes Container Detail","url":"/d/vault-kube-containers?${__url_time_range}&${__all_variables}"}],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by(cluster) (\n  container_memory_working_set_bytes:labeled{\n    container!=\"\",container!=\"POD\",deployment=\"vault\",env=\"$environment\",environment=\"$environment\",type=\"vault\"\n  }\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{ cluster }}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"vault Deployment: Memory","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"bytes","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Network utilization","fill":0,"fillGradient":0,"gridPos":{"h":8,"w":8,"x":16,"y":1},"id":81,"legend":{"alignAsTable":false,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":false},"lines":true,"linewidth":1,"links":[{"title":"‚ò∏Ô∏è vault Kubernetes Deployment Detail","url":"/d/vault-kube-deployments?${__url_time_range}&${__all_variables}"},{"title":"‚ò∏Ô∏è vault Kubernetes Container Detail","url":"/d/vault-kube-containers?${__url_time_range}&${__all_variables}"}],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[{"alias":"/receive .*/","transform":"negative-Y"}],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by(cluster) (\n  rate(\n    container_network_transmit_bytes_total:labeled{\n      deployment=\"vault\",env=\"$environment\",environment=\"$environment\",type=\"vault\"\n    }[$__rate_interval]\n  )\n)\n","format":"time_series","interval":"1m","intervalFactor":2,"legendFormat":"send {{ cluster }}","refId":"A"},{"expr":"sum by(cluster) (\n  rate(\n    container_network_receive_bytes_total:labeled{\n      deployment=\"vault\",env=\"$environment\",environment=\"$environment\",type=\"vault\"\n    }[$__rate_interval]\n  )\n)\n","format":"time_series","interval":"1m","intervalFactor":2,"legendFormat":"receive {{ cluster }}","refId":"B"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"vault Deployment: Network IO","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"Bps","label":"Network utilization","logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"Ratio of requested CPU resources from allocatable resources.\nIdeally we have requests utilization close to 100%. Values are\nbelow 100% typically because pods do not fit well on nodes or\nbecause we might be bound by memory requests already.\n","fill":0,"fillGradient":0,"gridPos":{"h":8,"w":12,"x":0,"y":9},"id":82,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by (node) (\n  kube_pod_container_resource_requests{resource=\"cpu\", unit=\"core\"}\n)\n/ on (node) group_left()\nkube_node_status_allocatable:labeled{env=\"$environment\",environment=\"$environment\",type=\"vault\",resource=\"cpu\"}\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{ node }}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Node CPU Requests Utilization","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"Ratio of requested Memory resources from allocatable resources.\nIdeally we have requests utilization close to 100%. Values are\nbelow 100% typically because pods do not fit well on nodes or\nbecause we might be bound by CPU requests already.\n","fill":0,"fillGradient":0,"gridPos":{"h":8,"w":12,"x":12,"y":9},"id":83,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by (node) (\n  kube_pod_container_resource_requests{resource=\"memory\", unit=\"byte\"}\n)\n/ on (node) group_left()\nkube_node_status_allocatable:labeled{env=\"$environment\",environment=\"$environment\",type=\"vault\",resource=\"memory\"}\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{ node }}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Node Memory Requests Utilization","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"‚ò∏Ô∏è Kubernetes Overview","titleSize":"h6","type":"row"},{"collapse":true,"collapsed":true,"gridPos":{"h":1,"w":24,"x":0,"y":500},"id":84,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Kubernetes containers are allocated a share of CPU. Configured using resource requests.\n\nThis is the amount of CPU that a container should always have available,\nthough it can briefly utilize more. However, if a lot of pods on the same\nhost exceed their requested CPU the container could be throttled earlier.\n\nThis monitors utilization/allocated requests over a 1 hour period, and takes\nthe 99th quantile of that utilization percentage in that period.\nWe want the worst case to be around 80%-90% utilization,\nmeaning we've sized the container correctly. If utilization is much higher than that\nthe container could already be throttled because the host is overused, if it\nis much lower, then we could be underutilizing a host.\n\nThis saturation point is only used for capacity planning.\nContainers that have a quota specified are excluded here and can be monitored using\nthe `kube_container_throttling` saturation component.\nThe burst utilization of a CPU is monitored and alerted upon using the\n`kube_container_cpu_limit` saturation point.\n Lower is better.","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":12,"x":0,"y":0},"id":2713861591,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"sort":"max","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[{"alias":"/^Soft SLO/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^Hard SLO/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/aggregated /","color":"#E7D551","linewidth":2,"zindex":3},{"alias":"/^95th quantile for week/","color":"#37872D","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^99th quantile for week/","color":"#56A64B","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":4,"zindex":-2}],"spaceLength":10,"stableId":"saturation-kube_container_cpu","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_min(\n  clamp_max(\n    quantile by(environment, tier, type, stage, shard, pod, container) (\n  0.99,\n  clamp_min(\n    clamp_max(\n      (\n        sum by (environment, tier, type, stage, shard, pod, container) (\n          rate(container_cpu_usage_seconds_total:labeled{container!=\"\", container!=\"POD\", env=\"$environment\",environment=\"$environment\",type=\"vault\"}[1h])\n        )\n        unless on(environment, tier, type, stage, shard, pod, container) (\n          last_over_time(container_spec_cpu_quota:labeled{container!=\"\", container!=\"POD\", env=\"$environment\",environment=\"$environment\",type=\"vault\"}[1h])\n        )\n      )\n      /\n      sum by(environment, tier, type, stage, shard, pod, container) (\n        kube_pod_container_resource_requests:labeled{container!=\"\", container!=\"POD\", resource=\"cpu\", env=\"$environment\",environment=\"$environment\",type=\"vault\"}\n      )\n      ,\n      1)\n  ,\n  0)\n)\n\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{ pod }} {{ container }}","refId":"A"},{"expr":"clamp_min(\n  clamp_max(\n    max(\n      max_over_time(gitlab_component_saturation:ratio{env=\"$environment\",environment=\"$environment\",type=\"vault\", component=\"kube_container_cpu\"}[$__interval])\n    ) by (component)\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"aggregated {{ component }}","refId":"B"},{"expr":"max(\n  gitlab_component_saturation:ratio_quantile95_1w{env=\"$environment\",environment=\"$environment\",type=\"vault\", component=\"kube_container_cpu\"}\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"95th quantile for week {{ component }}","refId":"C"},{"expr":"max(\n  gitlab_component_saturation:ratio_quantile99_1w{env=\"$environment\",environment=\"$environment\",type=\"vault\", component=\"kube_container_cpu\"}\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"99th quantile for week {{ component }}","refId":"D"},{"expr":"avg(slo:max:soft:gitlab_component_saturation:ratio{component=\"kube_container_cpu\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"Soft SLO: {{ component }}","refId":"E"},{"expr":"avg(slo:max:hard:gitlab_component_saturation:ratio{component=\"kube_container_cpu\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"Hard SLO: {{ component }}","refId":"F"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"kube_container_cpu component saturation: Kube Container CPU Utilization","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"Saturation %","logBase":1,"max":1,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Kubernetes containers can have a limit configured on how much CPU they can consume in\na burst. If we are at this limit, exceeding the allocated requested resources, we\nshould consider revisting the container's HPA configuration.\n\nWhen a container is utilizing CPU resources up-to it's configured limit for\nextended periods of time, this could cause it and other running containers to be\nthrottled.\n Lower is better.","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":12,"x":12,"y":0},"id":1262336683,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"sort":"max","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[{"alias":"/^Soft SLO/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^Hard SLO/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/aggregated /","color":"#E7D551","linewidth":2,"zindex":3},{"alias":"/^95th quantile for week/","color":"#37872D","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^99th quantile for week/","color":"#56A64B","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":4,"zindex":-2}],"spaceLength":10,"stableId":"saturation-kube_container_cpu_limit","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_min(\n  clamp_max(\n    max by(environment, tier, type, stage, shard, pod, container) (\n  clamp_min(\n    clamp_max(\n      sum by (environment, tier, type, stage, shard, pod, container) (\n        rate(container_cpu_usage_seconds_total:labeled{container!=\"\", container!=\"POD\", env=\"$environment\",environment=\"$environment\",type=\"vault\"}[5m])\n      )\n      /\n      sum by(environment, tier, type, stage, shard, pod, container) (\n        container_spec_cpu_quota:labeled{container!=\"\", container!=\"POD\", env=\"$environment\",environment=\"$environment\",type=\"vault\"}\n        /\n        container_spec_cpu_period:labeled{container!=\"\", container!=\"POD\", env=\"$environment\",environment=\"$environment\",type=\"vault\"}\n      )\n      ,\n      1)\n  ,\n  0)\n)\n\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{ pod }} {{ container }}","refId":"A"},{"expr":"clamp_min(\n  clamp_max(\n    max(\n      max_over_time(gitlab_component_saturation:ratio{env=\"$environment\",environment=\"$environment\",type=\"vault\", component=\"kube_container_cpu_limit\"}[$__interval])\n    ) by (component)\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"aggregated {{ component }}","refId":"B"},{"expr":"max(\n  gitlab_component_saturation:ratio_quantile95_1w{env=\"$environment\",environment=\"$environment\",type=\"vault\", component=\"kube_container_cpu_limit\"}\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"95th quantile for week {{ component }}","refId":"C"},{"expr":"max(\n  gitlab_component_saturation:ratio_quantile99_1w{env=\"$environment\",environment=\"$environment\",type=\"vault\", component=\"kube_container_cpu_limit\"}\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"99th quantile for week {{ component }}","refId":"D"},{"expr":"avg(slo:max:soft:gitlab_component_saturation:ratio{component=\"kube_container_cpu_limit\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"Soft SLO: {{ component }}","refId":"E"},{"expr":"avg(slo:max:hard:gitlab_component_saturation:ratio{component=\"kube_container_cpu_limit\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"Hard SLO: {{ component }}","refId":"F"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"kube_container_cpu_limit component saturation: Kube Container CPU over-utilization","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"Saturation %","logBase":1,"max":1,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"This uses the working set size from cAdvisor for the cgroup's memory usage. That may\nnot be a good measure as it includes filesystem cache pages that are not necessarily\nattributable to the application inside the cgroup, and are permitted to be evicted\ninstead of being OOM killed.\n Lower is better.","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":12,"x":0,"y":10},"id":172578411,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"sort":"max","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[{"alias":"/^Soft SLO/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^Hard SLO/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/aggregated /","color":"#E7D551","linewidth":2,"zindex":3},{"alias":"/^95th quantile for week/","color":"#37872D","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^99th quantile for week/","color":"#56A64B","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":4,"zindex":-2}],"spaceLength":10,"stableId":"saturation-kube_container_memory","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_min(\n  clamp_max(\n    max by(environment, tier, type, stage, shard, deployment) (\n  clamp_min(\n    clamp_max(\n      container_memory_working_set_bytes:labeled{container!=\"\", container!=\"POD\", env=\"$environment\",environment=\"$environment\",type=\"vault\"}\n      /\n      (container_spec_memory_limit_bytes:labeled{container!=\"\", container!=\"POD\", env=\"$environment\",environment=\"$environment\",type=\"vault\"} > 0)\n      ,\n      1)\n  ,\n  0)\n)\n\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{ deployment }}","refId":"A"},{"expr":"clamp_min(\n  clamp_max(\n    max(\n      max_over_time(gitlab_component_saturation:ratio{env=\"$environment\",environment=\"$environment\",type=\"vault\", component=\"kube_container_memory\"}[$__interval])\n    ) by (component)\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"aggregated {{ component }}","refId":"B"},{"expr":"max(\n  gitlab_component_saturation:ratio_quantile95_1w{env=\"$environment\",environment=\"$environment\",type=\"vault\", component=\"kube_container_memory\"}\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"95th quantile for week {{ component }}","refId":"C"},{"expr":"max(\n  gitlab_component_saturation:ratio_quantile99_1w{env=\"$environment\",environment=\"$environment\",type=\"vault\", component=\"kube_container_memory\"}\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"99th quantile for week {{ component }}","refId":"D"},{"expr":"avg(slo:max:soft:gitlab_component_saturation:ratio{component=\"kube_container_memory\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"Soft SLO: {{ component }}","refId":"E"},{"expr":"avg(slo:max:hard:gitlab_component_saturation:ratio{component=\"kube_container_memory\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"Hard SLO: {{ component }}","refId":"F"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"kube_container_memory component saturation: Kube Container Memory Utilization","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"Saturation %","logBase":1,"max":1,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Kube container throttling\n\nA container will be throttled if it reaches the configured cpu limit for the\nhorizontal pod autoscaler. Or when other containers on the node are overutilizing\nthe the CPU.\n\nTo get around this, consider increasing the limit for this workload, taking\ninto consideration the requested resources.\n Lower is better.","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":12,"x":12,"y":10},"id":54512634,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"sort":"max","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[{"alias":"/^Soft SLO/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^Hard SLO/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/aggregated /","color":"#E7D551","linewidth":2,"zindex":3},{"alias":"/^95th quantile for week/","color":"#37872D","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^99th quantile for week/","color":"#56A64B","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":4,"zindex":-2}],"spaceLength":10,"stableId":"saturation-kube_container_throttling","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_min(\n  clamp_max(\n    quantile by(environment, tier, type, stage, shard, pod, container) (\n  0.99,\n  clamp_min(\n    clamp_max(\n      avg by (environment, tier, type, stage, shard, pod, container)(\n        rate(container_cpu_cfs_throttled_periods_total:labeled{container!=\"\", env=\"$environment\",environment=\"$environment\",type=\"vault\"}[5m])\n        /\n        rate(container_cpu_cfs_periods_total:labeled{container!=\"\", env=\"$environment\",environment=\"$environment\",type=\"vault\"}[5m])\n      )\n      ,\n      1)\n  ,\n  0)\n)\n\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{ pod }} {{ container }}","refId":"A"},{"expr":"clamp_min(\n  clamp_max(\n    max(\n      max_over_time(gitlab_component_saturation:ratio{env=\"$environment\",environment=\"$environment\",type=\"vault\", component=\"kube_container_throttling\"}[$__interval])\n    ) by (component)\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"aggregated {{ component }}","refId":"B"},{"expr":"max(\n  gitlab_component_saturation:ratio_quantile95_1w{env=\"$environment\",environment=\"$environment\",type=\"vault\", component=\"kube_container_throttling\"}\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"95th quantile for week {{ component }}","refId":"C"},{"expr":"max(\n  gitlab_component_saturation:ratio_quantile99_1w{env=\"$environment\",environment=\"$environment\",type=\"vault\", component=\"kube_container_throttling\"}\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"99th quantile for week {{ component }}","refId":"D"},{"expr":"avg(slo:max:soft:gitlab_component_saturation:ratio{component=\"kube_container_throttling\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"Soft SLO: {{ component }}","refId":"E"},{"expr":"avg(slo:max:hard:gitlab_component_saturation:ratio{component=\"kube_container_throttling\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"Hard SLO: {{ component }}","refId":"F"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"kube_container_throttling component saturation: Kube container throttling","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"Saturation %","logBase":1,"max":1,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Measures Go memory usage as a percentage of container memory limit\n Lower is better.","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":12,"x":0,"y":20},"id":4163523952,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"sort":"max","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[{"alias":"/^Soft SLO/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^Hard SLO/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/aggregated /","color":"#E7D551","linewidth":2,"zindex":3},{"alias":"/^95th quantile for week/","color":"#37872D","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^99th quantile for week/","color":"#56A64B","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":4,"zindex":-2}],"spaceLength":10,"stableId":"saturation-kube_go_memory","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_min(\n  clamp_max(\n    max by(env, environment, tier, type, stage, shard, cluster, pod) (\n  clamp_min(\n    clamp_max(\n      go_memstats_alloc_bytes{env=\"$environment\",environment=\"$environment\",type=\"vault\"}\n      / on(env, environment, tier, type, stage, shard, cluster, pod) group_left()\n      topk by(env, environment, tier, type, stage, shard, cluster, pod) (1,\n        container_spec_memory_limit_bytes:labeled{container=~\"gitlab-pages|gitlab-workhorse|kas|registry|thanos-store\",env=\"$environment\",environment=\"$environment\",type=\"vault\"}\n      )\n      ,\n      1)\n  ,\n  0)\n)\n\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{ cluster }} {{ pod }}","refId":"A"},{"expr":"clamp_min(\n  clamp_max(\n    max(\n      max_over_time(gitlab_component_saturation:ratio{env=\"$environment\",environment=\"$environment\",type=\"vault\", component=\"kube_go_memory\"}[$__interval])\n    ) by (component)\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"aggregated {{ component }}","refId":"B"},{"expr":"max(\n  gitlab_component_saturation:ratio_quantile95_1w{env=\"$environment\",environment=\"$environment\",type=\"vault\", component=\"kube_go_memory\"}\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"95th quantile for week {{ component }}","refId":"C"},{"expr":"max(\n  gitlab_component_saturation:ratio_quantile99_1w{env=\"$environment\",environment=\"$environment\",type=\"vault\", component=\"kube_go_memory\"}\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"99th quantile for week {{ component }}","refId":"D"},{"expr":"avg(slo:max:soft:gitlab_component_saturation:ratio{component=\"kube_go_memory\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"Soft SLO: {{ component }}","refId":"E"},{"expr":"avg(slo:max:hard:gitlab_component_saturation:ratio{component=\"kube_go_memory\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"Hard SLO: {{ component }}","refId":"F"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"kube_go_memory component saturation: Go Memory Utilization per Node","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"Saturation %","logBase":1,"max":1,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"The [Horizontal Pod Autoscaler](https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/)\nautomatically scales the number of Pods in a deployment based on metrics.\n\nThe Horizontal Pod Autoscaler has a configured upper maximum. When this\nlimit is reached, the HPA will not increase the number of pods and other\nresource saturation (eg, CPU, memory) may occur.\n Lower is better.","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":12,"x":12,"y":20},"id":351198712,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"sort":"max","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[{"alias":"/^Soft SLO/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^Hard SLO/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/aggregated /","color":"#E7D551","linewidth":2,"zindex":3},{"alias":"/^95th quantile for week/","color":"#37872D","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^99th quantile for week/","color":"#56A64B","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":4,"zindex":-2}],"spaceLength":10,"stableId":"saturation-kube_horizontalpodautoscaler_desired_replicas","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_min(\n  clamp_max(\n    max by(environment, tier, type, stage, shard, horizontalpodautoscaler, shard) (\n  clamp_min(\n    clamp_max(\n      kube_horizontalpodautoscaler_status_desired_replicas:labeled{env=\"$environment\",environment=\"$environment\",type=\"vault\", shard!~\"ai-abstraction-layer|database-throttled|elasticsearch|gitaly-throttled|urgent-authorized-projects\", namespace!~\"pubsubbeat\"}\n      /\n      kube_horizontalpodautoscaler_spec_max_replicas:labeled{env=\"$environment\",environment=\"$environment\",type=\"vault\", shard!~\"ai-abstraction-layer|database-throttled|elasticsearch|gitaly-throttled|urgent-authorized-projects\", namespace!~\"pubsubbeat\"}\n      ,\n      1)\n  ,\n  0)\n)\n\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{ horizontalpodautoscaler }} {{ shard }}","refId":"A"},{"expr":"clamp_min(\n  clamp_max(\n    max(\n      max_over_time(gitlab_component_saturation:ratio{env=\"$environment\",environment=\"$environment\",type=\"vault\", component=\"kube_horizontalpodautoscaler_desired_replicas\"}[$__interval])\n    ) by (component)\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"aggregated {{ component }}","refId":"B"},{"expr":"max(\n  gitlab_component_saturation:ratio_quantile95_1w{env=\"$environment\",environment=\"$environment\",type=\"vault\", component=\"kube_horizontalpodautoscaler_desired_replicas\"}\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"95th quantile for week {{ component }}","refId":"C"},{"expr":"max(\n  gitlab_component_saturation:ratio_quantile99_1w{env=\"$environment\",environment=\"$environment\",type=\"vault\", component=\"kube_horizontalpodautoscaler_desired_replicas\"}\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"99th quantile for week {{ component }}","refId":"D"},{"expr":"avg(slo:max:soft:gitlab_component_saturation:ratio{component=\"kube_horizontalpodautoscaler_desired_replicas\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"Soft SLO: {{ component }}","refId":"E"},{"expr":"avg(slo:max:hard:gitlab_component_saturation:ratio{component=\"kube_horizontalpodautoscaler_desired_replicas\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"Hard SLO: {{ component }}","refId":"F"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"kube_horizontalpodautoscaler_desired_replicas component saturation: Horizontal Pod Autoscaler Desired Replicas","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"Saturation %","logBase":1,"max":1,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"This resource measures average CPU utilization across an all cores in the node pool for\na service fleet.\n\nIf it is becoming saturated, it may indicate that the fleet needs horizontal scaling.\n Lower is better.","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":12,"x":0,"y":30},"id":1839360107,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"sort":"max","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[{"alias":"/^Soft SLO/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^Hard SLO/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/aggregated /","color":"#E7D551","linewidth":2,"zindex":3},{"alias":"/^95th quantile for week/","color":"#37872D","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^99th quantile for week/","color":"#56A64B","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":4,"zindex":-2}],"spaceLength":10,"stableId":"saturation-kube_pool_cpu","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_min(\n  clamp_max(\n    max by(environment, tier, type, stage, shard) (\n  clamp_min(\n    clamp_max(\n      1 - avg by (environment, tier, type, stage, shard) (\n        rate(node_cpu_seconds_total:labeled{mode=\"idle\", env=\"$environment\",environment=\"$environment\",type=\"vault\"}[5m])\n      )\n      ,\n      1)\n  ,\n  0)\n)\n\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{ type }}","refId":"A"},{"expr":"clamp_min(\n  clamp_max(\n    max(\n      max_over_time(gitlab_component_saturation:ratio{env=\"$environment\",environment=\"$environment\",type=\"vault\", component=\"kube_pool_cpu\"}[$__interval])\n    ) by (component)\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"aggregated {{ component }}","refId":"B"},{"expr":"max(\n  gitlab_component_saturation:ratio_quantile95_1w{env=\"$environment\",environment=\"$environment\",type=\"vault\", component=\"kube_pool_cpu\"}\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"95th quantile for week {{ component }}","refId":"C"},{"expr":"max(\n  gitlab_component_saturation:ratio_quantile99_1w{env=\"$environment\",environment=\"$environment\",type=\"vault\", component=\"kube_pool_cpu\"}\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"99th quantile for week {{ component }}","refId":"D"},{"expr":"avg(slo:max:soft:gitlab_component_saturation:ratio{component=\"kube_pool_cpu\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"Soft SLO: {{ component }}","refId":"E"},{"expr":"avg(slo:max:hard:gitlab_component_saturation:ratio{component=\"kube_pool_cpu\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"Hard SLO: {{ component }}","refId":"F"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"kube_pool_cpu component saturation: Average Node Pool CPU Utilization","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"Saturation %","logBase":1,"max":1,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"A GKE kubernetes node pool is close to it's maximum number of nodes.\n\nThe maximum is defined in terraform, via the `max_node_count` field of a node pool. The limit is per-zone, so for\nsingle zone clusters the number of nodes will match the limit, for regional clusters, the limit is multiplied by\nthe number of zones the cluster is deployed over.\n Lower is better.","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":12,"x":12,"y":30},"id":1686893332,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"sort":"max","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[{"alias":"/^Soft SLO/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^Hard SLO/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/aggregated /","color":"#E7D551","linewidth":2,"zindex":3},{"alias":"/^95th quantile for week/","color":"#37872D","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^99th quantile for week/","color":"#56A64B","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":4,"zindex":-2}],"spaceLength":10,"stableId":"saturation-kube_pool_max_nodes","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_min(\n  clamp_max(\n    max by(env, environment, tier, type, stage, shard, cluster, label_pool, shard) (\n  clamp_min(\n    clamp_max(\n      count by (cluster, env, environment, label_pool, tier, type, stage, shard) (\n        kube_node_labels:labeled{env=\"$environment\",environment=\"$environment\",type=\"vault\"}\n      )\n      / on(cluster, env, environment, label_pool) group_left() (\n        label_replace(\n          terraform_report_google_cluster_node_pool_max_node_count,\n          \"label_pool\", \"$0\", \"pool_name\", \".*\"\n        )\n        * on(cluster, env, environment) group_left()\n        count by (cluster, env, environment) (\n          group by (cluster, env, environment, label_topology_kubernetes_io_zone) (\n            kube_node_labels:labeled{env=\"$environment\",environment=\"$environment\",type=\"vault\"}\n          )\n        )\n      )\n      ,\n      1)\n  ,\n  0)\n)\n\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{ cluster }} {{ label_pool }} {{ shard }}","refId":"A"},{"expr":"clamp_min(\n  clamp_max(\n    max(\n      max_over_time(gitlab_component_saturation:ratio{env=\"$environment\",environment=\"$environment\",type=\"vault\", component=\"kube_pool_max_nodes\"}[$__interval])\n    ) by (component)\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"aggregated {{ component }}","refId":"B"},{"expr":"max(\n  gitlab_component_saturation:ratio_quantile95_1w{env=\"$environment\",environment=\"$environment\",type=\"vault\", component=\"kube_pool_max_nodes\"}\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"95th quantile for week {{ component }}","refId":"C"},{"expr":"max(\n  gitlab_component_saturation:ratio_quantile99_1w{env=\"$environment\",environment=\"$environment\",type=\"vault\", component=\"kube_pool_max_nodes\"}\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"99th quantile for week {{ component }}","refId":"D"},{"expr":"avg(slo:max:soft:gitlab_component_saturation:ratio{component=\"kube_pool_max_nodes\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"Soft SLO: {{ component }}","refId":"E"},{"expr":"avg(slo:max:hard:gitlab_component_saturation:ratio{component=\"kube_pool_max_nodes\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"Hard SLO: {{ component }}","refId":"F"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"kube_pool_max_nodes component saturation: Kube Pool Max Node Limit","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"Saturation %","logBase":1,"max":1,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Open file descriptor utilization per instance.\n\nSaturation on file descriptor limits may indicate a resource-descriptor leak in the application.\n\nAs a temporary fix, you may want to consider restarting the affected process.\n Lower is better.","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":12,"x":0,"y":40},"id":1001792825,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"sort":"max","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[{"alias":"/^Soft SLO/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^Hard SLO/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/aggregated /","color":"#E7D551","linewidth":2,"zindex":3},{"alias":"/^95th quantile for week/","color":"#37872D","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^99th quantile for week/","color":"#56A64B","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":4,"zindex":-2}],"spaceLength":10,"stableId":"saturation-open_fds","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_min(\n  clamp_max(\n    max by(environment, tier, type, stage, shard, job, instance) (\n  clamp_min(\n    clamp_max(\n      (\n        process_open_fds{env=\"$environment\",environment=\"$environment\",type=\"vault\"}\n        /\n        process_max_fds{env=\"$environment\",environment=\"$environment\",type=\"vault\"}\n      )\n      or\n      (\n        ruby_file_descriptors{env=\"$environment\",environment=\"$environment\",type=\"vault\"}\n        /\n        ruby_process_max_fds{env=\"$environment\",environment=\"$environment\",type=\"vault\"}\n      )\n      ,\n      1)\n  ,\n  0)\n)\n\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{ job }} {{ instance }}","refId":"A"},{"expr":"clamp_min(\n  clamp_max(\n    max(\n      max_over_time(gitlab_component_saturation:ratio{env=\"$environment\",environment=\"$environment\",type=\"vault\", component=\"open_fds\"}[$__interval])\n    ) by (component)\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"aggregated {{ component }}","refId":"B"},{"expr":"max(\n  gitlab_component_saturation:ratio_quantile95_1w{env=\"$environment\",environment=\"$environment\",type=\"vault\", component=\"open_fds\"}\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"95th quantile for week {{ component }}","refId":"C"},{"expr":"max(\n  gitlab_component_saturation:ratio_quantile99_1w{env=\"$environment\",environment=\"$environment\",type=\"vault\", component=\"open_fds\"}\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"99th quantile for week {{ component }}","refId":"D"},{"expr":"avg(slo:max:soft:gitlab_component_saturation:ratio{component=\"open_fds\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"Soft SLO: {{ component }}","refId":"E"},{"expr":"avg(slo:max:hard:gitlab_component_saturation:ratio{component=\"open_fds\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"Hard SLO: {{ component }}","refId":"F"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"open_fds component saturation: Open file descriptor utilization per instance","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"Saturation %","logBase":1,"max":1,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"üå° Saturation Details","titleSize":"h6","type":"row"},{"datasource":"$PROMETHEUS_DS","description":"","fieldConfig":{"defaults":{"decimals":0,"displayName":"","links":[],"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"blue","value":null}]},"unit":""}},"gridPos":{"h":5,"w":6,"x":0,"y":0},"id":94,"links":[],"options":{"colorMode":"value","graphMode":"none","justifyMode":"auto","orientation":"vertical","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"name"},"pluginVersion":"7","targets":[{"expr":"sum by (pod) (vault_core_active{environment=\"$environment\"})","format":"time_series","instant":true,"interval":"1m","intervalFactor":1,"legendFormat":"{{ pod }}","refId":"A"}],"title":"Vault Leader Node","transformations":[],"transparent":false,"type":"stat"},{"datasource":"$PROMETHEUS_DS","description":"","fieldConfig":{"defaults":{"decimals":0,"displayName":"","links":[],"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"red","value":0},{"color":"orange","value":1},{"color":"green","value":2}]},"unit":"short"}},"gridPos":{"h":5,"w":6,"x":6,"y":0},"id":95,"links":[],"options":{"colorMode":"value","graphMode":"none","justifyMode":"auto","orientation":"vertical","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"value"},"pluginVersion":"7","targets":[{"expr":"vault_autopilot_failure_tolerance{environment=\"$environment\"}","format":"time_series","instant":true,"interval":"1m","intervalFactor":1,"legendFormat":"","refId":"A"}],"title":"Vault Raft Failure Tolerance","transformations":[],"transparent":false,"type":"stat"},{"datasource":"$PROMETHEUS_DS","description":"","fieldConfig":{"defaults":{"decimals":0,"displayName":"","links":[],"mappings":[{"id":0,"text":"Not Healthy","type":1,"value":"0"},{"id":1,"text":"Healthy","type":1,"value":"1"}],"thresholds":{"mode":"absolute","steps":[{"color":"red","value":0},{"color":"green","value":1}]},"unit":""}},"gridPos":{"h":5,"w":6,"x":12,"y":0},"id":96,"links":[],"options":{"colorMode":"value","graphMode":"none","justifyMode":"auto","orientation":"vertical","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"value"},"pluginVersion":"7","targets":[{"expr":"vault_autopilot_healthy{environment=\"$environment\"}","format":"time_series","instant":true,"interval":"1m","intervalFactor":1,"legendFormat":"","refId":"A"}],"title":"Vault Raft Autopilot Status","transformations":[],"transparent":false,"type":"stat"},{"datasource":"$PROMETHEUS_DS","description":"","fieldConfig":{"defaults":{"decimals":0,"displayName":"","links":[],"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"red","value":0},{"color":"orange","value":4},{"color":"green","value":5}]},"unit":"short"}},"gridPos":{"h":5,"w":6,"x":18,"y":0},"id":97,"links":[],"options":{"colorMode":"value","graphMode":"none","justifyMode":"auto","orientation":"vertical","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"value"},"pluginVersion":"7","targets":[{"expr":"count(vault_autopilot_node_healthy{environment=\"$environment\"} == 1)","format":"time_series","instant":true,"interval":"1m","intervalFactor":1,"legendFormat":"","refId":"A"}],"title":"Vault Raft Autopilot Healthy Nodes","transformations":[],"transparent":false,"type":"stat"},{"collapse":true,"collapsed":true,"gridPos":{"h":1,"w":24,"x":0,"y":300},"id":98,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"Duration of time taken by GET/LIST/PUT/DELETE operations at the barrier.\n","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":12,"x":0,"y":0},"id":99,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"vault_barrier_delete{environment=\"$environment\"}","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"DELETE q{{ quantile }} ({{ pod }})","refId":"A"},{"expr":"vault_barrier_get{environment=\"$environment\"}","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"GET q{{ quantile }} ({{ pod }})","refId":"B"},{"expr":"vault_barrier_list{environment=\"$environment\"}","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"LIST q{{ quantile }} ({{ pod }})","refId":"C"},{"expr":"vault_barrier_put{environment=\"$environment\"}","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"PUT q{{ quantile }} ({{ pod }})","refId":"D"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Barrier Operations Duration","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ms","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"GET/LIST/PUT/DELETE operations per second at the barrier.\n","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":12,"x":12,"y":0},"id":100,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"rate(vault_barrier_delete_count{environment=\"$environment\"}[$__interval])","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"DELETE ({{ pod }})","refId":"A"},{"expr":"rate(vault_barrier_get_count{environment=\"$environment\"}[$__interval])","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"GET ({{ pod }})","refId":"B"},{"expr":"rate(vault_barrier_list_count{environment=\"$environment\"}[$__interval])","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"LIST ({{ pod }})","refId":"C"},{"expr":"rate(vault_barrier_put_count{environment=\"$environment\"}[$__interval])","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"PUT ({{ pod }})","refId":"D"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Barrier Operations per Second","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ops","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"Cache hit/miss ratio.\n","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":12,"x":0,"y":1},"id":101,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(rate(vault_cache_hit{environment=\"$environment\"}[$__interval]))\n/\n(\n  sum(rate(vault_cache_hit{environment=\"$environment\"}[$__interval]))\n  +\n  (sum(rate(vault_cache_miss{environment=\"$environment\"}[$__interval])) or vector(0))\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"hit","refId":"A"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Cache Hit/Miss Ratio","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"Cache write/delete rate.\n","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":12,"x":12,"y":1},"id":102,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(rate(vault_cache_write{environment=\"$environment\"}[$__interval]))","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"write","refId":"A"},{"expr":"sum(rate(vault_cache_delete{environment=\"$environment\"}[$__interval]))","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"delete","refId":"B"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Cache Write/Delete Operations per Second","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ops","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"Vault Core","titleSize":"h6","type":"row"},{"collapse":true,"collapsed":true,"gridPos":{"h":1,"w":24,"x":0,"y":310},"id":103,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"Raft transaction rate.\n","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":12,"x":0,"y":0},"id":104,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"rate(vault_raft_apply{environment=\"$environment\"}[$__interval])","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{ pod }}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Raft Transactions","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ops","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"Time to commit a new entry to the Raft log on the leader.\n","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":12,"x":12,"y":0},"id":105,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"vault_raft_commitTime{environment=\"$environment\"}","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{ pod }} (p{{ quantile }})","refId":"A"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Raft Commit Time","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ms","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"Time to delete file from raft's underlying storage.\n","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":6,"x":0,"y":1},"id":106,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"vault_raft_delete{environment=\"$environment\"}","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{ pod }} (p{{ quantile }})","refId":"A"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Raft Delete Time","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ms","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"Time to retrieve file from raft's underlying storage.\n","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":6,"x":6,"y":1},"id":107,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"vault_raft_get{environment=\"$environment\"}","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{ pod }} (p{{ quantile }})","refId":"A"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Raft Get Time","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ms","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"Time to retrieve list of keys from raft's underlying storage.\n","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":6,"x":12,"y":1},"id":108,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"vault_raft_list{environment=\"$environment\"}","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{ pod }} (p{{ quantile }})","refId":"A"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Raft List Time","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ms","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"Time to persist key in raft's underlying storage.\n","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":6,"x":18,"y":1},"id":109,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"vault_raft_put{environment=\"$environment\"}","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{ pod }} (p{{ quantile }})","refId":"A"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Raft Put Time","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ms","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"Number of logs replicated to a node, to bring it up to speed with the leader's logs.\n","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":8,"x":0,"y":3},"id":110,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"rate(vault_raft_replication_appendEntries_logs{environment=\"$environment\"}[$__interval])","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{ pod }}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Raft Replication Append Entries Rate","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"Time taken by the append entries RPC, to replicate the log entries of a leader node onto its follower node(s).\n","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":8,"x":8,"y":3},"id":111,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"vault_raft_replication_appendEntries_rpc{environment=\"$environment\"}","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{ pod }} (p{{ quantile }})","refId":"A"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Raft Replication Append Entries","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ms","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"Time taken by the append entries RPC, to replicate the log entries of a leader node onto its follower node(s).\n","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":8,"x":16,"y":3},"id":112,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"vault_raft_replication_heartbeat{environment=\"$environment\"}","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{ pod }} (p{{ quantile }})","refId":"A"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Raft Replication Heartbeat","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ms","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"Time taken to process an append entries RPC call from a node.\n","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":4.7999999999999998,"x":0,"y":4},"id":113,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"vault_raft_rpc_appendEntries{environment=\"$environment\"}","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{ pod }} (p{{ quantile }})","refId":"A"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Raft RPC Append Entries","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ms","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"Time taken to process the outstanding log entries of a node.\n","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":4.7999999999999998,"x":4.7999999999999998,"y":4},"id":114,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"vault_raft_rpc_appendEntries_processLogs{environment=\"$environment\"}","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{ pod }} (p{{ quantile }})","refId":"A"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Raft RPC Append Entries: Process Logs","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ms","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"Time taken to add any outstanding logs for a node, since the last appendEntries was invoked.\n","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":4.7999999999999998,"x":9.5999999999999996,"y":4},"id":115,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"vault_raft_rpc_appendEntries_storeLogs{environment=\"$environment\"}","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{ pod }} (p{{ quantile }})","refId":"A"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Raft RPC Append Entries: Store Logs","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ms","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"Time taken to process a heartbeat request.\n","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":4.7999999999999998,"x":14.399999999999999,"y":4},"id":116,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"vault_raft_rpc_processHeartbeat{environment=\"$environment\"}","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{ pod }} (p{{ quantile }})","refId":"A"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Raft RPC Process Heartbeat","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ms","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"Time taken to complete requestVote RPC call.\n","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":4.7999999999999998,"x":19.199999999999999,"y":4},"id":117,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"vault_raft_rpc_requestVote{environment=\"$environment\"}","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{ pod }} (p{{ quantile }})","refId":"A"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Raft RPC Request Vote","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ms","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"Vault Integrated Storage (Raft)","titleSize":"h6","type":"row"},{"collapse":true,"collapsed":true,"gridPos":{"h":1,"w":24,"x":0,"y":320},"id":118,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"Time since the leader was last able to contact the follower nodes when checking its leader lease.\n","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":12,"x":0,"y":0},"id":119,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"vault_raft_leader_lastContact{environment=\"$environment\"}","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{ pod }} (p{{ quantile }})","refId":"A"}],"thresholds":[{"colorMode":"custom","fill":true,"fillColor":"rgba(242, 73, 92, 0.25)","line":false,"op":"gt","value":200,"yaxis":"left"}],"timeFrom":null,"timeShift":null,"title":"Raft Leader Last Contact","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"ms","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"Candidate/follower/leader state changes.\n","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":12,"x":12,"y":0},"id":120,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"total":false,"values":true},"lines":true,"linewidth":2,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"increase(vault_raft_state_candidate{environment=\"$environment\"}[$__interval])","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{ pod }}: candidate","refId":"A"},{"expr":"increase(vault_raft_state_follower{environment=\"$environment\"}[$__interval])","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{ pod }}: follower","refId":"B"},{"expr":"increase(vault_raft_state_leader{environment=\"$environment\"}[$__interval])","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{ pod }}: leader","refId":"C"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"Raft State Changes","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":"","logBase":1,"max":null,"min":0,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"Vault Integrated Storage (Raft) Leadership Changes","titleSize":"h6","type":"row"},{"collapse":true,"collapsed":true,"gridPos":{"x":0,"y":100010},"id":121,"panels":[{"colors":["rgba(50, 172, 45, 0.97)","rgba(237, 129, 40, 0.89)","rgba(245, 54, 54, 0.9)"],"composites":[],"datasource":"$PROMETHEUS_DS","decimals":3,"format":"percentunit","graphId":"diagram_errors","gridPos":{"h":10,"w":24,"x":0,"y":0},"id":122,"init":{"arrowMarkerAbsolute":true,"cloneCssStyles":true,"flowchart":{"htmlLabels":true,"useMaxWidth":true},"gantt":{"barGap":4,"barHeight":20,"fontFamily":"\"Open-Sans\", \"sans-serif\"","fontSize":11,"gridLineStartPadding":35,"leftPadding":75,"numberSectionStyles":3,"titleTopMargin":25,"topPadding":50},"logLevel":3,"sequenceDiagram":{"actorMargin":50,"bottomMarginAdj":1,"boxMargin":10,"boxTextMargin":5,"diagramMarginX":50,"diagramMarginY":10,"height":65,"messageMargin":35,"mirrorActors":true,"noteMargin":10,"useMaxWidth":true,"width":150},"startOnLoad":false},"interval":"","legend":{"avg":true,"current":true,"gradient":{"enabled":true,"show":true},"max":true,"min":true,"show":false,"total":true},"mappingType":1,"mappingTypes":[],"maxDataPoints":100,"maxWidth":false,"mermaidServiceUrl":"","metricCharacterReplacements":[],"moddedSeriesVal":0,"mode":"content","nullPointMode":"connected","options":{"content":"graph TD\n  subgraph inf\n  vault\nend\n\n\n  \n"},"seriesOverrides":[],"style":"","targets":[{"expr":"clamp_max(\n  max_over_time(gitlab_service_errors:ratio_5m{environment=\"$environment\",monitor=\"global\",stage=\"$stage\"}[$__range])\n,\n  1\n)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":1,"legendFormat":"{{ type }}"}],"thresholds":"0,0.001","title":"System Diagram (Keyed by Error Rates)","type":"jdbranham-diagram-panel","valueMaps":[],"valueName":"current","valueOptions":["avg","min","max","total","current"]},{"colors":["rgba(245, 54, 54, 0.9)","#FF9830","#73BF69"],"composites":[],"datasource":"$PROMETHEUS_DS","decimals":3,"format":"percentunit","graphId":"diagram_apdex","gridPos":{"h":10,"w":24,"x":0,"y":10},"id":123,"init":{"arrowMarkerAbsolute":true,"cloneCssStyles":true,"flowchart":{"htmlLabels":true,"useMaxWidth":true},"gantt":{"barGap":4,"barHeight":20,"fontFamily":"\"Open-Sans\", \"sans-serif\"","fontSize":11,"gridLineStartPadding":35,"leftPadding":75,"numberSectionStyles":3,"titleTopMargin":25,"topPadding":50},"logLevel":3,"sequenceDiagram":{"actorMargin":50,"bottomMarginAdj":1,"boxMargin":10,"boxTextMargin":5,"diagramMarginX":50,"diagramMarginY":10,"height":65,"messageMargin":35,"mirrorActors":true,"noteMargin":10,"useMaxWidth":true,"width":150},"startOnLoad":false},"interval":"","legend":{"avg":true,"current":true,"gradient":{"enabled":true,"show":true},"max":true,"min":true,"show":false,"total":true},"mappingType":1,"mappingTypes":[],"maxDataPoints":100,"maxWidth":false,"mermaidServiceUrl":"","metricCharacterReplacements":[],"moddedSeriesVal":0,"mode":"content","nullPointMode":"connected","options":{"content":"graph TD\n  subgraph inf\n  vault\nend\n\n\n  \n"},"seriesOverrides":[],"style":"","targets":[{"expr":"min_over_time(gitlab_service_apdex:ratio_5m{environment=\"$environment\",monitor=\"global\",stage=\"$stage\"}[$__range])\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":1,"legendFormat":"{{ type }}"}],"thresholds":"0.99,0.995,0.999","title":"System Diagram (Keyed by Apdex/Latency Scores)","type":"jdbranham-diagram-panel","valueMaps":[],"valueName":"current","valueOptions":["avg","min","max","total","current"]},{"colors":[],"composites":[],"datasource":"$PROMETHEUS_DS","decimals":3,"format":"percentunit","graphId":"diagram_maturity","gridPos":{"h":10,"w":24,"x":0,"y":20},"id":124,"init":{"arrowMarkerAbsolute":true,"cloneCssStyles":true,"flowchart":{"htmlLabels":true,"useMaxWidth":true},"gantt":{"barGap":4,"barHeight":20,"fontFamily":"\"Open-Sans\", \"sans-serif\"","fontSize":11,"gridLineStartPadding":35,"leftPadding":75,"numberSectionStyles":3,"titleTopMargin":25,"topPadding":50},"logLevel":3,"sequenceDiagram":{"actorMargin":50,"bottomMarginAdj":1,"boxMargin":10,"boxTextMargin":5,"diagramMarginX":50,"diagramMarginY":10,"height":65,"messageMargin":35,"mirrorActors":true,"noteMargin":10,"useMaxWidth":true,"width":150},"startOnLoad":false},"interval":"","legend":{"avg":true,"current":true,"gradient":{"enabled":true,"show":true},"max":true,"min":true,"show":false,"total":true},"mappingType":1,"mappingTypes":[],"maxDataPoints":100,"maxWidth":false,"mermaidServiceUrl":"","metricCharacterReplacements":[],"moddedSeriesVal":0,"mode":"content","nullPointMode":"connected","options":{"content":"graph TD\n  subgraph inf\n  vault[\"vault (Level 2)\"]\nend\n\n\n  \n"},"seriesOverrides":[],"style":"","targets":[],"thresholds":"","title":"System Diagram (Keyed by Maturity Model)","type":"jdbranham-diagram-panel","valueMaps":[],"valueName":"current","valueOptions":["avg","min","max","total","current"]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"üó∫Ô∏è System Diagrams","titleSize":"h6","type":"row"},{"content":"Made with ‚ù§Ô∏è and [Grafonnet](https://github.com/grafana/grafonnet-lib). [Contribute to this dashboard on GitLab.com](https://gitlab.com/gitlab-com/runbooks/blob/master/dashboards)\n","datasource":null,"gridPos":{"h":2,"w":24,"x":0,"y":110000},"id":125,"mode":"markdown","title":"Source","type":"text"}],"refresh":"","rows":[],"schemaVersion":16,"style":"light","tags":["managed","vault","gitlab","type:vault","vault","service overview"],"templating":{"list":[{"current":{"text":"Mimir - Gitlab Ops","value":"Mimir - Gitlab Ops"},"hide":0,"label":null,"name":"PROMETHEUS_DS","options":[],"query":"prometheus","refresh":1,"regex":"","type":"datasource"},{"allValue":null,"current":{"text":"ops","value":"ops"},"hide":0,"includeAll":false,"label":"","multi":false,"name":"environment","options":[{"text":"ops","value":"ops"},{"text":"pre","value":"pre"},{"text":"","value":""}],"query":"ops,pre,","refresh":0,"type":"custom"}]},"time":{"from":"now-6h/m","to":"now/m"},"timepicker":{"refresh_intervals":["1m","5m","10m","15m","30m"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"utc","title":"vault: Overview","version":0,"uid":"vault-main","description":"Uploaded by https://gitlab.com/gitlab-com/runbooks/-/jobs/8397766929 at Mon Nov 18 09:15:28 UTC 2024"}
