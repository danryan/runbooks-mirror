{"__inputs":[],"__requires":[],"annotations":{"list":[]},"editable":false,"gnetId":null,"graphTooltip":1,"hideControls":false,"id":null,"links":[],"panels":[{"collapse":false,"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":0},"id":2,"panels":[],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"http_router_cpu: HTTP Router CPU P999 Budget","titleSize":"h6","type":"row"},{"datasource":"$PROMETHEUS_DS","description":"","fieldConfig":{"defaults":{"decimals":0,"displayName":"Severity","links":[],"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"light-yellow","value":null}]},"unit":""}},"gridPos":{"h":4,"w":6,"x":0,"y":1},"id":3,"links":[],"options":{"colorMode":"background","graphMode":"none","justifyMode":"auto","orientation":"vertical","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"7","targets":[{"expr":"vector(3)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":1,"legendFormat":"","refId":"A"}],"title":"Saturation Severity","transformations":[],"transparent":false,"type":"stat"},{"datasource":"$PROMETHEUS_DS","description":"","fieldConfig":{"defaults":{"decimals":0,"displayName":"Horizontally Scalable","links":[],"mappings":[{"id":0,"text":"No","type":1,"value":"0"},{"id":1,"text":"Yes","type":1,"value":"1"}],"thresholds":{"mode":"absolute","steps":[{"color":"light-green","value":null}]},"unit":""}},"gridPos":{"h":4,"w":6,"x":6,"y":1},"id":4,"links":[],"options":{"colorMode":"background","graphMode":"none","justifyMode":"auto","orientation":"vertical","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"7","targets":[{"expr":"vector(1)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":1,"legendFormat":"","refId":"A"}],"title":"Scaling Characteristics","transformations":[],"transparent":false,"type":"stat"},{"datasource":"$PROMETHEUS_DS","description":"","fieldConfig":{"defaults":{"decimals":0,"displayName":"Tamland","links":[],"mappings":[{"from":"-10","id":0,"text":"Soon","to":"1","type":2}],"noValue":"No Forecast","thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":0},{"color":"orange","value":45}]},"unit":"d"}},"gridPos":{"h":4,"w":6,"x":12,"y":1},"id":5,"links":[{"targetBlank":true,"title":"Tamland Report","url":"https://gitlab-com.gitlab.io/gl-infra/tamland/${__field.labels.pagename}.html#http-router-service-http_router_cpu-resource-saturation"}],"options":{"colorMode":"background","graphMode":"none","justifyMode":"auto","orientation":"vertical","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"7","targets":[{"expr":"tamland_forecast_violation_days{component=\"http_router_cpu\",confidence_type=\"mean\",env=\"ops\",environment=\"ops\",threshold_type=\"hard\",type=\"http-router\"}\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":1,"legendFormat":"","refId":"A"}],"title":"Tamland Predicted Threshold Violation, Average Case","transformations":[],"transparent":false,"type":"stat"},{"datasource":"$PROMETHEUS_DS","description":"","fieldConfig":{"defaults":{"decimals":0,"displayName":"Tamland","links":[],"mappings":[{"from":"-10","id":0,"text":"Soon","to":"1","type":2}],"noValue":"No Forecast","thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":0},{"color":"orange","value":45}]},"unit":"d"}},"gridPos":{"h":4,"w":6,"x":18,"y":1},"id":6,"links":[{"targetBlank":true,"title":"Tamland Report","url":"https://gitlab-com.gitlab.io/gl-infra/tamland/${__field.labels.pagename}.html#http-router-service-http_router_cpu-resource-saturation"}],"options":{"colorMode":"background","graphMode":"none","justifyMode":"auto","orientation":"vertical","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"7","targets":[{"expr":"tamland_forecast_violation_days{component=\"http_router_cpu\",confidence_type=\"80%\",env=\"ops\",environment=\"ops\",threshold_type=\"hard\",type=\"http-router\"}\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":1,"legendFormat":"","refId":"A"}],"title":"Tamland Predicted Threshold Violation, Pessimistic Case","transformations":[],"transparent":false,"type":"stat"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Timeseries","fill":0,"fillGradient":0,"gridPos":{"h":12,"w":18,"x":0,"y":2},"id":3250352017,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"sort":"max","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[{"alias":"/^Soft SLO/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^Hard SLO/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/aggregated /","color":"#E7D551","linewidth":2,"zindex":3},{"alias":"/^95th quantile for week/","color":"#37872D","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^99th quantile for week/","color":"#56A64B","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":4,"zindex":-2}],"spaceLength":10,"stableId":"saturation-http_router_cpu","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_min(\n  clamp_max(\n    max(\n      gitlab_component_saturation:ratio{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"http-router\", component=\"http_router_cpu\"}\n    ) by (component)\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"aggregated {{ component }}","refId":"A"},{"expr":"max(\n  gitlab_component_saturation:ratio_quantile95_1w{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"http-router\", component=\"http_router_cpu\"}\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"95th quantile for week {{ component }}","refId":"B"},{"expr":"max(\n  gitlab_component_saturation:ratio_quantile99_1w{env=\"$environment\",environment=\"$environment\",stage=\"main\",type=\"http-router\", component=\"http_router_cpu\"}\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"99th quantile for week {{ component }}","refId":"C"},{"expr":"avg(slo:max:soft:gitlab_component_saturation:ratio{component=\"http_router_cpu\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"Soft SLO: {{ component }}","refId":"D"},{"expr":"avg(slo:max:hard:gitlab_component_saturation:ratio{component=\"http_router_cpu\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"Hard SLO: {{ component }}","refId":"E"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"HTTP Router CPU P999 Budget","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"Saturation %","logBase":1,"max":1,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]},{"content":"Maximum HTTP Router CPU time spent on any request for the fastest 99.9% of requests.\n\nThe more time on the CPU we spend the more latency the HTTP Router is adding to every request.\nThis also has a direct impact on [cost](https://developers.cloudflare.com/workers/platform/pricing/#workers) for HTTP Router.\n\nFor profiling a worker follow https://developers.cloudflare.com/workers/observability/dev-tools/cpu-usage/\n","datasource":null,"gridPos":{"h":12,"w":6,"x":18,"y":2},"id":8,"mode":"markdown","title":"","type":"text"},{"content":"Made with ❤️ and [Grafonnet](https://github.com/grafana/grafonnet-lib). [Contribute to this dashboard on GitLab.com](https://gitlab.com/gitlab-com/runbooks/blob/master/dashboards)\n","datasource":null,"gridPos":{"h":2,"w":24,"x":0,"y":110000},"id":9,"mode":"markdown","title":"Source","type":"text"}],"refresh":"","rows":[],"schemaVersion":16,"style":"light","tags":["managed","http-router","http-router","type:http-router","capacity-review"],"templating":{"list":[{"current":{"text":"Mimir - Gitlab Ops","value":"Mimir - Gitlab Ops"},"hide":0,"label":null,"name":"PROMETHEUS_DS","options":[],"query":"prometheus","refresh":1,"regex":"","type":"datasource"},{"allValue":null,"current":{"text":"gprd","value":"gprd"},"datasource":"$PROMETHEUS_DS","hide":0,"includeAll":false,"label":null,"multi":false,"name":"environment","options":[],"query":"label_values(gitlab_service_ops:rate_1h, environment)","refresh":1,"regex":"","sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false}]},"time":{"from":"now-15d/d","to":"now-1d/d"},"timepicker":{"refresh_intervals":["1m","5m","10m","15m","30m"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"utc","title":"http-router: Capacity Review","version":0,"uid":"http-router-capacity-review","description":"Uploaded by https://gitlab.com/gitlab-com/runbooks/-/jobs/8397766929 at Mon Nov 18 09:15:46 UTC 2024"}
