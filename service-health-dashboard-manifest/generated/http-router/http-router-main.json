{"__inputs":[],"__requires":[],"annotations":{"list":[{"builtIn":1,"datasource":"-- Grafana --","enable":true,"hide":false,"iconColor":"#96D98D","name":"deploy","showIn":0,"tags":["deploy","$environment"],"type":"tags"},{"builtIn":1,"datasource":"-- Grafana --","enable":false,"hide":false,"iconColor":"#FFEE52","name":"canary-deploy","showIn":0,"tags":["deploy","${environment}-cny"],"type":"tags"},{"builtIn":1,"datasource":"-- Grafana --","enable":false,"hide":false,"iconColor":"#CA95E5","name":"feature-flags","showIn":0,"tags":["feature-flag","${environment}"],"type":"tags"}]},"editable":false,"gnetId":null,"graphTooltip":1,"hideControls":false,"id":null,"links":[{"asDropdown":true,"icon":"external link","includeVars":false,"keepTime":true,"tags":"","targetBlank":false,"title":"Platform Triage","type":"link","url":"https://dashboards.gitlab.net/d/general-triage/platform-triage?orgId=1"},{"asDropdown":true,"icon":"external link","includeVars":true,"keepTime":true,"tags":["managed","service overview"],"targetBlank":false,"title":"Service Overview Dashboards","type":"dashboards","url":""},{"asDropdown":true,"icon":"dashboard","includeVars":true,"keepTime":true,"tags":"type:http-router","targetBlank":false,"title":"http-router Detail","type":"dashboards","url":""},{"asDropdown":true,"icon":"external link","includeVars":true,"keepTime":true,"tags":["managed","type:http-router","kube detail"],"targetBlank":false,"title":"☸️ http-router Kubernetes Detail","type":"dashboards","url":""}],"panels":[{"collapse":false,"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":0},"id":2,"panels":[],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"🌡️ Aggregated Service Level Indicators (𝙎𝙇𝙄𝙨)","titleSize":"h6","type":"row"},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Error rates are a measure of unhandled service exceptions per second. Client errors are excluded when possible. Lower is better","fill":0,"fillGradient":0,"gridPos":{"h":9,"w":8,"x":0,"y":1},"id":3495312364,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","options":{"dataLinks":[{"targetBlank":true,"title":"http-router Service Error-Rate SLO Analysis","url":"/d/alerts-service_slo_error?${__url_time_range}&${__all_variables}&var-type=http-router"}]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/6h Degradation SLO \\(5% of monthly error budget\\).*/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/1h Outage SLO \\(2% of monthly error budget\\).*/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/.*shard (apdex|error ratio|RPS)$/","color":"#E7D551"},{"alias":"http-router error ratio avg","color":"#5794F2","dashLength":1,"fillGradient":10,"linewidth":1,"spaceLength":1,"zindex":-3},{"alias":"last week","color":"#dddddd80","dashLength":4,"dashes":true,"fill":0,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":2,"zindex":-3},{"alias":"http-router error ratio","color":"#E7D551","fillBelowTo":"http-router error ratio avg","zindex":3}],"spaceLength":10,"stableId":"service-http-router-error-rate","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_max(\n  max_over_time(gitlab_service_errors:ratio_5m{env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"http-router\"}[$__interval])\n,\n  1\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"http-router error ratio","refId":"A"},{"expr":"(6 * avg(slo:max:events:gitlab_service_errors:ratio{component=\"\",monitor=\"global\",type=\"http-router\"})\n)\n","format":"time_series","interval":"5m","intervalFactor":1,"legendFormat":"6h Degradation SLO (5% of monthly error budget)","refId":"B"},{"expr":"(14.4 * avg(slo:max:events:gitlab_service_errors:ratio{component=\"\",monitor=\"global\",type=\"http-router\"})\n)\n","format":"time_series","interval":"5m","intervalFactor":1,"legendFormat":"1h Outage SLO (2% of monthly error budget)","refId":"C"},{"expr":"clamp_max(\n  avg_over_time(gitlab_service_errors:ratio_5m{env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"http-router\"}[$__interval])\n,\n  1\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"http-router error ratio avg","refId":"D"},{"expr":"clamp_max(\n  gitlab_service_errors:ratio_5m{env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"http-router\"} offset 1w\n,\n  scalar(max((14.4 * avg(slo:max:events:gitlab_service_errors:ratio{component=\"\",monitor=\"global\",type=\"http-router\"})\n)\n))\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"last week","refId":"E"}],"title":"http-router Service Error Ratio","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"percentunit","label":"Error %","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"datasource":"$PROMETHEUS_DS","description":"","fieldConfig":{"defaults":{"decimals":0,"displayName":"Status","mappings":[{"id":0,"options":{"0":{"color":"black","index":0,"text":"Healthy"},"1":{"color":"orange","index":1,"text":"Warning: 1h deteriorating"},"10":{"color":"orange","index":10,"text":"Warning: 6h recovering, 1h recovering"},"11":{"color":"red","index":11,"text":"Degraded: 6h recovering, 1h degraded"},"12":{"color":"red","index":12,"text":"Degraded: 6h degraded"},"13":{"color":"red","index":13,"text":"Degraded: 6h degraded, 1h deteriorating"},"14":{"color":"red","index":14,"text":"Degraded: 6h degraded, 1h recovering"},"15":{"color":"red","index":15,"text":"Degraded: 6h degraded, 1h degraded"},"2":{"color":"orange","index":2,"text":"Warning: 1h recovering"},"3":{"color":"red","index":3,"text":"Degraded: 1h degraded"},"4":{"color":"orange","index":4,"text":"Warning: 6h deteriorating"},"5":{"color":"orange","index":5,"text":"Warning: 6h deteriorating, 1h deteriorating"},"6":{"color":"orange","index":6,"text":"Warning: 6h deteriorating, 1h recovering"},"7":{"color":"red","index":7,"text":"Degraded: 6h deteriorating, 1h degraded"},"8":{"color":"orange","index":8,"text":"Warning: 6h recovering"},"9":{"color":"orange","index":9,"text":"Warning: 6h recovering, 1h deteriorating"}},"type":"value"}],"thresholds":{"mode":"absolute","steps":[{"color":"black","value":0},{"color":"orange","value":1},{"color":"orange","value":2},{"color":"red","value":3},{"color":"orange","value":4},{"color":"orange","value":5},{"color":"orange","value":6},{"color":"red","value":7},{"color":"orange","value":8},{"color":"orange","value":9},{"color":"orange","value":10},{"color":"red","value":11},{"color":"red","value":12},{"color":"red","value":13},{"color":"red","value":14},{"color":"red","value":15}]},"unit":"none"}},"gridPos":{"h":1,"w":8,"x":0,"y":10},"id":4,"options":{"colorMode":"background","graphMode":"none","justifyMode":"auto","orientation":"vertical","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"7","targets":[{"expr":"sum(\n  label_replace(\n    vector(0) and on() (gitlab_service_errors:ratio_1h{env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"http-router\"}),\n    \"period\", \"na\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(1) and on () (gitlab_service_errors:ratio_5m{env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"http-router\"} > on(tier, type, __tenant_id__) group_left() (14.4 * slo:max:events:gitlab_service_errors:ratio{component=\"\",monitor=\"global\",type=\"http-router\"})),\n    \"period\", \"5m\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(2) and on () (gitlab_service_errors:ratio_1h{env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"http-router\"} > on(tier, type, __tenant_id__) group_left() (14.4 * slo:max:events:gitlab_service_errors:ratio{component=\"\",monitor=\"global\",type=\"http-router\"})),\n    \"period\", \"1h\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(4) and on () (gitlab_service_errors:ratio_30m{env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"http-router\"} > on(tier, type, __tenant_id__) group_left() (6 * slo:max:events:gitlab_service_errors:ratio{component=\"\",monitor=\"global\",type=\"http-router\"})),\n    \"period\", \"30m\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(8) and on () (gitlab_service_errors:ratio_6h{env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"http-router\"} > on(tier, type, __tenant_id__) group_left() (6 * slo:max:events:gitlab_service_errors:ratio{component=\"\",monitor=\"global\",type=\"http-router\"})),\n    \"period\", \"6h\", \"\", \"\"\n  )\n)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":1,"legendFormat":"http-router Service | Errors","refId":"A"}],"title":"","transparent":false,"type":"stat"},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"The operation rate is the sum total of all requests being handle for all components within this service. Note that a single user request can lead to requests to multiple components. Higher is busier.","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":8,"x":8,"y":1},"id":2433781180,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/.*shard (apdex|error ratio|RPS)$/","color":"#E7D551"},{"alias":"http-router RPS","color":"#E7D551","zindex":3},{"alias":"last week","color":"#dddddd80","dashLength":4,"dashes":true,"fill":0,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":2,"zindex":-3},{"alias":"upper normal","color":"#73BF69","dashLength":8,"dashes":true,"fillBelowTo":"lower normal","legend":false,"lines":false,"linewidth":1,"nullPointMode":"connected","spaceLength":8,"zindex":-3},{"alias":"lower normal","color":"#73BF69","dashLength":8,"dashes":true,"legend":false,"lines":false,"linewidth":1,"nullPointMode":"connected","spaceLength":8,"zindex":-3}],"spaceLength":10,"stableId":"service-http-router-ops-rate","stack":false,"steppedLine":false,"targets":[{"expr":"avg_over_time(gitlab_service_ops:rate_5m{env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"http-router\"}[$__interval])\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"http-router RPS","refId":"A"},{"expr":"gitlab_service_ops:rate_5m{env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"http-router\"} offset 1w\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"last week","refId":"B"},{"expr":"clamp_min(\n  avg by (type) (\n    gitlab_service_ops:rate:prediction{env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"http-router\"}\n    + (1) *\n    gitlab_service_ops:rate:stddev_over_time_1w{env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"http-router\"}\n  ),\n  0\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"upper normal","refId":"C"},{"expr":"clamp_min(\n  avg by (type) (\n    gitlab_service_ops:rate:prediction{env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"http-router\"}\n    + (-1) *\n    gitlab_service_ops:rate:stddev_over_time_1w{env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"http-router\"}\n  ),\n  0\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"lower normal","refId":"D"}],"title":"http-router Service RPS - Requests per Second","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Operations per Second","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Saturation is a measure of what ratio of a finite resource is currently being utilized. Lower is better.","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":8,"x":16,"y":1},"id":1217942947,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[{"title":"http-router Service | http_router_cpu resource Dashboard","url":"https://dashboards.gitlab.net/d/alerts-http-router-capacity-review/?var-environment=gprd&var-type=http-router&var-stage=main&var-component=http_router_cpu"}],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stableId":"service-utilization","stack":false,"steppedLine":false,"targets":[{"expr":"max(\n  max_over_time(\n    gitlab_component_saturation:ratio{env=\"$environment\",environment=\"$environment\",type=\"http-router\"}[$__interval]\n  )\n) by (component)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{ component }} component","refId":"A"}],"title":"Saturation","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"percentunit","label":"Saturation %","logBase":1,"max":1,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"collapse":false,"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":20},"id":7,"panels":[],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"🔬 Service Level Indicators","titleSize":"h6","type":"row"},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Error rates are a measure of unhandled service exceptions per second. Client errors are excluded when possible. Lower is better","fill":0,"fillGradient":0,"gridPos":{"h":7,"w":8,"x":0,"y":21},"id":1908761530,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","options":{"dataLinks":[{"targetBlank":true,"title":"worker_requests SLI Error-Rate SLO Analysis","url":"/d/alerts-component_slo_error?${__url_time_range}&${__all_variables}&var-component=worker_requests&var-type=http-router"}]},"percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/6h Degradation SLO \\(5% of monthly error budget\\).*/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/1h Outage SLO \\(2% of monthly error budget\\).*/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/.*shard (apdex|error ratio|RPS)$/","color":"#E7D551"},{"alias":"worker_requests error ratio avg","color":"#5794F2","dashLength":1,"fillGradient":10,"linewidth":1,"spaceLength":1,"zindex":-3},{"alias":"last week","color":"#dddddd80","dashLength":4,"dashes":true,"fill":0,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":2,"zindex":-3},{"alias":"worker_requests error ratio","color":"#E7D551","fillBelowTo":"worker_requests error ratio avg","zindex":3}],"spaceLength":10,"stableId":"sli-worker_requests-error-rate","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_max(\n  max_over_time(gitlab_component_errors:ratio_5m{component=\"worker_requests\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"http-router\"}[$__interval])\n,\n  1\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"worker_requests error ratio","refId":"A"},{"expr":"(6 * avg(slo:max:events:gitlab_service_errors:ratio{component=\"worker_requests\",monitor=\"global\",type=\"http-router\"})\n)\n","format":"time_series","interval":"5m","intervalFactor":1,"legendFormat":"6h Degradation SLO (5% of monthly error budget)","refId":"B"},{"expr":"(14.4 * avg(slo:max:events:gitlab_service_errors:ratio{component=\"worker_requests\",monitor=\"global\",type=\"http-router\"})\n)\n","format":"time_series","interval":"5m","intervalFactor":1,"legendFormat":"1h Outage SLO (2% of monthly error budget)","refId":"C"},{"expr":"clamp_max(\n  avg_over_time(gitlab_component_errors:ratio_5m{component=\"worker_requests\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"http-router\"}[$__interval])\n,\n  1\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"worker_requests error ratio avg","refId":"D"},{"expr":"clamp_max(\n  gitlab_component_errors:ratio_5m{component=\"worker_requests\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"http-router\"} offset 1w\n,\n  scalar(max((14.4 * avg(slo:max:events:gitlab_service_errors:ratio{component=\"worker_requests\",monitor=\"global\",type=\"http-router\"})\n)\n))\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"last week","refId":"E"}],"title":"worker_requests SLI Error Ratio","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"percentunit","label":"Error %","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"datasource":"$PROMETHEUS_DS","description":"","fieldConfig":{"defaults":{"decimals":0,"displayName":"Status","mappings":[{"id":0,"options":{"0":{"color":"black","index":0,"text":"Healthy"},"1":{"color":"orange","index":1,"text":"Warning: 1h deteriorating"},"10":{"color":"orange","index":10,"text":"Warning: 6h recovering, 1h recovering"},"11":{"color":"red","index":11,"text":"Degraded: 6h recovering, 1h degraded"},"12":{"color":"red","index":12,"text":"Degraded: 6h degraded"},"13":{"color":"red","index":13,"text":"Degraded: 6h degraded, 1h deteriorating"},"14":{"color":"red","index":14,"text":"Degraded: 6h degraded, 1h recovering"},"15":{"color":"red","index":15,"text":"Degraded: 6h degraded, 1h degraded"},"2":{"color":"orange","index":2,"text":"Warning: 1h recovering"},"3":{"color":"red","index":3,"text":"Degraded: 1h degraded"},"4":{"color":"orange","index":4,"text":"Warning: 6h deteriorating"},"5":{"color":"orange","index":5,"text":"Warning: 6h deteriorating, 1h deteriorating"},"6":{"color":"orange","index":6,"text":"Warning: 6h deteriorating, 1h recovering"},"7":{"color":"red","index":7,"text":"Degraded: 6h deteriorating, 1h degraded"},"8":{"color":"orange","index":8,"text":"Warning: 6h recovering"},"9":{"color":"orange","index":9,"text":"Warning: 6h recovering, 1h deteriorating"}},"type":"value"}],"thresholds":{"mode":"absolute","steps":[{"color":"black","value":0},{"color":"orange","value":1},{"color":"orange","value":2},{"color":"red","value":3},{"color":"orange","value":4},{"color":"orange","value":5},{"color":"orange","value":6},{"color":"red","value":7},{"color":"orange","value":8},{"color":"orange","value":9},{"color":"orange","value":10},{"color":"red","value":11},{"color":"red","value":12},{"color":"red","value":13},{"color":"red","value":14},{"color":"red","value":15}]},"unit":"none"}},"gridPos":{"h":1,"w":8,"x":0,"y":28},"id":9,"options":{"colorMode":"background","graphMode":"none","justifyMode":"auto","orientation":"vertical","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"7","targets":[{"expr":"sum(\n  label_replace(\n    vector(0) and on() (gitlab_component_errors:ratio_1h{component=\"worker_requests\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"http-router\"}),\n    \"period\", \"na\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(1) and on () (gitlab_component_errors:ratio_5m{component=\"worker_requests\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"http-router\"} > on(tier, type, __tenant_id__) group_left() (14.4 * slo:max:events:gitlab_service_errors:ratio{component=\"worker_requests\",monitor=\"global\",type=\"http-router\"})),\n    \"period\", \"5m\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(2) and on () (gitlab_component_errors:ratio_1h{component=\"worker_requests\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"http-router\"} > on(tier, type, __tenant_id__) group_left() (14.4 * slo:max:events:gitlab_service_errors:ratio{component=\"worker_requests\",monitor=\"global\",type=\"http-router\"})),\n    \"period\", \"1h\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(4) and on () (gitlab_component_errors:ratio_30m{component=\"worker_requests\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"http-router\"} > on(tier, type, __tenant_id__) group_left() (6 * slo:max:events:gitlab_service_errors:ratio{component=\"worker_requests\",monitor=\"global\",type=\"http-router\"})),\n    \"period\", \"30m\", \"\", \"\"\n  )\n  or\n  label_replace(\n    vector(8) and on () (gitlab_component_errors:ratio_6h{component=\"worker_requests\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"http-router\"} > on(tier, type, __tenant_id__) group_left() (6 * slo:max:events:gitlab_service_errors:ratio{component=\"worker_requests\",monitor=\"global\",type=\"http-router\"})),\n    \"period\", \"6h\", \"\", \"\"\n  )\n)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":1,"legendFormat":"worker_requests SLI | Errors","refId":"A"}],"title":"","transparent":false,"type":"stat"},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"The operation rate is the sum total of all requests being handle for all components within this service. Note that a single user request can lead to requests to multiple components. Higher is busier.","fill":0,"fillGradient":0,"gridPos":{"h":8,"w":8,"x":8,"y":21},"id":296992239,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[{"alias":"/.*shard (apdex|error ratio|RPS)$/","color":"#E7D551"},{"alias":"worker_requests RPS","color":"#E7D551","zindex":3},{"alias":"last week","color":"#dddddd80","dashLength":4,"dashes":true,"fill":0,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":2,"zindex":-3}],"spaceLength":10,"stableId":"sli-worker_requests-ops-rate","stack":false,"steppedLine":false,"targets":[{"expr":"avg_over_time(gitlab_component_ops:rate_5m{component=\"worker_requests\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"http-router\"}[$__interval])\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"worker_requests RPS","refId":"A"},{"expr":"gitlab_component_ops:rate_5m{component=\"worker_requests\",env=\"$environment\",environment=\"$environment\",monitor=\"global\",type=\"http-router\"} offset 1w\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"last week","refId":"B"}],"title":"worker_requests SLI RPS - Requests per Second","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Operations per Second","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"content":"### Description\n\nAggregation of request that are flowing through the `http-router`.\n\nErrors on this SLI may indicate issues within the deployed `http-router`\ncodebase as errors are limited to those originating inside of the worker.\n\nSee: https://gitlab.com/gitlab-com/runbooks/-/blob/master/docs/http-router/logging.md?ref_type=heads\n\n\n\n### Observability Tools\n\n* [📖 Cloudflare Worker live logs: production-gitlab-com-cells-http-router](https://dash.cloudflare.com/852e9d53d0f8adbd9205389356f2303d/workers/services/live-logs/production-gitlab-com-cells-http-router/production)\n* [📖 Cloudflare Worker historical logs: production-gitlab-com-cells-http-router](https://dash.cloudflare.com/852e9d53d0f8adbd9205389356f2303d/workers/services/view/production-gitlab-com-cells-http-router/production/observability/logs)\n* [📖 Cloudflare Worker historical error logs: production-gitlab-com-cells-http-router](https://dash.cloudflare.com/852e9d53d0f8adbd9205389356f2303d/workers/services/view/production-gitlab-com-cells-http-router/production/observability/logs?filters=%5B%7B%22key%22%3A%22%24cloudflare.%24metadata.error%22%2C%22operation%22%3A%22EXISTS%22%2C%22type%22%3A%22string%22%2C%22id%22%3A%22%22%7D%5D)\n* [📖 Cloudflare Worker live logs: staging-gitlab-com-cells-http-router](https://dash.cloudflare.com/852e9d53d0f8adbd9205389356f2303d/workers/services/live-logs/staging-gitlab-com-cells-http-router/production)\n* [📖 Cloudflare Worker historical logs: staging-gitlab-com-cells-http-router](https://dash.cloudflare.com/852e9d53d0f8adbd9205389356f2303d/workers/services/view/staging-gitlab-com-cells-http-router/production/observability/logs)\n* [📖 Cloudflare Worker historical error logs: staging-gitlab-com-cells-http-router](https://dash.cloudflare.com/852e9d53d0f8adbd9205389356f2303d/workers/services/view/staging-gitlab-com-cells-http-router/production/observability/logs?filters=%5B%7B%22key%22%3A%22%24cloudflare.%24metadata.error%22%2C%22operation%22%3A%22EXISTS%22%2C%22type%22%3A%22string%22%2C%22id%22%3A%22%22%7D%5D)\n\n","gridPos":{"h":8,"w":8,"x":16,"y":21},"id":11,"mode":"markdown","title":"Details","type":"text"},{"collapse":true,"collapsed":true,"gridPos":{"h":10,"w":24,"x":0,"y":200},"id":12,"panels":[{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":12,"x":0,"y":0},"id":13,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by () (\n  sli_aggregations:cloudflare_worker_errors_count:rate_5m{env=\"$environment\",environment=\"$environment\"}\n)\n > 0","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"overall","refId":"A"}],"title":"worker_requests Errors - Overall","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Errors","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":12,"x":12,"y":0},"id":14,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by () (\n  sli_aggregations:cloudflare_worker_requests_count:rate_5m{env=\"$environment\",environment=\"$environment\"}\n)\n > 0","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"overall","refId":"A"}],"title":"worker_requests RPS - Overall","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Requests per Second","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":12,"x":0,"y":10},"id":15,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by (script_name) (\n  sli_aggregations:cloudflare_worker_errors_count:rate_5m{env=\"$environment\",environment=\"$environment\",script_name!=\"\"}\n)\n > 0","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{script_name}}","refId":"A"}],"title":"worker_requests Errors - per script_name","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Errors","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]},{"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":0,"description":"","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":12,"x":12,"y":10},"id":16,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"total":false,"values":true},"lines":true,"linewidth":2,"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum by (script_name) (\n  sli_aggregations:cloudflare_worker_requests_count:rate_5m{env=\"$environment\",environment=\"$environment\",script_name!=\"\"}\n)\n > 0","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{script_name}}","refId":"A"}],"title":"worker_requests RPS - per script_name","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true},"yaxes":[{"format":"short","label":"Requests per Second","logBase":1,"min":0,"show":true},{"format":"short","logBase":1,"max":1,"min":0,"show":false}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"🔬 SLI Detail: worker_requests","titleSize":"h6","type":"row"},{"collapse":true,"collapsed":true,"gridPos":{"h":1,"w":24,"x":0,"y":500},"id":17,"panels":[{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$PROMETHEUS_DS","decimals":2,"description":"Maximum HTTP Router CPU time spent on any request for the fastest 99.9% of requests.\n\nThe more time on the CPU we spend the more latency the HTTP Router is adding to every request.\nThis also has a direct impact on [cost](https://developers.cloudflare.com/workers/platform/pricing/#workers) for HTTP Router.\n\nFor profiling a worker follow https://developers.cloudflare.com/workers/observability/dev-tools/cpu-usage/\n Lower is better.","fill":0,"fillGradient":0,"gridPos":{"h":10,"w":12,"x":0,"y":0},"id":3250352017,"legend":{"alignAsTable":true,"avg":true,"current":true,"hideEmpty":true,"max":true,"min":true,"rightSide":false,"show":true,"sideWidth":null,"sort":"max","sortDesc":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[{"alias":"/^Soft SLO/","color":"#FF4500","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^Hard SLO/","color":"#F2495C","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":4,"nullPointMode":"connected","spaceLength":4,"zindex":-2},{"alias":"/aggregated /","color":"#E7D551","linewidth":2,"zindex":3},{"alias":"/^95th quantile for week/","color":"#37872D","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":1,"nullPointMode":"connected","spaceLength":10,"zindex":-2},{"alias":"/^99th quantile for week/","color":"#56A64B","dashLength":4,"dashes":true,"legend":true,"lines":true,"linewidth":2,"nullPointMode":"connected","spaceLength":4,"zindex":-2}],"spaceLength":10,"stableId":"saturation-http_router_cpu","stack":false,"steppedLine":false,"targets":[{"expr":"clamp_min(\n  clamp_max(\n    max by(environment, tier, type, stage, shard, script_name) (\n  clamp_min(\n    clamp_max(\n      max_over_time(cloudflare_worker_cpu_time{quantile=\"P999\", env=\"$environment\",environment=\"$environment\",type=\"http-router\"}[1m]) / (50 * 1000)\n      ,\n      1)\n  ,\n  0)\n)\n\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"{{ script_name }}","refId":"A"},{"expr":"clamp_min(\n  clamp_max(\n    max(\n      max_over_time(gitlab_component_saturation:ratio{env=\"$environment\",environment=\"$environment\",type=\"http-router\", component=\"http_router_cpu\"}[$__interval])\n    ) by (component)\n  ,1)\n,0)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"aggregated {{ component }}","refId":"B"},{"expr":"max(\n  gitlab_component_saturation:ratio_quantile95_1w{env=\"$environment\",environment=\"$environment\",type=\"http-router\", component=\"http_router_cpu\"}\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"95th quantile for week {{ component }}","refId":"C"},{"expr":"max(\n  gitlab_component_saturation:ratio_quantile99_1w{env=\"$environment\",environment=\"$environment\",type=\"http-router\", component=\"http_router_cpu\"}\n)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"99th quantile for week {{ component }}","refId":"D"},{"expr":"avg(slo:max:soft:gitlab_component_saturation:ratio{component=\"http_router_cpu\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"Soft SLO: {{ component }}","refId":"E"},{"expr":"avg(slo:max:hard:gitlab_component_saturation:ratio{component=\"http_router_cpu\"}) by (component)\n","format":"time_series","interval":"1m","intervalFactor":1,"legendFormat":"Hard SLO: {{ component }}","refId":"F"}],"thresholds":[],"timeFrom":null,"timeShift":null,"title":"http_router_cpu component saturation: HTTP Router CPU P999 Budget","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"percentunit","label":"Saturation %","logBase":1,"max":1,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":1,"min":0,"show":false}]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"🌡 Saturation Details","titleSize":"h6","type":"row"},{"collapse":true,"collapsed":true,"gridPos":{"x":0,"y":100010},"id":19,"panels":[{"colors":["rgba(50, 172, 45, 0.97)","rgba(237, 129, 40, 0.89)","rgba(245, 54, 54, 0.9)"],"composites":[],"datasource":"$PROMETHEUS_DS","decimals":3,"format":"percentunit","graphId":"diagram_errors","gridPos":{"h":10,"w":24,"x":0,"y":0},"id":20,"init":{"arrowMarkerAbsolute":true,"cloneCssStyles":true,"flowchart":{"htmlLabels":true,"useMaxWidth":true},"gantt":{"barGap":4,"barHeight":20,"fontFamily":"\"Open-Sans\", \"sans-serif\"","fontSize":11,"gridLineStartPadding":35,"leftPadding":75,"numberSectionStyles":3,"titleTopMargin":25,"topPadding":50},"logLevel":3,"sequenceDiagram":{"actorMargin":50,"bottomMarginAdj":1,"boxMargin":10,"boxTextMargin":5,"diagramMarginX":50,"diagramMarginY":10,"height":65,"messageMargin":35,"mirrorActors":true,"noteMargin":10,"useMaxWidth":true,"width":150},"startOnLoad":false},"interval":"","legend":{"avg":true,"current":true,"gradient":{"enabled":true,"show":true},"max":true,"min":true,"show":false,"total":true},"mappingType":1,"mappingTypes":[],"maxDataPoints":100,"maxWidth":false,"mermaidServiceUrl":"","metricCharacterReplacements":[],"moddedSeriesVal":0,"mode":"content","nullPointMode":"connected","options":{"content":"graph TD\n  subgraph db\n  patroni\n  pgbouncer\n  redis\n  redis-cluster-cache\n  redis-cluster-chat-cache\n  redis-cluster-feature-flag\n  redis-cluster-queues-meta\n  redis-cluster-ratelimiting\n  redis-cluster-repo-cache\n  redis-cluster-shared-state\n  redis-db-load-balancing\n  redis-pubsub\n  redis-registry-cache\n  redis-sessions\n  redis-sidekiq\n  redis-tracechunks\nend\n\nsubgraph inf\n  nat\n  search\n  zoekt\nend\n\nsubgraph lb\n  frontend\n  http-router\nend\n\nsubgraph stor\n  gitaly\n  google-cloud-storage\nend\n\nsubgraph sv\n  api\n  consul\n  ext-pvs\n  git\n  kas\n  registry\n  web\nend\n\n\n  api --> consul\napi --> ext-pvs\napi --> gitaly\napi --> google-cloud-storage\napi --> kas\napi --> patroni\napi --> pgbouncer\napi --> redis\napi --> redis-cluster-cache\napi --> redis-cluster-chat-cache\napi --> redis-cluster-feature-flag\napi --> redis-cluster-queues-meta\napi --> redis-cluster-ratelimiting\napi --> redis-cluster-repo-cache\napi --> redis-cluster-shared-state\napi --> redis-pubsub\napi --> redis-sessions\napi --> redis-sidekiq\napi --> redis-tracechunks\napi --> search\napi --> zoekt\nfrontend --> api\nfrontend --> git\nfrontend --> registry\nfrontend --> web\ngit --> consul\ngit --> ext-pvs\ngit --> gitaly\ngit --> google-cloud-storage\ngit --> patroni\ngit --> pgbouncer\ngit --> redis\ngit --> redis-cluster-cache\ngit --> redis-sidekiq\ngitaly --> gitaly\nhttp-router --> frontend\nhttp-router --> nat\nkas --> api\nkas --> gitaly\nkas --> kas\nkas --> redis\nnat --> frontend\npgbouncer --> patroni\nregistry --> api\nregistry --> redis-registry-cache\nweb --> consul\nweb --> ext-pvs\nweb --> gitaly\nweb --> google-cloud-storage\nweb --> patroni\nweb --> pgbouncer\nweb --> redis\nweb --> redis-cluster-cache\nweb --> redis-cluster-chat-cache\nweb --> redis-cluster-feature-flag\nweb --> redis-cluster-queues-meta\nweb --> redis-cluster-ratelimiting\nweb --> redis-cluster-repo-cache\nweb --> redis-cluster-shared-state\nweb --> redis-db-load-balancing\nweb --> redis-pubsub\nweb --> redis-sessions\nweb --> redis-sidekiq\nweb --> search\nweb --> zoekt\n"},"seriesOverrides":[],"style":"","targets":[{"expr":"clamp_max(\n  max_over_time(gitlab_service_errors:ratio_5m{environment=\"$environment\",monitor=\"global\",stage=\"$stage\"}[$__range])\n,\n  1\n)\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":1,"legendFormat":"{{ type }}"}],"thresholds":"0,0.001","title":"System Diagram (Keyed by Error Rates)","type":"jdbranham-diagram-panel","valueMaps":[],"valueName":"current","valueOptions":["avg","min","max","total","current"]},{"colors":["rgba(245, 54, 54, 0.9)","#FF9830","#73BF69"],"composites":[],"datasource":"$PROMETHEUS_DS","decimals":3,"format":"percentunit","graphId":"diagram_apdex","gridPos":{"h":10,"w":24,"x":0,"y":10},"id":21,"init":{"arrowMarkerAbsolute":true,"cloneCssStyles":true,"flowchart":{"htmlLabels":true,"useMaxWidth":true},"gantt":{"barGap":4,"barHeight":20,"fontFamily":"\"Open-Sans\", \"sans-serif\"","fontSize":11,"gridLineStartPadding":35,"leftPadding":75,"numberSectionStyles":3,"titleTopMargin":25,"topPadding":50},"logLevel":3,"sequenceDiagram":{"actorMargin":50,"bottomMarginAdj":1,"boxMargin":10,"boxTextMargin":5,"diagramMarginX":50,"diagramMarginY":10,"height":65,"messageMargin":35,"mirrorActors":true,"noteMargin":10,"useMaxWidth":true,"width":150},"startOnLoad":false},"interval":"","legend":{"avg":true,"current":true,"gradient":{"enabled":true,"show":true},"max":true,"min":true,"show":false,"total":true},"mappingType":1,"mappingTypes":[],"maxDataPoints":100,"maxWidth":false,"mermaidServiceUrl":"","metricCharacterReplacements":[],"moddedSeriesVal":0,"mode":"content","nullPointMode":"connected","options":{"content":"graph TD\n  subgraph db\n  patroni\n  pgbouncer\n  redis\n  redis-cluster-cache\n  redis-cluster-chat-cache\n  redis-cluster-feature-flag\n  redis-cluster-queues-meta\n  redis-cluster-ratelimiting\n  redis-cluster-repo-cache\n  redis-cluster-shared-state\n  redis-db-load-balancing\n  redis-pubsub\n  redis-registry-cache\n  redis-sessions\n  redis-sidekiq\n  redis-tracechunks\nend\n\nsubgraph inf\n  nat\n  search\n  zoekt\nend\n\nsubgraph lb\n  frontend\n  http-router\nend\n\nsubgraph stor\n  gitaly\n  google-cloud-storage\nend\n\nsubgraph sv\n  api\n  consul\n  ext-pvs\n  git\n  kas\n  registry\n  web\nend\n\n\n  api --> consul\napi --> ext-pvs\napi --> gitaly\napi --> google-cloud-storage\napi --> kas\napi --> patroni\napi --> pgbouncer\napi --> redis\napi --> redis-cluster-cache\napi --> redis-cluster-chat-cache\napi --> redis-cluster-feature-flag\napi --> redis-cluster-queues-meta\napi --> redis-cluster-ratelimiting\napi --> redis-cluster-repo-cache\napi --> redis-cluster-shared-state\napi --> redis-pubsub\napi --> redis-sessions\napi --> redis-sidekiq\napi --> redis-tracechunks\napi --> search\napi --> zoekt\nfrontend --> api\nfrontend --> git\nfrontend --> registry\nfrontend --> web\ngit --> consul\ngit --> ext-pvs\ngit --> gitaly\ngit --> google-cloud-storage\ngit --> patroni\ngit --> pgbouncer\ngit --> redis\ngit --> redis-cluster-cache\ngit --> redis-sidekiq\ngitaly --> gitaly\nhttp-router --> frontend\nhttp-router --> nat\nkas --> api\nkas --> gitaly\nkas --> kas\nkas --> redis\nnat --> frontend\npgbouncer --> patroni\nregistry --> api\nregistry --> redis-registry-cache\nweb --> consul\nweb --> ext-pvs\nweb --> gitaly\nweb --> google-cloud-storage\nweb --> patroni\nweb --> pgbouncer\nweb --> redis\nweb --> redis-cluster-cache\nweb --> redis-cluster-chat-cache\nweb --> redis-cluster-feature-flag\nweb --> redis-cluster-queues-meta\nweb --> redis-cluster-ratelimiting\nweb --> redis-cluster-repo-cache\nweb --> redis-cluster-shared-state\nweb --> redis-db-load-balancing\nweb --> redis-pubsub\nweb --> redis-sessions\nweb --> redis-sidekiq\nweb --> search\nweb --> zoekt\n"},"seriesOverrides":[],"style":"","targets":[{"expr":"min_over_time(gitlab_service_apdex:ratio_5m{environment=\"$environment\",monitor=\"global\",stage=\"$stage\"}[$__range])\n","format":"time_series","instant":true,"interval":"1m","intervalFactor":1,"legendFormat":"{{ type }}"}],"thresholds":"0.99,0.995,0.999","title":"System Diagram (Keyed by Apdex/Latency Scores)","type":"jdbranham-diagram-panel","valueMaps":[],"valueName":"current","valueOptions":["avg","min","max","total","current"]},{"colors":[],"composites":[],"datasource":"$PROMETHEUS_DS","decimals":3,"format":"percentunit","graphId":"diagram_maturity","gridPos":{"h":10,"w":24,"x":0,"y":20},"id":22,"init":{"arrowMarkerAbsolute":true,"cloneCssStyles":true,"flowchart":{"htmlLabels":true,"useMaxWidth":true},"gantt":{"barGap":4,"barHeight":20,"fontFamily":"\"Open-Sans\", \"sans-serif\"","fontSize":11,"gridLineStartPadding":35,"leftPadding":75,"numberSectionStyles":3,"titleTopMargin":25,"topPadding":50},"logLevel":3,"sequenceDiagram":{"actorMargin":50,"bottomMarginAdj":1,"boxMargin":10,"boxTextMargin":5,"diagramMarginX":50,"diagramMarginY":10,"height":65,"messageMargin":35,"mirrorActors":true,"noteMargin":10,"useMaxWidth":true,"width":150},"startOnLoad":false},"interval":"","legend":{"avg":true,"current":true,"gradient":{"enabled":true,"show":true},"max":true,"min":true,"show":false,"total":true},"mappingType":1,"mappingTypes":[],"maxDataPoints":100,"maxWidth":false,"mermaidServiceUrl":"","metricCharacterReplacements":[],"moddedSeriesVal":0,"mode":"content","nullPointMode":"connected","options":{"content":"graph TD\n  subgraph db\n  patroni[\"patroni (Level 2)\"]\n  pgbouncer[\"pgbouncer (Level 1)\"]\n  redis-cluster-cache[\"redis-cluster-cache (Level 2)\"]\n  redis-cluster-chat-cache[\"redis-cluster-chat-cache (Level 2)\"]\n  redis-cluster-feature-flag[\"redis-cluster-feature-flag (Level 2)\"]\n  redis-cluster-queues-meta[\"redis-cluster-queues-meta (Level 2)\"]\n  redis-cluster-ratelimiting[\"redis-cluster-ratelimiting (Level 2)\"]\n  redis-cluster-repo-cache[\"redis-cluster-repo-cache (Level 2)\"]\n  redis-cluster-shared-state[\"redis-cluster-shared-state (Level 2)\"]\n  redis-db-load-balancing[\"redis-db-load-balancing (Level 2)\"]\n  redis-pubsub[\"redis-pubsub (Level 2)\"]\n  redis-registry-cache[\"redis-registry-cache (Level 2)\"]\n  redis-sessions[\"redis-sessions (Level 3)\"]\n  redis-sidekiq[\"redis-sidekiq (Level 3)\"]\n  redis-tracechunks[\"redis-tracechunks (Level 3)\"]\n  redis[\"redis (Level 3)\"]\nend\n\nsubgraph inf\n  nat[\"nat (Level 1)\"]\n  search[\"search (Level 1)\"]\n  zoekt[\"zoekt (Level 1)\"]\nend\n\nsubgraph lb\n  frontend[\"frontend (Level 1)\"]\n  http-router[\"http-router (Level 1)\"]\nend\n\nsubgraph stor\n  gitaly[\"gitaly (Level 3)\"]\n  google-cloud-storage[\"google-cloud-storage (Level 2)\"]\nend\n\nsubgraph sv\n  api[\"api (Level 2)\"]\n  consul[\"consul (Level 1)\"]\n  ext-pvs[\"ext-pvs (Level 2)\"]\n  git[\"git (Level 2)\"]\n  kas[\"kas (Level 3)\"]\n  registry[\"registry (Level 2)\"]\n  web[\"web (Level 2)\"]\nend\n\n\n  api[\"api (Level 2)\"] --> consul\napi[\"api (Level 2)\"] --> ext-pvs\napi[\"api (Level 2)\"] --> gitaly\napi[\"api (Level 2)\"] --> google-cloud-storage\napi[\"api (Level 2)\"] --> kas\napi[\"api (Level 2)\"] --> patroni\napi[\"api (Level 2)\"] --> pgbouncer\napi[\"api (Level 2)\"] --> redis\napi[\"api (Level 2)\"] --> redis-cluster-cache\napi[\"api (Level 2)\"] --> redis-cluster-chat-cache\napi[\"api (Level 2)\"] --> redis-cluster-feature-flag\napi[\"api (Level 2)\"] --> redis-cluster-queues-meta\napi[\"api (Level 2)\"] --> redis-cluster-ratelimiting\napi[\"api (Level 2)\"] --> redis-cluster-repo-cache\napi[\"api (Level 2)\"] --> redis-cluster-shared-state\napi[\"api (Level 2)\"] --> redis-pubsub\napi[\"api (Level 2)\"] --> redis-sessions\napi[\"api (Level 2)\"] --> redis-sidekiq\napi[\"api (Level 2)\"] --> redis-tracechunks\napi[\"api (Level 2)\"] --> search\napi[\"api (Level 2)\"] --> zoekt\nfrontend[\"frontend (Level 1)\"] --> api\nfrontend[\"frontend (Level 1)\"] --> git\nfrontend[\"frontend (Level 1)\"] --> registry\nfrontend[\"frontend (Level 1)\"] --> web\ngit[\"git (Level 2)\"] --> consul\ngit[\"git (Level 2)\"] --> ext-pvs\ngit[\"git (Level 2)\"] --> gitaly\ngit[\"git (Level 2)\"] --> google-cloud-storage\ngit[\"git (Level 2)\"] --> patroni\ngit[\"git (Level 2)\"] --> pgbouncer\ngit[\"git (Level 2)\"] --> redis\ngit[\"git (Level 2)\"] --> redis-cluster-cache\ngit[\"git (Level 2)\"] --> redis-sidekiq\ngitaly[\"gitaly (Level 3)\"] --> gitaly\nhttp-router[\"http-router (Level 1)\"] --> frontend\nhttp-router[\"http-router (Level 1)\"] --> nat\nkas[\"kas (Level 3)\"] --> api\nkas[\"kas (Level 3)\"] --> gitaly\nkas[\"kas (Level 3)\"] --> kas\nkas[\"kas (Level 3)\"] --> redis\nnat[\"nat (Level 1)\"] --> frontend\npgbouncer[\"pgbouncer (Level 1)\"] --> patroni\nregistry[\"registry (Level 2)\"] --> api\nregistry[\"registry (Level 2)\"] --> redis-registry-cache\nweb[\"web (Level 2)\"] --> consul\nweb[\"web (Level 2)\"] --> ext-pvs\nweb[\"web (Level 2)\"] --> gitaly\nweb[\"web (Level 2)\"] --> google-cloud-storage\nweb[\"web (Level 2)\"] --> patroni\nweb[\"web (Level 2)\"] --> pgbouncer\nweb[\"web (Level 2)\"] --> redis\nweb[\"web (Level 2)\"] --> redis-cluster-cache\nweb[\"web (Level 2)\"] --> redis-cluster-chat-cache\nweb[\"web (Level 2)\"] --> redis-cluster-feature-flag\nweb[\"web (Level 2)\"] --> redis-cluster-queues-meta\nweb[\"web (Level 2)\"] --> redis-cluster-ratelimiting\nweb[\"web (Level 2)\"] --> redis-cluster-repo-cache\nweb[\"web (Level 2)\"] --> redis-cluster-shared-state\nweb[\"web (Level 2)\"] --> redis-db-load-balancing\nweb[\"web (Level 2)\"] --> redis-pubsub\nweb[\"web (Level 2)\"] --> redis-sessions\nweb[\"web (Level 2)\"] --> redis-sidekiq\nweb[\"web (Level 2)\"] --> search\nweb[\"web (Level 2)\"] --> zoekt\n"},"seriesOverrides":[],"style":"","targets":[],"thresholds":"","title":"System Diagram (Keyed by Maturity Model)","type":"jdbranham-diagram-panel","valueMaps":[],"valueName":"current","valueOptions":["avg","min","max","total","current"]}],"repeat":null,"repeatIteration":null,"repeatRowId":null,"showTitle":true,"title":"🗺️ System Diagrams","titleSize":"h6","type":"row"},{"content":"Made with ❤️ and [Grafonnet](https://github.com/grafana/grafonnet-lib). [Contribute to this dashboard on GitLab.com](https://gitlab.com/gitlab-com/runbooks/blob/master/dashboards)\n","datasource":null,"gridPos":{"h":2,"w":24,"x":0,"y":110000},"id":23,"mode":"markdown","title":"Source","type":"text"}],"refresh":"","rows":[],"schemaVersion":16,"style":"light","tags":["managed","http-router","gitlab","type:http-router","http-router","service overview"],"templating":{"list":[{"current":{"text":"Mimir - Gitlab Ops","value":"Mimir - Gitlab Ops"},"hide":0,"label":null,"name":"PROMETHEUS_DS","options":[],"query":"prometheus","refresh":1,"regex":"","type":"datasource"},{"allValue":null,"current":{"text":"gprd","value":"gprd"},"datasource":"$PROMETHEUS_DS","hide":0,"includeAll":false,"label":null,"multi":false,"name":"environment","options":[],"query":"label_values(gitlab_service_ops:rate_1h, environment)","refresh":1,"regex":"","sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false}]},"time":{"from":"now-6h/m","to":"now/m"},"timepicker":{"refresh_intervals":["1m","5m","10m","15m","30m"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"utc","title":"http-router: Overview","version":0,"uid":"http-router-main","description":"Uploaded by https://gitlab.com/gitlab-com/runbooks/-/jobs/8397766929 at Mon Nov 18 09:15:46 UTC 2024"}
