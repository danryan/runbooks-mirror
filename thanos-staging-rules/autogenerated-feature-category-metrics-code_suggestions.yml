---
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: autogenerated-feature-category-metrics-code-suggestions
  labels:
    ruler: thanos
    shard: '0'
  annotations: {}
spec:
  groups:
  - name: 'Prometheus Intermediate Metrics per feature: code_suggestions - burn-rate
      5m'
    interval: 1m
    partial_response_strategy: warn
    rules:
    - record: gitlab:component:feature_category:execution:apdex:success:rate_5m
      labels:
        component: ingress
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        (
          sum by (env,environment) (
            rate(nginx_ingress_controller_request_duration_seconds_bucket{container="controller",le="2.5",path!="/",status!~"4.*|5.*",type="code_suggestions"}[5m])
          )
          +
          sum by (env,environment) (
            rate(nginx_ingress_controller_request_duration_seconds_bucket{container="controller",le="10",path!="/",status!~"4.*|5.*",type="code_suggestions"}[5m])
          )
        )
        /
        2
    - record: gitlab:component:feature_category:execution:apdex:weight:score_5m
      labels:
        component: ingress
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        sum by (env,environment) (
          rate(nginx_ingress_controller_request_duration_seconds_bucket{container="controller",le="+Inf",path!="/",status!~"4.*|5.*",type="code_suggestions"}[5m])
        )
    - record: gitlab:component:feature_category:execution:ops:rate_5m
      labels:
        component: ingress
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        sum by (env,environment) (
          rate(nginx_ingress_controller_requests{container="controller",path!="/",type="code_suggestions"}[5m])
        )
    - record: gitlab:component:feature_category:execution:error:rate_5m
      labels:
        component: ingress
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        (
          sum by (env,environment) (
            rate(nginx_ingress_controller_requests{container="controller",path!="/",status=~"^5.*",type="code_suggestions"}[5m])
          )
        )
        or
        (
          0 * group by(env,environment) (
            gitlab:component:feature_category:execution:ops:rate_5m{component="ingress",feature_category="code_suggestions",stage="main",tier="sv",type="code_suggestions"}
          )
        )
    - record: gitlab:component:feature_category:execution:apdex:success:rate_5m
      labels:
        component: model_gateway
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        (
          sum by (env,environment) (
            rate(http_request_duration_seconds_bucket{container="model-gateway",le="2.5",status!~"4xx|5xx",type="code_suggestions"}[5m])
          )
          +
          sum by (env,environment) (
            rate(http_request_duration_seconds_bucket{container="model-gateway",le="10.0",status!~"4xx|5xx",type="code_suggestions"}[5m])
          )
        )
        /
        2
    - record: gitlab:component:feature_category:execution:apdex:weight:score_5m
      labels:
        component: model_gateway
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        sum by (env,environment) (
          rate(http_request_duration_seconds_bucket{container="model-gateway",le="+Inf",status!~"4xx|5xx",type="code_suggestions"}[5m])
        )
    - record: gitlab:component:feature_category:execution:ops:rate_5m
      labels:
        component: model_gateway
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        sum by (env,environment) (
          rate(http_request_duration_seconds_count{container="model-gateway",type="code_suggestions"}[5m])
        )
    - record: gitlab:component:feature_category:execution:error:rate_5m
      labels:
        component: model_gateway
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        (
          sum by (env,environment) (
            rate(http_request_duration_seconds_count{container="model-gateway",status="5xx",type="code_suggestions"}[5m])
          )
        )
        or
        (
          0 * group by(env,environment) (
            gitlab:component:feature_category:execution:ops:rate_5m{component="model_gateway",feature_category="code_suggestions",stage="main",tier="sv",type="code_suggestions"}
          )
        )
    - record: gitlab:component:feature_category:execution:apdex:success:rate_5m
      labels:
        component: native_model_inference
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        (
          sum by (env,environment) (
            rate(code_suggestions_inference_request_duration_seconds_bucket{container="model-gateway",le="5.0",model_engine="codegen",type="code_suggestions"}[5m])
          )
          +
          sum by (env,environment) (
            rate(code_suggestions_inference_request_duration_seconds_bucket{container="model-gateway",le="10.0",model_engine="codegen",type="code_suggestions"}[5m])
          )
        )
        /
        2
    - record: gitlab:component:feature_category:execution:apdex:weight:score_5m
      labels:
        component: native_model_inference
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        sum by (env,environment) (
          rate(code_suggestions_inference_request_duration_seconds_bucket{container="model-gateway",le="+Inf",model_engine="codegen",type="code_suggestions"}[5m])
        )
    - record: gitlab:component:feature_category:execution:ops:rate_5m
      labels:
        component: native_model_inference
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        sum by (env,environment) (
          rate(code_suggestions_inference_requests_total{container="model-gateway",model_engine="codegen",type="code_suggestions"}[5m])
        )
    - record: gitlab:component:feature_category:execution:apdex:success:rate_5m
      labels:
        component: third_party_model_inference
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        (
          sum by (env,environment) (
            rate(code_suggestions_inference_request_duration_seconds_bucket{container="model-gateway",le="5.0",model_engine!="codegen",type="code_suggestions"}[5m])
          )
          +
          sum by (env,environment) (
            rate(code_suggestions_inference_request_duration_seconds_bucket{container="model-gateway",le="10.0",model_engine!="codegen",type="code_suggestions"}[5m])
          )
        )
        /
        2
    - record: gitlab:component:feature_category:execution:apdex:weight:score_5m
      labels:
        component: third_party_model_inference
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        sum by (env,environment) (
          rate(code_suggestions_inference_request_duration_seconds_bucket{container="model-gateway",le="+Inf",model_engine!="codegen",type="code_suggestions"}[5m])
        )
    - record: gitlab:component:feature_category:execution:ops:rate_5m
      labels:
        component: third_party_model_inference
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        sum by (env,environment) (
          rate(code_suggestions_inference_requests_total{container="model-gateway",model_engine!="codegen",type="code_suggestions"}[5m])
        )
    - record: gitlab:component:feature_category:execution:ops:rate_5m
      labels:
        component: triton_server
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        sum by (env,environment) (
          rate(nv_inference_count{container="triton",type="code_suggestions"}[5m])
        )
    - record: gitlab:component:feature_category:execution:error:rate_5m
      labels:
        component: triton_server
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        (
          sum by (env,environment) (
            rate(nv_inference_request_failure{container="triton",type="code_suggestions"}[5m])
          )
        )
        or
        (
          0 * group by(env,environment) (
            gitlab:component:feature_category:execution:ops:rate_5m{component="triton_server",feature_category="code_suggestions",stage="main",tier="sv",type="code_suggestions"}
          )
        )
    - record: gitlab:component:feature_category:execution:ops:rate_5m
      labels:
        component: waf
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        sum by (env,environment) (
          rate(cloudflare_zone_requests_status_country_host{host=~"codesuggestions.gitlab.com.*",zone="gitlab.com"}[5m])
        )
    - record: gitlab:component:feature_category:execution:error:rate_5m
      labels:
        component: waf
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        (
          sum by (env,environment) (
            rate(cloudflare_zone_requests_status_country_host{host=~"codesuggestions.gitlab.com.*",status=~"^5.*",zone="gitlab.com"}[5m])
          )
        )
        or
        (
          0 * group by(env,environment) (
            gitlab:component:feature_category:execution:ops:rate_5m{component="waf",feature_category="code_suggestions",stage="main",tier="sv",type="code_suggestions"}
          )
        )
  - name: 'Prometheus Intermediate Metrics per feature: code_suggestions - burn-rate
      30m'
    interval: 2m
    partial_response_strategy: warn
    rules:
    - record: gitlab:component:feature_category:execution:apdex:success:rate_30m
      labels:
        component: ingress
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        (
          sum by (env,environment) (
            rate(nginx_ingress_controller_request_duration_seconds_bucket{container="controller",le="2.5",path!="/",status!~"4.*|5.*",type="code_suggestions"}[30m])
          )
          +
          sum by (env,environment) (
            rate(nginx_ingress_controller_request_duration_seconds_bucket{container="controller",le="10",path!="/",status!~"4.*|5.*",type="code_suggestions"}[30m])
          )
        )
        /
        2
    - record: gitlab:component:feature_category:execution:apdex:weight:score_30m
      labels:
        component: ingress
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        sum by (env,environment) (
          rate(nginx_ingress_controller_request_duration_seconds_bucket{container="controller",le="+Inf",path!="/",status!~"4.*|5.*",type="code_suggestions"}[30m])
        )
    - record: gitlab:component:feature_category:execution:ops:rate_30m
      labels:
        component: ingress
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        sum by (env,environment) (
          rate(nginx_ingress_controller_requests{container="controller",path!="/",type="code_suggestions"}[30m])
        )
    - record: gitlab:component:feature_category:execution:error:rate_30m
      labels:
        component: ingress
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        (
          sum by (env,environment) (
            rate(nginx_ingress_controller_requests{container="controller",path!="/",status=~"^5.*",type="code_suggestions"}[30m])
          )
        )
        or
        (
          0 * group by(env,environment) (
            gitlab:component:feature_category:execution:ops:rate_30m{component="ingress",feature_category="code_suggestions",stage="main",tier="sv",type="code_suggestions"}
          )
        )
    - record: gitlab:component:feature_category:execution:apdex:success:rate_30m
      labels:
        component: model_gateway
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        (
          sum by (env,environment) (
            rate(http_request_duration_seconds_bucket{container="model-gateway",le="2.5",status!~"4xx|5xx",type="code_suggestions"}[30m])
          )
          +
          sum by (env,environment) (
            rate(http_request_duration_seconds_bucket{container="model-gateway",le="10.0",status!~"4xx|5xx",type="code_suggestions"}[30m])
          )
        )
        /
        2
    - record: gitlab:component:feature_category:execution:apdex:weight:score_30m
      labels:
        component: model_gateway
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        sum by (env,environment) (
          rate(http_request_duration_seconds_bucket{container="model-gateway",le="+Inf",status!~"4xx|5xx",type="code_suggestions"}[30m])
        )
    - record: gitlab:component:feature_category:execution:ops:rate_30m
      labels:
        component: model_gateway
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        sum by (env,environment) (
          rate(http_request_duration_seconds_count{container="model-gateway",type="code_suggestions"}[30m])
        )
    - record: gitlab:component:feature_category:execution:error:rate_30m
      labels:
        component: model_gateway
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        (
          sum by (env,environment) (
            rate(http_request_duration_seconds_count{container="model-gateway",status="5xx",type="code_suggestions"}[30m])
          )
        )
        or
        (
          0 * group by(env,environment) (
            gitlab:component:feature_category:execution:ops:rate_30m{component="model_gateway",feature_category="code_suggestions",stage="main",tier="sv",type="code_suggestions"}
          )
        )
    - record: gitlab:component:feature_category:execution:apdex:success:rate_30m
      labels:
        component: native_model_inference
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        (
          sum by (env,environment) (
            rate(code_suggestions_inference_request_duration_seconds_bucket{container="model-gateway",le="5.0",model_engine="codegen",type="code_suggestions"}[30m])
          )
          +
          sum by (env,environment) (
            rate(code_suggestions_inference_request_duration_seconds_bucket{container="model-gateway",le="10.0",model_engine="codegen",type="code_suggestions"}[30m])
          )
        )
        /
        2
    - record: gitlab:component:feature_category:execution:apdex:weight:score_30m
      labels:
        component: native_model_inference
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        sum by (env,environment) (
          rate(code_suggestions_inference_request_duration_seconds_bucket{container="model-gateway",le="+Inf",model_engine="codegen",type="code_suggestions"}[30m])
        )
    - record: gitlab:component:feature_category:execution:ops:rate_30m
      labels:
        component: native_model_inference
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        sum by (env,environment) (
          rate(code_suggestions_inference_requests_total{container="model-gateway",model_engine="codegen",type="code_suggestions"}[30m])
        )
    - record: gitlab:component:feature_category:execution:apdex:success:rate_30m
      labels:
        component: third_party_model_inference
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        (
          sum by (env,environment) (
            rate(code_suggestions_inference_request_duration_seconds_bucket{container="model-gateway",le="5.0",model_engine!="codegen",type="code_suggestions"}[30m])
          )
          +
          sum by (env,environment) (
            rate(code_suggestions_inference_request_duration_seconds_bucket{container="model-gateway",le="10.0",model_engine!="codegen",type="code_suggestions"}[30m])
          )
        )
        /
        2
    - record: gitlab:component:feature_category:execution:apdex:weight:score_30m
      labels:
        component: third_party_model_inference
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        sum by (env,environment) (
          rate(code_suggestions_inference_request_duration_seconds_bucket{container="model-gateway",le="+Inf",model_engine!="codegen",type="code_suggestions"}[30m])
        )
    - record: gitlab:component:feature_category:execution:ops:rate_30m
      labels:
        component: third_party_model_inference
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        sum by (env,environment) (
          rate(code_suggestions_inference_requests_total{container="model-gateway",model_engine!="codegen",type="code_suggestions"}[30m])
        )
    - record: gitlab:component:feature_category:execution:ops:rate_30m
      labels:
        component: triton_server
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        sum by (env,environment) (
          rate(nv_inference_count{container="triton",type="code_suggestions"}[30m])
        )
    - record: gitlab:component:feature_category:execution:error:rate_30m
      labels:
        component: triton_server
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        (
          sum by (env,environment) (
            rate(nv_inference_request_failure{container="triton",type="code_suggestions"}[30m])
          )
        )
        or
        (
          0 * group by(env,environment) (
            gitlab:component:feature_category:execution:ops:rate_30m{component="triton_server",feature_category="code_suggestions",stage="main",tier="sv",type="code_suggestions"}
          )
        )
    - record: gitlab:component:feature_category:execution:ops:rate_30m
      labels:
        component: waf
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        sum by (env,environment) (
          rate(cloudflare_zone_requests_status_country_host{host=~"codesuggestions.gitlab.com.*",zone="gitlab.com"}[30m])
        )
    - record: gitlab:component:feature_category:execution:error:rate_30m
      labels:
        component: waf
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        (
          sum by (env,environment) (
            rate(cloudflare_zone_requests_status_country_host{host=~"codesuggestions.gitlab.com.*",status=~"^5.*",zone="gitlab.com"}[30m])
          )
        )
        or
        (
          0 * group by(env,environment) (
            gitlab:component:feature_category:execution:ops:rate_30m{component="waf",feature_category="code_suggestions",stage="main",tier="sv",type="code_suggestions"}
          )
        )
  - name: 'Prometheus Intermediate Metrics per feature: code_suggestions - burn-rate
      1h'
    interval: 1m
    partial_response_strategy: warn
    rules:
    - record: gitlab:component:feature_category:execution:apdex:success:rate_1h
      labels:
        component: ingress
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        (
          sum by (env,environment) (
            rate(nginx_ingress_controller_request_duration_seconds_bucket{container="controller",le="2.5",path!="/",status!~"4.*|5.*",type="code_suggestions"}[1h])
          )
          +
          sum by (env,environment) (
            rate(nginx_ingress_controller_request_duration_seconds_bucket{container="controller",le="10",path!="/",status!~"4.*|5.*",type="code_suggestions"}[1h])
          )
        )
        /
        2
    - record: gitlab:component:feature_category:execution:apdex:weight:score_1h
      labels:
        component: ingress
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        sum by (env,environment) (
          rate(nginx_ingress_controller_request_duration_seconds_bucket{container="controller",le="+Inf",path!="/",status!~"4.*|5.*",type="code_suggestions"}[1h])
        )
    - record: gitlab:component:feature_category:execution:ops:rate_1h
      labels:
        component: ingress
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        sum by (env,environment) (
          rate(nginx_ingress_controller_requests{container="controller",path!="/",type="code_suggestions"}[1h])
        )
    - record: gitlab:component:feature_category:execution:error:rate_1h
      labels:
        component: ingress
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        (
          sum by (env,environment) (
            rate(nginx_ingress_controller_requests{container="controller",path!="/",status=~"^5.*",type="code_suggestions"}[1h])
          )
        )
        or
        (
          0 * group by(env,environment) (
            gitlab:component:feature_category:execution:ops:rate_1h{component="ingress",feature_category="code_suggestions",stage="main",tier="sv",type="code_suggestions"}
          )
        )
    - record: gitlab:component:feature_category:execution:apdex:success:rate_1h
      labels:
        component: model_gateway
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        (
          sum by (env,environment) (
            rate(http_request_duration_seconds_bucket{container="model-gateway",le="2.5",status!~"4xx|5xx",type="code_suggestions"}[1h])
          )
          +
          sum by (env,environment) (
            rate(http_request_duration_seconds_bucket{container="model-gateway",le="10.0",status!~"4xx|5xx",type="code_suggestions"}[1h])
          )
        )
        /
        2
    - record: gitlab:component:feature_category:execution:apdex:weight:score_1h
      labels:
        component: model_gateway
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        sum by (env,environment) (
          rate(http_request_duration_seconds_bucket{container="model-gateway",le="+Inf",status!~"4xx|5xx",type="code_suggestions"}[1h])
        )
    - record: gitlab:component:feature_category:execution:ops:rate_1h
      labels:
        component: model_gateway
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        sum by (env,environment) (
          rate(http_request_duration_seconds_count{container="model-gateway",type="code_suggestions"}[1h])
        )
    - record: gitlab:component:feature_category:execution:error:rate_1h
      labels:
        component: model_gateway
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        (
          sum by (env,environment) (
            rate(http_request_duration_seconds_count{container="model-gateway",status="5xx",type="code_suggestions"}[1h])
          )
        )
        or
        (
          0 * group by(env,environment) (
            gitlab:component:feature_category:execution:ops:rate_1h{component="model_gateway",feature_category="code_suggestions",stage="main",tier="sv",type="code_suggestions"}
          )
        )
    - record: gitlab:component:feature_category:execution:apdex:success:rate_1h
      labels:
        component: native_model_inference
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        (
          sum by (env,environment) (
            rate(code_suggestions_inference_request_duration_seconds_bucket{container="model-gateway",le="5.0",model_engine="codegen",type="code_suggestions"}[1h])
          )
          +
          sum by (env,environment) (
            rate(code_suggestions_inference_request_duration_seconds_bucket{container="model-gateway",le="10.0",model_engine="codegen",type="code_suggestions"}[1h])
          )
        )
        /
        2
    - record: gitlab:component:feature_category:execution:apdex:weight:score_1h
      labels:
        component: native_model_inference
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        sum by (env,environment) (
          rate(code_suggestions_inference_request_duration_seconds_bucket{container="model-gateway",le="+Inf",model_engine="codegen",type="code_suggestions"}[1h])
        )
    - record: gitlab:component:feature_category:execution:ops:rate_1h
      labels:
        component: native_model_inference
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        sum by (env,environment) (
          rate(code_suggestions_inference_requests_total{container="model-gateway",model_engine="codegen",type="code_suggestions"}[1h])
        )
    - record: gitlab:component:feature_category:execution:apdex:success:rate_1h
      labels:
        component: third_party_model_inference
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        (
          sum by (env,environment) (
            rate(code_suggestions_inference_request_duration_seconds_bucket{container="model-gateway",le="5.0",model_engine!="codegen",type="code_suggestions"}[1h])
          )
          +
          sum by (env,environment) (
            rate(code_suggestions_inference_request_duration_seconds_bucket{container="model-gateway",le="10.0",model_engine!="codegen",type="code_suggestions"}[1h])
          )
        )
        /
        2
    - record: gitlab:component:feature_category:execution:apdex:weight:score_1h
      labels:
        component: third_party_model_inference
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        sum by (env,environment) (
          rate(code_suggestions_inference_request_duration_seconds_bucket{container="model-gateway",le="+Inf",model_engine!="codegen",type="code_suggestions"}[1h])
        )
    - record: gitlab:component:feature_category:execution:ops:rate_1h
      labels:
        component: third_party_model_inference
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        sum by (env,environment) (
          rate(code_suggestions_inference_requests_total{container="model-gateway",model_engine!="codegen",type="code_suggestions"}[1h])
        )
    - record: gitlab:component:feature_category:execution:ops:rate_1h
      labels:
        component: triton_server
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        sum by (env,environment) (
          rate(nv_inference_count{container="triton",type="code_suggestions"}[1h])
        )
    - record: gitlab:component:feature_category:execution:error:rate_1h
      labels:
        component: triton_server
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        (
          sum by (env,environment) (
            rate(nv_inference_request_failure{container="triton",type="code_suggestions"}[1h])
          )
        )
        or
        (
          0 * group by(env,environment) (
            gitlab:component:feature_category:execution:ops:rate_1h{component="triton_server",feature_category="code_suggestions",stage="main",tier="sv",type="code_suggestions"}
          )
        )
    - record: gitlab:component:feature_category:execution:ops:rate_1h
      labels:
        component: waf
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        sum by (env,environment) (
          rate(cloudflare_zone_requests_status_country_host{host=~"codesuggestions.gitlab.com.*",zone="gitlab.com"}[1h])
        )
    - record: gitlab:component:feature_category:execution:error:rate_1h
      labels:
        component: waf
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        (
          sum by (env,environment) (
            rate(cloudflare_zone_requests_status_country_host{host=~"codesuggestions.gitlab.com.*",status=~"^5.*",zone="gitlab.com"}[1h])
          )
        )
        or
        (
          0 * group by(env,environment) (
            gitlab:component:feature_category:execution:ops:rate_1h{component="waf",feature_category="code_suggestions",stage="main",tier="sv",type="code_suggestions"}
          )
        )
  - name: 'Prometheus Intermediate Metrics per feature: code_suggestions - burn-rate
      6h'
    interval: 2m
    partial_response_strategy: warn
    rules:
    - record: gitlab:component:feature_category:execution:apdex:success:rate_6h
      labels:
        component: ingress
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        (
          sum by (env,environment) (
            rate(nginx_ingress_controller_request_duration_seconds_bucket{container="controller",le="2.5",path!="/",status!~"4.*|5.*",type="code_suggestions"}[6h])
          )
          +
          sum by (env,environment) (
            rate(nginx_ingress_controller_request_duration_seconds_bucket{container="controller",le="10",path!="/",status!~"4.*|5.*",type="code_suggestions"}[6h])
          )
        )
        /
        2
    - record: gitlab:component:feature_category:execution:apdex:weight:score_6h
      labels:
        component: ingress
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        sum by (env,environment) (
          rate(nginx_ingress_controller_request_duration_seconds_bucket{container="controller",le="+Inf",path!="/",status!~"4.*|5.*",type="code_suggestions"}[6h])
        )
    - record: gitlab:component:feature_category:execution:ops:rate_6h
      labels:
        component: ingress
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        sum by (env,environment) (
          rate(nginx_ingress_controller_requests{container="controller",path!="/",type="code_suggestions"}[6h])
        )
    - record: gitlab:component:feature_category:execution:error:rate_6h
      labels:
        component: ingress
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        (
          sum by (env,environment) (
            rate(nginx_ingress_controller_requests{container="controller",path!="/",status=~"^5.*",type="code_suggestions"}[6h])
          )
        )
        or
        (
          0 * group by(env,environment) (
            gitlab:component:feature_category:execution:ops:rate_6h{component="ingress",feature_category="code_suggestions",stage="main",tier="sv",type="code_suggestions"}
          )
        )
    - record: gitlab:component:feature_category:execution:apdex:success:rate_6h
      labels:
        component: model_gateway
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        (
          sum by (env,environment) (
            rate(http_request_duration_seconds_bucket{container="model-gateway",le="2.5",status!~"4xx|5xx",type="code_suggestions"}[6h])
          )
          +
          sum by (env,environment) (
            rate(http_request_duration_seconds_bucket{container="model-gateway",le="10.0",status!~"4xx|5xx",type="code_suggestions"}[6h])
          )
        )
        /
        2
    - record: gitlab:component:feature_category:execution:apdex:weight:score_6h
      labels:
        component: model_gateway
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        sum by (env,environment) (
          rate(http_request_duration_seconds_bucket{container="model-gateway",le="+Inf",status!~"4xx|5xx",type="code_suggestions"}[6h])
        )
    - record: gitlab:component:feature_category:execution:ops:rate_6h
      labels:
        component: model_gateway
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        sum by (env,environment) (
          rate(http_request_duration_seconds_count{container="model-gateway",type="code_suggestions"}[6h])
        )
    - record: gitlab:component:feature_category:execution:error:rate_6h
      labels:
        component: model_gateway
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        (
          sum by (env,environment) (
            rate(http_request_duration_seconds_count{container="model-gateway",status="5xx",type="code_suggestions"}[6h])
          )
        )
        or
        (
          0 * group by(env,environment) (
            gitlab:component:feature_category:execution:ops:rate_6h{component="model_gateway",feature_category="code_suggestions",stage="main",tier="sv",type="code_suggestions"}
          )
        )
    - record: gitlab:component:feature_category:execution:apdex:success:rate_6h
      labels:
        component: native_model_inference
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        (
          sum by (env,environment) (
            rate(code_suggestions_inference_request_duration_seconds_bucket{container="model-gateway",le="5.0",model_engine="codegen",type="code_suggestions"}[6h])
          )
          +
          sum by (env,environment) (
            rate(code_suggestions_inference_request_duration_seconds_bucket{container="model-gateway",le="10.0",model_engine="codegen",type="code_suggestions"}[6h])
          )
        )
        /
        2
    - record: gitlab:component:feature_category:execution:apdex:weight:score_6h
      labels:
        component: native_model_inference
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        sum by (env,environment) (
          rate(code_suggestions_inference_request_duration_seconds_bucket{container="model-gateway",le="+Inf",model_engine="codegen",type="code_suggestions"}[6h])
        )
    - record: gitlab:component:feature_category:execution:ops:rate_6h
      labels:
        component: native_model_inference
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        sum by (env,environment) (
          rate(code_suggestions_inference_requests_total{container="model-gateway",model_engine="codegen",type="code_suggestions"}[6h])
        )
    - record: gitlab:component:feature_category:execution:apdex:success:rate_6h
      labels:
        component: third_party_model_inference
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        (
          sum by (env,environment) (
            rate(code_suggestions_inference_request_duration_seconds_bucket{container="model-gateway",le="5.0",model_engine!="codegen",type="code_suggestions"}[6h])
          )
          +
          sum by (env,environment) (
            rate(code_suggestions_inference_request_duration_seconds_bucket{container="model-gateway",le="10.0",model_engine!="codegen",type="code_suggestions"}[6h])
          )
        )
        /
        2
    - record: gitlab:component:feature_category:execution:apdex:weight:score_6h
      labels:
        component: third_party_model_inference
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        sum by (env,environment) (
          rate(code_suggestions_inference_request_duration_seconds_bucket{container="model-gateway",le="+Inf",model_engine!="codegen",type="code_suggestions"}[6h])
        )
    - record: gitlab:component:feature_category:execution:ops:rate_6h
      labels:
        component: third_party_model_inference
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        sum by (env,environment) (
          rate(code_suggestions_inference_requests_total{container="model-gateway",model_engine!="codegen",type="code_suggestions"}[6h])
        )
    - record: gitlab:component:feature_category:execution:ops:rate_6h
      labels:
        component: triton_server
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        sum by (env,environment) (
          rate(nv_inference_count{container="triton",type="code_suggestions"}[6h])
        )
    - record: gitlab:component:feature_category:execution:error:rate_6h
      labels:
        component: triton_server
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        (
          sum by (env,environment) (
            rate(nv_inference_request_failure{container="triton",type="code_suggestions"}[6h])
          )
        )
        or
        (
          0 * group by(env,environment) (
            gitlab:component:feature_category:execution:ops:rate_6h{component="triton_server",feature_category="code_suggestions",stage="main",tier="sv",type="code_suggestions"}
          )
        )
    - record: gitlab:component:feature_category:execution:ops:rate_6h
      labels:
        component: waf
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        sum by (env,environment) (
          rate(cloudflare_zone_requests_status_country_host{host=~"codesuggestions.gitlab.com.*",zone="gitlab.com"}[6h])
        )
    - record: gitlab:component:feature_category:execution:error:rate_6h
      labels:
        component: waf
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        (
          sum by (env,environment) (
            rate(cloudflare_zone_requests_status_country_host{host=~"codesuggestions.gitlab.com.*",status=~"^5.*",zone="gitlab.com"}[6h])
          )
        )
        or
        (
          0 * group by(env,environment) (
            gitlab:component:feature_category:execution:ops:rate_6h{component="waf",feature_category="code_suggestions",stage="main",tier="sv",type="code_suggestions"}
          )
        )
  - name: 'Prometheus Intermediate Metrics per feature: code_suggestions - burn-rate
      3d'
    interval: 2m
    partial_response_strategy: warn
    rules:
    - record: gitlab:component:feature_category:execution:apdex:success:rate_3d
      labels:
        component: ingress
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        (
          sum by (env,environment) (
            rate(nginx_ingress_controller_request_duration_seconds_bucket{container="controller",le="2.5",path!="/",status!~"4.*|5.*",type="code_suggestions"}[3d])
          )
          +
          sum by (env,environment) (
            rate(nginx_ingress_controller_request_duration_seconds_bucket{container="controller",le="10",path!="/",status!~"4.*|5.*",type="code_suggestions"}[3d])
          )
        )
        /
        2
    - record: gitlab:component:feature_category:execution:apdex:weight:score_3d
      labels:
        component: ingress
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        sum by (env,environment) (
          rate(nginx_ingress_controller_request_duration_seconds_bucket{container="controller",le="+Inf",path!="/",status!~"4.*|5.*",type="code_suggestions"}[3d])
        )
    - record: gitlab:component:feature_category:execution:ops:rate_3d
      labels:
        component: ingress
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        sum by (env,environment) (
          rate(nginx_ingress_controller_requests{container="controller",path!="/",type="code_suggestions"}[3d])
        )
    - record: gitlab:component:feature_category:execution:error:rate_3d
      labels:
        component: ingress
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        (
          sum by (env,environment) (
            rate(nginx_ingress_controller_requests{container="controller",path!="/",status=~"^5.*",type="code_suggestions"}[3d])
          )
        )
        or
        (
          0 * group by(env,environment) (
            gitlab:component:feature_category:execution:ops:rate_3d{component="ingress",feature_category="code_suggestions",stage="main",tier="sv",type="code_suggestions"}
          )
        )
    - record: gitlab:component:feature_category:execution:apdex:success:rate_3d
      labels:
        component: model_gateway
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        (
          sum by (env,environment) (
            rate(http_request_duration_seconds_bucket{container="model-gateway",le="2.5",status!~"4xx|5xx",type="code_suggestions"}[3d])
          )
          +
          sum by (env,environment) (
            rate(http_request_duration_seconds_bucket{container="model-gateway",le="10.0",status!~"4xx|5xx",type="code_suggestions"}[3d])
          )
        )
        /
        2
    - record: gitlab:component:feature_category:execution:apdex:weight:score_3d
      labels:
        component: model_gateway
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        sum by (env,environment) (
          rate(http_request_duration_seconds_bucket{container="model-gateway",le="+Inf",status!~"4xx|5xx",type="code_suggestions"}[3d])
        )
    - record: gitlab:component:feature_category:execution:ops:rate_3d
      labels:
        component: model_gateway
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        sum by (env,environment) (
          rate(http_request_duration_seconds_count{container="model-gateway",type="code_suggestions"}[3d])
        )
    - record: gitlab:component:feature_category:execution:error:rate_3d
      labels:
        component: model_gateway
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        (
          sum by (env,environment) (
            rate(http_request_duration_seconds_count{container="model-gateway",status="5xx",type="code_suggestions"}[3d])
          )
        )
        or
        (
          0 * group by(env,environment) (
            gitlab:component:feature_category:execution:ops:rate_3d{component="model_gateway",feature_category="code_suggestions",stage="main",tier="sv",type="code_suggestions"}
          )
        )
    - record: gitlab:component:feature_category:execution:apdex:success:rate_3d
      labels:
        component: native_model_inference
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        (
          sum by (env,environment) (
            rate(code_suggestions_inference_request_duration_seconds_bucket{container="model-gateway",le="5.0",model_engine="codegen",type="code_suggestions"}[3d])
          )
          +
          sum by (env,environment) (
            rate(code_suggestions_inference_request_duration_seconds_bucket{container="model-gateway",le="10.0",model_engine="codegen",type="code_suggestions"}[3d])
          )
        )
        /
        2
    - record: gitlab:component:feature_category:execution:apdex:weight:score_3d
      labels:
        component: native_model_inference
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        sum by (env,environment) (
          rate(code_suggestions_inference_request_duration_seconds_bucket{container="model-gateway",le="+Inf",model_engine="codegen",type="code_suggestions"}[3d])
        )
    - record: gitlab:component:feature_category:execution:ops:rate_3d
      labels:
        component: native_model_inference
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        sum by (env,environment) (
          rate(code_suggestions_inference_requests_total{container="model-gateway",model_engine="codegen",type="code_suggestions"}[3d])
        )
    - record: gitlab:component:feature_category:execution:apdex:success:rate_3d
      labels:
        component: third_party_model_inference
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        (
          sum by (env,environment) (
            rate(code_suggestions_inference_request_duration_seconds_bucket{container="model-gateway",le="5.0",model_engine!="codegen",type="code_suggestions"}[3d])
          )
          +
          sum by (env,environment) (
            rate(code_suggestions_inference_request_duration_seconds_bucket{container="model-gateway",le="10.0",model_engine!="codegen",type="code_suggestions"}[3d])
          )
        )
        /
        2
    - record: gitlab:component:feature_category:execution:apdex:weight:score_3d
      labels:
        component: third_party_model_inference
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        sum by (env,environment) (
          rate(code_suggestions_inference_request_duration_seconds_bucket{container="model-gateway",le="+Inf",model_engine!="codegen",type="code_suggestions"}[3d])
        )
    - record: gitlab:component:feature_category:execution:ops:rate_3d
      labels:
        component: third_party_model_inference
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        sum by (env,environment) (
          rate(code_suggestions_inference_requests_total{container="model-gateway",model_engine!="codegen",type="code_suggestions"}[3d])
        )
    - record: gitlab:component:feature_category:execution:ops:rate_3d
      labels:
        component: triton_server
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        sum by (env,environment) (
          rate(nv_inference_count{container="triton",type="code_suggestions"}[3d])
        )
    - record: gitlab:component:feature_category:execution:error:rate_3d
      labels:
        component: triton_server
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        (
          sum by (env,environment) (
            rate(nv_inference_request_failure{container="triton",type="code_suggestions"}[3d])
          )
        )
        or
        (
          0 * group by(env,environment) (
            gitlab:component:feature_category:execution:ops:rate_3d{component="triton_server",feature_category="code_suggestions",stage="main",tier="sv",type="code_suggestions"}
          )
        )
    - record: gitlab:component:feature_category:execution:ops:rate_3d
      labels:
        component: waf
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        sum by (env,environment) (
          rate(cloudflare_zone_requests_status_country_host{host=~"codesuggestions.gitlab.com.*",zone="gitlab.com"}[3d])
        )
    - record: gitlab:component:feature_category:execution:error:rate_3d
      labels:
        component: waf
        feature_category: code_suggestions
        stage: main
        tier: sv
        type: code_suggestions
      expr: |
        (
          sum by (env,environment) (
            rate(cloudflare_zone_requests_status_country_host{host=~"codesuggestions.gitlab.com.*",status=~"^5.*",zone="gitlab.com"}[3d])
          )
        )
        or
        (
          0 * group by(env,environment) (
            gitlab:component:feature_category:execution:ops:rate_3d{component="waf",feature_category="code_suggestions",stage="main",tier="sv",type="code_suggestions"}
          )
        )
