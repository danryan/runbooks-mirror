# WARNING. DO NOT EDIT THIS FILE BY HAND. USE ./mimir-rules-jsonnet/mimir-aggregations.jsonnet TO GENERATE IT
# YOUR CHANGES WILL BE OVERRIDDEN
groups:
- name: 'Global SLI Metrics: mimir - Burn-Rate 5m'
  interval: 1m
  rules:
  - record: gitlab_component_ops:rate_5m
    labels:
      component: mimir_compactor
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_compactor_group_compaction_runs_started_total:rate_5m{job="mimir/compactor",namespace="mimir",type="mimir"} offset 30s
      )
  - record: gitlab_component_errors:rate_5m
    labels:
      component: mimir_compactor
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      (
        sum by () (
          sli_aggregations:cortex_compactor_group_compactions_failures_total:rate_5m{code=~"^5.*",job="mimir/compactor",namespace="mimir",type="mimir"} offset 30s
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_5m{component="mimir_compactor",env="ops",environment="ops",monitor="global",stage="main",tier="inf",type="mimir"}
        )
      )
  - record: gitlab_component_apdex:success:rate_5m
    labels:
      component: mimir_distributor
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_request_duration_seconds_bucket:rate_5m{job="mimir/distributor",le="30.0",namespace="mimir",type="mimir"}
      )
  - record: gitlab_component_apdex:weight:score_5m
    labels:
      component: mimir_distributor
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_request_duration_seconds_bucket:rate_5m{job="mimir/distributor",le="+Inf",namespace="mimir",type="mimir"}
      )
  - record: gitlab_component_ops:rate_5m
    labels:
      component: mimir_distributor
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_request_duration_seconds_count:rate_5m{job="mimir/distributor",namespace="mimir",type="mimir"} offset 30s
      )
  - record: gitlab_component_errors:rate_5m
    labels:
      component: mimir_distributor
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      (
        sum by () (
          sli_aggregations:cortex_request_duration_seconds_count:rate_5m{code=~"^5.*",job="mimir/distributor",namespace="mimir",type="mimir"} offset 30s
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_5m{component="mimir_distributor",env="ops",environment="ops",monitor="global",stage="main",tier="inf",type="mimir"}
        )
      )
  - record: gitlab_component_apdex:success:rate_5m
    labels:
      component: mimir_ingester
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_request_duration_seconds_bucket:rate_5m{job="mimir/ingester",le="30.0",namespace="mimir",type="mimir"}
      )
  - record: gitlab_component_apdex:weight:score_5m
    labels:
      component: mimir_ingester
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_request_duration_seconds_bucket:rate_5m{job="mimir/ingester",le="+Inf",namespace="mimir",type="mimir"}
      )
  - record: gitlab_component_ops:rate_5m
    labels:
      component: mimir_ingester
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_request_duration_seconds_count:rate_5m{job="mimir/ingester",namespace="mimir",type="mimir"} offset 30s
      )
  - record: gitlab_component_errors:rate_5m
    labels:
      component: mimir_ingester
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      (
        sum by () (
          sli_aggregations:cortex_request_duration_seconds_count:rate_5m{code=~"^5.*",job="mimir/ingester",namespace="mimir",type="mimir"} offset 30s
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_5m{component="mimir_ingester",env="ops",environment="ops",monitor="global",stage="main",tier="inf",type="mimir"}
        )
      )
  - record: gitlab_component_apdex:success:rate_5m
    labels:
      component: mimir_querier
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_querier_request_duration_seconds_count:rate_5m{job="mimir/querier",le="30.0",namespace="mimir",type="mimir"}
      )
  - record: gitlab_component_apdex:weight:score_5m
    labels:
      component: mimir_querier
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_querier_request_duration_seconds_count:rate_5m{job="mimir/querier",le="+Inf",namespace="mimir",type="mimir"}
      )
  - record: gitlab_component_ops:rate_5m
    labels:
      component: mimir_querier
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_request_duration_seconds_count:rate_5m{job="mimir/querier",namespace="mimir",type="mimir"} offset 30s
      )
  - record: gitlab_component_errors:rate_5m
    labels:
      component: mimir_querier
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      (
        sum by () (
          sli_aggregations:cortex_request_duration_seconds_count:rate_5m{code=~"^5.*",job="mimir/querier",namespace="mimir",type="mimir"} offset 30s
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_5m{component="mimir_querier",env="ops",environment="ops",monitor="global",stage="main",tier="inf",type="mimir"}
        )
      )
  - record: gitlab_component_apdex:success:rate_5m
    labels:
      component: mimir_query_frontend
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_querier_query_frontend_request_duration_seconds_bucket:rate_5m{job="mimir/query-frontend",le="30.0",namespace="mimir",type="mimir"}
      )
  - record: gitlab_component_apdex:weight:score_5m
    labels:
      component: mimir_query_frontend
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_querier_query_frontend_request_duration_seconds_bucket:rate_5m{job="mimir/query-frontend",le="+Inf",namespace="mimir",type="mimir"}
      )
  - record: gitlab_component_ops:rate_5m
    labels:
      component: mimir_query_frontend
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_request_duration_seconds_count:rate_5m{job="mimir/query-frontend",namespace="mimir",type="mimir"} offset 30s
      )
  - record: gitlab_component_errors:rate_5m
    labels:
      component: mimir_query_frontend
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      (
        sum by () (
          sli_aggregations:cortex_request_duration_seconds_count:rate_5m{code=~"^5.*",job="mimir/query-frontend",namespace="mimir",type="mimir"} offset 30s
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_5m{component="mimir_query_frontend",env="ops",environment="ops",monitor="global",stage="main",tier="inf",type="mimir"}
        )
      )
  - record: gitlab_component_apdex:success:rate_5m
    labels:
      component: mimir_query_scheduler
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_query_scheduler_queue_duration_seconds_bucket:rate_5m{job="mimir/query-scheduler",le="30.0",namespace="mimir",type="mimir"}
      )
  - record: gitlab_component_apdex:weight:score_5m
    labels:
      component: mimir_query_scheduler
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_query_scheduler_queue_duration_seconds_bucket:rate_5m{job="mimir/query-scheduler",le="+Inf",namespace="mimir",type="mimir"}
      )
  - record: gitlab_component_ops:rate_5m
    labels:
      component: mimir_query_scheduler
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_query_scheduler_queue_duration_seconds_count:rate_5m{job="mimir/query-scheduler",namespace="mimir",type="mimir"} offset 30s
      )
  - record: gitlab_component_errors:rate_5m
    labels:
      component: mimir_query_scheduler
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      (
        sum by () (
          sli_aggregations:cortex_query_scheduler_queue_duration_seconds_count:rate_5m{code=~"^5.*",job="mimir/query-scheduler",namespace="mimir",type="mimir"} offset 30s
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_5m{component="mimir_query_scheduler",env="ops",environment="ops",monitor="global",stage="main",tier="inf",type="mimir"}
        )
      )
  - record: gitlab_component_ops:rate_5m
    labels:
      component: mimir_ruler
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_prometheus_rule_evaluations_total:rate_5m{job="mimir/compactor",namespace="mimir",type="mimir"} offset 30s
      )
  - record: gitlab_component_errors:rate_5m
    labels:
      component: mimir_ruler
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      (
        sum by () (
          sli_aggregations:cortex_prometheus_rule_evaluation_failures_total:rate_5m{job="mimir/compactor",namespace="mimir",type="mimir"} offset 30s
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_5m{component="mimir_ruler",env="ops",environment="ops",monitor="global",stage="main",tier="inf",type="mimir"}
        )
      )
  - record: gitlab_component_apdex:success:rate_5m
    labels:
      component: mimir_store_gateway
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_kv_request_duration_seconds_bucket:rate_5m{job="mimir/store-gateway",le="30.0",namespace="mimir",type="mimir"}
      )
  - record: gitlab_component_apdex:weight:score_5m
    labels:
      component: mimir_store_gateway
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_kv_request_duration_seconds_bucket:rate_5m{job="mimir/store-gateway",le="+Inf",namespace="mimir",type="mimir"}
      )
  - record: gitlab_component_ops:rate_5m
    labels:
      component: mimir_store_gateway
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_kv_request_duration_seconds_count:rate_5m{job="mimir/store-gateway",namespace="mimir",type="mimir"} offset 30s
      )
  - record: gitlab_component_errors:rate_5m
    labels:
      component: mimir_store_gateway
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      (
        sum by () (
          sli_aggregations:cortex_kv_request_duration_seconds_count:rate_5m{code=~"^5.*",job="mimir/store-gateway",namespace="mimir",type="mimir"} offset 30s
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_5m{component="mimir_store_gateway",env="ops",environment="ops",monitor="global",stage="main",tier="inf",type="mimir"}
        )
      )
- name: 'Global SLI Metrics: mimir - Burn-Rate 30m'
  interval: 2m
  rules:
  - record: gitlab_component_ops:rate_30m
    labels:
      component: mimir_compactor
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_compactor_group_compaction_runs_started_total:rate_30m{job="mimir/compactor",namespace="mimir",type="mimir"} offset 30s
      )
  - record: gitlab_component_errors:rate_30m
    labels:
      component: mimir_compactor
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      (
        sum by () (
          sli_aggregations:cortex_compactor_group_compactions_failures_total:rate_30m{code=~"^5.*",job="mimir/compactor",namespace="mimir",type="mimir"} offset 30s
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_30m{component="mimir_compactor",env="ops",environment="ops",monitor="global",stage="main",tier="inf",type="mimir"}
        )
      )
  - record: gitlab_component_apdex:success:rate_30m
    labels:
      component: mimir_distributor
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_request_duration_seconds_bucket:rate_30m{job="mimir/distributor",le="30.0",namespace="mimir",type="mimir"}
      )
  - record: gitlab_component_apdex:weight:score_30m
    labels:
      component: mimir_distributor
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_request_duration_seconds_bucket:rate_30m{job="mimir/distributor",le="+Inf",namespace="mimir",type="mimir"}
      )
  - record: gitlab_component_ops:rate_30m
    labels:
      component: mimir_distributor
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_request_duration_seconds_count:rate_30m{job="mimir/distributor",namespace="mimir",type="mimir"} offset 30s
      )
  - record: gitlab_component_errors:rate_30m
    labels:
      component: mimir_distributor
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      (
        sum by () (
          sli_aggregations:cortex_request_duration_seconds_count:rate_30m{code=~"^5.*",job="mimir/distributor",namespace="mimir",type="mimir"} offset 30s
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_30m{component="mimir_distributor",env="ops",environment="ops",monitor="global",stage="main",tier="inf",type="mimir"}
        )
      )
  - record: gitlab_component_apdex:success:rate_30m
    labels:
      component: mimir_ingester
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_request_duration_seconds_bucket:rate_30m{job="mimir/ingester",le="30.0",namespace="mimir",type="mimir"}
      )
  - record: gitlab_component_apdex:weight:score_30m
    labels:
      component: mimir_ingester
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_request_duration_seconds_bucket:rate_30m{job="mimir/ingester",le="+Inf",namespace="mimir",type="mimir"}
      )
  - record: gitlab_component_ops:rate_30m
    labels:
      component: mimir_ingester
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_request_duration_seconds_count:rate_30m{job="mimir/ingester",namespace="mimir",type="mimir"} offset 30s
      )
  - record: gitlab_component_errors:rate_30m
    labels:
      component: mimir_ingester
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      (
        sum by () (
          sli_aggregations:cortex_request_duration_seconds_count:rate_30m{code=~"^5.*",job="mimir/ingester",namespace="mimir",type="mimir"} offset 30s
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_30m{component="mimir_ingester",env="ops",environment="ops",monitor="global",stage="main",tier="inf",type="mimir"}
        )
      )
  - record: gitlab_component_apdex:success:rate_30m
    labels:
      component: mimir_querier
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_querier_request_duration_seconds_count:rate_30m{job="mimir/querier",le="30.0",namespace="mimir",type="mimir"}
      )
  - record: gitlab_component_apdex:weight:score_30m
    labels:
      component: mimir_querier
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_querier_request_duration_seconds_count:rate_30m{job="mimir/querier",le="+Inf",namespace="mimir",type="mimir"}
      )
  - record: gitlab_component_ops:rate_30m
    labels:
      component: mimir_querier
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_request_duration_seconds_count:rate_30m{job="mimir/querier",namespace="mimir",type="mimir"} offset 30s
      )
  - record: gitlab_component_errors:rate_30m
    labels:
      component: mimir_querier
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      (
        sum by () (
          sli_aggregations:cortex_request_duration_seconds_count:rate_30m{code=~"^5.*",job="mimir/querier",namespace="mimir",type="mimir"} offset 30s
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_30m{component="mimir_querier",env="ops",environment="ops",monitor="global",stage="main",tier="inf",type="mimir"}
        )
      )
  - record: gitlab_component_apdex:success:rate_30m
    labels:
      component: mimir_query_frontend
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_querier_query_frontend_request_duration_seconds_bucket:rate_30m{job="mimir/query-frontend",le="30.0",namespace="mimir",type="mimir"}
      )
  - record: gitlab_component_apdex:weight:score_30m
    labels:
      component: mimir_query_frontend
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_querier_query_frontend_request_duration_seconds_bucket:rate_30m{job="mimir/query-frontend",le="+Inf",namespace="mimir",type="mimir"}
      )
  - record: gitlab_component_ops:rate_30m
    labels:
      component: mimir_query_frontend
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_request_duration_seconds_count:rate_30m{job="mimir/query-frontend",namespace="mimir",type="mimir"} offset 30s
      )
  - record: gitlab_component_errors:rate_30m
    labels:
      component: mimir_query_frontend
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      (
        sum by () (
          sli_aggregations:cortex_request_duration_seconds_count:rate_30m{code=~"^5.*",job="mimir/query-frontend",namespace="mimir",type="mimir"} offset 30s
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_30m{component="mimir_query_frontend",env="ops",environment="ops",monitor="global",stage="main",tier="inf",type="mimir"}
        )
      )
  - record: gitlab_component_apdex:success:rate_30m
    labels:
      component: mimir_query_scheduler
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_query_scheduler_queue_duration_seconds_bucket:rate_30m{job="mimir/query-scheduler",le="30.0",namespace="mimir",type="mimir"}
      )
  - record: gitlab_component_apdex:weight:score_30m
    labels:
      component: mimir_query_scheduler
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_query_scheduler_queue_duration_seconds_bucket:rate_30m{job="mimir/query-scheduler",le="+Inf",namespace="mimir",type="mimir"}
      )
  - record: gitlab_component_ops:rate_30m
    labels:
      component: mimir_query_scheduler
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_query_scheduler_queue_duration_seconds_count:rate_30m{job="mimir/query-scheduler",namespace="mimir",type="mimir"} offset 30s
      )
  - record: gitlab_component_errors:rate_30m
    labels:
      component: mimir_query_scheduler
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      (
        sum by () (
          sli_aggregations:cortex_query_scheduler_queue_duration_seconds_count:rate_30m{code=~"^5.*",job="mimir/query-scheduler",namespace="mimir",type="mimir"} offset 30s
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_30m{component="mimir_query_scheduler",env="ops",environment="ops",monitor="global",stage="main",tier="inf",type="mimir"}
        )
      )
  - record: gitlab_component_ops:rate_30m
    labels:
      component: mimir_ruler
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_prometheus_rule_evaluations_total:rate_30m{job="mimir/compactor",namespace="mimir",type="mimir"} offset 30s
      )
  - record: gitlab_component_errors:rate_30m
    labels:
      component: mimir_ruler
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      (
        sum by () (
          sli_aggregations:cortex_prometheus_rule_evaluation_failures_total:rate_30m{job="mimir/compactor",namespace="mimir",type="mimir"} offset 30s
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_30m{component="mimir_ruler",env="ops",environment="ops",monitor="global",stage="main",tier="inf",type="mimir"}
        )
      )
  - record: gitlab_component_apdex:success:rate_30m
    labels:
      component: mimir_store_gateway
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_kv_request_duration_seconds_bucket:rate_30m{job="mimir/store-gateway",le="30.0",namespace="mimir",type="mimir"}
      )
  - record: gitlab_component_apdex:weight:score_30m
    labels:
      component: mimir_store_gateway
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_kv_request_duration_seconds_bucket:rate_30m{job="mimir/store-gateway",le="+Inf",namespace="mimir",type="mimir"}
      )
  - record: gitlab_component_ops:rate_30m
    labels:
      component: mimir_store_gateway
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_kv_request_duration_seconds_count:rate_30m{job="mimir/store-gateway",namespace="mimir",type="mimir"} offset 30s
      )
  - record: gitlab_component_errors:rate_30m
    labels:
      component: mimir_store_gateway
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      (
        sum by () (
          sli_aggregations:cortex_kv_request_duration_seconds_count:rate_30m{code=~"^5.*",job="mimir/store-gateway",namespace="mimir",type="mimir"} offset 30s
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_30m{component="mimir_store_gateway",env="ops",environment="ops",monitor="global",stage="main",tier="inf",type="mimir"}
        )
      )
- name: 'Global SLI Metrics: mimir - Burn-Rate 1h'
  interval: 1m
  rules:
  - record: gitlab_component_ops:rate_1h
    labels:
      component: mimir_compactor
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_compactor_group_compaction_runs_started_total:rate_1h{job="mimir/compactor",namespace="mimir",type="mimir"} offset 30s
      )
  - record: gitlab_component_errors:rate_1h
    labels:
      component: mimir_compactor
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      (
        sum by () (
          sli_aggregations:cortex_compactor_group_compactions_failures_total:rate_1h{code=~"^5.*",job="mimir/compactor",namespace="mimir",type="mimir"} offset 30s
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_1h{component="mimir_compactor",env="ops",environment="ops",monitor="global",stage="main",tier="inf",type="mimir"}
        )
      )
  - record: gitlab_component_apdex:success:rate_1h
    labels:
      component: mimir_distributor
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_request_duration_seconds_bucket:rate_1h{job="mimir/distributor",le="30.0",namespace="mimir",type="mimir"}
      )
  - record: gitlab_component_apdex:weight:score_1h
    labels:
      component: mimir_distributor
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_request_duration_seconds_bucket:rate_1h{job="mimir/distributor",le="+Inf",namespace="mimir",type="mimir"}
      )
  - record: gitlab_component_ops:rate_1h
    labels:
      component: mimir_distributor
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_request_duration_seconds_count:rate_1h{job="mimir/distributor",namespace="mimir",type="mimir"} offset 30s
      )
  - record: gitlab_component_errors:rate_1h
    labels:
      component: mimir_distributor
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      (
        sum by () (
          sli_aggregations:cortex_request_duration_seconds_count:rate_1h{code=~"^5.*",job="mimir/distributor",namespace="mimir",type="mimir"} offset 30s
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_1h{component="mimir_distributor",env="ops",environment="ops",monitor="global",stage="main",tier="inf",type="mimir"}
        )
      )
  - record: gitlab_component_apdex:success:rate_1h
    labels:
      component: mimir_ingester
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_request_duration_seconds_bucket:rate_1h{job="mimir/ingester",le="30.0",namespace="mimir",type="mimir"}
      )
  - record: gitlab_component_apdex:weight:score_1h
    labels:
      component: mimir_ingester
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_request_duration_seconds_bucket:rate_1h{job="mimir/ingester",le="+Inf",namespace="mimir",type="mimir"}
      )
  - record: gitlab_component_ops:rate_1h
    labels:
      component: mimir_ingester
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_request_duration_seconds_count:rate_1h{job="mimir/ingester",namespace="mimir",type="mimir"} offset 30s
      )
  - record: gitlab_component_errors:rate_1h
    labels:
      component: mimir_ingester
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      (
        sum by () (
          sli_aggregations:cortex_request_duration_seconds_count:rate_1h{code=~"^5.*",job="mimir/ingester",namespace="mimir",type="mimir"} offset 30s
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_1h{component="mimir_ingester",env="ops",environment="ops",monitor="global",stage="main",tier="inf",type="mimir"}
        )
      )
  - record: gitlab_component_apdex:success:rate_1h
    labels:
      component: mimir_querier
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_querier_request_duration_seconds_count:rate_1h{job="mimir/querier",le="30.0",namespace="mimir",type="mimir"}
      )
  - record: gitlab_component_apdex:weight:score_1h
    labels:
      component: mimir_querier
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_querier_request_duration_seconds_count:rate_1h{job="mimir/querier",le="+Inf",namespace="mimir",type="mimir"}
      )
  - record: gitlab_component_ops:rate_1h
    labels:
      component: mimir_querier
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_request_duration_seconds_count:rate_1h{job="mimir/querier",namespace="mimir",type="mimir"} offset 30s
      )
  - record: gitlab_component_errors:rate_1h
    labels:
      component: mimir_querier
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      (
        sum by () (
          sli_aggregations:cortex_request_duration_seconds_count:rate_1h{code=~"^5.*",job="mimir/querier",namespace="mimir",type="mimir"} offset 30s
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_1h{component="mimir_querier",env="ops",environment="ops",monitor="global",stage="main",tier="inf",type="mimir"}
        )
      )
  - record: gitlab_component_apdex:success:rate_1h
    labels:
      component: mimir_query_frontend
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_querier_query_frontend_request_duration_seconds_bucket:rate_1h{job="mimir/query-frontend",le="30.0",namespace="mimir",type="mimir"}
      )
  - record: gitlab_component_apdex:weight:score_1h
    labels:
      component: mimir_query_frontend
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_querier_query_frontend_request_duration_seconds_bucket:rate_1h{job="mimir/query-frontend",le="+Inf",namespace="mimir",type="mimir"}
      )
  - record: gitlab_component_ops:rate_1h
    labels:
      component: mimir_query_frontend
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_request_duration_seconds_count:rate_1h{job="mimir/query-frontend",namespace="mimir",type="mimir"} offset 30s
      )
  - record: gitlab_component_errors:rate_1h
    labels:
      component: mimir_query_frontend
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      (
        sum by () (
          sli_aggregations:cortex_request_duration_seconds_count:rate_1h{code=~"^5.*",job="mimir/query-frontend",namespace="mimir",type="mimir"} offset 30s
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_1h{component="mimir_query_frontend",env="ops",environment="ops",monitor="global",stage="main",tier="inf",type="mimir"}
        )
      )
  - record: gitlab_component_apdex:success:rate_1h
    labels:
      component: mimir_query_scheduler
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_query_scheduler_queue_duration_seconds_bucket:rate_1h{job="mimir/query-scheduler",le="30.0",namespace="mimir",type="mimir"}
      )
  - record: gitlab_component_apdex:weight:score_1h
    labels:
      component: mimir_query_scheduler
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_query_scheduler_queue_duration_seconds_bucket:rate_1h{job="mimir/query-scheduler",le="+Inf",namespace="mimir",type="mimir"}
      )
  - record: gitlab_component_ops:rate_1h
    labels:
      component: mimir_query_scheduler
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_query_scheduler_queue_duration_seconds_count:rate_1h{job="mimir/query-scheduler",namespace="mimir",type="mimir"} offset 30s
      )
  - record: gitlab_component_errors:rate_1h
    labels:
      component: mimir_query_scheduler
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      (
        sum by () (
          sli_aggregations:cortex_query_scheduler_queue_duration_seconds_count:rate_1h{code=~"^5.*",job="mimir/query-scheduler",namespace="mimir",type="mimir"} offset 30s
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_1h{component="mimir_query_scheduler",env="ops",environment="ops",monitor="global",stage="main",tier="inf",type="mimir"}
        )
      )
  - record: gitlab_component_ops:rate_1h
    labels:
      component: mimir_ruler
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_prometheus_rule_evaluations_total:rate_1h{job="mimir/compactor",namespace="mimir",type="mimir"} offset 30s
      )
  - record: gitlab_component_errors:rate_1h
    labels:
      component: mimir_ruler
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      (
        sum by () (
          sli_aggregations:cortex_prometheus_rule_evaluation_failures_total:rate_1h{job="mimir/compactor",namespace="mimir",type="mimir"} offset 30s
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_1h{component="mimir_ruler",env="ops",environment="ops",monitor="global",stage="main",tier="inf",type="mimir"}
        )
      )
  - record: gitlab_component_apdex:success:rate_1h
    labels:
      component: mimir_store_gateway
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_kv_request_duration_seconds_bucket:rate_1h{job="mimir/store-gateway",le="30.0",namespace="mimir",type="mimir"}
      )
  - record: gitlab_component_apdex:weight:score_1h
    labels:
      component: mimir_store_gateway
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_kv_request_duration_seconds_bucket:rate_1h{job="mimir/store-gateway",le="+Inf",namespace="mimir",type="mimir"}
      )
  - record: gitlab_component_ops:rate_1h
    labels:
      component: mimir_store_gateway
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      sum by () (
        sli_aggregations:cortex_kv_request_duration_seconds_count:rate_1h{job="mimir/store-gateway",namespace="mimir",type="mimir"} offset 30s
      )
  - record: gitlab_component_errors:rate_1h
    labels:
      component: mimir_store_gateway
      env: ops
      environment: ops
      monitor: global
      stage: main
      tier: inf
      type: mimir
    expr: |
      (
        sum by () (
          sli_aggregations:cortex_kv_request_duration_seconds_count:rate_1h{code=~"^5.*",job="mimir/store-gateway",namespace="mimir",type="mimir"} offset 30s
        )
      )
      or
      (
        0 * group by() (
          gitlab_component_ops:rate_1h{component="mimir_store_gateway",env="ops",environment="ops",monitor="global",stage="main",tier="inf",type="mimir"}
        )
      )
