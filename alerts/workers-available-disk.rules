ALERT worker_20_disk
  IF (node_filesystem_avail{instance=~"worker.*", mountpoint="/"} / node_filesystem_size{instance=~"worker.*", mountpoint="/"}) < 0.20 AND (node_filesystem_avail{instance=~"worker.*", mountpoint="/"} / node_filesystem_size{instance=~"worker.*", mountpoint="/"}) > 0.10
  FOR 1m
  LABELS { severity = "warn", pager="slack" }
  ANNOTATIONS {
    title = "Low disk space left on {{ $labels.mountpoint }} on worker {{ $labels.instance }}: {{ node_filesystem_avail{instance=~"worker.*", mountpoint="/"} / node_filesystem_size{instance=~"worker.*", mountpoint="/"} * 100 }}%",
    description = "Consider jumping into the instance and removing old logs: cd /var/log/gitlab; find ./ -mtime +5 -exec rm {} \;",
  }

ALERT worker_10_disk
  IF (node_filesystem_avail{instance=~"worker.*", mountpoint="/"} / node_filesystem_size{instance=~"worker.*", mountpoint="/"}) <= 0.10
  FOR 1m
  LABELS { severity = "critical", pager="slack" }
  ANNOTATIONS {
    title = "Really low disk space left on {{ $labels.mountpoint }} on worker {{ $labels.instance }}: {{ node_filesystem_avail{instance=~"worker.*", mountpoint="/"} / node_filesystem_size{instance=~"worker.*", mountpoint="/"} * 100 }}%",
    description = "Consider jumping into the instance and removing old logs: cd /var/log/gitlab; find ./ -mtime +5 -exec rm {} \;",
  }
