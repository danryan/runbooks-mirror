groups:
- name: gitlab-wale-backup.rules
  rules:
  - record: gitlab_com:last_wale_backup_age_in_seconds
    expr: (time() - wale_backup_last_completed_time_seconds{instance="postgres-01.db.prd.gitlab.com:3903"})
  - alert: WALEBackupDelayed
    expr: gitlab_com:last_wale_backup_age_in_seconds >= 60 * 60
    for: 5m
    labels:
      pager: pagerduty
      severity: critical
    annotations:
      description: WALE syncs to S3 might be not working. Please follow the runbook
        to review the problem.
      runbook: troubleshooting/gitlab-com-wale-backups.md
      title: Last WALE backup (from postgres-01 to S3) was seen {{ .Value | humanizeDuration
        }} ago.
