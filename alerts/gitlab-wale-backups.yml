groups:
- name: gitlab-wale-backup.rules
  rules:
  - record: gitlab_com:last_wale_backup_age_in_seconds
    expr: (time() - wale_backup_last_completed_time_seconds)
  - alert: WALEBackupDelayedProd
    expr: gitlab_com:last_wale_backup_age_in_seconds{environment=~"prd|gprd"} >= 60 * 60
    for: 5m
    labels:
      pager: pagerduty
      severity: critical
    annotations:
      description: WALE syncs to S3 might be not working. Please follow the runbook
        to review the problem.
      runbook: troubleshooting/gitlab-com-wale-backups.md
      title: Last WALE backup was seen {{ .Value | humanizeDuration }} ago.
  - alert: WALEBackupDelayedStaging
    expr: gitlab_com:last_wale_backup_age_in_seconds{environment=~"stg|gstg"} >= 60 * 60
    for: 5m
    labels:
      severity: critical
    annotations:
      description: WALE syncs to S3 might be not working. Please follow the runbook
        to review the problem.
      runbook: troubleshooting/gitlab-com-wale-backups.md
      title: Last WALE backup was seen {{ .Value | humanizeDuration }} ago.
