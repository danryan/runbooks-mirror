ALERT HighWebErrorRate
  IF sum(backend_code:haproxy_server_http_responses_total:irate1m{tier="lb", environment="prd", backend="web", code="5xx"}) - sum(backend_code:haproxy_server_http_responses_total:irate1m{tier="lb", environment="prd", backend="web", code!="5xx"}) > 0
  FOR 15s
  LABELS {severity="critical", pager="pagerduty"}
  ANNOTATIONS {
    title="High Error Rate on Front End Web",
    description="We are having more 5xx returns than any other reply. Web traffic is being impacted and the service is probably down. Have you thought about turning it off and on again?",
    runbook="troubleshooting/gitlab-com-is-down.md"
  }
