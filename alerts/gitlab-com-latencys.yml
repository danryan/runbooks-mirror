groups:
- name: gitlab-com-latency.rules
  rules:
  - alert: GitLabComLatencyGitalyCritical
    expr: gitaly:grpc_server_handling_seconds:p95{environment="prd"} >= 60
    for: 5m
    labels:
      pager: pagerduty
      severity: critical
    annotations:
      description: Reach out to the Gitaly team and mitigate the problem restarting
        gitaly on the affected node if it's causing a partial outage.
      runbook: troubleshooting/gitaly-latency.md
      title: Gitaly latency on {{ $labels.fqdn }} has been over 1m during the last
        5m
  - alert: GitLabComLatencyWeb
    expr: type:rails_requests_completed_milliseconds:p95{environment="prd",type="web"}
      > 3000
    for: 1m
    labels:
      severity: warn
    annotations:
      description: This might be causing a slowdown on the site and/or affecting users.
        Please check the Triage Dashboard in Grafana.
      title: Web latency on GitLab.com has been over 3s during the last 1m
  - alert: GitLabComLatencyWebCritical
    expr: type:rails_requests_completed_milliseconds:p95{environment="prd",type="web"}
      > 3000
    for: 5m
    labels:
      pager: pagerduty
      severity: critical
    annotations:
      description: This might be causing a slowdown on the site and/or affecting users.
        Please check the Triage Dashboard in Grafana.
      title: Web latency on GitLab.com has been over 3s during the last 5m
  - alert: GitLabComLatencyAPI
    expr: type:rails_requests_completed_milliseconds:p95{environment="prd",type="api"}
      > 150
    for: 5m
    labels:
      severity: warn
    annotations:
      description: This might be causing a slowdown on the site and/or affecting users.
        Please check the Triage Dashboard in Grafana.
      title: API latency on GitLab.com has been over 150ms during the last 5m
