## RUNNERS CACHE
ALERT runners_cache_is_down
  IF probe_http_status_code{job="runners-cache-registry",instance=~"https://runners-cache.*minio.*"} != 200
  FOR 1m
  LABELS {severity="critical", channel="ci", pager="pagerduty"}
  ANNOTATIONS {
    title='Runners cache on {{ reReplaceAll "/minio/login" "" (reReplaceAll "https://" "" .Labels.instance) }} is down',
    runbook="troubleshooting/runners_cache_is_down.md",
    description="This impacts CI execution builds, consider tweeting: !tweet 'CI executions are being delayed due to our runners cache being down at GitLab.com, we are investigating the root cause'"
  }

## RUNNERS REGISTRY
ALERT runners_registry_is_down
  IF probe_http_status_code{job="runners-cache-registry",instance=~"https://runners-cache.*1443.*"} != 200
  FOR 1m
  LABELS {severity="critical", channel="ci", pager="pagerduty"}
  ANNOTATIONS {
    title='Runners registry on {{ reReplaceAll ":1443/v2" "" (reReplaceAll "https://" "" .Labels.instance) }} is down',
    runbook="troubleshooting/runners_registry_is_down.md",
    description="This impacts CI execution builds, consider tweeting: !tweet 'CI executions are being delayed due to our runners registry being down at GitLab.com, we are investigating the root cause'"
  }

## RUNNERS CACHE FREE DISK SPACE IS LESS THAN 7%
ALERT runners_cache_disk_space
  IF node_filesystem_avail{device="/dev/vda1",instance="runners-cache-1"} / node_filesystem_size{device="/dev/vda1",instance="runners-cache-1"} < 0.07
  FOR 1m
  LABELS {severity="critical", channel="infrastructure"}
  ANNOTATIONS {
    title = "There is less than 7% of free disk space left on runners cache",
    runbook = "troubleshooting/runners_cache_disk_space.md",
    description = "This could block CI execution when the runners can't pull new images. This can be a flapping alert, so just check first"
  }
