groups:
- name: redis-memory.rules
  rules:
  - alert: RedisMemoryUsageTooHigh
    expr: (avg(redis_memory_used_bytes{environment=~"gprd", type="redis"}) by (fqdn) / avg(node_memory_MemTotal_bytes{environment=~"gprd", type="redis"}) by (fqdn)) > 0.80
    for: 5m
    labels:
      pager: pagerduty
      severity: critical
    annotations:
      title: Redis memory usage is too high
      description: Redis node {{$labels.fqdn}} is using over 80% of the host memory for the last 5 minutes.
      runbook: howto/clear_anonymous_sessions.md
