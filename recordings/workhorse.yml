groups:
- name: GitLab Workhorse Git HTTP Session Count
  interval: 1m
  rules:
  - record: gitlab_workhorse_git_http_sessions_active:total
    labels:
      type: git
      tier: sv
    expr: >
      sum(avg_over_time(gitlab_workhorse_git_http_sessions_active{type="git", tier="sv"}[1m])) by (environment, stage, tier, type)

  - record: gitlab_workhorse_git_http_sessions_active:total:avg_over_time_1w
    labels:
      type: git
      tier: sv
    expr: >
      avg_over_time(gitlab_workhorse_git_http_sessions_active:total[1w])

  - record: gitlab_workhorse_git_http_sessions_active:total:stddev_over_time_1w
    labels:
      type: git
      tier: sv
    expr: >
      stddev_over_time(gitlab_workhorse_git_http_sessions_active:total[1w])
