
# Total redis operations by command.
cmd:redis_command_call_duration_seconds_count:irate1m = sum(irate(redis_command_call_duration_seconds_count[1m])) by (cmd, environment)

# Keyspace hits & misses percentage
redis:keyspace_hits:irate1m = irate(redis_keyspace_hits_total[1m])
redis:keyspace_misses:irate1m = irate(redis_keyspace_misses_total[1m])

# Networking rate
redis:net_input_bytes:irate1m = irate(redis_net_input_bytes_total[1m])
redis:net_output_bytes:irate1m = irate(redis_net_output_bytes_total[1m])

# DB Keys
redis:db_keys:irate1m = irate(redis_db_keys[1m])
redis:db_keys_expiring:irate1m = irate(redis_db_keys_expiring[1m])
redis:expired_keys:irate1m = irate(redis_expired_keys_total[1m])
redis:evicted_keys:irate1m = irate(redis_evicted_keys_total[1m])
redis:commands_processed:irate1m = irate(redis_commands_processed_total[1m])

# Connections
redis:connections_received:irate1m = irate(redis_connections_received_total[1m])

# The master has N-1 connected slaves (while the slaves have 0 slaves).
gitlab:redis_disconnected_slaves = count without(fqdn, instance, job) (redis_connected_slaves) - sum without(fqdn, instance, job) (redis_connected_slaves) - 1
gitlab:redis_master = redis_connected_slaves > 1

